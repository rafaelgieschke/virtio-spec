<a href="https://github.com/rafaelgieschke/virtio-spec/actions/runs/11494624098">Source: https://github.com/rafaelgieschke/virtio-spec/actions/runs/11494624098</a><br />
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head>
<title>Virtual I/O Device (VIRTIO) Version 1.3</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)"> 
<!-- info,charset=utf-8,fn-in,html --> 
<meta name="src" content="virtio-v1.3-csd01.tex"> 
<link rel="stylesheet" type="text/css" href="virtio-v1.3-csd01.css"> 
</head><body 
>
<!--l. 1--><p class="noindent" >
                                                                  

                                                                  
<!--l. 4--><p class="noindent" ><table style="border-collapse:collapse;"><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ><img 
src="images/oasis.png" alt="PIC"  
 >  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<!--l. 9--><p class="noindent" ><div style="color: #446CAA; font-size: 24pt;"> <span 
class="aeb10-">Virtual I/O Device (VIRTIO) Version 1.3 </span></div>
<!--l. 10--><p class="noindent" ><div style="color: #446CAA; font-size: 18pt;"> <span 
class="aeb10-">Committee Specification Draft 01 </span></div>
<!--l. 12--><p class="noindent" ><div style="color: #446CAA; font-size: 18pt;"> <span 
class="aeb10-">06 October 2023 </span></div>
<!--l. 14--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">This stage: </span></div> <div style="margin-left: 20px;">      <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/tex/" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/tex/</a>
(Authoritative)<br 
class="newline" />   <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/virtio-v1.3-csd01.pdf" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/virtio-v1.3-csd01.pdf</a><br 
class="newline" />   <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/virtio-v1.3-csd01.html" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/virtio-v1.3-csd01.html</a> </div>
<!--l. 20--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Previous stage: </span></div> <div style="margin-left: 20px;">  N/A  </div>
<!--l. 24--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Latest stage: </span></div> <div style="margin-left: 20px;">      <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/virtio-v1.3.pdf" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/virtio-v1.3.pdf</a><br 
class="newline" />   <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/virtio-v1.3.html" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/virtio-v1.3.html</a> </div>
<!--l. 29--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Technical Committee: </span></div> <div style="margin-left: 20px;">  <a 
href="https://www.oasis-open.org/committees/virtio/" >OASIS Virtual I/O Device (VIRTIO) TC</a>  </div>
<a 
 id="x1-1doc"></a>
<!--l. 34--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Chairs: </span></div> <div style="margin-left: 20px;">  Michael S. Tsirkin (<a 
href="mailto:mst@redhat.com" >mst@redhat.com</a>), <a 
href="https://www.redhat.com/" >Red Hat</a><br 
class="newline" />Cornelia Huck (<a 
href="mailto:cohuck@redhat.com" >cohuck@redhat.com</a>), <a 
href="https://www.redhat.com/" >Red Hat</a><br 
class="newline" /> </div>
<!--l. 39--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Editors: </span></div> <div style="margin-left: 20px;">  Michael S. Tsirkin (<a 
href="mailto:mst@redhat.com" >mst@redhat.com</a>), <a 
href="https://www.redhat.com/" >Red Hat</a><br 
class="newline" />Cornelia Huck (<a 
href="mailto:cohuck@redhat.com" >cohuck@redhat.com</a>), <a 
href="https://www.redhat.com/" >Red Hat</a><br 
class="newline" /> </div>
<!--l. 45--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Additional artifacts: </span></div> <div style="margin-left: 20px;">  This prose specification is one component of a Work Product
that also includes:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 48--><p class="noindent" >Example Driver Listing: <br 
class="newline" />    <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/listings/" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/listings/</a></li></ul>
                                                                  

                                                                  
</div>
<!--l. 54--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Related work: </span></div> <div style="margin-left: 20px;">  This specification replaces or supersedes:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 57--><p class="noindent" >Virtual I/O Device (VIRTIO) Version 1.2. Edited by Michael S. Tsirkin
     and Cornelia Huck. Latest stage:<br 
class="newline" />    <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.2/virtio-v1.2.html" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.2/virtio-v1.2.html</a>
     </li>
     <li class="itemize">
     <!--l. 59--><p class="noindent" >Virtual I/O Device (VIRTIO) Version 1.1. Edited by Michael S. Tsirkin
     and Cornelia Huck. Latest stage:<br 
class="newline" />    <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.1/virtio-v1.1.html" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.1/virtio-v1.1.html</a>
     </li>
     <li class="itemize">
     <!--l. 61--><p class="noindent" >Virtual  I/O  Device  (VIRTIO)  Version  1.0.  Edited  by  Rusty  Russell,
     Michael S. Tsirkin, Cornelia Huck, and Pawel Moll. Latest stage:<br 
class="newline" />    <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.0/virtio-v1.0.html" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.0/virtio-v1.0.html</a>
     </li>
     <li class="itemize">
     <!--l. 64--><p class="noindent" >Virtio PCI Card Specification Version 0.9.5:<br 
class="newline" />    <a 
href="http://ozlabs.org/~rusty/virtio-spec/virtio-0.9.5.pdf" class="url" >http://ozlabs.org/~rusty/virtio-spec/virtio-0.9.5.pdf</a></li></ul>
</div>
<!--l. 80--><p class="noindent" >
                                                                  

                                                                  
<!--l. 82--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Abstract: </span></div> <div style="margin-left: 20px;">  This document describes the specifications of the “virtio” family of
devices. These devices are found in virtual environments, yet by design they look like
physical devices to the guest within the virtual machine - and this document treats
them as such. This similarity allows the guest to use standard drivers and discovery
mechanisms.
<!--l. 8--><p class="noindent" >The purpose of virtio and this specification is that virtual environments and guests
should have a straightforward, efficient, standard and extensible mechanism for
virtual devices, rather than boutique per-environment or per-OS mechanisms.   </div>
<!--l. 86--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Status: </span></div> <div style="margin-left: 20px;">  This document was last revised or approved by the Virtual I/O
Device (VIRTIO) TC on the above date. The level of approval is also
listed above. Check the “Latest stage” location noted above for possible
later revisions of this document. Any other numbered Versions and other
technical work produced by the Technical Committee (TC) are listed at
<a 
href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=virtio#technical" class="url" >https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=virtio#technical</a>.
<!--l. 94--><p class="noindent" >Technical Committee members should send comments on this specification to the
Technical Committee’s email list. Others should send comments to the Technical
Committee by using the “<a 
href="https://www.oasis-open.org/committees/comments/form.php?wg_abbrev=virtio" >Send A Comment</a>” button on the Technical Committee’s
web page at     <a 
href="https://www.oasis-open.org/committees/virtio/" class="url" >https://www.oasis-open.org/committees/virtio/</a>.
<!--l. 1--><p class="noindent" >This specification is provided under the <a 
href="https://www.oasis-open.org/policies-guidelines/ipr/#Non-Assertion-Mode" >Non-Assertion</a> Mode of the <a 
href="https://www.oasis-open.org/policies-guidelines/ipr/" >OASIS IPR
Policy</a>, the mode chosen when the Technical Committee was established. For
information on whether any patents have been disclosed that may be essential to
implementing this specification, and any offers of patent licensing terms, please refer
to the Intellectual Property Rights page in the TC’s GitHub repository (
<a 
href="https://github.com/oasis-tcs/virtio-admin/blob/master/IPR.md" class="url" >https://github.com/oasis-tcs/virtio-admin/blob/master/IPR.md</a>).
<!--l. 103--><p class="noindent" >Note that any machine-readable content (<a 
href="https://www.oasis-open.org/policies-guidelines/tc-process-2017-05-26/#wpComponentsCompLang" >Computer Language Definitions</a>) declared
Normative for this Work Product is provided in separate plain text files. In the event
of a discrepancy between any such plain text file and display content in the Work
Product’s prose narrative document(s), the content in the separate plain text file
prevails.
</div>
<!--l. 114--><p class="noindent" ><div style="color: #446CAA; font-size: 10pt;"> <span 
class="aeb10-">Citation format: </span></div> <div style="margin-left: 20px;">  When referencing this specification the following citation format
should be used:<br 
class="newline" />
<!--l. 117--><p class="noindent" ><span 
class="aeb10-">[VIRTIO-v1.3]</span><br 
class="newline" /><span 
class="aeti-10">Virtual I/O Device (VIRTIO) Version 1.3</span>. Edited by Michael S. Tsirkin and
Cornelia Huck. 06 October 2023. OASIS Committee Specification Draft 01.
<a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/virtio-v1.3-csd01.html" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/virtio-v1.3-csd01.html</a>. Latest
stage:     <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/virtio-v1.3.html" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/virtio-v1.3.html</a>.  </div>
                                                                  

                                                                  
<!--l. 123--><p class="noindent" >
                                                                  

                                                                  
__________________________________________________________________
<!--l. 125--><p class="noindent" ><div style="color: #446CAA; font-size: 18pt;"> <span 
class="aeb10-">Notices </span></div>
<!--l. 127--><p class="noindent" >Copyright <span 
class="tcrm-1000">© </span>OASIS Open 2023. All Rights Reserved.
<!--l. 129--><p class="noindent" >All capitalized terms in the following text have the meanings assigned to them in the
OASIS Intellectual Property Rights Policy (the "OASIS IPR Policy"). The full <a 
href="https://www.oasis-open.org/policies-guidelines/ipr/" >Policy</a>
may be found at the OASIS website.
<!--l. 133--><p class="noindent" >This document and translations of it may be copied and furnished to others, and
derivative works that comment on or otherwise explain it or assist in its
implementation may be prepared, copied, published, and distributed, in whole or in
part, without restriction of any kind, provided that the above copyright notice and
this section are included on all such copies and derivative works. However, this
document itself may not be modified in any way, including by removing the copyright
notice or references to OASIS, except as needed for the purpose of developing any
document or deliverable produced by an OASIS Technical Committee (in which case
the rules applicable to copyrights, as set forth in the OASIS IPR Policy,
must be followed) or as required to translate it into languages other than
English.
<!--l. 146--><p class="noindent" >The limited permissions granted above are perpetual and will not be revoked by
OASIS or its successors or assigns.
<!--l. 149--><p class="noindent" >This document and the information contained herein is provided on an "AS IS" basis
and OASIS DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
THE INFORMATION HEREIN WILL NOT INFRINGE ANY OWNERSHIP
RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR
FITNESS FOR A PARTICULAR PURPOSE. OASIS AND ITS MEMBERS
WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR
CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THIS
DOCUMENT OR ANY PART THEREOF.
<!--l. 158--><p class="noindent" >As stated in the OASIS IPR Policy, the following three paragraphs in brackets apply
to OASIS Standards Final Deliverable documents (Committee Specifications, OASIS
Standards, or Approved Errata).
<!--l. 162--><p class="noindent" >[OASIS requests that any OASIS Party or any other party that believes it has patent
claims that would necessarily be infringed by implementations of this OASIS
Committee Specification or OASIS Standard, to notify OASIS TC Administrator and
provide an indication of its willingness to grant patent licenses to such patent claims
in a manner consistent with the IPR Mode of the OASIS Technical Committee that
produced this specification.]
<!--l. 170--><p class="noindent" >[OASIS invites any party to contact the OASIS TC Administrator if it is aware of a
claim of ownership of any patent claims that would necessarily be infringed by
implementations of this specification by a patent holder that is not willing to provide
                                                                  

                                                                  
a license to such patent claims in a manner consistent with the IPR Mode of
the OASIS Technical Committee that produced this specification. OASIS
may include such claims on its website, but disclaims any obligation to do
so.]
<!--l. 178--><p class="noindent" >[OASIS takes no position regarding the validity or scope of any intellectual property
or other rights that might be claimed to pertain to the implementation or use
of the technology described in this document or the extent to which any
license under such rights might or might not be available; neither does it
represent that it has made any effort to identify any such rights. Information on
OASIS’ procedures with respect to rights in any document or deliverable
produced by an OASIS Technical Committee can be found on the OASIS
website. Copies of claims of rights made available for publication and any
assurances of licenses to be made available, or the result of an attempt made to
obtain a general license or permission for the use of such proprietary rights by
implementers or users of this OASIS Committee Specification or OASIS
Standard, can be obtained from the OASIS TC Administrator. OASIS makes no
representation that any information or list of intellectual property rights will at
any time be complete, or that any claims in such list are, in fact, Essential
Claims.]
<!--l. 195--><p class="noindent" >The name "OASIS" is a trademark of <a 
href="https://www.oasis-open.org/" >OASIS</a>, the owner and developer of this
specification, and should be used only to refer to the organization and its official
outputs. OASIS welcomes reference to, and implementation and use of, specifications,
while reserving the right to enforce its marks against misleading uses. Please see
<a 
href="https://www.oasis-open.org/policies-guidelines/trademark/" class="url" >https://www.oasis-open.org/policies-guidelines/trademark/</a> for above guidance.
<br 
class="newline" /><br 
class="newline" />
                                                                  

                                                                  
                                                                  

                                                                  
<!--l. 24--><p class="noindent" >__________________________________________________________________
<h2 class="likechapterHead"><a 
 id="x1-1000"></a>Table of Contents</h2>
<div class="tableofcontents">
<span class="chapterToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">Introduction</a></span>
<br /> <span class="sectionToc" >1.1 <a 
href="#x1-30001" id="QQ2-1-3">Normative References</a></span>
<br /> <span class="sectionToc" >1.2 <a 
href="#x1-40002" id="QQ2-1-4">Non-Normative References</a></span>
<br /> <span class="sectionToc" >1.3 <a 
href="#x1-50003" id="QQ2-1-5">Terminology</a></span>
<br />  <span class="subsectionToc" >1.3.1 <a 
href="#x1-60001" id="QQ2-1-6">Legacy Interface: Terminology</a></span>
<br />  <span class="subsectionToc" >1.3.2 <a 
href="#x1-70002" id="QQ2-1-7">Transition from earlier specification drafts</a></span>
<br /> <span class="sectionToc" >1.4 <a 
href="#x1-80004" id="QQ2-1-8">Structure Specifications</a></span>
<br /> <span class="sectionToc" >1.5 <a 
href="#x1-90005" id="QQ2-1-9">Constant Specifications</a></span>
<br /><span class="chapterToc" >2 <a 
href="#x1-100002" id="QQ2-1-10">Basic Facilities of a Virtio Device</a></span>
<br /> <span class="sectionToc" >2.1 <a 
href="#x1-110001" id="QQ2-1-11"><span 
class="aeti-10">Device Status </span>Field</a></span>
<br />  <span class="subsectionToc" >2.1.1 <a 
href="#x1-120001" id="QQ2-1-12">Driver Requirements: Device Status Field</a></span>
<br />  <span class="subsectionToc" >2.1.2 <a 
href="#x1-130002" id="QQ2-1-13">Device Requirements: Device Status Field</a></span>
<br /> <span class="sectionToc" >2.2 <a 
href="#x1-140002" id="QQ2-1-14">Feature Bits</a></span>
<br />  <span class="subsectionToc" >2.2.1 <a 
href="#x1-150001" id="QQ2-1-15">Driver Requirements: Feature Bits</a></span>
<br />  <span class="subsectionToc" >2.2.2 <a 
href="#x1-160002" id="QQ2-1-16">Device Requirements: Feature Bits</a></span>
<br />  <span class="subsectionToc" >2.2.3 <a 
href="#x1-170003" id="QQ2-1-17">Legacy Interface: A Note on Feature Bits</a></span>
<br /> <span class="sectionToc" >2.3 <a 
href="#x1-180003" id="QQ2-1-18">Notifications</a></span>
<br /> <span class="sectionToc" >2.4 <a 
href="#x1-190004" id="QQ2-1-19">Device Reset</a></span>
<br />  <span class="subsectionToc" >2.4.1 <a 
href="#x1-200001" id="QQ2-1-20">Device Requirements: Device Reset</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >2.4.2 <a 
href="#x1-210002" id="QQ2-1-21">Driver Requirements: Device Reset</a></span>
<br /> <span class="sectionToc" >2.5 <a 
href="#x1-220005" id="QQ2-1-22">Device Configuration Space</a></span>
<br />  <span class="subsectionToc" >2.5.1 <a 
href="#x1-230001" id="QQ2-1-23">Driver Requirements: Device Configuration Space</a></span>
<br />  <span class="subsectionToc" >2.5.2 <a 
href="#x1-240002" id="QQ2-1-24">Device Requirements: Device Configuration Space</a></span>
<br />  <span class="subsectionToc" >2.5.3 <a 
href="#x1-250003" id="QQ2-1-25">Legacy Interface: A Note on Device Configuration Space endian-ness</a></span>
<br />  <span class="subsectionToc" >2.5.4 <a 
href="#x1-260004" id="QQ2-1-26">Legacy Interface: Device Configuration Space</a></span>
<br /> <span class="sectionToc" >2.6 <a 
href="#x1-270006" id="QQ2-1-27">Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.6.1 <a 
href="#x1-280001" id="QQ2-1-28">Virtqueue Reset</a></span>
<br /> <span class="sectionToc" >2.7 <a 
href="#x1-350007" id="QQ2-1-35">Split Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.7.1 <a 
href="#x1-360001" id="QQ2-1-36">Driver Requirements: Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.7.2 <a 
href="#x1-370002" id="QQ2-1-37">Legacy Interfaces: A Note on Virtqueue Layout</a></span>
<br />  <span class="subsectionToc" >2.7.3 <a 
href="#x1-380003" id="QQ2-1-38">Legacy Interfaces: A Note on Virtqueue Endianness</a></span>
<br />  <span class="subsectionToc" >2.7.4 <a 
href="#x1-390004" id="QQ2-1-39">Message Framing</a></span>
<br />  <span class="subsectionToc" >2.7.5 <a 
href="#x1-430005" id="QQ2-1-43">The Virtqueue Descriptor Table</a></span>
<br />  <span class="subsectionToc" >2.7.6 <a 
href="#x1-490006" id="QQ2-1-49">The Virtqueue Available Ring</a></span>
<br />  <span class="subsectionToc" >2.7.7 <a 
href="#x1-510007" id="QQ2-1-51">Used Buffer Notification Suppression</a></span>
<br />  <span class="subsectionToc" >2.7.8 <a 
href="#x1-540008" id="QQ2-1-54">The Virtqueue Used Ring</a></span>
<br />  <span class="subsectionToc" >2.7.9 <a 
href="#x1-580009" id="QQ2-1-58">In-order use of descriptors</a></span>
<br />  <span class="subsectionToc" >2.7.10 <a 
href="#x1-5900010" id="QQ2-1-59">Available Buffer Notification Suppression</a></span>
<br />  <span class="subsectionToc" >2.7.11 <a 
href="#x1-6200011" id="QQ2-1-62">Helpers for Operating Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.7.12 <a 
href="#x1-6300012" id="QQ2-1-63">Virtqueue Operation</a></span>
<br />  <span class="subsectionToc" >2.7.13 <a 
href="#x1-6400013" id="QQ2-1-64">Supplying Buffers to The Device</a></span>
<br />  <span class="subsectionToc" >2.7.14 <a 
href="#x1-7100014" id="QQ2-1-71">Receiving Used Buffers From The Device</a></span>
<br /> <span class="sectionToc" >2.8 <a 
href="#x1-720008" id="QQ2-1-72">Packed Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.8.1 <a 
href="#x1-730001" id="QQ2-1-73">Driver and Device Ring Wrap Counters</a></span>
<br />  <span class="subsectionToc" >2.8.2 <a 
href="#x1-740002" id="QQ2-1-74">Polling of available and used descriptors</a></span>
<br />  <span class="subsectionToc" >2.8.3 <a 
href="#x1-750003" id="QQ2-1-75">Write Flag</a></span>
<br />  <span class="subsectionToc" >2.8.4 <a 
href="#x1-760004" id="QQ2-1-76">Element Address and Length</a></span>
<br />  <span class="subsectionToc" >2.8.5 <a 
href="#x1-770005" id="QQ2-1-77">Scatter-Gather Support</a></span>
<br />  <span class="subsectionToc" >2.8.6 <a 
href="#x1-780006" id="QQ2-1-78">Next Flag: Descriptor Chaining</a></span>
<br />  <span class="subsectionToc" >2.8.7 <a 
href="#x1-790007" id="QQ2-1-79">Indirect Flag: Scatter-Gather Support</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >2.8.8 <a 
href="#x1-800008" id="QQ2-1-80">In-order use of descriptors</a></span>
<br />  <span class="subsectionToc" >2.8.9 <a 
href="#x1-810009" id="QQ2-1-81">Multi-buffer requests</a></span>
<br />  <span class="subsectionToc" >2.8.10 <a 
href="#x1-8200010" id="QQ2-1-82">Driver and Device Event Suppression</a></span>
<br />  <span class="subsectionToc" >2.8.11 <a 
href="#x1-8400011" id="QQ2-1-84">Driver Requirements: Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.8.12 <a 
href="#x1-8500012" id="QQ2-1-85">Device Requirements: Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.8.13 <a 
href="#x1-8600013" id="QQ2-1-86">The Virtqueue Descriptor Format</a></span>
<br />  <span class="subsectionToc" >2.8.14 <a 
href="#x1-8700014" id="QQ2-1-87">Event Suppression Structure Format</a></span>
<br />  <span class="subsectionToc" >2.8.15 <a 
href="#x1-8800015" id="QQ2-1-88">Device Requirements: The Virtqueue Descriptor Table</a></span>
<br />  <span class="subsectionToc" >2.8.16 <a 
href="#x1-8900016" id="QQ2-1-89">Driver Requirements: The Virtqueue Descriptor Table</a></span>
<br />  <span class="subsectionToc" >2.8.17 <a 
href="#x1-9000017" id="QQ2-1-90">Driver Requirements: Scatter-Gather Support</a></span>
<br />  <span class="subsectionToc" >2.8.18 <a 
href="#x1-9100018" id="QQ2-1-91">Device Requirements: Scatter-Gather Support</a></span>
<br />  <span class="subsectionToc" >2.8.19 <a 
href="#x1-9200019" id="QQ2-1-92">Driver Requirements: Indirect Descriptors</a></span>
<br />  <span class="subsectionToc" >2.8.20 <a 
href="#x1-9300020" id="QQ2-1-93">Virtqueue Operation</a></span>
<br />  <span class="subsectionToc" >2.8.21 <a 
href="#x1-9400021" id="QQ2-1-94">Supplying Buffers to The Device</a></span>
<br />  <span class="subsectionToc" >2.8.22 <a 
href="#x1-10000022" id="QQ2-1-100">Receiving Used Buffers From The Device</a></span>
<br /> <span class="sectionToc" >2.9 <a 
href="#x1-1010009" id="QQ2-1-101">Driver Notifications</a></span>
<br /> <span class="sectionToc" >2.10 <a 
href="#x1-10200010" id="QQ2-1-102">Shared Memory Regions</a></span>
<br />  <span class="subsectionToc" >2.10.1 <a 
href="#x1-1030001" id="QQ2-1-103">Addressing within regions</a></span>
<br />  <span class="subsectionToc" >2.10.2 <a 
href="#x1-1040002" id="QQ2-1-104">Device Requirements: Shared Memory Regions</a></span>
<br /> <span class="sectionToc" >2.11 <a 
href="#x1-10500011" id="QQ2-1-105">Exporting Objects</a></span>
<br /> <span class="sectionToc" >2.12 <a 
href="#x1-10600012" id="QQ2-1-106">Device groups</a></span>
<br />  <span class="subsectionToc" >2.12.1 <a 
href="#x1-1070001" id="QQ2-1-107">Group administration commands</a></span>
<br /> <span class="sectionToc" >2.13 <a 
href="#x1-14200013" id="QQ2-1-145">Administration Virtqueues</a></span>
<br />  <span class="subsectionToc" >2.13.1 <a 
href="#x1-1430001" id="QQ2-1-146">Device Requirements: Group administration commands</a></span>
<br />  <span class="subsectionToc" >2.13.2 <a 
href="#x1-1440002" id="QQ2-1-147">Driver Requirements: Group administration commands</a></span>
<br /> <span class="sectionToc" >2.14 <a 
href="#x1-14500014" id="QQ2-1-148">Device parts</a></span>
<br />  <span class="subsectionToc" >2.14.1 <a 
href="#x1-1460001" id="QQ2-1-149">Common device parts</a></span>
<br />  <span class="subsectionToc" >2.14.2 <a 
href="#x1-1530002" id="QQ2-1-157">Assumptions</a></span>
<br /><span class="chapterToc" >3 <a 
href="#x1-1540003" id="QQ2-1-158">General Initialization And Device Operation</a></span>
<br /> <span class="sectionToc" >3.1 <a 
href="#x1-1550001" id="QQ2-1-159">Device Initialization</a></span>
<br />  <span class="subsectionToc" >3.1.1 <a 
href="#x1-1560001" id="QQ2-1-160">Driver Requirements: Device Initialization</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >3.1.2 <a 
href="#x1-1570002" id="QQ2-1-161">Legacy Interface: Device Initialization</a></span>
<br /> <span class="sectionToc" >3.2 <a 
href="#x1-1580002" id="QQ2-1-162">Device Operation</a></span>
<br />  <span class="subsectionToc" >3.2.1 <a 
href="#x1-1590001" id="QQ2-1-163">Notification of Device Configuration Changes</a></span>
<br /> <span class="sectionToc" >3.3 <a 
href="#x1-1600003" id="QQ2-1-164">Device Cleanup</a></span>
<br />  <span class="subsectionToc" >3.3.1 <a 
href="#x1-1610001" id="QQ2-1-165">Driver Requirements: Device Cleanup</a></span>
<br /><span class="chapterToc" >4 <a 
href="#x1-1620004" id="QQ2-1-166">Virtio Transport Options</a></span>
<br /> <span class="sectionToc" >4.1 <a 
href="#x1-1630001" id="QQ2-1-167">Virtio Over PCI Bus</a></span>
<br />  <span class="subsectionToc" >4.1.1 <a 
href="#x1-1640001" id="QQ2-1-168">Device Requirements: Virtio Over PCI Bus</a></span>
<br />  <span class="subsectionToc" >4.1.2 <a 
href="#x1-1650002" id="QQ2-1-169">PCI Device Discovery</a></span>
<br />  <span class="subsectionToc" >4.1.3 <a 
href="#x1-1690003" id="QQ2-1-173">PCI Device Layout</a></span>
<br />  <span class="subsectionToc" >4.1.4 <a 
href="#x1-1720004" id="QQ2-1-176">Virtio Structure PCI Capabilities</a></span>
<br />  <span class="subsectionToc" >4.1.5 <a 
href="#x1-1960005" id="QQ2-1-200">PCI-specific Initialization And Device Operation</a></span>
<br /> <span class="sectionToc" >4.2 <a 
href="#x1-2130002" id="QQ2-1-218">Virtio Over MMIO</a></span>
<br />  <span class="subsectionToc" >4.2.1 <a 
href="#x1-2140001" id="QQ2-1-219">MMIO Device Discovery</a></span>
<br />  <span class="subsectionToc" >4.2.2 <a 
href="#x1-2150002" id="QQ2-1-220">MMIO Device Register Layout</a></span>
<br />  <span class="subsectionToc" >4.2.3 <a 
href="#x1-2180003" id="QQ2-1-225">MMIO-specific Initialization And Device Operation</a></span>
<br />  <span class="subsectionToc" >4.2.4 <a 
href="#x1-2250004" id="QQ2-1-233">Legacy interface</a></span>
<br />  <span class="subsectionToc" >4.2.5 <a 
href="#x1-2260005" id="QQ2-1-235">Features reserved for future use</a></span>
<br /> <span class="sectionToc" >4.3 <a 
href="#x1-2270003" id="QQ2-1-236">Virtio Over Channel I/O</a></span>
<br />  <span class="subsectionToc" >4.3.1 <a 
href="#x1-2280001" id="QQ2-1-237">Basic Concepts</a></span>
<br />  <span class="subsectionToc" >4.3.2 <a 
href="#x1-2330002" id="QQ2-1-242">Device Initialization</a></span>
<br />  <span class="subsectionToc" >4.3.3 <a 
href="#x1-2520003" id="QQ2-1-261">Device Operation</a></span>
<br />  <span class="subsectionToc" >4.3.4 <a 
href="#x1-2650004" id="QQ2-1-275">Features reserved for future use</a></span>
<br /><span class="chapterToc" >5 <a 
href="#x1-2660005" id="QQ2-1-276">Device Types</a></span>
<br /> <span class="sectionToc" >5.1 <a 
href="#x1-2670001" id="QQ2-1-277">Network Device</a></span>
<br />  <span class="subsectionToc" >5.1.1 <a 
href="#x1-2680001" id="QQ2-1-278">Device ID</a></span>
<br />  <span class="subsectionToc" >5.1.2 <a 
href="#x1-2690002" id="QQ2-1-279">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.1.3 <a 
href="#x1-2700003" id="QQ2-1-280">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.1.4 <a 
href="#x1-2730004" id="QQ2-1-283">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.1.5 <a 
href="#x1-2770005" id="QQ2-1-287">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.1.6 <a 
href="#x1-2780006" id="QQ2-1-288">Device and driver capabilities</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >5.1.7 <a 
href="#x1-2790007" id="QQ2-1-289">Device resource objects</a></span>
<br />  <span class="subsectionToc" >5.1.8 <a 
href="#x1-2800008" id="QQ2-1-290">Device Operation</a></span>
<br /> <span class="sectionToc" >5.2 <a 
href="#x1-3710002" id="QQ2-1-383">Block Device</a></span>
<br />  <span class="subsectionToc" >5.2.1 <a 
href="#x1-3720001" id="QQ2-1-384">Device ID</a></span>
<br />  <span class="subsectionToc" >5.2.2 <a 
href="#x1-3730002" id="QQ2-1-385">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.2.3 <a 
href="#x1-3740003" id="QQ2-1-386">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.2.4 <a 
href="#x1-3760004" id="QQ2-1-388">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.2.5 <a 
href="#x1-3780005" id="QQ2-1-390">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.2.6 <a 
href="#x1-3820006" id="QQ2-1-394">Device Operation</a></span>
<br /> <span class="sectionToc" >5.3 <a 
href="#x1-3870003" id="QQ2-1-399">Console Device</a></span>
<br />  <span class="subsectionToc" >5.3.1 <a 
href="#x1-3880001" id="QQ2-1-400">Device ID</a></span>
<br />  <span class="subsectionToc" >5.3.2 <a 
href="#x1-3890002" id="QQ2-1-401">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.3.3 <a 
href="#x1-3900003" id="QQ2-1-402">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.3.4 <a 
href="#x1-3910004" id="QQ2-1-403">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.3.5 <a 
href="#x1-3930005" id="QQ2-1-405">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.3.6 <a 
href="#x1-3950006" id="QQ2-1-407">Device Operation</a></span>
<br /> <span class="sectionToc" >5.4 <a 
href="#x1-4020004" id="QQ2-1-414">Entropy Device</a></span>
<br />  <span class="subsectionToc" >5.4.1 <a 
href="#x1-4030001" id="QQ2-1-415">Device ID</a></span>
<br />  <span class="subsectionToc" >5.4.2 <a 
href="#x1-4040002" id="QQ2-1-416">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.4.3 <a 
href="#x1-4050003" id="QQ2-1-417">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.4.4 <a 
href="#x1-4060004" id="QQ2-1-418">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.4.5 <a 
href="#x1-4070005" id="QQ2-1-419">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.4.6 <a 
href="#x1-4080006" id="QQ2-1-420">Device Operation</a></span>
<br /> <span class="sectionToc" >5.5 <a 
href="#x1-4110005" id="QQ2-1-423">Traditional Memory Balloon Device</a></span>
<br />  <span class="subsectionToc" >5.5.1 <a 
href="#x1-4120001" id="QQ2-1-424">Device ID</a></span>
<br />  <span class="subsectionToc" >5.5.2 <a 
href="#x1-4130002" id="QQ2-1-425">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.5.3 <a 
href="#x1-4140003" id="QQ2-1-426">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.5.4 <a 
href="#x1-4180004" id="QQ2-1-430">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.5.5 <a 
href="#x1-4200005" id="QQ2-1-432">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.5.6 <a 
href="#x1-4210006" id="QQ2-1-433">Device Operation</a></span>
<br /> <span class="sectionToc" >5.6 <a 
href="#x1-4400006" id="QQ2-1-452">SCSI Host Device</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >5.6.1 <a 
href="#x1-4410001" id="QQ2-1-453">Device ID</a></span>
<br />  <span class="subsectionToc" >5.6.2 <a 
href="#x1-4420002" id="QQ2-1-454">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.6.3 <a 
href="#x1-4430003" id="QQ2-1-455">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.6.4 <a 
href="#x1-4440004" id="QQ2-1-456">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.6.5 <a 
href="#x1-4480005" id="QQ2-1-460">Device Requirements: Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.6.6 <a 
href="#x1-4490006" id="QQ2-1-461">Device Operation</a></span>
<br /> <span class="sectionToc" >5.7 <a 
href="#x1-4620007" id="QQ2-1-474">GPU Device</a></span>
<br />  <span class="subsectionToc" >5.7.1 <a 
href="#x1-4630001" id="QQ2-1-475">Device ID</a></span>
<br />  <span class="subsectionToc" >5.7.2 <a 
href="#x1-4640002" id="QQ2-1-476">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.7.3 <a 
href="#x1-4650003" id="QQ2-1-477">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.7.4 <a 
href="#x1-4660004" id="QQ2-1-478">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.7.5 <a 
href="#x1-4690005" id="QQ2-1-481">Device Requirements: Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.7.6 <a 
href="#x1-4700006" id="QQ2-1-482">Device Operation</a></span>
<br />  <span class="subsectionToc" >5.7.7 <a 
href="#x1-4810007" id="QQ2-1-493">VGA Compatibility</a></span>
<br /> <span class="sectionToc" >5.8 <a 
href="#x1-4820008" id="QQ2-1-494">Input Device</a></span>
<br />  <span class="subsectionToc" >5.8.1 <a 
href="#x1-4830001" id="QQ2-1-495">Device ID</a></span>
<br />  <span class="subsectionToc" >5.8.2 <a 
href="#x1-4840002" id="QQ2-1-496">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.8.3 <a 
href="#x1-4850003" id="QQ2-1-497">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.8.4 <a 
href="#x1-4860004" id="QQ2-1-498">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.8.5 <a 
href="#x1-4870005" id="QQ2-1-499">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.8.6 <a 
href="#x1-4900006" id="QQ2-1-502">Device Operation</a></span>
<br /> <span class="sectionToc" >5.9 <a 
href="#x1-4930009" id="QQ2-1-505">Crypto Device</a></span>
<br />  <span class="subsectionToc" >5.9.1 <a 
href="#x1-4940001" id="QQ2-1-506">Device ID</a></span>
<br />  <span class="subsectionToc" >5.9.2 <a 
href="#x1-4950002" id="QQ2-1-507">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.9.3 <a 
href="#x1-4960003" id="QQ2-1-508">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.9.4 <a 
href="#x1-4980004" id="QQ2-1-510">Supported crypto services</a></span>
<br />  <span class="subsectionToc" >5.9.5 <a 
href="#x1-5040005" id="QQ2-1-516">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.9.6 <a 
href="#x1-5070006" id="QQ2-1-519">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.9.7 <a 
href="#x1-5090007" id="QQ2-1-521">Device Operation</a></span>
<br /> <span class="sectionToc" >5.10 <a 
href="#x1-53800010" id="QQ2-1-550">Socket Device</a></span>
<br />  <span class="subsectionToc" >5.10.1 <a 
href="#x1-5390001" id="QQ2-1-551">Device ID</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >5.10.2 <a 
href="#x1-5400002" id="QQ2-1-552">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.10.3 <a 
href="#x1-5410003" id="QQ2-1-553">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.10.4 <a 
href="#x1-5440004" id="QQ2-1-556">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.10.5 <a 
href="#x1-5450005" id="QQ2-1-557">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.10.6 <a 
href="#x1-5460006" id="QQ2-1-558">Device Operation</a></span>
<br /> <span class="sectionToc" >5.11 <a 
href="#x1-56200011" id="QQ2-1-574">File System Device</a></span>
<br />  <span class="subsectionToc" >5.11.1 <a 
href="#x1-5630001" id="QQ2-1-575">Device ID</a></span>
<br />  <span class="subsectionToc" >5.11.2 <a 
href="#x1-5640002" id="QQ2-1-576">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.11.3 <a 
href="#x1-5650003" id="QQ2-1-577">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.11.4 <a 
href="#x1-5660004" id="QQ2-1-578">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.11.5 <a 
href="#x1-5690005" id="QQ2-1-581">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.11.6 <a 
href="#x1-5700006" id="QQ2-1-582">Device Operation</a></span>
<br /> <span class="sectionToc" >5.12 <a 
href="#x1-58200012" id="QQ2-1-594">RPMB Device</a></span>
<br />  <span class="subsectionToc" >5.12.1 <a 
href="#x1-5830001" id="QQ2-1-595">Device ID</a></span>
<br />  <span class="subsectionToc" >5.12.2 <a 
href="#x1-5840002" id="QQ2-1-596">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.12.3 <a 
href="#x1-5850003" id="QQ2-1-597">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.12.4 <a 
href="#x1-5860004" id="QQ2-1-598">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.12.5 <a 
href="#x1-5870005" id="QQ2-1-599">Device Requirements: Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.12.6 <a 
href="#x1-5880006" id="QQ2-1-600">Device Operation</a></span>
<br /> <span class="sectionToc" >5.13 <a 
href="#x1-59700013" id="QQ2-1-609">IOMMU device</a></span>
<br />  <span class="subsectionToc" >5.13.1 <a 
href="#x1-5980001" id="QQ2-1-610">Device ID</a></span>
<br />  <span class="subsectionToc" >5.13.2 <a 
href="#x1-5990002" id="QQ2-1-611">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.13.3 <a 
href="#x1-6000003" id="QQ2-1-612">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.13.4 <a 
href="#x1-6030004" id="QQ2-1-615">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.13.5 <a 
href="#x1-6060005" id="QQ2-1-618">Device initialization</a></span>
<br />  <span class="subsectionToc" >5.13.6 <a 
href="#x1-6080006" id="QQ2-1-620">Device operations</a></span>
<br /> <span class="sectionToc" >5.14 <a 
href="#x1-63300014" id="QQ2-1-645">Sound Device</a></span>
<br />  <span class="subsectionToc" >5.14.1 <a 
href="#x1-6340001" id="QQ2-1-646">Device ID</a></span>
<br />  <span class="subsectionToc" >5.14.2 <a 
href="#x1-6350002" id="QQ2-1-647">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.14.3 <a 
href="#x1-6360003" id="QQ2-1-648">Feature Bits</a></span>
<br />  <span class="subsectionToc" >5.14.4 <a 
href="#x1-6370004" id="QQ2-1-649">Device Configuration Layout</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >5.14.5 <a 
href="#x1-6380005" id="QQ2-1-650">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.14.6 <a 
href="#x1-6400006" id="QQ2-1-652">Device Operation</a></span>
<br /> <span class="sectionToc" >5.15 <a 
href="#x1-68200015" id="QQ2-1-694">Memory Device</a></span>
<br />  <span class="subsectionToc" >5.15.1 <a 
href="#x1-6830001" id="QQ2-1-695">Device ID</a></span>
<br />  <span class="subsectionToc" >5.15.2 <a 
href="#x1-6840002" id="QQ2-1-696">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.15.3 <a 
href="#x1-6850003" id="QQ2-1-697">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.15.4 <a 
href="#x1-6860004" id="QQ2-1-698">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.15.5 <a 
href="#x1-6890005" id="QQ2-1-701">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.15.6 <a 
href="#x1-6920006" id="QQ2-1-704">Device Operation</a></span>
<br /> <span class="sectionToc" >5.16 <a 
href="#x1-70700016" id="QQ2-1-719">I2C Adapter Device</a></span>
<br />  <span class="subsectionToc" >5.16.1 <a 
href="#x1-7080001" id="QQ2-1-720">Device ID</a></span>
<br />  <span class="subsectionToc" >5.16.2 <a 
href="#x1-7090002" id="QQ2-1-721">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.16.3 <a 
href="#x1-7100003" id="QQ2-1-722">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.16.4 <a 
href="#x1-7110004" id="QQ2-1-723">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.16.5 <a 
href="#x1-7120005" id="QQ2-1-724">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.16.6 <a 
href="#x1-7130006" id="QQ2-1-725">Device Operation</a></span>
<br /> <span class="sectionToc" >5.17 <a 
href="#x1-71800017" id="QQ2-1-730">SCMI Device</a></span>
<br />  <span class="subsectionToc" >5.17.1 <a 
href="#x1-7190001" id="QQ2-1-731">Device ID</a></span>
<br />  <span class="subsectionToc" >5.17.2 <a 
href="#x1-7200002" id="QQ2-1-732">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.17.3 <a 
href="#x1-7210003" id="QQ2-1-733">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.17.4 <a 
href="#x1-7230004" id="QQ2-1-735">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.17.5 <a 
href="#x1-7240005" id="QQ2-1-736">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.17.6 <a 
href="#x1-7250006" id="QQ2-1-737">Device Operation</a></span>
<br /> <span class="sectionToc" >5.18 <a 
href="#x1-73500018" id="QQ2-1-747">GPIO Device</a></span>
<br />  <span class="subsectionToc" >5.18.1 <a 
href="#x1-7360001" id="QQ2-1-748">Device ID</a></span>
<br />  <span class="subsectionToc" >5.18.2 <a 
href="#x1-7370002" id="QQ2-1-749">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.18.3 <a 
href="#x1-7380003" id="QQ2-1-750">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.18.4 <a 
href="#x1-7390004" id="QQ2-1-751">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.18.5 <a 
href="#x1-7400005" id="QQ2-1-752">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.18.6 <a 
href="#x1-7410006" id="QQ2-1-753">Device Operation: requestq</a></span>
<br />  <span class="subsectionToc" >5.18.7 <a 
href="#x1-7510007" id="QQ2-1-763">Device Operation: eventq</a></span>
                                                                  

                                                                  
<br /> <span class="sectionToc" >5.19 <a 
href="#x1-75500019" id="QQ2-1-767">PMEM Device</a></span>
<br />  <span class="subsectionToc" >5.19.1 <a 
href="#x1-7560001" id="QQ2-1-768">Device ID</a></span>
<br />  <span class="subsectionToc" >5.19.2 <a 
href="#x1-7570002" id="QQ2-1-769">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.19.3 <a 
href="#x1-7580003" id="QQ2-1-770">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.19.4 <a 
href="#x1-7590004" id="QQ2-1-771">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.19.5 <a 
href="#x1-7600005" id="QQ2-1-772">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.19.6 <a 
href="#x1-7630006" id="QQ2-1-775">Driver Operations</a></span>
<br />  <span class="subsectionToc" >5.19.7 <a 
href="#x1-7640007" id="QQ2-1-776">Device Operations</a></span>
<br />  <span class="subsectionToc" >5.19.8 <a 
href="#x1-7680008" id="QQ2-1-780">Possible security implications</a></span>
<br />  <span class="subsectionToc" >5.19.9 <a 
href="#x1-7690009" id="QQ2-1-781">Countermeasures</a></span>
<br /> <span class="sectionToc" >5.20 <a 
href="#x1-77400020" id="QQ2-1-786">CAN Device</a></span>
<br />  <span class="subsectionToc" >5.20.1 <a 
href="#x1-7750001" id="QQ2-1-787">Device ID</a></span>
<br />  <span class="subsectionToc" >5.20.2 <a 
href="#x1-7760002" id="QQ2-1-788">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.20.3 <a 
href="#x1-7770003" id="QQ2-1-789">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.20.4 <a 
href="#x1-7790004" id="QQ2-1-791">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.20.5 <a 
href="#x1-7810005" id="QQ2-1-793">Device Operation</a></span>
<br /> <span class="sectionToc" >5.21 <a 
href="#x1-78600021" id="QQ2-1-798">SPI Controller Device</a></span>
<br />  <span class="subsectionToc" >5.21.1 <a 
href="#x1-7870001" id="QQ2-1-799">Device ID</a></span>
<br />  <span class="subsectionToc" >5.21.2 <a 
href="#x1-7880002" id="QQ2-1-800">Virtqueues</a></span>
<br />  <span class="subsectionToc" >5.21.3 <a 
href="#x1-7890003" id="QQ2-1-801">Feature bits</a></span>
<br />  <span class="subsectionToc" >5.21.4 <a 
href="#x1-7900004" id="QQ2-1-802">Device configuration layout</a></span>
<br />  <span class="subsectionToc" >5.21.5 <a 
href="#x1-7910005" id="QQ2-1-803">Device Initialization</a></span>
<br />  <span class="subsectionToc" >5.21.6 <a 
href="#x1-7920006" id="QQ2-1-804">Device Operation</a></span>
<br /><span class="chapterToc" >6 <a 
href="#x1-7970006" id="QQ2-1-809">Reserved Feature Bits</a></span>
<br /> <span class="sectionToc" >6.1 <a 
href="#x1-7980001" id="QQ2-1-810">Driver Requirements: Reserved Feature Bits</a></span>
<br /> <span class="sectionToc" >6.2 <a 
href="#x1-7990002" id="QQ2-1-811">Device Requirements: Reserved Feature Bits</a></span>
<br /> <span class="sectionToc" >6.3 <a 
href="#x1-8000003" id="QQ2-1-812">Legacy Interface: Reserved Feature Bits</a></span>
<br /><span class="chapterToc" >7 <a 
href="#x1-8010007" id="QQ2-1-813">Conformance</a></span>
<br /> <span class="sectionToc" >7.1 <a 
href="#x1-8020001" id="QQ2-1-814">Conformance Targets</a></span>
<br /> <span class="sectionToc" >7.2 <a 
href="#x1-8030002" id="QQ2-1-815">Clause 1: Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.1 <a 
href="#x1-8040001" id="QQ2-1-816">Clause 2: PCI Driver Conformance</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >7.2.2 <a 
href="#x1-8050002" id="QQ2-1-817">Clause 3: MMIO Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.3 <a 
href="#x1-8060003" id="QQ2-1-818">Clause 4: Channel I/O Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.4 <a 
href="#x1-8070004" id="QQ2-1-819">Clause 5: Network Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.5 <a 
href="#x1-8080005" id="QQ2-1-820">Clause 6: Block Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.6 <a 
href="#x1-8090006" id="QQ2-1-821">Clause 7: Console Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.7 <a 
href="#x1-8100007" id="QQ2-1-822">Clause 8: Entropy Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.8 <a 
href="#x1-8110008" id="QQ2-1-823">Clause 9: Traditional Memory Balloon Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.9 <a 
href="#x1-8120009" id="QQ2-1-824">Clause 10: SCSI Host Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.10 <a 
href="#x1-81300010" id="QQ2-1-825">Clause 11: Input Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.11 <a 
href="#x1-81400011" id="QQ2-1-826">Clause 12: Crypto Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.12 <a 
href="#x1-81500012" id="QQ2-1-827">Clause 13: Socket Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.13 <a 
href="#x1-81600013" id="QQ2-1-828">Clause 14: File System Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.14 <a 
href="#x1-81700014" id="QQ2-1-829">Clause 15: RPMB Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.15 <a 
href="#x1-81800015" id="QQ2-1-830">Clause 16: IOMMU Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.16 <a 
href="#x1-81900016" id="QQ2-1-831">Clause 17: Sound Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.17 <a 
href="#x1-82000017" id="QQ2-1-832">Clause 18: Memory Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.18 <a 
href="#x1-82100018" id="QQ2-1-833">Clause 19: I2C Adapter Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.19 <a 
href="#x1-82200019" id="QQ2-1-834">Clause 20: SCMI Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.20 <a 
href="#x1-82300020" id="QQ2-1-835">Clause 21: GPIO Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.21 <a 
href="#x1-82400021" id="QQ2-1-836">Clause 22: PMEM Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.22 <a 
href="#x1-82500022" id="QQ2-1-837">Clause 23: CAN Driver Conformance</a></span>
<br />  <span class="subsectionToc" >7.2.23 <a 
href="#x1-82600023" id="QQ2-1-838">Clause 24: SPI Controller Driver Conformance</a></span>
<br /> <span class="sectionToc" >7.3 <a 
href="#x1-8270003" id="QQ2-1-839">Clause 25: Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.1 <a 
href="#x1-8280001" id="QQ2-1-840">Clause 26: PCI Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.2 <a 
href="#x1-8290002" id="QQ2-1-841">Clause 27: MMIO Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.3 <a 
href="#x1-8300003" id="QQ2-1-842">Clause 28: Channel I/O Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.4 <a 
href="#x1-8310004" id="QQ2-1-843">Clause 29: Network Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.5 <a 
href="#x1-8320005" id="QQ2-1-844">Clause 30: Block Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.6 <a 
href="#x1-8330006" id="QQ2-1-845">Clause 31: Console Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.7 <a 
href="#x1-8340007" id="QQ2-1-846">Clause 32: Entropy Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.8 <a 
href="#x1-8350008" id="QQ2-1-847">Clause 33: Traditional Memory Balloon Device Conformance</a></span>
                                                                  

                                                                  
<br />  <span class="subsectionToc" >7.3.9 <a 
href="#x1-8360009" id="QQ2-1-848">Clause 34: SCSI Host Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.10 <a 
href="#x1-83700010" id="QQ2-1-849">Clause 35: GPU Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.11 <a 
href="#x1-83800011" id="QQ2-1-850">Clause 36: Input Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.12 <a 
href="#x1-83900012" id="QQ2-1-851">Clause 37: Crypto Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.13 <a 
href="#x1-84000013" id="QQ2-1-852">Clause 38: Socket Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.14 <a 
href="#x1-84100014" id="QQ2-1-853">Clause 39: File System Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.15 <a 
href="#x1-84200015" id="QQ2-1-854">Clause 40: RPMB Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.16 <a 
href="#x1-84300016" id="QQ2-1-855">Clause 41: IOMMU Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.17 <a 
href="#x1-84400017" id="QQ2-1-856">Clause 42: Sound Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.18 <a 
href="#x1-84500018" id="QQ2-1-857">Clause 43: Memory Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.19 <a 
href="#x1-84600019" id="QQ2-1-858">Clause 44: I2C Adapter Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.20 <a 
href="#x1-84700020" id="QQ2-1-859">Clause 45: SCMI Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.21 <a 
href="#x1-84800021" id="QQ2-1-860">Clause 46: GPIO Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.22 <a 
href="#x1-84900022" id="QQ2-1-861">Clause 47: PMEM Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.23 <a 
href="#x1-85000023" id="QQ2-1-862">Clause 48: CAN Device Conformance</a></span>
<br />  <span class="subsectionToc" >7.3.24 <a 
href="#x1-85100024" id="QQ2-1-863">Clause 49: SPI Controller Device Conformance</a></span>
<br /> <span class="sectionToc" >7.4 <a 
href="#x1-8520004" id="QQ2-1-864">Clause 50: Legacy Interface: Transitional Device and Transitional Driver Conformance</a></span>
<br /><span class="appendixToc" >A <a 
href="#x1-853000A" id="QQ2-1-865">virtio_queue.h</a></span>
<br /><span class="appendixToc" >B <a 
href="#x1-854000B" id="QQ2-1-867">Creating New Device Types</a></span>
<br /> <span class="sectionToc" >B.1 <a 
href="#x1-8550001" id="QQ2-1-868">How Many Virtqueues?</a></span>
<br /> <span class="sectionToc" >B.2 <a 
href="#x1-8560002" id="QQ2-1-869">What Device Configuration Space Layout?</a></span>
<br /> <span class="sectionToc" >B.3 <a 
href="#x1-8570003" id="QQ2-1-870">What Device Number?</a></span>
<br /> <span class="sectionToc" >B.4 <a 
href="#x1-8580004" id="QQ2-1-871">How many MSI-X vectors? (for PCI)</a></span>
<br /> <span class="sectionToc" >B.5 <a 
href="#x1-8590005" id="QQ2-1-872">Device Improvements</a></span>
<br /> <span class="sectionToc" >B.6 <a 
href="#x1-8600006" id="QQ2-1-873">How to define a new device part?</a></span>
<br /> <span class="sectionToc" >B.7 <a 
href="#x1-8610007" id="QQ2-1-874">When to define a new device part?</a></span>
<br /> <span class="sectionToc" >B.8 <a 
href="#x1-8620008" id="QQ2-1-875">How to avoid device part duplication with existing structure?</a></span>
<br /> <span class="sectionToc" >B.9 <a 
href="#x1-8630009" id="QQ2-1-876">How to extend the existing device part definition?</a></span>
<br /><span class="appendixToc" >C <a 
href="#x1-864000C" id="QQ2-1-877">Creating New Transports</a></span>
<br /><span class="appendixToc" >D <a 
href="#x1-865000D" id="QQ2-1-878">Acknowledgements</a></span>
<br /><span class="appendixToc" >E <a 
href="#x1-870000E" id="QQ2-1-883">Revision History</a></span>
                                                                  

                                                                  
</div>
                                                                  

                                                                  
                                                                  

                                                                  
<!--l. 1--><p class="noindent" ><h2 class="chapterHead"><hr><span class="titlemark">1</span> <a 
 id="x1-20001"></a>Introduction</h2>
This document describes the specifications of the “virtio” family of devices. These
devices are found in virtual environments, yet by design they look like physical
devices to the guest within the virtual machine - and this document treats them as
such. This similarity allows the guest to use standard drivers and discovery
mechanisms.
<!--l. 8--><p class="noindent" >The purpose of virtio and this specification is that virtual environments
and guests should have a straightforward, efficient, standard and extensible
mechanism for virtual devices, rather than boutique per-environment or per-OS
mechanisms.
     <dl class="description"><dt class="description">
     <!--l. 6--><p class="noindent" >
<span 
class="aeb10-">Straightforward:</span> </dt><dd 
class="description">
     <!--l. 6--><p class="noindent" >Virtio devices use normal bus mechanisms of interrupts and DMA which
     should be familiar to any device driver author. There is no exotic page-flipping
     or COW mechanism: it’s just a normal device.<span class="footnote-mark"><a 
href="#fn1x1" id="fn1x1-bk"><sup class="textsuperscript">1</sup></a></span><a 
 id="x1-2001f1"></a>
     </dd><dt class="description">
     <!--l. 15--><p class="noindent" >
<span 
class="aeb10-">Efficient:</span> </dt><dd 
class="description">
     <!--l. 15--><p class="noindent" >Virtio devices consist of rings of descriptors for both input and output,
     which are neatly laid out to avoid cache effects from both driver and device
     writing to the same cache lines.
     </dd><dt class="description">
     <!--l. 20--><p class="noindent" >
<span 
class="aeb10-">Standard:</span> </dt><dd 
class="description">
     <!--l. 20--><p class="noindent" >Virtio makes no assumptions about the environment in which it operates,
     beyond supporting the bus to which device is attached. In this specification,
     virtio devices are implemented over MMIO, Channel I/O and PCI bus
     transports <span class="footnote-mark"><a 
href="#fn2x1" id="fn2x1-bk"><sup class="textsuperscript">2</sup></a></span><a 
 id="x1-2002f2"></a>,
     earlier drafts have been implemented on other buses not included here.
     </dd><dt class="description">
     <!--l. 30--><p class="noindent" >
<span 
class="aeb10-">Extensible:</span> </dt><dd 
class="description">
     <!--l. 30--><p class="noindent" >Virtio devices contain feature bits which are acknowledged by the guest
     operating system during device setup. This allows forwards and backwards
     compatibility: the device offers all the features it knows about, and the
     driver acknowledges those it understands and wishes to use.</dd></dl>
<a 
 id="x1-2003r1"></a>
                                                                  

                                                                  
<h3 class="sectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-30001"></a>Normative References</h3>
<a 
 id="x1-3001r1"></a><!--l. 40--><div class="longtable"> <table id="TBL-2" class="longtable" 
 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1"><col 
id="TBL-2-2"></colgroup>
<tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-1"  
class="td11"> <a 
 id="likesection.1"></a><a 
 id="x1-3002x1"></a><span 
class="aeb10-">[RFC2119]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-1-2"  
class="td11">
 <!--l. 41--><p class="noindent" >Bradner S., “Key words for use in RFCs to Indicate Requirement Levels”, BCP 14,
  RFC 2119, March 1997. <br 
class="newline" />    <a 
href="http://www.ietf.org/rfc/rfc2119.txt" class="url" >http://www.ietf.org/rfc/rfc2119.txt</a>                                                            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-1"  
class="td11"> <a 
 id="likesection.2"></a><a 
 id="x1-3003x2"></a><span 
class="aeb10-">[RFC4122]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-2-2"  
class="td11">
 <!--l. 44--><p class="noindent" >Leach, P., Mealling, M., and R. Salz, “A Universally Unique IDentifier (UUID) URN
  Namespace”, RFC 4122, DOI 10.17487/RFC4122, July 2005. <br 
class="newline" />    <a 
href="http://www.ietf.org/rfc/rfc4122.txt" class="url" >http://www.ietf.org/rfc/rfc4122.txt</a>                                                            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-3-1"  
class="td11"> <a 
 id="likesection.3"></a><a 
 id="x1-3004x3"></a><span 
class="aeb10-">[S390 PoP]                      </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-3-2"  
class="td11">
 <!--l. 47--><p class="noindent" >z/Architecture Principles of Operation, IBM Publication SA22-7832, <br 
class="newline" />   <a 
href="https://www.ibm.com/docs/en/SSQ2R2_15.0.0/com.ibm.tpf.toolkit.hlasm.doc/dz9zr006.pdf" class="url" >https://www.ibm.com/docs/en/SSQ2R2_15.0.0/com.ibm.tpf.toolkit.hlasm.doc/dz9zr006.pdf</a>,
  and any future revisions                                                                               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-4-1"  
class="td11"> <a 
 id="likesection.4"></a><a 
 id="x1-3005x4"></a><span 
class="aeb10-">[S390 Common I/O]          </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-4-2"  
class="td11">
 <!--l. 49--><p class="noindent" >ESA/390 Common I/O-Device and Self-Description, IBM Publication SA22-7204,
  <br 
class="newline" />   <a 
href="https://www.ibm.com/resources/publications/OutputPubsDetails?PubID=SA22720401" class="url" >https://www.ibm.com/resources/publications/OutputPubsDetails?PubID=SA22720401</a>,
  and any future revisions                                                                               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-5-1"  
class="td11"> <a 
 id="likesection.5"></a><a 
 id="x1-3006x5"></a><span 
class="aeb10-">[PCI]                              </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-5-2"  
class="td11">
 <!--l. 51--><p class="noindent" >Conventional PCI Specifications, <br 
class="newline" />    <a 
href="http://www.pcisig.com/specifications/conventional/" class="url" >http://www.pcisig.com/specifications/conventional/</a>, PCI-SIG                         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-6-1"  
class="td11"> <a 
 id="likesection.6"></a><a 
 id="x1-3007x6"></a><span 
class="aeb10-">[PCIe]                            </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-6-2"  
class="td11">
 <!--l. 55--><p class="noindent" >PCI Express Specifications <br 
class="newline" />    <a 
href="http://www.pcisig.com/specifications/pciexpress/" class="url" >http://www.pcisig.com/specifications/pciexpress/</a>, PCI-SIG                            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-7-1"  
class="td11"> <a 
 id="likesection.7"></a><a 
 id="x1-3008x7"></a><span 
class="aeb10-">[IEEE 802]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-7-2"  
class="td11">
 <!--l. 59--><p class="noindent" >IEEE  Standard  for  Local  and  Metropolitan  Area  Networks:  Overview  and
  Architecture, <br 
class="newline" />    <a 
href="http://www.ieee802.org/" class="url" >http://www.ieee802.org/</a>, IEEE                                                                 </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-8-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-8-1"  
class="td11"> <a 
 id="likesection.8"></a><a 
 id="x1-3009x8"></a><span 
class="aeb10-">[IEEE 802.3-2022]             </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-8-2"  
class="td11">
 <!--l. 63--><p class="noindent" >IEEE Standard for Ethernet, <br 
class="newline" />    <a 
href="https://doi.org/10.1109/IEEESTD.2022.9844436" class="url" >https://doi.org/10.1109/IEEESTD.2022.9844436</a>, IEEE 802.3-2022                  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-9-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-9-1"  
class="td11"> <a 
 id="likesection.9"></a><a 
 id="x1-3010x9"></a><span 
class="aeb10-">[IEEE 802 Ethertypes]       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-9-2"  
class="td11">
 <!--l. 67--><p class="noindent" >IEEE 802 Ethertypes, <br 
class="newline" />      <a 
href="https://www.iana.org/assignments/ieee-802-numbers/ieee-802-numbers.xhtml" class="url" >https://www.iana.org/assignments/ieee-802-numbers/ieee-802-numbers.xhtml</a>,
  IANA                                                                                                      </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-10-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-10-1"  
class="td11"> <a 
 id="likesection.10"></a><a 
 id="x1-3011x10"></a><span 
class="aeb10-">[IANA Protocol Numbers]  </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-10-2"  
class="td11">
 <!--l. 71--><p class="noindent" >IANA Protocol Numbers, <br 
class="newline" />    <a 
href="https://www.iana.org/assignments/protocol-numbers" class="url" >https://www.iana.org/assignments/protocol-numbers</a>, IANA                           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-11-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-11-1"  
class="td11"> <a 
 id="likesection.11"></a><a 
 id="x1-3012x11"></a><span 
class="aeb10-">[SAM]                            </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-11-2"  
class="td11">
 <!--l. 75--><p class="noindent" >SCSI Architectural Model, <br 
class="newline" />    <a 
href="http://www.t10.org/cgi-bin/ac.pl?t=f&f=sam4r05.pdf" class="url" >http://www.t10.org/cgi-bin/ac.pl?t=f&f=sam4r05.pdf</a>                                   </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-12-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-12-1"  
class="td11"> <a 
 id="likesection.12"></a><a 
 id="x1-3013x12"></a><span 
class="aeb10-">[SCSI MMC]                    </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-12-2"  
class="td11">
 <!--l. 78--><p class="noindent" >SCSI Multimedia Commands, <br 
class="newline" />    <a 
href="http://www.t10.org/cgi-bin/ac.pl?t=f&f=mmc6r00.pdf" class="url" >http://www.t10.org/cgi-bin/ac.pl?t=f&f=mmc6r00.pdf</a>                                  </td>
                                                                  

                                                                  
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-13-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-13-1"  
class="td11"> <a 
 id="likesection.13"></a><a 
 id="x1-3014x13"></a><span 
class="aeb10-">[FUSE]                           </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-13-2"  
class="td11">
 <!--l. 81--><p class="noindent" >Linux FUSE interface, <br 
class="newline" />   <a 
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/fuse.h" class="url" >https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/fuse.h</a> </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-14-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-14-1"  
class="td11"> <a 
 id="likesection.14"></a><a 
 id="x1-3015x14"></a><span 
class="aeb10-">[errno]                            </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-14-2"  
class="td11">
 <!--l. 84--><p class="noindent" >Linux error names and numbers, <br 
class="newline" />   <a 
href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/asm-generic/errno-base.h" class="url" >https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/asm-generic/errno-base.h</a> </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-15-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-15-1"  
class="td11"> <a 
 id="likesection.15"></a><a 
 id="x1-3016x15"></a><span 
class="aeb10-">[eMMC]                          </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-15-2"  
class="td11">
 <!--l. 87--><p class="noindent" >eMMC Electrical Standard (5.1), JESD84-B51, <br 
class="newline" />    <a 
href="http://www.jedec.org/sites/default/files/docs/JESD84-B51.pdf" class="url" >http://www.jedec.org/sites/default/files/docs/JESD84-B51.pdf</a>                       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-16-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-16-1"  
class="td11"> <a 
 id="likesection.16"></a><a 
 id="x1-3017x16"></a><span 
class="aeb10-">[HDA]                            </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-16-2"  
class="td11">
 <!--l. 90--><p class="noindent" >High Definition Audio Specification, <br 
class="newline" />   <a 
href="https://www.intel.com/content/dam/www/public/us/en/documents/product-specifications/high-definition-audio-specification.pdf" class="url" >https://www.intel.com/content/dam/www/public/us/en/documents/product-specifications/high-definition-audio-specification.pdf</a> </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-17-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-17-1"  
class="td11"> <a 
 id="likesection.17"></a><a 
 id="x1-3018x17"></a><span 
class="aeb10-">[I2C]                              </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-17-2"  
class="td11">
 <!--l. 93--><p class="noindent" >I2C-bus specification and user manual, <br 
class="newline" />    <a 
href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf" class="url" >https://www.nxp.com/docs/en/user-guide/UM10204.pdf</a>                               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-18-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-18-1"  
class="td11"> <a 
 id="likesection.18"></a><a 
 id="x1-3019x18"></a><span 
class="aeb10-">[SCMI]                           </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-18-2"  
class="td11">
 <!--l. 96--><p class="noindent" >Arm System Control and Management Interface, DEN0056, <br 
class="newline" />    <a 
href="https://developer.arm.com/docs/den0056/c" class="url" >https://developer.arm.com/docs/den0056/c</a>, version C and any future revisions  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-19-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-19-1"  
class="td11"> <a 
 id="likesection.19"></a><a 
 id="x1-3020x19"></a><span 
class="aeb10-">[RFC3447]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-19-2"  
class="td11">
 <!--l. 99--><p class="noindent" >J. Jonsson.,“Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography”,
  February 2003. <br 
class="newline" />    <a 
href="https://www.ietf.org/rfc/rfc3447.txt" class="url" >https://www.ietf.org/rfc/rfc3447.txt</a>                                                           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-20-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-20-1"  
class="td11"> <a 
 id="likesection.20"></a><a 
 id="x1-3021x20"></a><span 
class="aeb10-">[FIPS186-3]                     </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-20-2"  
class="td11">
 <!--l. 102--><p class="noindent" >National Institute of Standards and Technology (NIST), FIPS Publication 180-3:
  Secure Hash Standard, October 2008. <br 
class="newline" />   <a 
href="https://csrc.nist.gov/csrc/media/publications/fips/186/3/archive/2009-06-25/documents/fips_186-3.pdf" class="url" >https://csrc.nist.gov/csrc/media/publications/fips/186/3/archive/2009-06-25/documents/fips_186-3.pdf</a> </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-21-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-21-1"  
class="td11"> <a 
 id="likesection.21"></a><a 
 id="x1-3022x21"></a><span 
class="aeb10-">[RFC5915]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-21-2"  
class="td11">
 <!--l. 105--><p class="noindent" >“Elliptic Curve Private Key Structure”, June 2010. <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc5915" class="url" >https://www.rfc-editor.org/rfc/rfc5915</a>                                                       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-22-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-22-1"  
class="td11"> <a 
 id="likesection.22"></a><a 
 id="x1-3023x22"></a><span 
class="aeb10-">[RFC6025]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-22-2"  
class="td11">
 <!--l. 108--><p class="noindent" >C.Wallace., “ASN.1 Translation”, October 2010. <br 
class="newline" />    <a 
href="https://www.ietf.org/rfc/rfc6025.txt" class="url" >https://www.ietf.org/rfc/rfc6025.txt</a>                                                           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-23-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-23-1"  
class="td11"> <a 
 id="likesection.23"></a><a 
 id="x1-3024x23"></a><span 
class="aeb10-">[RFC3279]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-23-2"  
class="td11">
 <!--l. 111--><p class="noindent" >W.Polk.,   “Algorithms   and   Identifiers   for   the   Internet   X.509   Public   Key
  Infrastructure  Certificate  and  Certificate  Revocation  List  (CRL)  Profile”,  April
  2002. <br 
class="newline" />    <a 
href="https://www.ietf.org/rfc/rfc3279.txt" class="url" >https://www.ietf.org/rfc/rfc3279.txt</a>                                                           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-24-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-24-1"  
class="td11"> <a 
 id="likesection.24"></a><a 
 id="x1-3025x24"></a><span 
class="aeb10-">[SEC1]                            </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-24-2"  
class="td11">
 <!--l. 114--><p class="noindent" >Standards  for  Efficient  Cryptography  Group(SECG),  “SEC1:  Elliptic  Cureve
  Cryptography”, Version 1.0, September 2000. <br 
class="newline" />    <a 
href="https://www.secg.org/sec1-v2.pdf" class="url" >https://www.secg.org/sec1-v2.pdf</a>                                                              </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-25-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-25-1"  
class="td11"> <a 
 id="likesection.25"></a><a 
 id="x1-3026x25"></a><span 
class="aeb10-">[RFC2784]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-25-2"  
class="td11">
 <!--l. 118--><p class="noindent" >Generic Routing Encapsulation. This protocol is only specified for IPv4 and used
  as either the payload or delivery protocol. <br 
class="newline" />    <a 
href="https://datatracker.ietf.org/doc/rfc2784/" class="url" >https://datatracker.ietf.org/doc/rfc2784/</a>                                                    </td>
                                                                  

                                                                  
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-26-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-26-1"  
class="td11"> <a 
 id="likesection.26"></a><a 
 id="x1-3027x26"></a><span 
class="aeb10-">[RFC2890]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-26-2"  
class="td11">
 <!--l. 121--><p class="noindent" >Key and Sequence Number Extensions to <a 
href="#x1-3026x25">GRE</a>. This protocol describes extensions
  by which two fields, Key and Sequence Number, can be optionally carried in the
  <a 
href="#x1-3026x25">GRE</a> Header. <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc2890" class="url" >https://www.rfc-editor.org/rfc/rfc2890</a>                                                       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-27-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-27-1"  
class="td11"> <a 
 id="likesection.27"></a><a 
 id="x1-3028x27"></a><span 
class="aeb10-">[RFC7676]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-27-2"  
class="td11">
 <!--l. 125--><p class="noindent" >IPv6 Support for Generic Routing Encapsulation (GRE). This protocol is specified
  for IPv6 and used as either the payload or delivery protocol. Note that this does
  not change the GRE header format or any behaviors specified by RFC 2784 or RFC
  2890. <br 
class="newline" />    <a 
href="https://datatracker.ietf.org/doc/rfc7676/" class="url" >https://datatracker.ietf.org/doc/rfc7676/</a>                                                    </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-28-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-28-1"  
class="td11"> <a 
 id="likesection.28"></a><a 
 id="x1-3029x28"></a><span 
class="aeb10-">[GRE-in-UDP]                 </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-28-2"  
class="td11">
 <!--l. 129--><p class="noindent" >GRE-in-UDP  Encapsulation.  This  specifies  a  method  of  encapsulating  network
  protocol packets within GRE and UDP headers. This protocol is specified for IPv4
  and IPv6, and used as either the payload or delivery protocol. <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc8086" class="url" >https://www.rfc-editor.org/rfc/rfc8086</a>                                                       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-29-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-29-1"  
class="td11"> <a 
 id="likesection.29"></a><a 
 id="x1-3030x29"></a><span 
class="aeb10-">[VXLAN]                        </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-29-2"  
class="td11">
 <!--l. 133--><p class="noindent" >Virtual eXtensible Local Area Network. <br 
class="newline" />    <a 
href="https://datatracker.ietf.org/doc/rfc7348/" class="url" >https://datatracker.ietf.org/doc/rfc7348/</a>                                                    </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-30-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-30-1"  
class="td11"> <a 
 id="likesection.30"></a><a 
 id="x1-3031x30"></a><span 
class="aeb10-">[VXLAN-GPE]                 </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-30-2"  
class="td11">
 <!--l. 136--><p class="noindent" >Generic Protocol Extension for VXLAN. This protocol describes extending Virtual
  eXtensible Local Area Network (VXLAN) via changes to the VXLAN header. <br 
class="newline" />    <a 
href="https://www.ietf.org/archive/id/draft-ietf-nvo3-vxlan-gpe-12.txt" class="url" >https://www.ietf.org/archive/id/draft-ietf-nvo3-vxlan-gpe-12.txt</a>                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-31-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-31-1"  
class="td11"> <a 
 id="likesection.31"></a><a 
 id="x1-3032x31"></a><span 
class="aeb10-">[GENEVE]                      </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-31-2"  
class="td11">
 <!--l. 139--><p class="noindent" >Generic Network Virtualization Encapsulation. <br 
class="newline" />    <a 
href="https://datatracker.ietf.org/doc/rfc8926/" class="url" >https://datatracker.ietf.org/doc/rfc8926/</a>                                                    </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-32-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-32-1"  
class="td11"> <a 
 id="likesection.32"></a><a 
 id="x1-3033x32"></a><span 
class="aeb10-">[IPIP]                             </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-32-2"  
class="td11">
 <!--l. 142--><p class="noindent" >IP Encapsulation within IP. <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc2003" class="url" >https://www.rfc-editor.org/rfc/rfc2003</a>                                                       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-33-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-33-1"  
class="td11"> <a 
 id="likesection.33"></a><a 
 id="x1-3034x33"></a><span 
class="aeb10-">[NVGRE]                        </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-33-2"  
class="td11">
 <!--l. 145--><p class="noindent" >NVGRE: Network Virtualization Using Generic Routing Encapsulation <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc7637.html" class="url" >https://www.rfc-editor.org/rfc/rfc7637.html</a>                                                 </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-34-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-34-1"  
class="td11"> <a 
 id="likesection.34"></a><a 
 id="x1-3035x34"></a><span 
class="aeb10-">[IP]                                </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-34-2"  
class="td11">
 <!--l. 148--><p class="noindent" >INTERNET PROTOCOL <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc791" class="url" >https://www.rfc-editor.org/rfc/rfc791</a>                                                         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-35-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-35-1"  
class="td11"> <a 
 id="likesection.35"></a><a 
 id="x1-3036x35"></a><span 
class="aeb10-">[Internet Header Format]   </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-35-2"  
class="td11">
 <!--l. 151--><p class="noindent" >Internet Header Format <br 
class="newline" />    <a 
href="https://datatracker.ietf.org/doc/html/rfc791#section-3.1" class="url" >https://datatracker.ietf.org/doc/html/rfc791#section-3.1</a>                               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-36-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-36-1"  
class="td11"> <a 
 id="likesection.36"></a><a 
 id="x1-3037x36"></a><span 
class="aeb10-">[IPv6 Header Format]        </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-36-2"  
class="td11">
 <!--l. 154--><p class="noindent" >IPv6 Header Format <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc8200#section-3" class="url" >https://www.rfc-editor.org/rfc/rfc8200#section-3</a>                                         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-37-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-37-1"  
class="td11"> <a 
 id="likesection.37"></a><a 
 id="x1-3038x37"></a><span 
class="aeb10-">[UDP]                             </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-37-2"  
class="td11">
 <!--l. 157--><p class="noindent" >User Datagram Protocol <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc768" class="url" >https://www.rfc-editor.org/rfc/rfc768</a>                                                         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-38-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-38-1"  
class="td11"> <a 
 id="likesection.38"></a><a 
 id="x1-3039x38"></a><span 
class="aeb10-">[TCP]                             </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-38-2"  
class="td11">
 <!--l. 160--><p class="noindent" >TRANSMISSION CONTROL PROTOCOL <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc793" class="url" >https://www.rfc-editor.org/rfc/rfc793</a>                                                         </td>
                                                                  

                                                                  
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-39-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-39-1"  
class="td11"> <a 
 id="likesection.39"></a><a 
 id="x1-3040x39"></a><span 
class="aeb10-">[TCP Header Format]        </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-39-2"  
class="td11">
 <!--l. 163--><p class="noindent" >TCP Header Format <br 
class="newline" />    <a 
href="https://www.rfc-editor.org/rfc/rfc9293#name-header-format" class="url" >https://www.rfc-editor.org/rfc/rfc9293#name-header-format</a>                          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-40-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-40-1"  
class="td11"> <a 
 id="likesection.40"></a><a 
 id="x1-3041x40"></a><span 
class="aeb10-">[CAN]                            </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-40-2"  
class="td11">
 <!--l. 166--><p class="noindent" >ISO 11898-1:2015 Road vehicles – Controller area network (CAN) – Part 1: Data
  link layer and physical signalling                                                                   </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-41-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-41-1"  
class="td11"> <a 
 id="likesection.41"></a><a 
 id="x1-3042x41"></a><span 
class="aeb10-">[RFC8174]                       </span></td><td  style="white-space:normal; text-align:left;" id="TBL-2-41-2"  
class="td11">
 <!--l. 168--><p class="noindent" >Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words", BCP
  14, RFC 8174, DOI 10.17487/RFC8174, May 2017 <br 
class="newline" />    <a 
href="http://www.ietf.org/rfc/rfc8174.txt" class="url" >http://www.ietf.org/rfc/rfc8174.txt</a>                                                            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-42-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-42-1"  
class="td11">                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-43-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-43-1"  
class="td11">                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-44-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-44-1"  
class="td11">                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-45-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-45-1"  
class="td11">                     </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-46-"><td  style="white-space:nowrap; text-align:left;" id="TBL-2-46-1"  
class="td11">                         </td><td  style="white-space:normal; text-align:left;" id="TBL-2-46-2"  
class="td11">
</td></tr>
</table></div>
<a 
 id="x1-3043r3"></a>
<h3 class="sectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-40002"></a>Non-Normative References</h3>
<a 
 id="x1-4001r2"></a><!--l. 176--><div class="longtable"> <table id="TBL-3" class="longtable" 
 
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1"><col 
id="TBL-3-2"></colgroup>
<tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-1-1"  
class="td11"> <a 
 id="likesection.42"></a><a 
 id="x1-4002x42"></a><span 
class="aeb10-">[Virtio PCI Draft]  </span></td><td  style="white-space:normal; text-align:left;" id="TBL-3-1-2"  
class="td11">
 <!--l. 177--><p class="noindent" >Virtio PCI Draft Specification <br 
class="newline" />    <a 
href="http://ozlabs.org/~rusty/virtio-spec/virtio-0.9.5.pdf" class="url" >http://ozlabs.org/~rusty/virtio-spec/virtio-0.9.5.pdf</a>                                      </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-2-1"  
class="td11">               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-3-1"  
class="td11">               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-4-1"  
class="td11">               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-5-1"  
class="td11">               </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-3-6-1"  
class="td11">                  </td><td  style="white-space:normal; text-align:left;" id="TBL-3-6-2"  
class="td11">
</td></tr>
</table></div>
<a 
 id="x1-4003r4"></a>
<h3 class="sectionHead"><span class="titlemark">1.3   </span> <a 
 id="x1-50003"></a>Terminology</h3>
<!--l. 183--><p class="noindent" >The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”,
“SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”,
“MAY”, and “OPTIONAL” in this document are to be interpreted as described in
<a 
href="#x1-3002x1">[RFC2119]</a> and <a 
href="#x1-3042x41">[RFC8174]</a> when, and only when, they appear in all capitals, as
shown here.
<a 
 id="x1-5001r1"></a>
<h4 class="subsectionHead"><span class="titlemark">1.3.1   </span> <a 
 id="x1-60001"></a>Legacy Interface: Terminology</h4>
<!--l. 191--><p class="noindent" >Specification drafts preceding version 1.0 of this specification (e.g. see <a 
href="#x1-4002x42">[Virtio PCI
Draft]</a>) defined a similar, but different interface between the driver and the device.
Since these are widely deployed, this specification accommodates OPTIONAL
features to simplify transition from these earlier draft interfaces.
<!--l. 199--><p class="noindent" >Specifically devices and drivers MAY support:
                                                                  

                                                                  
     <dl class="description"><dt class="description">
     <!--l. 201--><p class="noindent" >
<span 
class="aeb10-">Legacy Interface</span> </dt><dd 
class="description">
     <!--l. 201--><p class="noindent" >is an interface specified by an earlier draft of this specification (before 1.0)
     </dd><dt class="description">
     <!--l. 204--><p class="noindent" >
<span 
class="aeb10-">Legacy Device</span> </dt><dd 
class="description">
     <!--l. 204--><p class="noindent" >is  a  device  implemented  before  this  specification  was  released,  and
     implementing a legacy interface on the host side
     </dd><dt class="description">
     <!--l. 207--><p class="noindent" >
<span 
class="aeb10-">Legacy Driver</span> </dt><dd 
class="description">
     <!--l. 207--><p class="noindent" >is  a  driver  implemented  before  this  specification  was  released,  and
     implementing a legacy interface on the guest side</dd></dl>
<!--l. 212--><p class="noindent" >Legacy devices and legacy drivers are not compliant with this specification.
<!--l. 215--><p class="noindent" >To simplify transition from these earlier draft interfaces, a device MAY implement:
     <dl class="description"><dt class="description">
     <!--l. 219--><p class="noindent" >
<span 
class="aeb10-">Transitional Device</span> </dt><dd 
class="description">
     <!--l. 219--><p class="noindent" >a  device  supporting  both  drivers  conforming  to  this  specification,  and
     allowing legacy drivers.</dd></dl>
<!--l. 224--><p class="noindent" >Similarly, a driver MAY implement:
     <dl class="description"><dt class="description">
     <!--l. 226--><p class="noindent" >
<span 
class="aeb10-">Transitional Driver</span> </dt><dd 
class="description">
     <!--l. 226--><p class="noindent" >a  driver  supporting  both  devices  conforming  to  this  specification,  and
     legacy devices.</dd></dl>
<span 
class="aeb10-">Note:</span> Legacy interfaces are not required; ie. don’t implement them unless you
      have a need for backwards compatibility!
<!--l. 236--><p class="noindent" >Devices or drivers with no legacy compatibility are referred to as non-transitional
devices and drivers, respectively.
<a 
 id="x1-6001r6"></a>
<h4 class="subsectionHead"><span class="titlemark">1.3.2   </span> <a 
 id="x1-70002"></a>Transition from earlier specification drafts</h4>
<!--l. 241--><p class="noindent" >For devices and drivers already implementing the legacy interface, some changes will
                                                                  

                                                                  
have to be made to support this specification.
<!--l. 245--><p class="noindent" >In this case, it might be beneficial for the reader to focus on sections tagged "Legacy
Interface" in the section title. These highlight the changes made since the earlier
drafts.
<a 
 id="x1-7001r5"></a>
<h3 class="sectionHead"><span class="titlemark">1.4   </span> <a 
 id="x1-80004"></a>Structure Specifications</h3>
<!--l. 251--><p class="noindent" >Many device and driver in-memory structure layouts are documented using the C
struct syntax. All structures are assumed to be without additional padding.
To stress this, cases where common C compilers are known to insert extra
padding within structures are tagged using the GNU C __attribute__((packed))
syntax.
<!--l. 257--><p class="noindent" >For the integer data types used in the structure definitions, the following conventions
are used:
     <dl class="description"><dt class="description">
     <!--l. 261--><p class="noindent" >
<span 
class="aeb10-">u8, u16, u32, u64</span> </dt><dd 
class="description">
     <!--l. 261--><p class="noindent" >An unsigned integer of the specified length in bits.
     </dd><dt class="description">
     <!--l. 263--><p class="noindent" >
<span 
class="aeb10-">le16, le32, le64</span> </dt><dd 
class="description">
     <!--l. 263--><p class="noindent" >An unsigned integer of the specified length in bits, in little-endian byte
     order.
     </dd><dt class="description">
     <!--l. 266--><p class="noindent" >
<span 
class="aeb10-">be16, be32, be64</span> </dt><dd 
class="description">
     <!--l. 266--><p class="noindent" >An unsigned integer of the specified length in bits, in big-endian byte
     order.</dd></dl>
<!--l. 270--><p class="noindent" >Some of the fields to be defined in this specification don’t start or don’t end on a byte
boundary. Such fields are called bit-fields. A set of bit-fields is always a sub-division
of an integer typed field.
<!--l. 274--><p class="noindent" >Bit-fields within integer fields are always listed in order, from the least significant
to the most significant bit. The bit-fields are considered unsigned integers
of the specified width with the next in significance relationship of the bits
preserved.
<!--l. 280--><p class="noindent" >For example: <!--l. 281-->
<pre class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-8001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">S</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-8002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-8003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">A</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-8004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">B</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-8005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-8006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">y</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-8007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
                                                                  

                                                                  
<!--l. 290--><p class="noindent" >documents the value A stored in the low 15 bit of <span 
class="aeti-10">x </span>and the value B stored in the
high bit of <span 
class="aeti-10">x</span>, the 16-bit integer <span 
class="aeti-10">x </span>in turn stored using the big-endian byte order at
the beginning of the structure S, and being followed immediately by an unsigned
integer <span 
class="aeti-10">y </span>stored in big-endian byte order at an offset of 2 bytes (16 bits) from the
beginning of the structure.
<!--l. 298--><p class="noindent" >Note that this notation somewhat resembles the C bitfield syntax but should not be
naively converted to a bitfield notation for portable code: it matches the way bitfields
are packed by C compilers on little-endian architectures but not the way bitfields are
packed by C compilers on big-endian architectures.
<!--l. 304--><p class="noindent" >Assuming that CPU_TO_BE16 converts a 16-bit integer from a native CPU to the
big-endian byte order, the following is the equivalent portable C code to generate a
value to be stored into <span 
class="aeti-10">x</span>: <!--l. 307-->
<pre class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-8008r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CPU_TO_BE16</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">B</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">A</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span></pre>
<a 
 id="x1-8009r8"></a>
<h3 class="sectionHead"><span class="titlemark">1.5   </span> <a 
 id="x1-90005"></a>Constant Specifications</h3>
<!--l. 312--><p class="noindent" >In many cases, numeric values used in the interface between the device and the driver
are documented using the C #define and /* */ comment syntax. Multiple
related values are grouped together with a common name as a prefix, using _
as a separator. Using _XXX as a suffix refers to all values in a group. For
example:
<!--l. 319-->
<pre class="lstlisting" id="listing-3"><span class="label"><a 
 id="x1-9001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Field</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Fld</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">A</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">description</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-9002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_FLD_A</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-9003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Field</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Fld</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">B</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">description</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-9004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_FLD_B</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span></pre>
<!--l. 325--><p class="noindent" >documents two numeric values for a field <span 
class="aeti-10">Fld</span>, with <span 
class="aeti-10">Fld </span>having value 1 referring to <span 
class="aeti-10">A</span>
and <span 
class="aeti-10">Fld </span>having value 2 referring to <span 
class="aeti-10">B</span>. Note that <span 
class="cmmi-10"><< </span>refers to the shift-left
operation.
<!--l. 330--><p class="noindent" >Further, in this case VIRTIO_FLD_A and VIRTIO_FLD_B refer to values 1 and 2 of
Fld respectively. Further, VIRTIO_FLD_XXX refers to either VIRTIO_FLD_A or
VIRTIO_FLD_B.
<!--l. 334--><p class="noindent" >
                                                                  

                                                                  
                                                                  

                                                                  
<!--l. 1--><p class="noindent" ><h2 class="chapterHead"><hr><span class="titlemark">2</span> <a 
 id="x1-100002"></a>Basic Facilities of a Virtio Device</h2>
A virtio device is discovered and identified by a bus-specific method (see
the bus specific sections: <a 
href="#x1-1630001">4.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a> <a 
href="#x1-1630001">Virtio Over PCI Bus<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a>, <a 
href="#x1-2130002">4.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO --></a> <a 
href="#x1-2130002">Virtio Over MMIO<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO --></a>
and <a 
href="#x1-2270003">4.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over Channel I/O --></a> <a 
href="#x1-2270003">Virtio Over Channel I/O<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over Channel I/O --></a>). Each device consists of the following
parts:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 9--><p class="noindent" >Device status field
     </li>
     <li class="itemize">
     <!--l. 10--><p class="noindent" >Feature bits
     </li>
     <li class="itemize">
     <!--l. 11--><p class="noindent" >Notifications
     </li>
     <li class="itemize">
     <!--l. 12--><p class="noindent" >Device Configuration space
     </li>
     <li class="itemize">
     <!--l. 13--><p class="noindent" >One or more virtqueues</li></ul>
<a 
 id="x1-10001r9"></a>
<h3 class="sectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-110001"></a><span 
class="aeti-10">Device Status </span>Field</h3>
<!--l. 17--><p class="noindent" >During device initialization by a driver, the driver follows the sequence of steps
specified in <a 
href="#x1-1550001">3.1<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a>.
<!--l. 22--><p class="noindent" >The <span 
class="aeti-10">device status </span>field provides a simple low-level indication of the completed steps of
this sequence. It’s most useful to imagine it hooked up to traffic lights on the console
indicating the status of each device. The following bits are defined (listed below in
the order in which they would be typically set):
     <dl class="description"><dt class="description">
     <!--l. 29--><p class="noindent" >
<span 
class="aeb10-">ACKNOWLEDGE (1)</span> </dt><dd 
class="description">
     <!--l. 29--><p class="noindent" >Indicates that the guest OS has found the device and recognized it as a
     valid virtio device.
     </dd><dt class="description">
     <!--l. 32--><p class="noindent" >
<span 
class="aeb10-">DRIVER (2)</span> </dt><dd 
class="description">
                                                                  

                                                                  
     <!--l. 32--><p class="noindent" >Indicates that the guest OS knows how to drive the device.
     <span 
class="aeb10-">Note:</span> There could be a significant (or infinite) delay before setting this
          bit. For example, under Linux, drivers can be loadable modules.
     </dd><dt class="description">
     <!--l. 39--><p class="noindent" >
<span 
class="aeb10-">FAILED (128)</span> </dt><dd 
class="description">
     <!--l. 39--><p class="noindent" >Indicates that something went wrong in the guest, and it has given up
     on the device. This could be an internal error, or the driver didn’t
     like the device for some reason, or even a fatal error during device
     operation.
     </dd><dt class="description">
     <!--l. 44--><p class="noindent" >
<span 
class="aeb10-">FEATURES_OK (8)</span> </dt><dd 
class="description">
     <!--l. 44--><p class="noindent" >Indicates that the driver has acknowledged all the features it understands, and
     feature negotiation is complete.
     </dd><dt class="description">
     <!--l. 47--><p class="noindent" >
<span 
class="aeb10-">DRIVER_OK (4)</span> </dt><dd 
class="description">
     <!--l. 47--><p class="noindent" >Indicates that the driver is set up and ready to drive the device.
     </dd><dt class="description">
     <!--l. 50--><p class="noindent" >
<span 
class="aeb10-">DEVICE_NEEDS_RESET (64)</span> </dt><dd 
class="description">
     <!--l. 50--><p class="noindent" >Indicates that the device has experienced an error from which it can’t
     recover.</dd></dl>
<!--l. 54--><p class="noindent" >The <span 
class="aeti-10">device status </span>field starts out as 0, and is reinitialized to 0 by the device during
reset.
<a 
 id="x1-11001r7"></a>
<h4 class="subsectionHead"><span class="titlemark">2.1.1   </span> <a 
 id="x1-120001"></a>Driver Requirements: Device Status Field</h4>
<!--l. 58--><p class="noindent" >The driver MUST update <span 
class="aeti-10">device status</span>, setting bits to indicate the completed steps of
the driver initialization sequence specified in <a 
href="#x1-1550001">3.1<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a>. The driver MUST NOT clear a
<span 
class="aeti-10">device status </span>bit. If the driver sets the FAILED bit, the driver MUST later reset the
device before attempting to re-initialize.
<!--l. 67--><p class="noindent" >The driver SHOULD NOT rely on completion of operations of a device if
DEVICE_NEEDS_RESET is set.
                                                                  

                                                                  
<span 
class="aeb10-">Note:</span> For example, the driver can’t assume requests in flight will be completed
      if DEVICE_NEEDS_RESET is set, nor can it assume that they have not
      been completed. A good implementation will try to recover by issuing a
      reset.
<a 
 id="x1-12001r12"></a>
<h4 class="subsectionHead"><span class="titlemark">2.1.2   </span> <a 
 id="x1-130002"></a>Device Requirements: Device Status Field</h4>
<!--l. 78--><p class="noindent" >The device MUST NOT consume buffers or send any used buffer notifications to the
driver before DRIVER_OK.
<!--l. 81--><p class="noindent" >The device SHOULD set DEVICE_NEEDS_RESET when it enters an error state
that a reset is needed. If DRIVER_OK is set, after it sets DEVICE_NEEDS_RESET,
the device MUST send a device configuration change notification to the
driver.
<a 
 id="x1-13001r11"></a>
<h3 class="sectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-140002"></a>Feature Bits</h3>
<!--l. 87--><p class="noindent" >Each virtio device offers all the features it understands. During device initialization,
the driver reads this and tells the device the subset that it accepts. The only way to
renegotiate is to reset the device.
<!--l. 92--><p class="noindent" >This allows for forwards and backwards compatibility: if the device is enhanced with
a new feature bit, older drivers will not write that feature bit back to the device.
Similarly, if a driver is enhanced with a feature that the device doesn’t support, it see
the new feature is not offered.
<!--l. 97--><p class="noindent" >Feature bits are allocated as follows:
     <dl class="description"><dt class="description">
     <!--l. 100--><p class="noindent" >
<span 
class="aeb10-">0 to 23, and 50 to 127</span> </dt><dd 
class="description">
     <!--l. 100--><p class="noindent" >Feature bits for the specific device type
     </dd><dt class="description">
     <!--l. 102--><p class="noindent" >
<span 
class="aeb10-">24 to 41</span> </dt><dd 
class="description">
     <!--l. 102--><p class="noindent" >Feature bits reserved for extensions to the queue and feature negotiation
     mechanisms, see <a 
href="#x1-7970006">6<!--tex4ht:ref: sec:Reserved Feature Bits --></a>
     </dd><dt class="description">
     <!--l. 105--><p class="noindent" >
<span 
class="aeb10-">42 to 49, and 128 and above</span> </dt><dd 
class="description">
     <!--l. 105--><p class="noindent" >Feature bits reserved for future extensions.</dd></dl>
<span 
class="aeb10-">Note:</span> For example, feature bit 0 for a network device (i.e. Device ID 1) indicates
                                                                  

                                                                  
      that the device supports checksumming of packets.
<!--l. 114--><p class="noindent" >In particular, new fields in the device configuration space are indicated by offering a
new feature bit.
<!--l. 117--><p class="noindent" >To keep the feature negotiation mechanism extensible, it is important that devices <span 
class="aeti-10">do</span>
<span 
class="aeti-10">not offer any feature bits that they would not be able to handle if the driver accepted</span>
<span 
class="aeti-10">them (even though drivers are not supposed to accept any unspecified, reserved, or</span>
<span 
class="aeti-10">unsupported features even if offered, according to the specification.) Likewise, it is</span>
<span 
class="aeti-10">important that drivers </span>do not accept feature bits they do not know how to handle
(even though devices are not supposed to offer any unspecified, reserved, or
unsupported features in the first place, according to the specification.) The preferred
way for handling reserved and unexpected features is that the driver ignores
them.
<!--l. 130--><p class="noindent" >In particular, this is especially important for features limited to specific transports, as
enabling these for more transports in future versions of the specification is highly
likely to require changing the behaviour from drivers and devices. Drivers and devices
supporting multiple transports need to carefully maintain per-transport lists of
allowed features.
<a 
 id="x1-14001r13"></a>
<h4 class="subsectionHead"><span class="titlemark">2.2.1   </span> <a 
 id="x1-150001"></a>Driver Requirements: Feature Bits</h4>
<!--l. 139--><p class="noindent" >The driver MUST NOT accept a feature which the device did not offer, and
MUST NOT accept a feature which requires another feature which was not
accepted.
<!--l. 143--><p class="noindent" >The driver MUST validate the feature bits offered by the device. The driver MUST
ignore and MUST NOT accept any feature bit that is
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 146--><p class="noindent" >not described in this specification,
     </li>
     <li class="itemize">
     <!--l. 147--><p class="noindent" >marked as reserved,
     </li>
     <li class="itemize">
     <!--l. 148--><p class="noindent" >not supported for the specific transport,
     </li>
     <li class="itemize">
     <!--l. 149--><p class="noindent" >not defined for the device type.</li></ul>
<!--l. 152--><p class="noindent" >The driver SHOULD go into backwards compatibility mode if the device does not
offer a feature it understands, otherwise MUST set the FAILED <span 
class="aeti-10">device status </span>bit and
                                                                  

                                                                  
cease initialization.
<!--l. 156--><p class="noindent" >By contrast, the driver MUST NOT fail solely because a feature it does not
understand has been offered by the device.
<a 
 id="x1-15001r15"></a>
<h4 class="subsectionHead"><span class="titlemark">2.2.2   </span> <a 
 id="x1-160002"></a>Device Requirements: Feature Bits</h4>
<!--l. 160--><p class="noindent" >The device MUST NOT offer a feature which requires another feature which was not
offered. The device SHOULD accept any valid subset of features the driver accepts,
otherwise it MUST fail to set the FEATURES_OK <span 
class="aeti-10">device status </span>bit when the driver
writes it.
<!--l. 165--><p class="noindent" >The device MUST NOT offer feature bits corresponding to features it would
not support if accepted by the driver (even if the driver is prohibited from
accepting the feature bits by the specification); for the sake of clarity, this
refers to feature bits not described in this specification, reserved feature
bits and feature bits reserved or not supported for the specific transport
or the specific device type, but this does not preclude devices written to a
future version of this specification from offering such feature bits should such
a specification have a provision for devices to support the corresponding
features.
<!--l. 176--><p class="noindent" >If a device has successfully negotiated a set of features at least once (by accepting the
FEATURES_OK <span 
class="aeti-10">device status </span>bit during device initialization), then it SHOULD
NOT fail re-negotiation of the same set of features after a device or system
reset. Failure to do so would interfere with resuming from suspend and error
recovery.
<a 
 id="x1-16001r16"></a>
<h4 class="subsectionHead"><span class="titlemark">2.2.3   </span> <a 
 id="x1-170003"></a>Legacy Interface: A Note on Feature Bits</h4>
<!--l. 187--><p class="noindent" >Transitional Drivers MUST detect Legacy Devices by detecting that the feature bit
VIRTIO_F_VERSION_1 is not offered. Transitional devices MUST detect Legacy
drivers by detecting that VIRTIO_F_VERSION_1 has not been acknowledged by the
driver.
<!--l. 192--><p class="noindent" >In this case device is used through the legacy interface.
<!--l. 194--><p class="noindent" >Legacy interface support is OPTIONAL. Thus, both transitional and non-transitional
devices and drivers are compliant with this specification.
<!--l. 198--><p class="noindent" >Requirements pertaining to transitional devices and drivers is contained in sections
named ’Legacy Interface’ like this one.
<!--l. 201--><p class="noindent" >When device is used through the legacy interface, transitional devices and
transitional drivers MUST operate according to the requirements documented within
these legacy interface sections. Specification text within these sections generally does
not apply to non-transitional devices.
<a 
 id="x1-17001r14"></a>
                                                                  

                                                                  
<h3 class="sectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-180003"></a>Notifications</h3>
<!--l. 210--><p class="noindent" >The notion of sending a notification (driver to device or device to driver) plays an
important role in this specification. The modus operandi of the notifications is
transport specific.
<!--l. 214--><p class="noindent" >There are three types of notifications:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 216--><p class="noindent" >configuration change notification
     </li>
     <li class="itemize">
     <!--l. 217--><p class="noindent" >available buffer notification
     </li>
     <li class="itemize">
     <!--l. 218--><p class="noindent" >used buffer notification.</li></ul>
<!--l. 221--><p class="noindent" >Configuration change notifications and used buffer notifications are sent by the
device, the recipient is the driver. A configuration change notification indicates that
the device configuration space has changed; a used buffer notification indicates
that a buffer may have been made used on the virtqueue designated by the
notification.
<!--l. 227--><p class="noindent" >Available buffer notifications are sent by the driver, the recipient is the device. This
type of notification indicates that a buffer may have been made available on the
virtqueue designated by the notification.
<!--l. 231--><p class="noindent" >The semantics, the transport-specific implementations, and other important
aspects of the different notifications are specified in detail in the following
chapters.
<!--l. 235--><p class="noindent" >Most transports implement notifications sent by the device to the driver using
interrupts. Therefore, in previous versions of this specification, these notifications
were often called interrupts. Some names defined in this specification still retain this
interrupt terminology. Occasionally, the term event is used to refer to a notification
or a receipt of a notification.
<a 
 id="x1-18001r18"></a>
<h3 class="sectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-190004"></a>Device Reset</h3>
<!--l. 244--><p class="noindent" >The driver may want to initiate a device reset at various times; notably, it is required
to do so during device initialization and device cleanup.
<!--l. 247--><p class="noindent" >The mechanism used by the driver to initiate the reset is transport specific.
<a 
 id="x1-19001r17"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">2.4.1   </span> <a 
 id="x1-200001"></a>Device Requirements: Device Reset</h4>
<!--l. 251--><p class="noindent" >A device MUST reinitialize <span 
class="aeti-10">device status </span>to 0 after receiving a reset.
<!--l. 253--><p class="noindent" >A device MUST NOT send notifications or interact with the queues after indicating
completion of the reset by reinitializing <span 
class="aeti-10">device status </span>to 0, until the driver
re-initializes the device.
<a 
 id="x1-20001r20"></a>
<h4 class="subsectionHead"><span class="titlemark">2.4.2   </span> <a 
 id="x1-210002"></a>Driver Requirements: Device Reset</h4>
<!--l. 259--><p class="noindent" >The driver SHOULD consider a driver-initiated reset complete when it reads <span 
class="aeti-10">device</span>
<span 
class="aeti-10">status </span>as 0.
<a 
 id="x1-21001r19"></a>
<h3 class="sectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-220005"></a>Device Configuration Space</h3>
<!--l. 264--><p class="noindent" >Device configuration space is generally used for rarely-changing or initialization-time
parameters. Where configuration fields are optional, their existence is indicated by
feature bits: Future versions of this specification will likely extend the device
configuration space by adding extra fields at the tail.
<span 
class="aeb10-">Note:</span> The device configuration space uses the little-endian format for multi-byte
      fields.
<!--l. 275--><p class="noindent" >Each transport also provides a generation count for the device configuration space,
which will change whenever there is a possibility that two accesses to the device
configuration space can see different versions of that space.
<a 
 id="x1-22001r21"></a>
<h4 class="subsectionHead"><span class="titlemark">2.5.1   </span> <a 
 id="x1-230001"></a>Driver Requirements: Device Configuration Space</h4>
<!--l. 281--><p class="noindent" >Drivers MUST NOT assume reads from fields greater than 32 bits wide are atomic,
nor are reads from multiple fields: drivers SHOULD read device configuration space
fields like so:
<!--l. 285-->
<pre class="lstlisting" id="listing-4"><span class="label"><a 
 id="x1-23001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">before</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">after</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-23002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">do</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-23003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">before</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">get_config_generation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-23004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">entry</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">entries</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-23005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">after</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">get_config_generation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-23006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">while</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">after</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">before</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
<!--l. 294--><p class="noindent" >For optional configuration space fields, the driver MUST check that the
corresponding feature is offered before accessing that part of the configuration
space.
<span 
class="aeb10-">Note:</span> See section <a 
href="#x1-1550001">3.1<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a> for details on feature negotiation.
<!--l. 301--><p class="noindent" >Drivers MUST NOT limit structure size and device configuration space size. Instead,
drivers SHOULD only check that device configuration space is <span 
class="aeti-10">large enough </span>to
contain the fields necessary for device operation.
                                                                  

                                                                  
<span 
class="aeb10-">Note:</span> For example, if the specification states that device configuration space
      ’includes a single 8-bit field’ drivers should understand this to mean that
      the device configuration space might also include an arbitrary amount of
      tail padding, and accept any device configuration space size equal to or
      greater than the specified 8-bit size.
<a 
 id="x1-23007r23"></a>
<h4 class="subsectionHead"><span class="titlemark">2.5.2   </span> <a 
 id="x1-240002"></a>Device Requirements: Device Configuration Space</h4>
<!--l. 315--><p class="noindent" >The device MUST allow reading of any device-specific configuration field
before FEATURES_OK is set by the driver. This includes fields which are
conditional on feature bits, as long as those feature bits are offered by the
device.
<a 
 id="x1-24001r24"></a>
<h4 class="subsectionHead"><span class="titlemark">2.5.3   </span> <a 
 id="x1-250003"></a>Legacy Interface: A Note on Device Configuration Space endian-ness</h4>
<!--l. 322--><p class="noindent" >Note that for legacy interfaces, device configuration space is generally the guest’s
native endian, rather than PCI’s little-endian. The correct endian-ness is documented
for each device.
<a 
 id="x1-25001r25"></a>
<h4 class="subsectionHead"><span class="titlemark">2.5.4   </span> <a 
 id="x1-260004"></a>Legacy Interface: Device Configuration Space</h4>
<!--l. 328--><p class="noindent" >Legacy devices did not have a configuration generation field, thus are susceptible to
race conditions if configuration is updated. This affects the block <span 
class="aeti-10">capacity </span>(see <a 
href="#x1-3760004">5.2.4<!--tex4ht:ref: sec:Device Types / Block Device / Device configuration layout --></a>)
and network <span 
class="aeti-10">mac </span>(see <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>) fields; when using the legacy interface, drivers
SHOULD read these fields multiple times until two reads generate a consistent
result.
<a 
 id="x1-26001r22"></a>
<h3 class="sectionHead"><span class="titlemark">2.6   </span> <a 
 id="x1-270006"></a>Virtqueues</h3>
<!--l. 340--><p class="noindent" >The mechanism for bulk data transport on virtio devices is
pretentiously called a virtqueue. Each device can have zero or more
virtqueues<span class="footnote-mark"><a 
href="#fn3x2" id="fn3x2-bk"><sup class="textsuperscript">3</sup></a></span><a 
 id="x1-27001f3"></a>.
<!--l. 345--><p class="noindent" >A virtio device can have maximum of 65536 virtqueues. Each virtqueue is identified
by a virtqueue index. A virtqueue index has a value in the range of 0 to
65535.
<!--l. 349--><p class="noindent" >Driver makes requests available to device by adding an available buffer to the queue,
i.e., adding a buffer describing the request to a virtqueue, and optionally
triggering a driver event, i.e., sending an available buffer notification to the
device.
<!--l. 355--><p class="noindent" >Device executes the requests and - when complete - adds a used buffer to
the queue, i.e., lets the driver know by marking the buffer as used. Device
can then trigger a device event, i.e., send a used buffer notification to the
                                                                  

                                                                  
driver.
<!--l. 360--><p class="noindent" >Device reports the number of bytes it has written to memory for each buffer it uses.
This is referred to as “used length”.
<!--l. 363--><p class="noindent" >Device is not generally required to use buffers in the same order in which they have
been made available by the driver.
<!--l. 367--><p class="noindent" >Some devices always use descriptors in the same order in which they have been made
available. These devices can offer the VIRTIO_F_IN_ORDER feature. If negotiated,
this knowledge might allow optimizations or simplify driver and/or device
code.
<!--l. 372--><p class="noindent" >Each virtqueue can consist of up to 3 parts:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 374--><p class="noindent" >Descriptor Area - used for describing buffers
     </li>
     <li class="itemize">
     <!--l. 375--><p class="noindent" >Driver Area - extra data supplied by driver to the device
     </li>
     <li class="itemize">
     <!--l. 376--><p class="noindent" >Device Area - extra data supplied by device to driver</li></ul>
<span 
class="aeb10-">Note:</span> Note that previous versions of this spec used different names for these parts
      (following <a 
href="#x1-350007">2.7<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Split Virtqueues --></a>):
          <ul class="itemize1">
          <li class="itemize">
          <!--l. 383--><p class="noindent" >Descriptor Table - for the Descriptor Area
          </li>
          <li class="itemize">
          <!--l. 384--><p class="noindent" >Available Ring - for the Driver Area
          </li>
          <li class="itemize">
          <!--l. 385--><p class="noindent" >Used Ring - for the Device Area</li></ul>
<!--l. 390--><p class="noindent" >Two formats are supported: Split Virtqueues (see <a 
href="#x1-350007">2.7<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Split Virtqueues --></a> <a 
href="#x1-350007">Split Virtqueues<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Split Virtqueues --></a>) and Packed
Virtqueues (see <a 
href="#x1-720008">2.8<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Packed Virtqueues --></a> <a 
href="#x1-720008">Packed Virtqueues<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Packed Virtqueues --></a>).
<!--l. 398--><p class="noindent" >Every driver and device supports either the Packed or the Split Virtqueue format, or
both.
<a 
 id="x1-27002r26"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">2.6.1   </span> <a 
 id="x1-280001"></a>Virtqueue Reset</h4>
<!--l. 403--><p class="noindent" >When VIRTIO_F_RING_RESET is negotiated, the driver can reset a virtqueue
individually. The way to reset the virtqueue is transport specific.
<!--l. 406--><p class="noindent" >Virtqueue reset is divided into two parts. The driver first resets a queue and can
afterwards optionally re-enable it.
<a 
 id="x1-28001r1"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.6.1.1   </span> <a 
 id="x1-290001"></a>Virtqueue Reset</h5>
<a 
 id="x1-29001r1"></a>
<!--l. 411--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.6.1.1.1</span> <a 
 id="x1-300001"></a>Device Requirements: Virtqueue Reset</h5>
After a queue has been reset by the driver, the device MUST NOT execute any
requests from that virtqueue, or notify the driver for it.
<!--l. 416--><p class="noindent" >The device MUST reset any state of a virtqueue to the default state, including the
available state and the used state.
<a 
 id="x1-30001r30"></a>
<!--l. 419--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.6.1.1.2</span> <a 
 id="x1-310002"></a>Driver Requirements: Virtqueue Reset</h5>
After the driver tells the device to reset a queue, the driver MUST verify that the
queue has actually been reset.
<!--l. 424--><p class="noindent" >After the queue has been successfully reset, the driver MAY release any resource
associated with that virtqueue.
<a 
 id="x1-31001r29"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.6.1.2   </span> <a 
 id="x1-320002"></a>Virtqueue Re-enable</h5>
<!--l. 429--><p class="noindent" >This process is the same as the initialization process of a single queue during the
initialization of the entire device.
<a 
 id="x1-32001r31"></a>
<!--l. 432--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.6.1.2.1</span> <a 
 id="x1-330001"></a>Device Requirements: Virtqueue Re-enable</h5>
The device MUST observe any queue configuration that may have been changed by
the driver, like the maximum queue size.
<a 
 id="x1-33001r33"></a>
<!--l. 437--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.6.1.2.2</span> <a 
 id="x1-340002"></a>Driver Requirements: Virtqueue Re-enable</h5>
When re-enabling a queue, the driver MUST configure the queue resources as during
initial virtqueue discovery, but optionally with different parameters.
<a 
 id="x1-34001r27"></a>
<h3 class="sectionHead"><span class="titlemark">2.7   </span> <a 
 id="x1-350007"></a>Split Virtqueues</h3>
<!--l. 2--><p class="noindent" >The split virtqueue format was the only format supported by the version 1.0 (and
earlier) of this standard.
                                                                  

                                                                  
<!--l. 5--><p class="noindent" >The split virtqueue format separates the virtqueue into several parts, where each part
is write-able by either the driver or the device, but not both. Multiple parts and/or
locations within a part need to be updated when making a buffer available and when
marking it as used.
<!--l. 11--><p class="noindent" >Each queue has a 16-bit queue size parameter, which sets the number of entries and
implies the total size of the queue.
<!--l. 15--><p class="noindent" >Each virtqueue consists of three parts:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 18--><p class="noindent" >Descriptor Table - occupies the Descriptor Area
     </li>
     <li class="itemize">
     <!--l. 19--><p class="noindent" >Available Ring - occupies the Driver Area
     </li>
     <li class="itemize">
     <!--l. 20--><p class="noindent" >Used Ring - occupies the Device Area</li></ul>
<!--l. 23--><p class="noindent" >where each part is physically-contiguous in guest memory, and has different
alignment requirements.
<!--l. 26--><p class="noindent" >The memory alignment and size requirements, in bytes, of each part of the virtqueue
are summarized in the following table:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Virtqueue Part    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Alignment  </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Size                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Descriptor Table  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16            </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="cmr-10">16</span><span 
class="cmsy-10">∗</span>(Queue Size)     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Available Ring    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 2              </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="cmr-10">6 + 2</span><span 
class="cmsy-10">∗</span>(Queue Size)  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Used Ring          </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4              </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="cmr-10">6 + 8</span><span 
class="cmsy-10">∗</span>(Queue Size)  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 41--><p class="noindent" >The Alignment column gives the minimum alignment for each part of the
virtqueue.
<!--l. 44--><p class="noindent" >The Size column gives the total number of bytes for each part of the virtqueue.
<!--l. 47--><p class="noindent" >Queue Size corresponds to the maximum number of buffers in the
virtqueue<span class="footnote-mark"><a 
href="#fn4x2" id="fn4x2-bk"><sup class="textsuperscript">4</sup></a></span><a 
 id="x1-35001f4"></a>.
Queue Size value is always a power of 2. The maximum Queue Size value is 32768.
This value is specified in a bus-specific way.
<!--l. 53--><p class="noindent" >When the driver wants to send a buffer to the device, it fills in a slot in the descriptor
table (or chains several together), and writes the descriptor index into the
available ring. It then notifies the device. When the device has finished a buffer,
it writes the descriptor index into the used ring, and sends a used buffer
notification.
<a 
 id="x1-35002r28"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">2.7.1   </span> <a 
 id="x1-360001"></a>Driver Requirements: Virtqueues</h4>
<!--l. 61--><p class="noindent" >The driver MUST ensure that the physical address of the first byte of each
virtqueue part is a multiple of the specified alignment value in the above
table.
<a 
 id="x1-36001r36"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.2   </span> <a 
 id="x1-370002"></a>Legacy Interfaces: A Note on Virtqueue Layout</h4>
<!--l. 67--><p class="noindent" >For Legacy Interfaces, several additional restrictions are placed on the virtqueue
layout:
<!--l. 70--><p class="noindent" >Each virtqueue occupies two or more physically-contiguous pages (usually defined as
4096 bytes, but depending on the transport; henceforth referred to as Queue Align)
and consists of three parts:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Descriptor Table  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Available Ring (…padding…)  </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Used Ring  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
</div>
<!--l. 81--><p class="noindent" >The bus-specific Queue Size field controls the total number of bytes for the virtqueue.
When using the legacy interface, the transitional driver MUST retrieve the Queue
Size field from the device and MUST allocate the total number of bytes for the
virtqueue according to the following formula (Queue Align given in qalign and Queue
Size given in qsz):
<!--l. 89-->
<pre class="lstlisting" id="listing-5"><span class="label"><a 
 id="x1-37001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ALIGN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(((</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qalign</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">"</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qalign</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">static</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">inline</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unsigned</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unsigned</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">int</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qsz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ALIGN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qsz</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u16</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*(3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qsz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ALIGN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u16</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used_elem</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qsz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<!--l. 98--><p class="noindent" >This wastes some space with padding. When using the legacy interface, both
transitional devices and drivers MUST use the following virtqueue layout structure to
locate elements of the virtqueue:
<!--l. 103-->
<pre class="lstlisting" id="listing-6"><span class="label"><a 
 id="x1-37007r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37008r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actual</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">each</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37009r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37010r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37011r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">A</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">available</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">heads</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">free</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">running</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37012r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37013r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37014r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Padding</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Align</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">boundary</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37015r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pad</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Padding</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37016r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37017r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">A</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">heads</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">free</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">running</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37018r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-37019r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-37020r37"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.3   </span> <a 
 id="x1-380003"></a>Legacy Interfaces: A Note on Virtqueue Endianness</h4>
<!--l. 121--><p class="noindent" >Note that when using the legacy interface, transitional devices and drivers
MUST use the native endian of the guest as the endian of fields and in the
virtqueue. This is opposed to little-endian for non-legacy interface as specified
by this standard. It is assumed that the host is already aware of the guest
endian.
<a 
 id="x1-38001r38"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.4   </span> <a 
 id="x1-390004"></a>Message Framing</h4>
<!--l. 129--><p class="noindent" >The framing of messages with descriptors is independent of the contents of the
                                                                  

                                                                  
buffers. For example, a network transmit buffer consists of a 12 byte header followed
by the network packet. This could be most simply placed in the descriptor table as a
12 byte output descriptor followed by a 1514 byte output descriptor, but it could also
consist of a single 1526 byte output descriptor in the case where the header and
packet are adjacent, or even three or more descriptors (possibly with loss of efficiency
in that case).
<!--l. 138--><p class="noindent" >Note that, some device implementations have large-but-reasonable restrictions on
total descriptor size (such as based on IOV_MAX in the host OS). This has not been
a problem in practice: little sympathy will be given to drivers which create
unreasonably-sized descriptors such as by dividing a network packet into 1500
single-byte descriptors!
<a 
 id="x1-39001r32"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.4.1   </span> <a 
 id="x1-400001"></a>Device Requirements: Message Framing</h5>
<!--l. 146--><p class="noindent" >The device MUST NOT make assumptions about the particular arrangement of
descriptors. The device MAY have a reasonable limit of descriptors it will allow in a
chain.
<a 
 id="x1-40001r40"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.4.2   </span> <a 
 id="x1-410002"></a>Driver Requirements: Message Framing</h5>
<!--l. 151--><p class="noindent" >The driver MUST place any device-writable descriptor elements after any
device-readable descriptor elements.
<!--l. 154--><p class="noindent" >The driver SHOULD NOT use an excessive number of descriptors to describe a
buffer.
<a 
 id="x1-41001r41"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.4.3   </span> <a 
 id="x1-420003"></a>Legacy Interface: Message Framing</h5>
<!--l. 159--><p class="noindent" >Regrettably, initial driver implementations used simple layouts, and devices came to
rely on it, despite this specification wording. In addition, the specification for
virtio_blk SCSI commands required intuiting field lengths from frame boundaries (see
<a 
href="#x1-3850003">5.2.6.3<!--tex4ht:ref: sec:Device Types / Block Device / Device Operation / Legacy Interface: Device Operation --></a> <a 
href="#x1-3850003">Legacy Interface: Device Operation<!--tex4ht:ref: sec:Device Types / Block Device / Device Operation / Legacy Interface: Device Operation --></a>)
<!--l. 165--><p class="noindent" >Thus when using the legacy interface, the VIRTIO_F_ANY_LAYOUT feature
indicates to both the device and the driver that no assumptions were made about
framing. Requirements for transitional drivers when this is not negotiated are
included in each device section.
<a 
 id="x1-42001r39"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.5   </span> <a 
 id="x1-430005"></a>The Virtqueue Descriptor Table</h4>
<!--l. 173--><p class="noindent" >The descriptor table refers to the buffers the driver is using for the device. <span 
class="aeti-10">addr </span>is a
physical address, and the buffers can be chained via <span 
class="aeti-10">next</span>. Each descriptor describes a
buffer which is read-only for the device (“device-readable”) or write-only for the
device (“device-writable”), but a chain of descriptors can contain both device-readable
and device-writable buffers.
                                                                  

                                                                  
<!--l. 179--><p class="noindent" >The actual contents of the memory offered to the device depends on the device type.
Most common is to begin the data with a header (containing little-endian fields)
for the device to read, and postfix it with a status tailer for the device to
write.
<!--l. 184-->
<pre class="lstlisting" id="listing-7"><span class="label"><a 
 id="x1-43001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Address</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">guest</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">physical</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">marks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">continuing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">via</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_NEXT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">marks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">otherwise</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_WRITE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">means</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">contains</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">list</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_INDIRECT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indicated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">NEXT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-43017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 204--><p class="noindent" >The number of descriptors in the table is defined by the queue size for this virtqueue:
this is the maximum possible descriptor chain length.
<!--l. 207--><p class="noindent" >If VIRTIO_F_IN_ORDER has been negotiated, driver uses descriptors in ring order:
starting from offset 0 in the table, and wrapping around at the end of the
table.
<span 
class="aeb10-">Note:</span> The legacy <a 
href="#x1-4002x42">[Virtio PCI Draft]</a> referred to this structure as vring_desc, and
      the constants as VRING_DESC_F_NEXT, etc, but the layout and values
      were identical.
<a 
 id="x1-43018r42"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.5.1   </span> <a 
 id="x1-440001"></a>Device Requirements: The Virtqueue Descriptor Table</h5>
<!--l. 218--><p class="noindent" >A device MUST NOT write to a device-readable buffer, and a device SHOULD NOT
read a device-writable buffer (it MAY do so for debugging or diagnostic purposes). A
device MUST NOT write to any descriptor table entry.
<a 
 id="x1-44001r44"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.5.2   </span> <a 
 id="x1-450002"></a>Driver Requirements: The Virtqueue Descriptor Table</h5>
<!--l. 223--><p class="noindent" >Drivers MUST NOT add a descriptor chain longer than <span 
class="cmr-10">2</span><sup><span 
class="cmr-7">32</span></sup> bytes in total; this
implies that loops in the descriptor chain are forbidden!
<!--l. 226--><p class="noindent" >If VIRTIO_F_IN_ORDER has been negotiated, and when making a descriptor with
VRING_DESC_F_NEXT set in <span 
class="aeti-10">flags </span>at offset <span 
class="cmmi-10">x </span>in the table available to the
device, driver MUST set <span 
class="aeti-10">next </span>to <span 
class="cmr-10">0 </span>for the last descriptor in the table (where
<span 
class="cmmi-10">x </span><span 
class="cmr-10">= </span><span 
class="cmmi-10">queue</span>_<span 
class="cmmi-10">size </span><span 
class="cmsy-10">− </span><span 
class="cmr-10">1</span>) and to <span 
class="cmmi-10">x </span><span 
class="cmr-10">+ 1 </span>for the rest of the descriptors.
<a 
 id="x1-45001r45"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.5.3   </span> <a 
 id="x1-460003"></a>Indirect Descriptors</h5>
<!--l. 234--><p class="noindent" >Some devices benefit by concurrently dispatching a large number of large requests.
The VIRTIO_F_INDIRECT_DESC feature allows this (see <a 
href="#x1-853000A">A<!--tex4ht:ref: sec:virtio-queue.h --></a> <a 
href="#x1-853000A">virtio_queue.h<!--tex4ht:ref: sec:virtio-queue.h --></a>). To
increase ring capacity the driver can store a table of indirect descriptors
anywhere in memory, and insert a descriptor in main virtqueue (with
<span 
class="aeti-10">flags</span>&VIRTQ_DESC_F_INDIRECT on) that refers to memory buffer containing this
indirect descriptor table; <span 
class="aeti-10">addr </span>and <span 
class="aeti-10">len </span>refer to the indirect table address and length
in bytes, respectively.
                                                                  

                                                                  
<!--l. 243--><p class="noindent" >The indirect table layout structure looks like this (<span 
class="aeti-10">len </span>is the length of the
descriptor that refers to this table, which is a variable, so this code won’t
compile):
<!--l. 247-->
<pre class="lstlisting" id="listing-8"><span class="label"><a 
 id="x1-46001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indirect_descriptor_table</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-46002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actual</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">each</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-46003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-46004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 254--><p class="noindent" >The first indirect descriptor is located at start of the indirect descriptor table (index
0), additional indirect descriptors are chained by <span 
class="aeti-10">next</span>. An indirect descriptor without
a valid <span 
class="aeti-10">next </span>(with <span 
class="aeti-10">flags</span>&VIRTQ_DESC_F_NEXT off) signals the end of the
descriptor. A single indirect descriptor table can include both device-readable and
device-writable descriptors.
<!--l. 261--><p class="noindent" >If VIRTIO_F_IN_ORDER has been negotiated, indirect descriptors use sequential
indices, in-order: index 0 followed by index 1 followed by index 2, etc.
<a 
 id="x1-46005r34"></a>
<!--l. 265--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.7.5.3.1</span> <a 
 id="x1-470001"></a>Driver Requirements: Indirect Descriptors</h5>
The driver MUST NOT set the VIRTQ_DESC_F_INDIRECT flag unless the
VIRTIO_F_INDIRECT_DESC feature was negotiated. The driver MUST NOT set
the VIRTQ_DESC_F_INDIRECT flag within an indirect descriptor (ie. only one table
per descriptor).
<!--l. 271--><p class="noindent" >A driver MUST NOT create a descriptor chain longer than the Queue Size of the
device.
<!--l. 274--><p class="noindent" >A driver MUST NOT set both VIRTQ_DESC_F_INDIRECT and VIRTQ_DESC_F_NEXT
in <span 
class="aeti-10">flags</span>.
<!--l. 277--><p class="noindent" >If VIRTIO_F_IN_ORDER has been negotiated, indirect descriptors MUST appear
sequentially, with <span 
class="aeti-10">next </span>taking the value of 1 for the 1st descriptor, 2 for the 2nd one,
etc.
<a 
 id="x1-47001r47"></a>
<!--l. 281--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.7.5.3.2</span> <a 
 id="x1-480002"></a>Device Requirements: Indirect Descriptors</h5>
The device MUST ignore the write-only flag (<span 
class="aeti-10">flags</span>&VIRTQ_DESC_F_WRITE) in the
descriptor that refers to an indirect table.
<!--l. 284--><p class="noindent" >The device MUST handle the case of zero or more normal chained descriptors
followed by a single descriptor with <span 
class="aeti-10">flags</span>&VIRTQ_DESC_F_INDIRECT.
<span 
class="aeb10-">Note:</span> While unusual (most implementations either create a chain solely using
      non-indirect descriptors, or use a single indirect element), such a layout
      is valid.
<a 
 id="x1-48001r43"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">2.7.6   </span> <a 
 id="x1-490006"></a>The Virtqueue Available Ring</h4>
<!--l. 295--><p class="noindent" >The available ring has the following layout structure:
<!--l. 297-->
<pre class="lstlisting" id="listing-9"><span class="label"><a 
 id="x1-49001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-49002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_AVAIL_F_NO_INTERRUPT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-49003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-49004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-49005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-49006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_EVENT_IDX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-49007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 307--><p class="noindent" >The driver uses the available ring to offer buffers to the device: each ring entry refers
to the head of a descriptor chain. It is only written by the driver and read by the
device.
<!--l. 311--><p class="noindent" ><span 
class="aeti-10">idx </span>field indicates where the driver would put the next descriptor entry in the ring
(modulo the queue size). This starts at 0, and increases.
<span 
class="aeb10-">Note:</span> The legacy <a 
href="#x1-4002x42">[Virtio PCI Draft]</a> referred to this structure as vring_avail,
      and the constant as VRING_AVAIL_F_NO_INTERRUPT, but the layout
      and value were identical.
<a 
 id="x1-49008r46"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.6.1   </span> <a 
 id="x1-500001"></a>Driver Requirements: The Virtqueue Available Ring</h5>
<!--l. 321--><p class="noindent" >A driver MUST NOT decrement the available <span 
class="aeti-10">idx </span>on a virtqueue (ie. there is no way
to “unexpose” buffers).
<a 
 id="x1-50001r49"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.7   </span> <a 
 id="x1-510007"></a>Used Buffer Notification Suppression</h4>
<!--l. 327--><p class="noindent" >If the VIRTIO_F_EVENT_IDX feature bit is not negotiated, the <span 
class="aeti-10">flags </span>field in the
available ring offers a crude mechanism for the driver to inform the device that it
doesn’t want notifications when buffers are used. Otherwise <span 
class="aeti-10">used_event </span>is a more
performant alternative where the driver specifies how far the device can progress
before a notification is required.
<!--l. 334--><p class="noindent" >Neither of these notification suppression methods are reliable, as they are not
synchronized with the device, but they serve as useful optimizations.
<a 
 id="x1-51001r50"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.7.1   </span> <a 
 id="x1-520001"></a>Driver Requirements: Used Buffer Notification Suppression</h5>
<!--l. 339--><p class="noindent" >If the VIRTIO_F_EVENT_IDX feature bit is not negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 341--><p class="noindent" >The driver MUST set <span 
class="aeti-10">flags </span>to 0 or 1.
     </li>
     <li class="itemize">
                                                                  

                                                                  
     <!--l. 342--><p class="noindent" >The driver MAY set <span 
class="aeti-10">flags </span>to 1 to advise the device that notifications are
     not needed.</li></ul>
<!--l. 346--><p class="noindent" >Otherwise, if the VIRTIO_F_EVENT_IDX feature bit is negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 348--><p class="noindent" >The driver MUST set <span 
class="aeti-10">flags </span>to 0.
     </li>
     <li class="itemize">
     <!--l. 349--><p class="noindent" >The driver MAY use <span 
class="aeti-10">used_event </span>to advise the device that notifications are
     unnecessary until the device writes an entry with an index specified by
     <span 
class="aeti-10">used_event </span>into the used ring (equivalently, until <span 
class="aeti-10">idx </span>in the used ring will
     reach the value <span 
class="aeti-10">used_event </span>+ 1).</li></ul>
<!--l. 354--><p class="noindent" >The driver MUST handle spurious notifications from the device.
<a 
 id="x1-52001r52"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.7.2   </span> <a 
 id="x1-530002"></a>Device Requirements: Used Buffer Notification Suppression</h5>
<!--l. 358--><p class="noindent" >If the VIRTIO_F_EVENT_IDX feature bit is not negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 360--><p class="noindent" >The device MUST ignore the <span 
class="aeti-10">used_event </span>value.
     </li>
     <li class="itemize">
     <!--l. 361--><p class="noindent" >After the device writes a descriptor index into the used ring:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 363--><p class="noindent" >If <span 
class="aeti-10">flags </span>is 1, the device SHOULD NOT send a notification.
         </li>
         <li class="itemize">
         <!--l. 364--><p class="noindent" >If <span 
class="aeti-10">flags </span>is 0, the device MUST send a notification.</li></ul>
     </li></ul>
<!--l. 368--><p class="noindent" >Otherwise, if the VIRTIO_F_EVENT_IDX feature bit is negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 370--><p class="noindent" >The device MUST ignore the lower bit of <span 
class="aeti-10">flags</span>.
     </li>
     <li class="itemize">
                                                                  

                                                                  
     <!--l. 371--><p class="noindent" >After the device writes a descriptor index into the used ring:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 373--><p class="noindent" >If  the  <span 
class="aeti-10">idx  </span>field  in  the  used  ring  (which  determined  where  that
         descriptor  index  was  placed)  was  equal  to  <span 
class="aeti-10">used_event</span>,  the  device
         MUST send a notification.
         </li>
         <li class="itemize">
         <!--l. 376--><p class="noindent" >Otherwise the device SHOULD NOT send a notification.</li></ul>
     </li></ul>
<span 
class="aeb10-">Note:</span> For example, if <span 
class="aeti-10">used_event </span>is 0, then a device using
      <!--l. 383--><p class="noindent" >VIRTIO_F_EVENT_IDX would send a used buffer notification to the
      driver after the first buffer is used (and again after the 65536th buffer,
      etc).
<a 
 id="x1-53001r51"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.8   </span> <a 
 id="x1-540008"></a>The Virtqueue Used Ring</h4>
<!--l. 390--><p class="noindent" >The used ring has the following layout structure:
<!--l. 392-->
<pre class="lstlisting" id="listing-10"><span class="label"><a 
 id="x1-54001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_USED_F_NO_NOTIFY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used_elem</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_EVENT_IDX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">here</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ids</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reasons</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used_elem</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Index</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">number</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">written</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">into</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">described</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-54018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 413--><p class="noindent" >The used ring is where the device returns buffers once it is done with them: it is only
written to by the device, and read by the driver.
<!--l. 416--><p class="noindent" >Each entry in the ring is a pair: <span 
class="aeti-10">id </span>indicates the head entry of the descriptor chain
describing the buffer (this matches an entry placed in the available ring by the guest
earlier), and <span 
class="aeti-10">len </span>the total of bytes written into the buffer.
<span 
class="aeb10-">Note:</span> <span 
class="aeti-10">len </span>is particularly useful for drivers using untrusted buffers: if a driver
      does not know exactly how much has been written by the device, the
      driver would have to zero the buffer in advance to ensure no data leakage
      occurs.
      <!--l. 427--><p class="noindent" >For example, a network driver may hand a received buffer directly to
      an  unprivileged  userspace  application.  If  the  network  device  has  not
      overwritten  the  bytes  which  were  in  that  buffer,  this  could  leak  the
      contents of freed memory from other processes to the application.
<!--l. 433--><p class="noindent" ><span 
class="aeti-10">idx </span>field indicates where the device would put the next descriptor entry in the ring
(modulo the queue size). This starts at 0, and increases.
                                                                  

                                                                  
<span 
class="aeb10-">Note:</span> The legacy <a 
href="#x1-4002x42">[Virtio PCI Draft]</a> referred to these structures as vring_used
      and                                                                    vring_used_elem,
      and the constant as VRING_USED_F_NO_NOTIFY, but the layout and
      value were identical.
<a 
 id="x1-54019r53"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.8.1   </span> <a 
 id="x1-550001"></a>Legacy Interface: The Virtqueue Used Ring</h5>
<!--l. 448--><p class="noindent" >Historically, many drivers ignored the <span 
class="aeti-10">len </span>value, as a result, many devices set <span 
class="aeti-10">len</span>
incorrectly. Thus, when using the legacy interface, it is generally a good idea to
ignore the <span 
class="aeti-10">len </span>value in used ring entries if possible. Specific known issues are listed
per device type.
<a 
 id="x1-55001r55"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.8.2   </span> <a 
 id="x1-560002"></a>Device Requirements: The Virtqueue Used Ring</h5>
<!--l. 456--><p class="noindent" >The device MUST set <span 
class="aeti-10">len </span>prior to updating the used <span 
class="aeti-10">idx</span>.
<!--l. 458--><p class="noindent" >The device MUST write at least <span 
class="aeti-10">len </span>bytes to descriptor, beginning at the first
device-writable buffer, prior to updating the used <span 
class="aeti-10">idx</span>.
<!--l. 462--><p class="noindent" >The device MAY write more than <span 
class="aeti-10">len </span>bytes to descriptor.
<span 
class="aeb10-">Note:</span> There are potential error cases where a device might not know what parts
      of the buffers have been written. This is why <span 
class="aeti-10">len </span>is permitted to be an
      underestimate: that’s preferable to the driver believing that uninitialized
      memory has been overwritten when it has not.
<a 
 id="x1-56001r56"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.8.3   </span> <a 
 id="x1-570003"></a>Driver Requirements: The Virtqueue Used Ring</h5>
<!--l. 473--><p class="noindent" >The driver MUST NOT make assumptions about data in device-writable buffers
beyond the first <span 
class="aeti-10">len </span>bytes, and SHOULD ignore this data.
<a 
 id="x1-57001r54"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.9   </span> <a 
 id="x1-580009"></a>In-order use of descriptors</h4>
<!--l. 479--><p class="noindent" >Some devices always use descriptors in the same order in which they have been made
available. These devices can offer the VIRTIO_F_IN_ORDER feature. If negotiated,
this knowledge allows devices to notify the use of a batch of buffers to the
driver by only writing out a single used ring entry with the <span 
class="aeti-10">id </span>corresponding
to the head entry of the descriptor chain describing the last buffer in the
batch.
<!--l. 487--><p class="noindent" >The device then skips forward in the ring according to the size of the batch.
Accordingly, it increments the used <span 
class="aeti-10">idx </span>by the size of the batch.
<!--l. 491--><p class="noindent" >The driver needs to look up the used <span 
class="aeti-10">id </span>and calculate the batch size to be
able to advance to where the next used ring entry will be written by the
                                                                  

                                                                  
device.
<!--l. 495--><p class="noindent" >This will result in the used ring entry at an offset matching the first available ring
entry in the batch, the used ring entry for the next batch at an offset matching the
first available ring entry in the next batch, etc.
<!--l. 500--><p class="noindent" >The skipped buffers (for which no used ring entry was written) are assumed to have
been used (read or written) by the device completely.
<a 
 id="x1-58001r58"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.10   </span> <a 
 id="x1-5900010"></a>Available Buffer Notification Suppression</h4>
<!--l. 506--><p class="noindent" >The device can suppress available buffer notifications in a manner analogous to the
way drivers can suppress used buffer notifications as detailed in section <a 
href="#x1-510007">2.7.7<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Used Buffer Notification Suppression --></a>. The
device manipulates <span 
class="aeti-10">flags </span>or <span 
class="aeti-10">avail_event </span>in the used ring the same way the driver
manipulates <span 
class="aeti-10">flags </span>or <span 
class="aeti-10">used_event </span>in the available ring.
<a 
 id="x1-59001r57"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.10.1   </span> <a 
 id="x1-600001"></a>Driver Requirements: Available Buffer Notification Suppression</h5>
<!--l. 515--><p class="noindent" >The driver MUST initialize <span 
class="aeti-10">flags </span>in the used ring to 0 when allocating the used
ring.
<!--l. 518--><p class="noindent" >If the VIRTIO_F_EVENT_IDX feature bit is not negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 520--><p class="noindent" >The driver MUST ignore the <span 
class="aeti-10">avail_event </span>value.
     </li>
     <li class="itemize">
     <!--l. 521--><p class="noindent" >After the driver writes a descriptor index into the available ring:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 523--><p class="noindent" >If <span 
class="aeti-10">flags </span>is 1, the driver SHOULD NOT send a notification.
         </li>
         <li class="itemize">
         <!--l. 524--><p class="noindent" >If <span 
class="aeti-10">flags </span>is 0, the driver MUST send a notification.</li></ul>
     </li></ul>
<!--l. 528--><p class="noindent" >Otherwise, if the VIRTIO_F_EVENT_IDX feature bit is negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 530--><p class="noindent" >The driver MUST ignore the lower bit of <span 
class="aeti-10">flags</span>.
     </li>
                                                                  

                                                                  
     <li class="itemize">
     <!--l. 531--><p class="noindent" >After the driver writes a descriptor index into the available ring:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 533--><p class="noindent" >If the <span 
class="aeti-10">idx  </span>field in the available ring (which determined where that
         descriptor  index  was  placed)  was  equal  to  <span 
class="aeti-10">avail_event</span>,  the  driver
         MUST send a notification.
         </li>
         <li class="itemize">
         <!--l. 536--><p class="noindent" >Otherwise the driver SHOULD NOT send a notification.</li></ul>
     </li></ul>
<a 
 id="x1-60001r60"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.10.2   </span> <a 
 id="x1-610002"></a>Device Requirements: Available Buffer Notification Suppression</h5>
<!--l. 541--><p class="noindent" >If the VIRTIO_F_EVENT_IDX feature bit is not negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 543--><p class="noindent" >The device MUST set <span 
class="aeti-10">flags </span>to 0 or 1.
     </li>
     <li class="itemize">
     <!--l. 544--><p class="noindent" >The device MAY set <span 
class="aeti-10">flags </span>to 1 to advise the driver that notifications are
     not needed.</li></ul>
<!--l. 548--><p class="noindent" >Otherwise, if the VIRTIO_F_EVENT_IDX feature bit is negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 550--><p class="noindent" >The device MUST set <span 
class="aeti-10">flags </span>to 0.
     </li>
     <li class="itemize">
     <!--l. 551--><p class="noindent" >The device MAY use <span 
class="aeti-10">avail_event </span>to advise the driver that notifications
     are unnecessary until the driver writes entry with an index specified by
     <span 
class="aeti-10">avail_event </span>into the available ring (equivalently, until <span 
class="aeti-10">idx </span>in the available
     ring will reach the value <span 
class="aeti-10">avail_event </span>+ 1).</li></ul>
<!--l. 555--><p class="noindent" >The device MUST handle spurious notifications from the driver.
<a 
 id="x1-61001r59"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.11   </span> <a 
 id="x1-6200011"></a>Helpers for Operating Virtqueues</h4>
<!--l. 559--><p class="noindent" >The Linux Kernel Source code contains the definitions above and helper routines in a
                                                                  

                                                                  
more usable form, in include/uapi/linux/virtio_ring.h. This was explicitly licensed
by IBM and Red Hat under the (3-clause) BSD license so that it can be
freely used by all other projects, and is reproduced (with slight variation) in
<a 
href="#x1-853000A">A<!--tex4ht:ref: sec:virtio-queue.h --></a> <a 
href="#x1-853000A">virtio_queue.h<!--tex4ht:ref: sec:virtio-queue.h --></a>.
<a 
 id="x1-62001r62"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.12   </span> <a 
 id="x1-6300012"></a>Virtqueue Operation</h4>
<!--l. 568--><p class="noindent" >There are two parts to virtqueue operation: supplying new available buffers to the
device, and processing used buffers from the device.
<span 
class="aeb10-">Note:</span> As an example, the simplest virtio network device has two virtqueues: the
      transmit virtqueue and the receive virtqueue. The driver adds outgoing
      (device-readable) packets to the transmit virtqueue, and then frees them
      after  they  are  used.  Similarly,  incoming  (device-writable)  buffers  are
      added to the receive virtqueue, and processed after they are used.
<!--l. 581--><p class="noindent" >What follows is the requirements of each of these two parts when using the split
virtqueue format in more detail.
<a 
 id="x1-63001r63"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.13   </span> <a 
 id="x1-6400013"></a>Supplying Buffers to The Device</h4>
<!--l. 586--><p class="noindent" >The driver offers buffers to one of the device’s virtqueues as follows:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-640011"></a> The driver places the buffer into free descriptor(s) in the descriptor table,
     chaining as necessary (see <a 
href="#x1-430005">2.7.5<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table --></a> <a 
href="#x1-430005">The Virtqueue Descriptor Table<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table --></a>).
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-640022"></a> The driver places the index of the head of the descriptor chain into the
     next ring entry of the available ring.
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Steps <a 
href="#x1-640011">1<!--tex4ht:ref: itm:Basic Facilities of a Virtio Device / Virtqueues / Supplying Buffers to The Device / Place Buffers --></a> and <a 
href="#x1-640022">2<!--tex4ht:ref: itm:Basic Facilities of a Virtio Device / Virtqueues / Supplying Buffers to The Device / Place Index --></a> MAY be performed repeatedly if batching is possible.
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">The driver performs a suitable memory barrier to ensure the device sees
     the updated descriptor table and available ring before the next step.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">The available <span 
class="aeti-10">idx  </span>is increased by the number of descriptor chain heads
     added to the available ring.
     </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">The driver performs a suitable memory barrier to ensure that it updates
     the <span 
class="aeti-10">idx </span>field before checking for notification suppression.
     </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">The  driver  sends  an  available  buffer  notification  to  the  device  if  such
     notifications are not suppressed.</dd></dl>
                                                                  

                                                                  
<!--l. 612--><p class="noindent" >Note that the above code does not take precautions against the available ring buffer
wrapping around: this is not possible since the ring buffer is the same size as the
descriptor table, so step (1) will prevent such a condition.
<!--l. 617--><p class="noindent" >In addition, the maximum queue size is 32768 (the highest power of 2 which fits in 16
bits), so the 16-bit <span 
class="aeti-10">idx </span>value can always distinguish between a full and empty
buffer.
<!--l. 621--><p class="noindent" >What follows is the requirements of each stage in more detail.
<a 
 id="x1-64008r61"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.13.1   </span> <a 
 id="x1-650001"></a>Placing Buffers Into The Descriptor Table</h5>
<!--l. 625--><p class="noindent" >A buffer consists of zero or more device-readable physically-contiguous elements
followed by zero or more physically-contiguous device-writable elements (each has at
least one element). This algorithm maps it into the descriptor table to form a
descriptor chain:
<!--l. 631--><p class="noindent" >for each buffer element, b:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Get the next free descriptor table entry, d
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Set <span 
class="aeti-10">d.addr </span>to the physical address of the start of b
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Set <span 
class="aeti-10">d.len </span>to the length of b.
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">If b is device-writable, set <span 
class="aeti-10">d.flags </span>to VIRTQ_DESC_F_WRITE, otherwise
     0.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">If there is a buffer element after this:
         <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
      (a) </dt><dd 
class="enumerate-enumitem">Set <span 
class="aeti-10">d.next </span>to the index of the next free descriptor element.
         </dd><dt class="enumerate-enumitem">
     (b) </dt><dd 
class="enumerate-enumitem">Set the VIRTQ_DESC_F_NEXT bit in <span 
class="aeti-10">d.flags</span>.</dd></dl>
     </dd></dl>
<!--l. 647--><p class="noindent" >In practice, <span 
class="aeti-10">d.next </span>is usually used to chain free descriptors, and a separate
count kept to check there are enough free descriptors before beginning the
mappings.
<a 
 id="x1-65008r65"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.13.2   </span> <a 
 id="x1-660002"></a>Updating The Available Ring</h5>
<!--l. 653--><p class="noindent" >The descriptor chain head is the first d in the algorithm above, ie. the index of the
descriptor table entry referring to the first part of the buffer. A naive driver
                                                                  

                                                                  
implementation MAY do the following (with the appropriate conversion to-and-from
little-endian assumed):
<!--l. 658-->
<pre class="lstlisting" id="listing-11"><span class="label"><a 
 id="x1-66001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">%</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qsz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
<!--l. 662--><p class="noindent" >However, in general the driver MAY add many descriptor chains before it updates <span 
class="aeti-10">idx</span>
(at which point they become visible to the device), so it is common to keep a counter
of how many the driver has added:
<!--l. 666-->
<pre class="lstlisting" id="listing-12"><span class="label"><a 
 id="x1-66002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">added</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">++)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">%</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">qsz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
<a 
 id="x1-66003r66"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.13.3   </span> <a 
 id="x1-670003"></a>Updating <span 
class="aeti-10">idx</span></h5>
<!--l. 672--><p class="noindent" ><span 
class="aeti-10">idx </span>always increments, and wraps naturally at 65536:
<!--l. 675-->
<pre class="lstlisting" id="listing-13"><span class="label"><a 
 id="x1-67001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">added</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
<!--l. 679--><p class="noindent" >Once available <span 
class="aeti-10">idx </span>is updated by the driver, this exposes the descriptor and its
contents. The device MAY access the descriptor chains the driver created and the
memory they refer to immediately.
<a 
 id="x1-67002r48"></a>
<!--l. 684--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.7.13.3.1</span> <a 
 id="x1-680001"></a>Driver Requirements: Updating idx</h5>
The driver MUST perform a suitable memory barrier before the <span 
class="aeti-10">idx </span>update, to
ensure the device sees the most up-to-date copy.
<a 
 id="x1-68001r67"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.7.13.4   </span> <a 
 id="x1-690004"></a>Notifying The Device</h5>
<!--l. 690--><p class="noindent" >The actual method of device notification is bus-specific, but generally it can be
expensive. So the device MAY suppress such notifications if it doesn’t need them, as
detailed in section <a 
href="#x1-5900010">2.7.10<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Notification Suppression --></a>.
<!--l. 694--><p class="noindent" >The driver has to be careful to expose the new <span 
class="aeti-10">idx </span>value before checking if
notifications are suppressed.
<a 
 id="x1-69001r68"></a>
<!--l. 697--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.7.13.4.1</span> <a 
 id="x1-700001"></a>Driver Requirements: Notifying The Device</h5>
The driver MUST perform a suitable memory barrier before reading <span 
class="aeti-10">flags </span>or
<span 
class="aeti-10">avail_event</span>, to avoid missing a notification.
                                                                  

                                                                  
<a 
 id="x1-70001r64"></a>
<h4 class="subsectionHead"><span class="titlemark">2.7.14   </span> <a 
 id="x1-7100014"></a>Receiving Used Buffers From The Device</h4>
<!--l. 703--><p class="noindent" >Once the device has used buffers referred to by a descriptor (read from or written to
them, or parts of both, depending on the nature of the virtqueue and the
device), it sends a used buffer notification to the driver as detailed in section
<a 
href="#x1-510007">2.7.7<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Used Buffer Notification Suppression --></a>.
<span 
class="aeb10-">Note:</span>
      <!--l. 711--><p class="noindent" >For optimal performance, a driver MAY disable used buffer notifications
      while  processing  the  used  ring,  but  beware  the  problem  of  missing
      notifications between emptying the ring and reenabling notifications. This
      is usually handled by re-checking for more used buffers after notifications
      are re-enabled:
      <!--l. 717-->
      <pre class="lstlisting" id="listing-14"><span class="label"><a 
 id="x1-71001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_disable_used_buffer_notifications</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(;;)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last_seen_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16_to_cpu</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_enable_used_buffer_notifications</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mb</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">()</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last_seen_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16_to_cpu</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">break</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_disable_used_buffer_notifications</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used_elem</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last_seen_used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">%</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vsz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">process_buffer</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last_seen_used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">++;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-71017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
      
<a 
 id="x1-71018r35"></a>
<h3 class="sectionHead"><span class="titlemark">2.8   </span> <a 
 id="x1-720008"></a>Packed Virtqueues</h3>
<!--l. 3--><p class="noindent" >Packed virtqueues is an alternative compact virtqueue layout using read-write
memory, that is memory that is both read and written by both the device and the
driver.
<!--l. 7--><p class="noindent" >Use of packed virtqueues is negotiated by the VIRTIO_F_RING_PACKED feature
bit.
<!--l. 10--><p class="noindent" >Packed virtqueues support up to <span 
class="cmr-10">2</span><sup><span 
class="cmr-7">15</span></sup> entries each.
<!--l. 12--><p class="noindent" >With current transports, virtqueues are located in guest memory allocated by the
driver. Each packed virtqueue consists of three parts:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 17--><p class="noindent" >Descriptor Ring - occupies the Descriptor Area
     </li>
     <li class="itemize">
     <!--l. 18--><p class="noindent" >Driver Event Suppression - occupies the Driver Area
     </li>
     <li class="itemize">
     <!--l. 19--><p class="noindent" >Device Event Suppression - occupies the Device Area</li></ul>
                                                                  

                                                                  
<!--l. 22--><p class="noindent" >Where the Descriptor Ring in turn consists of descriptors, and where each descriptor
can contain the following parts:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 26--><p class="noindent" >Buffer ID
     </li>
     <li class="itemize">
     <!--l. 27--><p class="noindent" >Element Address
     </li>
     <li class="itemize">
     <!--l. 28--><p class="noindent" >Element Length
     </li>
     <li class="itemize">
     <!--l. 29--><p class="noindent" >Flags</li></ul>
<!--l. 32--><p class="noindent" >A buffer consists of zero or more device-readable physically-contiguous elements
followed by zero or more physically-contiguous device-writable elements (each buffer
has at least one element).
<!--l. 36--><p class="noindent" >When the driver wants to send such a buffer to the device, it writes at least one
available descriptor describing elements of the buffer into the Descriptor Ring. The
descriptor(s) are associated with a buffer by means of a Buffer ID stored within the
descriptor.
<!--l. 42--><p class="noindent" >The driver then notifies the device. When the device has finished processing the
buffer, it writes a used device descriptor including the Buffer ID into the Descriptor
Ring (overwriting a driver descriptor previously made available), and sends a used
event notification.
<!--l. 48--><p class="noindent" >The Descriptor Ring is used in a circular manner: the driver writes descriptors into
the ring in order. After reaching the end of the ring, the next descriptor is placed at
the head of the ring. Once the ring is full of driver descriptors, the driver stops
sending new requests and waits for the device to start processing descriptors and
to write out some used descriptors before making new driver descriptors
available.
<!--l. 56--><p class="noindent" >Similarly, the device reads descriptors from the ring in order and detects that a driver
descriptor has been made available. As processing of descriptors is completed, used
descriptors are written by the device back into the ring.
<!--l. 61--><p class="noindent" >Note: after reading driver descriptors and starting their processing in order, the
device might complete their processing out of order. Used device descriptors are
written in the order in which their processing is complete.
<!--l. 66--><p class="noindent" >The Device Event Suppression data structure is write-only by the device. It includes
                                                                  

                                                                  
information for reducing the number of device events, i.e., sending fewer available
buffer notifications to the device.
<!--l. 71--><p class="noindent" >The Driver Event Suppression data structure is read-only by the device. It includes
information for reducing the number of driver events, i.e., sending fewer used buffer
notifications to the driver.
<a 
 id="x1-72001r71"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.1   </span> <a 
 id="x1-730001"></a>Driver and Device Ring Wrap Counters</h4>
<!--l. 78--><p class="noindent" >Each of the driver and the device are expected to maintain, internally, a single-bit
ring wrap counter initialized to 1.
<!--l. 81--><p class="noindent" >The counter maintained by the driver is called the Driver Ring Wrap Counter. The
driver changes the value of this counter each time it makes available the last
descriptor in the ring (after making the last descriptor available).
<!--l. 87--><p class="noindent" >The counter maintained by the device is called the Device Ring Wrap Counter. The
device changes the value of this counter each time it uses the last descriptor in the
ring (after marking the last descriptor used).
<!--l. 92--><p class="noindent" >It is easy to see that the Driver Ring Wrap Counter in the driver matches the Device
Ring Wrap Counter in the device when both are processing the same descriptor, or
when all available descriptors have been used.
<!--l. 96--><p class="noindent" >To mark a descriptor as available and used, both the driver and the device use the
following two flags: <!--l. 98-->
<pre class="lstlisting" id="listing-15"><span class="label"><a 
 id="x1-73001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_AVAIL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-73002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_USED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15)</span></span></pre>
<!--l. 103--><p class="noindent" >To mark a descriptor as available, the driver sets the VIRTQ_DESC_F_AVAIL bit
in Flags to match the internal Driver Ring Wrap Counter. It also sets the
VIRTQ_DESC_F_USED bit to match the <span 
class="aeti-10">inverse </span>value (i.e. to not match the internal
Driver Ring Wrap Counter).
<!--l. 109--><p class="noindent" >To mark a descriptor as used, the device sets the VIRTQ_DESC_F_USED bit in
Flags to match the internal Device Ring Wrap Counter. It also sets the
VIRTQ_DESC_F_AVAIL bit to match the <span 
class="aeti-10">same </span>value.
<!--l. 114--><p class="noindent" >Thus VIRTQ_DESC_F_AVAIL and VIRTQ_DESC_F_USED bits are different for an
available descriptor and equal for a used descriptor.
<!--l. 117--><p class="noindent" >Note that this observation is mostly useful for sanity-checking as these are necessary
but not sufficient conditions - for example, all descriptors are zero-initialized. To
detect used and available descriptors it is possible for drivers and devices to keep
track of the last observed value of VIRTQ_DESC_F_USED/VIRTQ_DESC_F_AVAIL.
Other techniques to detect VIRTQ_DESC_F_AVAIL/VIRTQ_DESC_F_USED bit
changes might also be possible.
<a 
 id="x1-73003r73"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">2.8.2   </span> <a 
 id="x1-740002"></a>Polling of available and used descriptors</h4>
<!--l. 129--><p class="noindent" >Writes of device and driver descriptors can generally be reordered, but each side
(driver and device) are only required to poll (or test) a single location in memory: the
next device descriptor after the one they processed previously, in circular
order.
<!--l. 134--><p class="noindent" >Sometimes the device needs to only write out a single used descriptor after processing
a batch of multiple available descriptors. As described in more detail below, this can
happen when using descriptor chaining or with in-order use of descriptors. In this
case, the device writes out a used descriptor with the buffer id of the last descriptor
in the group. After processing the used descriptor, both device and driver then skip
forward in the ring the number of the remaining descriptors in the group until
processing (reading for the driver and writing for the device) the next used
descriptor.
<a 
 id="x1-74001r74"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.3   </span> <a 
 id="x1-750003"></a>Write Flag</h4>
<!--l. 148--><p class="noindent" >In an available descriptor, the VIRTQ_DESC_F_WRITE bit within Flags is used to
mark a descriptor as corresponding to a write-only or read-only element of a
buffer.
<!--l. 152-->
<pre class="lstlisting" id="listing-16"><span class="label"><a 
 id="x1-75001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">marks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">otherwise</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-75002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_WRITE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<!--l. 157--><p class="noindent" >In a used descriptor, this bit is used to specify whether any data has been written by
the device into any parts of the buffer.
<a 
 id="x1-75003r75"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.4   </span> <a 
 id="x1-760004"></a>Element Address and Length</h4>
<!--l. 164--><p class="noindent" >In an available descriptor, Element Address corresponds to the physical address of
the buffer element. The length of the element assumed to be physically contiguous is
stored in Element Length.
<!--l. 168--><p class="noindent" >In a used descriptor, Element Address is unused. Element Length specifies the length
of the buffer that has been initialized (written to) by the device.
<!--l. 172--><p class="noindent" >Element Length is reserved for used descriptors without the VIRTQ_DESC_F_WRITE
flag, and is ignored by drivers.
<a 
 id="x1-76001r76"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.5   </span> <a 
 id="x1-770005"></a>Scatter-Gather Support</h4>
<!--l. 178--><p class="noindent" >Some drivers need an ability to supply a list of multiple buffer elements (also known
as a scatter/gather list) with a request. Two features support this: descriptor
chaining and indirect descriptors.
                                                                  

                                                                  
<!--l. 182--><p class="noindent" >If neither feature is in use by the driver, each buffer is physically-contiguous, either
read-only or write-only and is described completely by a single descriptor.
<!--l. 186--><p class="noindent" >While unusual (most implementations either create all lists solely using non-indirect
descriptors, or always use a single indirect element), if both features have been
negotiated, mixing indirect and non-indirect descriptors in a ring is valid, as long as
each list only contains descriptors of a given type.
<!--l. 192--><p class="noindent" >Scatter/gather lists only apply to available descriptors. A single used descriptor
corresponds to the whole list.
<!--l. 195--><p class="noindent" >The device limits the number of descriptors in a list through a transport-specific
and/or device-specific value. If not limited, the maximum number of descriptors in a
list is the virtqueue size.
<a 
 id="x1-77001r77"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.6   </span> <a 
 id="x1-780006"></a>Next Flag: Descriptor Chaining</h4>
<!--l. 203--><p class="noindent" >The packed ring format allows the driver to supply a scatter/gather list to the device
by using multiple descriptors, and setting the VIRTQ_DESC_F_NEXT bit in Flags
for all but the last available descriptor.
<!--l. 208-->
<pre class="lstlisting" id="listing-17"><span class="label"><a 
 id="x1-78001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">marks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">continuing</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-78002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_NEXT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<!--l. 213--><p class="noindent" >Buffer ID is included in the last descriptor in the list.
<!--l. 215--><p class="noindent" >The driver always makes the first descriptor in the list available after the rest of the
list has been written out into the ring. This guarantees that the device will never
observe a partial scatter/gather list in the ring.
<!--l. 220--><p class="noindent" >Note: all flags, including VIRTQ_DESC_F_AVAIL, VIRTQ_DESC_F_USED,
VIRTQ_DESC_F_WRITE must be set/cleared correctly in all descriptors in the list,
not just the first one.
<!--l. 224--><p class="noindent" >The device only writes out a single used descriptor for the whole list. It
then skips forward according to the number of descriptors in the list. The
driver needs to keep track of the size of the list corresponding to each buffer
ID, to be able to skip to where the next used descriptor is written by the
device.
<!--l. 230--><p class="noindent" >For example, if descriptors are used in the same order in which they are made
available, this will result in the used descriptor overwriting the first available
descriptor in the list, the used descriptor for the next list overwriting the first
available descriptor in the next list, etc.
<!--l. 236--><p class="noindent" >VIRTQ_DESC_F_NEXT is reserved in used descriptors, and should be ignored by
drivers.
<a 
 id="x1-78003r78"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">2.8.7   </span> <a 
 id="x1-790007"></a>Indirect Flag: Scatter-Gather Support</h4>
<!--l. 242--><p class="noindent" >Some devices benefit by concurrently dispatching a large number of large requests.
The VIRTIO_F_INDIRECT_DESC feature allows this. To increase ring capacity the
driver can store a (read-only by the device) table of indirect descriptors anywhere
in memory, and insert a descriptor in the main virtqueue (with <span 
class="aeti-10">Flags </span>bit
VIRTQ_DESC_F_INDIRECT on) that refers to a buffer element containing this
indirect descriptor table; <span 
class="aeti-10">addr </span>and <span 
class="aeti-10">len </span>refer to the indirect table address and length
in bytes, respectively. <!--l. 251-->
<pre class="lstlisting" id="listing-18"><span class="label"><a 
 id="x1-79001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">means</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">element</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">contains</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">table</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-79002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_INDIRECT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span></pre>
<!--l. 256--><p class="noindent" >The indirect table layout structure looks like this (<span 
class="aeti-10">len </span>is the Buffer Length of the
descriptor that refers to this table, which is a variable):
<!--l. 260-->
<pre class="lstlisting" id="listing-19"><span class="label"><a 
 id="x1-79003r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pvirtq_indirect_descriptor_table</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-79004r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actual</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">structures</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pvirtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">each</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-79005r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pvirtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pvirtq_desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-79006r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 267--><p class="noindent" >The first descriptor is located at the start of the indirect descriptor table, additional
indirect descriptors come immediately afterwards. The VIRTQ_DESC_F_WRITE
<span 
class="aeti-10">flags </span>bit is the only valid flag for descriptors in the indirect table. Others are reserved
and are ignored by the device. Buffer ID is also reserved and is ignored by the
device.
<!--l. 274--><p class="noindent" >In descriptors with VIRTQ_DESC_F_INDIRECT set VIRTQ_DESC_F_WRITE is
reserved and is ignored by the device.
<a 
 id="x1-79007r79"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.8   </span> <a 
 id="x1-800008"></a>In-order use of descriptors</h4>
<!--l. 280--><p class="noindent" >Some devices always use descriptors in the same order in which they have been made
available. These devices can offer the VIRTIO_F_IN_ORDER feature. If negotiated,
this knowledge allows devices to notify the use of a batch of buffers to the driver by
only writing out a single used descriptor with the Buffer ID corresponding to the last
descriptor in the batch.
<!--l. 287--><p class="noindent" >The device then skips forward in the ring according to the size of the batch. The
driver needs to look up the used Buffer ID and calculate the batch size to be
able to advance to where the next used descriptor will be written by the
device.
<!--l. 292--><p class="noindent" >This will result in the used descriptor overwriting the first available descriptor in the
batch, the used descriptor for the next batch overwriting the first available descriptor
in the next batch, etc.
<!--l. 297--><p class="noindent" >The skipped buffers (for which no used descriptor was written) are assumed to have
been used (read or written) by the device completely.
<a 
 id="x1-80001r80"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">2.8.9   </span> <a 
 id="x1-810009"></a>Multi-buffer requests</h4>
<!--l. 303--><p class="noindent" >Some devices combine multiple buffers as part of processing of a single request. These
devices always mark the descriptor corresponding to the first buffer in the request
used after the rest of the descriptors (corresponding to rest of the buffers) in the
request - which follow the first descriptor in ring order - has been marked used and
written out into the ring. This guarantees that the driver will never observe a partial
request in the ring.
<a 
 id="x1-81001r81"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.10   </span> <a 
 id="x1-8200010"></a>Driver and Device Event Suppression</h4>
<!--l. 314--><p class="noindent" >In many systems used and available buffer notifications involve significant overhead.
To mitigate this overhead, each virtqueue includes two identical structures used for
controlling notifications between the device and the driver.
<!--l. 319--><p class="noindent" >The Driver Event Suppression structure is read-only by the device and controls the
used buffer notifications sent by the device to the driver.
<!--l. 323--><p class="noindent" >The Device Event Suppression structure is read-only by the driver and controls the
available buffer notifications sent by the driver to the device.
<!--l. 327--><p class="noindent" >Each of these Event Suppression structures includes the following fields:
     <dl class="description"><dt class="description">
     <!--l. 330--><p class="noindent" >
<span 
class="aeb10-">Descriptor Ring Change Event Flags</span> </dt><dd 
class="description">
     <!--l. 330--><p class="noindent" >Takes values: <!--l. 331-->
     <pre class="lstlisting" id="listing-20"><span class="label"><a 
 id="x1-82001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Enable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">events</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_ENABLE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Disable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">events</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_DISABLE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Enable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">events</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specified</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Ring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Change</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Wrap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">valid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_EVENT_IDX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">has</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">been</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_DESC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-82011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x3</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span></pre>
     
     </dd><dt class="description">
     <!--l. 344--><p class="noindent" >
<span 
class="aeb10-">Descriptor Ring Change Event Offset</span> </dt><dd 
class="description">
     <!--l. 344--><p class="noindent" >If Event Flags set to descriptor specific event: offset within the ring (in units of
     descriptor size). Event will only trigger when this descriptor is made
     available/used respectively.
     </dd><dt class="description">
     <!--l. 348--><p class="noindent" >
<span 
class="aeb10-">Descriptor Ring Change Event Wrap Counter</span> </dt><dd 
class="description">
     <!--l. 348--><p class="noindent" >If Event Flags set to descriptor specific event: offset within the ring
     (in units of descriptor size). Event will only trigger when Ring Wrap
     Counter matches this value and a descriptor is made available/used
     respectively.</dd></dl>
                                                                  

                                                                  
<!--l. 355--><p class="noindent" >After writing out some descriptors, both the device and the driver are expected to
consult the relevant structure to find out whether a used respectively an available
buffer notification should be sent.
<a 
 id="x1-82012r69"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.8.10.1   </span> <a 
 id="x1-830001"></a>Structure Size and Alignment</h5>
<!--l. 362--><p class="noindent" >Each part of the virtqueue is physically-contiguous in guest memory, and has
different alignment requirements.
<!--l. 365--><p class="noindent" >The memory alignment and size requirements, in bytes, of each part of the virtqueue
are summarized in the following table:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Virtqueue Part                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Alignment  </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Size                  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Descriptor Ring               </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16            </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="cmr-10">16</span><span 
class="cmsy-10">∗</span>(Queue Size)  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device Event Suppression  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4              </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Driver Event Suppression  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4              </td><td style="text-align: left; min-width: \@testpach 3 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4                      </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 380--><p class="noindent" >The Alignment column gives the minimum alignment for each part of the
virtqueue.
<!--l. 383--><p class="noindent" >The Size column gives the total number of bytes for each part of the virtqueue.
<!--l. 386--><p class="noindent" >Queue Size corresponds to the maximum number of descriptors in the
virtqueue<span class="footnote-mark"><a 
href="#fn5x2" id="fn5x2-bk"><sup class="textsuperscript">5</sup></a></span><a 
 id="x1-83001f5"></a>.
The Queue Size value does not have to be a power of 2.
<a 
 id="x1-83002r82"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.11   </span> <a 
 id="x1-8400011"></a>Driver Requirements: Virtqueues</h4>
<!--l. 392--><p class="noindent" >The driver MUST ensure that the physical address of the first byte of each
virtqueue part is a multiple of the specified alignment value in the above
table.
<a 
 id="x1-84001r84"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.12   </span> <a 
 id="x1-8500012"></a>Device Requirements: Virtqueues</h4>
<!--l. 397--><p class="noindent" >The device MUST start processing driver descriptors in the order in which they
appear in the ring. The device MUST start writing device descriptors into the ring in
the order in which they complete. The device MAY reorder descriptor writes once
they are started.
<a 
 id="x1-85001r85"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.13   </span> <a 
 id="x1-8600013"></a>The Virtqueue Descriptor Format</h4>
<!--l. 407--><p class="noindent" >The available descriptor refers to the buffers the driver is sending to the device. <span 
class="aeti-10">addr</span>
is a physical address, and the descriptor is identified with a buffer using the <span 
class="aeti-10">id</span>
field.
<!--l. 411-->
<pre class="lstlisting" id="listing-21"><span class="label"><a 
 id="x1-86001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pvirtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Address</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">depending</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-86010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
                                                                  

                                                                  
<!--l. 424--><p class="noindent" >The descriptor ring is zero-initialized.
<a 
 id="x1-86011r86"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.14   </span> <a 
 id="x1-8700014"></a>Event Suppression Structure Format</h4>
<!--l. 430--><p class="noindent" >The following structure is used to reduce the number of notifications sent between
driver and device.
<!--l. 433-->
<pre class="lstlisting" id="listing-22"><span class="label"><a 
 id="x1-87001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pvirtq_event_suppress</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc_event_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Ring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Change</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc_event_wrap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Ring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Change</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Wrap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">If</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc_event_flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">set</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_DESC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc_event_flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Ring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Change</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">14;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">set</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-87010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-87011r87"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.15   </span> <a 
 id="x1-8800015"></a>Device Requirements: The Virtqueue Descriptor Table</h4>
<!--l. 447--><p class="noindent" >A device MUST NOT write to a device-readable buffer, and a device SHOULD NOT
read a device-writable buffer. A device MUST NOT use a descriptor unless it
observes the VIRTQ_DESC_F_AVAIL bit in its <span 
class="aeti-10">flags </span>being changed (e.g. as compared
to the initial zero value). A device MUST NOT change a descriptor after changing
it’s the VIRTQ_DESC_F_USED bit in its <span 
class="aeti-10">flags</span>.
<a 
 id="x1-88001r88"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.16   </span> <a 
 id="x1-8900016"></a>Driver Requirements: The Virtqueue Descriptor Table</h4>
<!--l. 456--><p class="noindent" >A driver MUST NOT change a descriptor unless it observes the VIRTQ_DESC_F_USED
bit in its <span 
class="aeti-10">flags </span>being changed. A driver MUST NOT change a descriptor after
changing the VIRTQ_DESC_F_AVAIL bit in its <span 
class="aeti-10">flags</span>. When notifying the device,
driver MUST set <span 
class="aeti-10">next_off  </span>and <span 
class="aeti-10">next_wrap </span>to match the next descriptor not
yet made available to the device. A driver MAY send multiple available
buffer notifications without making any new descriptors available to the
device.
<a 
 id="x1-89001r89"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.17   </span> <a 
 id="x1-9000017"></a>Driver Requirements: Scatter-Gather Support</h4>
<!--l. 468--><p class="noindent" >A driver MUST NOT create a descriptor list longer than allowed by the
device.
<!--l. 471--><p class="noindent" >A driver MUST NOT create a descriptor list longer than the Queue Size.
<!--l. 474--><p class="noindent" >This implies that loops in the descriptor list are forbidden!
<!--l. 476--><p class="noindent" >The driver MUST place any device-writable descriptor elements after any
device-readable descriptor elements.
<!--l. 479--><p class="noindent" >A driver MUST NOT depend on the device to use more descriptors to be able to
write out all descriptors in a list. A driver MUST make sure there’s enough space in
the ring for the whole list before making the first descriptor in the list available to
the device.
                                                                  

                                                                  
<!--l. 485--><p class="noindent" >A driver MUST NOT make the first descriptor in the list available before all
subsequent descriptors comprising the list are made available.
<a 
 id="x1-90001r90"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.18   </span> <a 
 id="x1-9100018"></a>Device Requirements: Scatter-Gather Support</h4>
<!--l. 490--><p class="noindent" >The device MUST use descriptors in a list chained by the VIRTQ_DESC_F_NEXT
flag in the same order that they were made available by the driver.
<!--l. 494--><p class="noindent" >The device MAY limit the number of buffers it will allow in a list.
<a 
 id="x1-91001r91"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.19   </span> <a 
 id="x1-9200019"></a>Driver Requirements: Indirect Descriptors</h4>
<!--l. 498--><p class="noindent" >The driver MUST NOT set the VIRTQ_DESC_F_INDIRECT flag unless the
VIRTIO_F_INDIRECT_DESC feature was negotiated. The driver MUST NOT set
any flags except DESC_F_WRITE within an indirect descriptor.
<!--l. 502--><p class="noindent" >A driver MUST NOT create a descriptor chain longer than allowed by the
device.
<!--l. 505--><p class="noindent" >A driver MUST NOT write direct descriptors with VIRTQ_DESC_F_INDIRECT set
in a scatter-gather list linked by VIRTQ_DESC_F_NEXT. <span 
class="aeti-10">flags</span>.
<a 
 id="x1-92001r92"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.20   </span> <a 
 id="x1-9300020"></a>Virtqueue Operation</h4>
<!--l. 512--><p class="noindent" >There are two parts to virtqueue operation: supplying new available buffers to the
device, and processing used buffers from the device.
<!--l. 516--><p class="noindent" >What follows is the requirements of each of these two parts when using the packed
virtqueue format in more detail.
<a 
 id="x1-93001r93"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.21   </span> <a 
 id="x1-9400021"></a>Supplying Buffers to The Device</h4>
<!--l. 521--><p class="noindent" >The driver offers buffers to one of the device’s virtqueues as follows:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The driver places the buffer into free descriptor(s) in the Descriptor Ring.
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">The driver performs a suitable memory barrier to ensure that it updates
     the descriptor(s) before checking for notification suppression.
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If notifications are not suppressed, the driver notifies the device of the new
     available buffers.</dd></dl>
<!--l. 533--><p class="noindent" >What follows are the requirements of each stage in more detail.
<a 
 id="x1-94004r83"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">2.8.21.1   </span> <a 
 id="x1-950001"></a>Placing Available Buffers Into The Descriptor Ring</h5>
<!--l. 537--><p class="noindent" >For each buffer element, b:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Get the next descriptor table entry, d
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Get the next free buffer id value
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Set <span 
class="aeti-10">d.addr </span>to the physical address of the start of b
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Set <span 
class="aeti-10">d.len </span>to the length of b.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">Set <span 
class="aeti-10">d.id </span>to the buffer id
     </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">Calculate the flags as follows:
         <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
      (a) </dt><dd 
class="enumerate-enumitem">If b is device-writable, set the VIRTQ_DESC_F_WRITE bit to 1,
         otherwise 0
         </dd><dt class="enumerate-enumitem">
     (b) </dt><dd 
class="enumerate-enumitem">Set the VIRTQ_DESC_F_AVAIL bit to the current value of the Driver
         Ring Wrap Counter
         </dd><dt class="enumerate-enumitem">
      (c) </dt><dd 
class="enumerate-enumitem">Set the VIRTQ_DESC_F_USED bit to inverse value</dd></dl>
     </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">Perform a memory barrier to ensure that the descriptor has been initialized
     </dd><dt class="enumerate-enumitem">
  8. </dt><dd 
class="enumerate-enumitem">Set <span 
class="aeti-10">d.flags </span>to the calculated flags value
     </dd><dt class="enumerate-enumitem">
  9. </dt><dd 
class="enumerate-enumitem">If d is the last descriptor in the ring, toggle the Driver Ring Wrap
     Counter
     </dd><dt class="enumerate-enumitem">
 10. </dt><dd 
class="enumerate-enumitem">Otherwise, increment d to point at the next descriptor</dd></dl>
<!--l. 559--><p class="noindent" >This makes a single descriptor buffer available. However, in general the driver
MAY make use of a batch of descriptors as part of a single request. In that
case, it defers updating the descriptor flags for the first descriptor (and the
previous memory barrier) until after the rest of the descriptors have been
initialized.
<!--l. 566--><p class="noindent" >Once the descriptor <span 
class="aeti-10">flags </span>field is updated by the driver, this exposes the descriptor
                                                                  

                                                                  
and its contents. The device MAY access the descriptor and any following descriptors
the driver created and the memory they refer to immediately.
<a 
 id="x1-95014r70"></a>
<!--l. 571--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.8.21.1.1</span> <a 
 id="x1-960001"></a>Driver Requirements: Updating flags</h5>
The driver MUST perform a suitable memory barrier before the <span 
class="aeti-10">flags </span>update, to
ensure the device sees the most up-to-date copy.
<a 
 id="x1-96001r95"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.8.21.2   </span> <a 
 id="x1-970002"></a>Sending Available Buffer Notifications</h5>
<!--l. 580--><p class="noindent" >The actual method of device notification is bus-specific, but generally it can be
expensive. So the device MAY suppress such notifications if it doesn’t need them,
using the Event Suppression structure comprising the Device Area as detailed in
section <a 
href="#x1-8700014">2.8.14<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Packed Virtqueues / Event Suppression Structure Format --></a>.
<!--l. 587--><p class="noindent" >The driver has to be careful to expose the new <span 
class="aeti-10">flags </span>value before checking if
notifications are suppressed.
<a 
 id="x1-97001r97"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.8.21.3   </span> <a 
 id="x1-980003"></a>Implementation Example</h5>
<!--l. 592--><p class="noindent" >Below is a driver code example. It does not attempt to reduce the number of
available buffer notifications, neither does it support the VIRTIO_F_EVENT_IDX
feature.
<!--l. 596-->
<pre class="lstlisting" id="listing-23"><span class="label"><a 
 id="x1-98001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Note</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">initialized</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Note</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">an</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">array</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">same</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">alloc_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">first</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">each</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">element</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">++;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ids</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">].</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">address</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">get_addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">].</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">get_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">?</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_AVAIL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">?</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_USED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">f</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">get_flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">not</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">element</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">f</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_NEXT</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Don</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mark</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">st</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">available</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">until</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">all</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">them</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ready</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">==</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">first</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">f</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">else</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">].</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">f</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">++;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">^=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98037r37"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98038r38"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98039r39"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ID</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">included</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">list</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98040r40"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">].</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98041r41"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write_memory_barrier</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">()</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98042r42"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">first</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">].</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98043r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98044r44"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">memory_barrier</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">()</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98045r45"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98046r46"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_DISABLE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98047r47"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notify_device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-98048r48"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<a 
 id="x1-98051r96"></a>
<!--l. 649--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.8.21.3.1</span> <a 
 id="x1-990001"></a>Driver Requirements: Sending Available Buffer Notifications</h5>
The driver MUST perform a suitable memory barrier before reading the Event
Suppression structure occupying the Device Area. Failing to do so could result in
mandatory available buffer notifications not being sent.
<a 
 id="x1-99001r94"></a>
<h4 class="subsectionHead"><span class="titlemark">2.8.22   </span> <a 
 id="x1-10000022"></a>Receiving Used Buffers From The Device</h4>
<!--l. 657--><p class="noindent" >Once the device has used buffers referred to by a descriptor (read from or written to
them, or parts of both, depending on the nature of the virtqueue and the
device), it sends a used buffer notification to the driver as detailed in section
<a 
href="#x1-8700014">2.8.14<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Packed Virtqueues / Event Suppression Structure Format --></a>.
<span 
class="aeb10-">Note:</span>
      <!--l. 666--><p class="noindent" >For optimal performance, a driver MAY disable used buffer notifications
      while processing the used buffers, but beware the problem of missing
                                                                  

                                                                  
      notifications  between  emptying  the  ring  and  reenabling  used  buffer
      notifications. This is usually handled by re-checking for more used buffers
      after notifications are re-enabled:
<!--l. 674-->
<pre class="lstlisting" id="listing-24"><span class="label"><a 
 id="x1-100001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Note</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">initialized</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_DISABLE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(;;)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pvirtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Check</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">has</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">been</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">made</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">available</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">check</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">necessary</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">making</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">new</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">available</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parallel</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">processing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">g</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">another</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">thread</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Note</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">there</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">many</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">other</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ways</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">check</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">g</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">track</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">number</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">outstanding</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">available</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffers</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">check</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">it</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">not</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">has</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">been</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bool</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_AVAIL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bool</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_USED</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">||</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_wrap_count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_ENABLE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">memory_barrier</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">()</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Re</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">test</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">case</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">made</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">more</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">available</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parallel</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">processing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">g</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">another</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">thread</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">more</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">before</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enabled</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">events</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bool</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_AVAIL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bool</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_USED</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">||</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_wrap_count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">break</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RING_EVENT_FLAGS_DISABLE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read_memory_barrier</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">()</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100042r42"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100043r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">skip</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">until</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100044r44"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100045r45"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">assert</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100046r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100047r47"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sgs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100048r48"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100049r49"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100050r50"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_wrap_count</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">^=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100051r51"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100052r52"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100053r53"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">free_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100054r54"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100055r55"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">process_buffer</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-100056r56"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<a 
 id="x1-100057r72"></a>
<h3 class="sectionHead"><span class="titlemark">2.9   </span> <a 
 id="x1-1010009"></a>Driver Notifications</h3>
<!--l. 448--><p class="noindent" >The driver is sometimes required to send an available buffer notification to the
device.
<!--l. 451--><p class="noindent" >When VIRTIO_F_NOTIFICATION_DATA has not been negotiated, this notification
contains either a virtqueue index if VIRTIO_F_NOTIF_CONFIG_DATA
is not negotiated or device supplied virtqueue notification config data if
VIRTIO_F_NOTIF_CONFIG_DATA is negotiated.
<!--l. 456--><p class="noindent" >The notification method and supplying any such virtqueue notification config data is
transport specific.
<!--l. 459--><p class="noindent" >However, some devices benefit from the ability to find out the amount of available
data in the queue without accessing the virtqueue in memory: for efficiency or as a
debugging aid.
<!--l. 463--><p class="noindent" >To help with these optimizations, when VIRTIO_F_NOTIFICATION_DATA
has been negotiated, driver notifications to the device include the following
information:
     <dl class="description"><dt class="description">
     <!--l. 468--><p class="noindent" >
<span 
class="aeb10-">vq_index or vq_notif_config_data</span> </dt><dd 
class="description">
     <!--l. 468--><p class="noindent" >Either virtqueue index or device supplied queue notification config data
     corresponding to a virtqueue.
     </dd><dt class="description">
     <!--l. 470--><p class="noindent" >
<span 
class="aeb10-">next_off</span> </dt><dd 
class="description">
     <!--l. 470--><p class="noindent" >Offset  within  the  ring  where  the  next  available  ring  entry  will  be
     written. When VIRTIO_F_RING_PACKED has not been negotiated this
     refers  to  the  15  least  significant  bits  of  the  available  index.  When
     VIRTIO_F_RING_PACKED has been negotiated this refers to the offset
     (in units of descriptor entries) within the descriptor ring where the next
     available descriptor will be written.
     </dd><dt class="description">
                                                                  

                                                                  
     <!--l. 479--><p class="noindent" >
<span 
class="aeb10-">next_wrap</span> </dt><dd 
class="description">
     <!--l. 479--><p class="noindent" >Wrap           Counter.           With           VIRTIO_F_RING_PACKED
     this is the wrap counter referring to the next available descriptor. Without
     VIRTIO_F_RING_PACKED this is the most significant bit (bit 15) of the
     available index.</dd></dl>
<!--l. 486--><p class="noindent" >Note that the driver can send multiple notifications even without making any
more buffers available. When VIRTIO_F_NOTIFICATION_DATA has been
negotiated, these notifications would then have identical <span 
class="aeti-10">next_off  </span>and <span 
class="aeti-10">next_wrap</span>
values.
<a 
 id="x1-101001r101"></a>
<h3 class="sectionHead"><span class="titlemark">2.10   </span> <a 
 id="x1-10200010"></a>Shared Memory Regions</h3>
<!--l. 3--><p class="noindent" >Shared memory regions are an additional facility available to devices that
need a region of memory that’s continuously shared between the device and
the driver, rather than passed between them in the way virtqueue elements
are.
<!--l. 8--><p class="noindent" >Example uses include shared caches and version pools for versioned data
structures.
<!--l. 11--><p class="noindent" >The memory region is allocated by the device and presented to the driver. Where the
device is implemented in software on a host, this arrangement allows the memory
region to be allocated by a library on the host, which the device may not have full
control over.
<!--l. 17--><p class="noindent" >A device may have multiple shared memory regions associated with it. Each region
has a <span 
class="aeti-10">shmid </span>to identify it, the meaning of which is device-specific.
<!--l. 21--><p class="noindent" >Enumeration and location of shared memory regions is performed in a transport-specific
way.
<!--l. 24--><p class="noindent" >Memory consistency rules vary depending on the region and the device and they will
be specified as required by each device.
<a 
 id="x1-102001r100"></a>
<h4 class="subsectionHead"><span class="titlemark">2.10.1   </span> <a 
 id="x1-1030001"></a>Addressing within regions</h4>
<!--l. 29--><p class="noindent" >References into shared memory regions are represented as offsets from the beginning
of the region instead of absolute memory addresses. Offsets are used both for
references between structures stored within shared memory and for requests placed in
virtqueues that refer to shared memory. The <span 
class="aeti-10">shmid </span>may be explicit or may be
inferred from the context of the reference.
<a 
 id="x1-103001r103"></a>
<h4 class="subsectionHead"><span class="titlemark">2.10.2   </span> <a 
 id="x1-1040002"></a>Device Requirements: Shared Memory Regions</h4>
<!--l. 39--><p class="noindent" >Shared memory regions MUST NOT expose shared memory regions which are used
to control the operation of the device, nor to stream data.
                                                                  

                                                                  
<a 
 id="x1-104001r102"></a>
<h3 class="sectionHead"><span class="titlemark">2.11   </span> <a 
 id="x1-10500011"></a>Exporting Objects</h3>
<!--l. 495--><p class="noindent" >When an object created by one virtio device needs to be shared with a separate virtio
device, the first device can export the object by generating a UUID which can then
be passed to the second device to identify the object.
<!--l. 500--><p class="noindent" >What constitutes an object, how to export objects, and how to import objects are
defined by the individual device types. It is RECOMMENDED that devices generate
version 4 UUIDs as specified by <a 
href="#x1-3003x2">[RFC4122]</a>.
<a 
 id="x1-105001r105"></a>
<h3 class="sectionHead"><span class="titlemark">2.12   </span> <a 
 id="x1-10600012"></a>Device groups</h3>
<!--l. 3--><p class="noindent" >It is occasionally useful to have a device control a group of other devices (the group
may occasionally include the device itself) within a group. The owner device itself is
not a member of the group (except in the special case of the self group). Terminology
used in such cases:
     <dl class="description"><dt class="description">
     <!--l. 10--><p class="noindent" >
<span 
class="aeb10-">Device group</span> </dt><dd 
class="description">
     <!--l. 10--><p class="noindent" >or just group, includes zero or more devices.
     </dd><dt class="description">
     <!--l. 12--><p class="noindent" >
<span 
class="aeb10-">Owner device</span> </dt><dd 
class="description">
     <!--l. 12--><p class="noindent" >or owner, the device controlling the group.
     </dd><dt class="description">
     <!--l. 14--><p class="noindent" >
<span 
class="aeb10-">Member device</span> </dt><dd 
class="description">
     <!--l. 14--><p class="noindent" >a device within a group. The owner device itself is not a member of the
     group except for the <span 
class="aeti-10">Self group type</span>.
     </dd><dt class="description">
     <!--l. 17--><p class="noindent" >
<span 
class="aeb10-">Member identifier</span> </dt><dd 
class="description">
     <!--l. 17--><p class="noindent" >each member has this identifier, unique within the group and used to
     address it through the owner device.
     </dd><dt class="description">
     <!--l. 20--><p class="noindent" >
<span 
class="aeb10-">Group type identifier</span> </dt><dd 
class="description">
                                                                  

                                                                  
     <!--l. 20--><p class="noindent" >specifies  what  kind  of  member  devices  there  are  in  a  group,  how  the
     member identifier is interpreted and what kind of control the owner has. A
     given owner can control multiple groups of different types but only a single
     group of a given type, thus the type and the owner together identify the
     group. <span class="footnote-mark"><a 
href="#fn6x2" id="fn6x2-bk"><sup class="textsuperscript">6</sup></a></span><a 
 id="x1-106001f6"></a></dd></dl>
<span 
class="aeb10-">Note:</span> Each device only has a single driver, thus for the purposes of this section,
      "the driver" is usually unambiguous and refers to the driver of the owner
      device. When there’s ambiguity, "owner driver" refers to the driver of the
      owner device, while "member driver" refers to the driver of a member
      device.
<!--l. 41--><p class="noindent" >The following group types, and their identifiers, are currently specified:
     <dl class="description"><dt class="description">
     <!--l. 43--><p class="noindent" >
<span 
class="aeb10-">Self group type (0x0)</span> </dt><dd 
class="description">
     <!--l. 43--><p class="noindent" >This device group includes the owner device itself and no other devices.
     The group type identifier for this group is 0x0. The member identifier for
     this group has a value of 0x0.
     </dd><dt class="description">
     <!--l. 48--><p class="noindent" >
<span 
class="aeb10-">SR-IOV group type (0x1)</span> </dt><dd 
class="description">
     <!--l. 48--><p class="noindent" >This device group has a PCI Single Root I/O Virtualization (SR-IOV)
     physical function (PF) device as the owner and includes all its SR-IOV
     virtual functions (VFs) as members (see <a 
href="#x1-3007x6">[PCIe]</a>).
     <!--l. 54--><p class="noindent" >The PF device itself is not a member of the group.
     <!--l. 56--><p class="noindent" >The group type identifier for this group is 0x1.
     <!--l. 58--><p class="noindent" >A member identifier for this group can have a value from 0x1 to <span 
class="aeti-10">NumVFs</span>
     as specified in the SR-IOV Extended Capability of the owner device and
     equals the SR-IOV VF number of the member device; the group only
     exists when the <span 
class="aeti-10">VF Enable </span>bit in the SR-IOV Control Register within the
     SR-IOV Extended Capability of the owner device is set (see <a 
href="#x1-3007x6">[PCIe]</a>).
     <!--l. 67--><p class="noindent" >Both owner and member devices for this group type use the Virtio PCI
     transport (see <a 
href="#x1-1630001">4.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a>).</dd></dl>
<a 
 id="x1-106002r104"></a>
<h4 class="subsectionHead"><span class="titlemark">2.12.1   </span> <a 
 id="x1-1070001"></a>Group administration commands</h4>
<!--l. 73--><p class="noindent" >The driver sends group administration commands to the owner device of a group
to control member devices of the group. This mechanism can be used, for
example, to configure a member device before it is initialized by its driver.
                                                                  

                                                                  
<span class="footnote-mark"><a 
href="#fn7x2" id="fn7x2-bk"><sup class="textsuperscript">7</sup></a></span><a 
 id="x1-107001f7"></a>
<!--l. 82--><p class="noindent" >All the group administration commands are of the following form:
<!--l. 84-->
<pre class="lstlisting" id="listing-25"><span class="label"><a 
 id="x1-107002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107003r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107004r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107005r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107006r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Self</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107007r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IOV</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107008r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2-65535</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107009r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107010r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">group_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107011r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unused</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">future</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">extensions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107012r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved1</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[12];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107013r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">group_member_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107014r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command_specific_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107015r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107016r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107017r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107018r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status_qualifier</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107019r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unused</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">future</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">extensions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107020r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved2</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107021r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command_specific_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107022r21"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 108--><p class="noindent" >For all commands, <span 
class="aeti-10">opcode</span>, <span 
class="aeti-10">group_type </span>and if necessary <span 
class="aeti-10">group_member_id </span>and
<span 
class="aeti-10">command_specific_data </span>are set by the driver, and the owner device sets <span 
class="aeti-10">status </span>and if
needed <span 
class="aeti-10">status_qualifier </span>and <span 
class="aeti-10">command_specific_result</span>.
<!--l. 114--><p class="noindent" >Generally, any unused device-readable fields are set to zero by the driver and ignored
by the device. Any unused device-writeable fields are set to zero by the device and
ignored by the driver.
<!--l. 118--><p class="noindent" ><span 
class="aeti-10">opcode </span>specifies the command. The valid values for <span 
class="aeti-10">opcode </span>can be found in the
following table:
                                                                  

                                                                  
<!--l. 166--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > opcode                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                                                                           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Command
 Description</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0000                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_CMD_LIST_QUERY                               </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Provides
 to
 driver
 list
 of
 commands
 supported
 for
 this
 group
 type</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0001                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_CMD_LIST_USE                                    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Provides
 to
 device
 list
 of
 commands
 used
 for
 this
 group
 type</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0002                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1090001">VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE</a>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Writes
 into
 the
 legacy
 common
 configuration
 structure</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0003                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1100002">VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ</a>    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reads
 from
 the
 legacy
 common
 configuration
 structure</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0004                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1110003">VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE</a>          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Writes
 into
 the
 legacy
 device
 configuration
 structure</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0005                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1120004">VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ</a>            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reads
 into
 the
 legacy
 device
 configuration
 structure</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0006                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1130005">VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO</a>               </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Query
 the
 notification
 region
 information</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-9"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0007                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1170001">VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY</a>                   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Query
 the
 supported
 device
 capabilities
 bitmap</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-10"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0008                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1180002">VIRTIO_ADMIN_CMD_DEVICE_CAP_GET</a>                       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Get
 the
 device
 capabilities</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-11"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0009                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1190003">VIRTIO_ADMIN_CMD_DRIVER_CAP_SET</a>                       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Set
 the
 driver
 capabilities</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-12"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000a                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1230001">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE</a>            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Create
 a
 device
 resource
 object</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-13"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000c                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1240002">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY</a>            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Modify
 a
 device
 resource
 object</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-14"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000b                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1250003">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY</a>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Query
 a
 device
 resource
 object</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-15"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000d                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1260004">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY</a>          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Destroy
 a
 device
 resource
 object</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-16"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000e                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1330001">VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET</a>      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Get
 the
 metadata
 of
 the
 device
 parts</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-17"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000f                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1340002">VIRTIO_ADMIN_CMD_DEV_PARTS_GET</a>                        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Get
 the
 device
 parts</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-18"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0010                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1350003">VIRTIO_ADMIN_CMD_DEV_PARTS_SET</a>                         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Set
 the
 device
 parts</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-19"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0011                </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1360004">VIRTIO_ADMIN_CMD_DEV_MODE_SET</a>                          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Stop
 or
 resume
 the
 device</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-20"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0013 - 0x7FFF  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                                                                                 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Commands
 using
 <span 
class="aeti-10">struct</span>
 <span 
class="aeti-10">virtio_admin_cmd</span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-21"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x8000 - 0xFFFF  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                                                                                 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved
 for
 future
 commands
 (possibly
 using
 a
 different
 structure)</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-22"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >                 </td>
</tr></table>                                                                  

                                                                  
<!--l. 168--><p class="noindent" >The <span 
class="aeti-10">group_type </span>specifies the group type identifier. The <span 
class="aeti-10">group_member_id </span>specifies the
member identifier within the group. See section <a 
href="#x1-10600012">2.12<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups --></a> for the definition of the group
type identifier and group member identifier.
<!--l. 174--><p class="noindent" >The <span 
class="aeti-10">status </span>describes the command result and possibly failure reason at an abstract
level, this is appropriate for forwarding to applications. The <span 
class="aeti-10">status_qualifier</span>
describes failures at a low virtio specific level, as appropriate for debugging.
The following table describes possible <span 
class="aeti-10">status </span>values; to simplify common
implementations, they are intentionally matching common <a 
href="#x1-3015x14">Linux error names and
numbers</a>:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Status (decimal)  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                                             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description                                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 00                    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_OK           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > successful completion                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 06                    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_ENXIO      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > no such capability or resource           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 11                    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_EAGAIN    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > try again                                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 12                    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_ENOMEM  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > insufficient resources                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16                    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_EBUSY      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > device busy                                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 22                    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_EINVAL     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > invalid command                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 28                    </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_ENOSPC   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > resources exhausted on device           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-9"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > other                 </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                                                    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > group administration command error  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-10"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 204--><p class="noindent" >When <span 
class="aeti-10">status </span>is VIRTIO_ADMIN_STATUS_OK, <span 
class="aeti-10">status_qualifier </span>is reserved and set to
zero by the device.
<!--l. 207--><p class="noindent" >The following table describes possible <span 
class="aeti-10">status_qualifier </span>values:
                                                                  

                                                                  
<!--l. 231--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Status           </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                                                                 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x00              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_OK                            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > used
 with
 VIRTIO_ADMIN_STATUS_OK</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x01              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_INVALID_COMMAND  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > command
 error:
 no
 additional
 information</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x02              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_INVALID_OPCODE     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > unsupported
 or
 invalid
 <span 
class="aeti-10">opcode</span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x03              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_INVALID_FIELD         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > unsupported
 or
 invalid
 field
 within
 <span 
class="aeti-10">command_specific_data</span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x04              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_INVALID_GROUP       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > unsupported
 or
 invalid
 <span 
class="aeti-10">group_type</span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x05              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_INVALID_MEMBER     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > unsupported
 or
 invalid
 <span 
class="aeti-10">group_member_id</span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x06              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_NORESOURCE           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > out
 of
 internal
 resources:
 ok
 to
 retry</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-9"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x07              </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_ADMIN_STATUS_Q_TRYAGAIN                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > command
 blocks
 for
 too
 long:
 should
 retry</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-10"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x08-0xFFFF  </td><td style="text-align: left; min-width: 5in; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                                                                        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > reserved
 for
 future
 use </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-11"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >              </td>
</tr></table>
<!--l. 233--><p class="noindent" >Each command uses a different <span 
class="aeti-10">command_specific_data </span>and <span 
class="aeti-10">command_specific_result</span>
                                                                  

                                                                  
structures and the length of <span 
class="aeti-10">command_specific_data </span>and <span 
class="aeti-10">command_specific_result</span>
depends on these structures and is described separately or is implicit in the structure
description.
<!--l. 239--><p class="noindent" >Before sending any group administration commands to the device, the driver needs to
communicate to the device which commands it is going to use. Initially (after reset),
only two commands are assumed to be used: VIRTIO_ADMIN_CMD_LIST_QUERY
and VIRTIO_ADMIN_CMD_LIST_USE.
<!--l. 244--><p class="noindent" >Before sending any other commands for any member of a specific group to the device,
the driver queries the supported commands via VIRTIO_ADMIN_CMD_LIST_QUERY
and sends the commands it is capable of using via VIRTIO_ADMIN_CMD_LIST_USE.
<!--l. 249--><p class="noindent" >Commands VIRTIO_ADMIN_CMD_LIST_QUERY and VIRTIO_ADMIN_CMD_LIST_USE
both use the following structure describing the command opcodes:
<!--l. 254-->
<pre class="lstlisting" id="listing-26"><span class="label"><a 
 id="x1-107023r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_list</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107024r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Indicates</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">which</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">below</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">were</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">returned</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107025r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device_admin_cmd_opcodes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-107026r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 261--><p class="noindent" >This structure is an array of 64 bit values in little-endian byte order, in which a bit is
set if the specific command opcode is supported. Thus, <span 
class="aeti-10">device_admin_cmd_opcodes[0]</span>
refers to the first 64-bit value in this array corresponding to opcodes 0 to 63,
<span 
class="aeti-10">device_admin_cmd_opcodes[1] </span>is the second 64-bit value corresponding to opcodes
64 to 127, etc. For example, the array of size 2 including the values 0x3 in
<span 
class="aeti-10">device_admin_cmd_opcodes[0] </span>and 0x1 in <span 
class="aeti-10">device_admin_cmd_opcodes[1] </span>indicates that
only opcodes 0, 1 and 64 are supported. The length of the array depends on the
supported opcodes - it is large enough to include bits set for all supported opcodes,
that is the length can be calculated by starting with the largest supported
opcode adding one, dividing by 64 and rounding up. In other words, for
VIRTIO_ADMIN_CMD_LIST_QUERY and VIRTIO_ADMIN_CMD_LIST_USE the
length of <span 
class="aeti-10">command_specific_result </span>and <span 
class="aeti-10">command_specific_data </span>respectively will be
<span 
class="cmmi-10">DIV</span> <sub><span 
class="cmmi-7">R</span></sub><span 
class="cmmi-10">OUND</span><sub><span 
class="cmmi-7">U</span></sub><span 
class="cmmi-10">P</span><span 
class="cmr-10">(</span><span 
class="cmmi-10">max</span><sub><span 
class="cmmi-7">c</span></sub><span 
class="cmmi-10">md,</span><span 
class="cmr-10">64) </span><span 
class="cmsy-10">∗ </span><span 
class="cmr-10">8 </span>where DIV_ROUND_UP is integer division with
round up and <span 
class="aeti-10">max_cmd </span>is the largest available command opcode.
<!--l. 282--><p class="noindent" >The array is also allowed to be larger and to additionally include an arbitrary number
of all-zero entries.
<!--l. 285--><p class="noindent" >Accordingly, bits 0 and 1 corresponding to opcode 0 (VIRTIO_ADMIN_CMD_LIST_QUERY)
and 1 (VIRTIO_ADMIN_CMD_LIST_USE) are always set in <span 
class="aeti-10">device_admin_cmd_opcodes[0]</span>
returned by VIRTIO_ADMIN_CMD_LIST_QUERY.
<!--l. 290--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_LIST_QUERY, <span 
class="aeti-10">opcode </span>is set to 0x0. The
<span 
class="aeti-10">group_member_id </span>is unused. It is set to zero by driver. This command has
no command specific data. The device, upon success, returns a result in
<span 
class="aeti-10">command_specific_result </span>in the format <span 
class="aeti-10">struct virtio_admin_cmd_list </span>describing the list
of group administration commands supported for the group type specified by
<span 
class="aeti-10">group_type</span>.
<!--l. 299--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_LIST_USE, <span 
class="aeti-10">opcode </span>is set to 0x1. The
                                                                  

                                                                  
<span 
class="aeti-10">group_member_id </span>is unused. It is set to zero by driver. The <span 
class="aeti-10">command_specific_data</span>
is in the format <span 
class="aeti-10">struct virtio_admin_cmd_list </span>describing the list of group
administration commands used by the driver with the group type specified by
<span 
class="aeti-10">group_type</span>.
<!--l. 307--><p class="noindent" >This command has no command specific result.
<!--l. 309--><p class="noindent" >The driver issues the command VIRTIO_ADMIN_CMD_LIST_QUERY to query the
list of commands valid for this group and before sending any commands for any
member of a group.
<!--l. 313--><p class="noindent" >The driver then enables use of some of the opcodes by sending to the device the
command VIRTIO_ADMIN_CMD_LIST_USE with a subset of the list returned by
VIRTIO_ADMIN_CMD_LIST_QUERY that is both understood and used by the
driver.
<!--l. 318--><p class="noindent" >If the device supports the command list used by the driver, the device completes the
command with status VIRTIO_ADMIN_STATUS_OK. If the device does not
support the command list (for example, if the driver is not capable to use
some required commands), the device completes the command with status
VIRTIO_ADMIN_STATUS_INVALID_FIELD.
<!--l. 326--><p class="noindent" >Note: the driver is assumed not to set bits in device_admin_cmd_opcodes if it is not
familiar with how the command opcode is used, since the device could have
dependencies between command opcodes.
<!--l. 332--><p class="noindent" >It is assumed that all members in a group support and are used with the same
list of commands. However, for owner devices supporting multiple group
types, the list of supported commands might differ between different group
types.
<a 
 id="x1-107027r98"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.12.1.1   </span> <a 
 id="x1-1080001"></a>Legacy Interfaces</h5>
<!--l. 4--><p class="noindent" >In some systems, there is a need to support utilizing a legacy driver with a
device that does not directly support the legacy interface. In such scenarios, a
group owner device can provide the legacy interface functionality for the
group member devices. The driver of the owner device can then access the
legacy interface of a member device on behalf of the legacy member device
driver.
<!--l. 10--><p class="noindent" >For example, with the SR-IOV group type, group members (VFs) can not present the
legacy interface in an I/O BAR in BAR0 as expected by the legacy pci driver. If the
legacy driver is running inside a virtual machine, the hypervisor executing the
virtual machine can present a virtual device with an I/O BAR in BAR0.
The hypervisor intercepts the legacy driver accesses to this I/O BAR and
forwards them to the group owner device (PF) using group administration
commands.
<!--l. 17--><p class="noindent" >The following commands support such a legacy interface functionality:
                                                                  

                                                                  
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ</dd></dl>
<!--l. 26--><p class="noindent" >These commands are currently only defined for the SR-IOV group type and
have, generally, the same effect as member device accesses through a legacy
interface listed in section <a 
href="#x1-19300010">4.1.4.10<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Legacy Interfaces: A Note on PCI Device Layout --></a> except that little-endian format is assumed
unconditionally.
<a 
 id="x1-108005r99"></a>
<!--l. 32--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.1.1</span> <a 
 id="x1-1090001"></a>VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE</h5>
This command has the same effect as writing into the virtio common configuration
structure through the legacy interface. The <span 
class="aeti-10">command_specific_data </span>is in the format
<span 
class="aeti-10">struct virtio_admin_cmd_legacy_common_cfg_wr_data </span>describing the access to be
performed.
<!--l. 40-->
<pre class="lstlisting" id="listing-27"><span class="label"><a 
 id="x1-109001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_legacy_common_cfg_wr_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-109002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">within</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">common</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">structure</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-109003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-109004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-109005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 48--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE,
<span 
class="aeti-10">opcode </span>is set to 0x2. The <span 
class="aeti-10">group_member_id </span>refers to the member device to be
accessed. The <span 
class="aeti-10">offset </span>refers to the offset for the write within the virtio common
configuration structure, and excluding the device-specific configuration. The length of
the data to write is simply the length of <span 
class="aeti-10">data</span>.
<!--l. 55--><p class="noindent" >No length or alignment restrictions are placed on the value of the <span 
class="aeti-10">offset </span>and the
length of the <span 
class="aeti-10">data</span>, except that the resulting access refers to a single field and is
completely within the virtio common configuration structure, excluding the
device-specific configuration.
<!--l. 60--><p class="noindent" >This command has no command specific result.
<a 
 id="x1-109006r109"></a>
<!--l. 62--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.1.2</span> <a 
 id="x1-1100002"></a>VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ</h5>
This command has the same effect as reading from the virtio common configuration
structure through the legacy interface. The <span 
class="aeti-10">command_specific_data </span>is in the format
<span 
class="aeti-10">struct virtio_admin_cmd_legacy_common_cfg_rd_data </span>describing the access to be
performed.
                                                                  

                                                                  
<!--l. 70-->
<pre class="lstlisting" id="listing-28"><span class="label"><a 
 id="x1-110001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_legacy_common_cfg_rd_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-110002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">within</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">common</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">structure</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-110003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 76--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ,
<span 
class="aeti-10">opcode </span>is set to 0x3. The <span 
class="aeti-10">group_member_id </span>refers to the member device to be
accessed. The <span 
class="aeti-10">offset </span>refers to the offset for the read from the virtio common
configuration structure, and excluding the device-specific configuration.
<!--l. 82-->
<pre class="lstlisting" id="listing-29"><span class="label"><a 
 id="x1-110004r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_legacy_common_cfg_rd_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-110005r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-110006r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 88--><p class="noindent" >No length or alignment restrictions are placed on the value of the <span 
class="aeti-10">offset </span>and the
length of the <span 
class="aeti-10">data</span>, except that the resulting access refers to a single field and is
completely within the virtio common configuration structure, excluding the
device-specific configuration.
<!--l. 93--><p class="noindent" >When the command completes successfully, <span 
class="aeti-10">command_specific_result </span>is in the format
<span 
class="aeti-10">struct virtio_admin_cmd_legacy_common_cfg_rd_result </span>returned by the device. The
length of the data read is simply the length of <span 
class="aeti-10">data</span>.
<a 
 id="x1-110007r110"></a>
<!--l. 98--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.1.3</span> <a 
 id="x1-1110003"></a>VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE</h5>
This command has the same effect as writing into the virtio device-specific
configuration through the legacy interface. The <span 
class="aeti-10">command_specific_data </span>is in the
format <span 
class="aeti-10">struct virtio_admin_cmd_legacy_dev_reg_wr_data </span>describing the access to be
performed.
<!--l. 106-->
<pre class="lstlisting" id="listing-30"><span class="label"><a 
 id="x1-111001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_legacy_dev_reg_wr_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-111002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">within</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-111003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-111004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-111005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 114--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE,
<span 
class="aeti-10">opcode </span>is set to 0x4. The <span 
class="aeti-10">group_member_id </span>refers to the member device to
be accessed. The <span 
class="aeti-10">offset </span>refers to the offset for the write within the virtio
device-specific configuration. The length of the data to write is simply the length of
<span 
class="aeti-10">data</span>.
<!--l. 121--><p class="noindent" >No length or alignment restrictions are placed on the value of the <span 
class="aeti-10">offset </span>and the
length of the <span 
class="aeti-10">data</span>, except that the resulting access refers to a single field and is
completely within the device-specific configuration.
<!--l. 126--><p class="noindent" >This command has no command specific result.
<a 
 id="x1-111006r111"></a>
                                                                  

                                                                  
<!--l. 128--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.1.4</span> <a 
 id="x1-1120004"></a>VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ</h5>
This command has the same effect as reading from the virtio device-specific
configuration through the legacy interface. The <span 
class="aeti-10">command_specific_data </span>is in the
format <span 
class="aeti-10">struct virtio_admin_cmd_legacy_common_cfg_rd_data </span>describing the access to
be performed.
<!--l. 136-->
<pre class="lstlisting" id="listing-31"><span class="label"><a 
 id="x1-112001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_legacy_dev_cfg_rd_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-112002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">within</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-112003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 142--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ, <span 
class="aeti-10">opcode </span>is
set to 0x5. The <span 
class="aeti-10">group_member_id </span>refers to the member device to be accessed.
The <span 
class="aeti-10">offset </span>refers to the offset for the read from the virtio device-specific
configuration.
<!--l. 148-->
<pre class="lstlisting" id="listing-32"><span class="label"><a 
 id="x1-112004r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_legacy_dev_reg_rd_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-112005r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-112006r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 154--><p class="noindent" >No length or alignment restrictions are placed on the value of the <span 
class="aeti-10">offset </span>and the
length of the <span 
class="aeti-10">data</span>, except that the resulting access refers to a single field and is
completely within the device-specific configuration.
<!--l. 159--><p class="noindent" >When the command completes successfully, <span 
class="aeti-10">command_specific_result </span>is in the
format <span 
class="aeti-10">struct virtio_admin_cmd_legacy_dev_reg_rd_result </span>returned by the
device.
<!--l. 163--><p class="noindent" >The length of the data read is simply the length of <span 
class="aeti-10">data</span>.
<a 
 id="x1-112007r112"></a>
<!--l. 165--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.1.5</span> <a 
 id="x1-1130005"></a>VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO</h5>
The driver of the owner device can send a driver notification to the
member device operated using the legacy interface by executing
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE with the <span 
class="aeti-10">offset</span>
matching <span 
class="aeti-10">Queue Notify </span>and the <span 
class="aeti-10">data </span>containing a 16-bit virtqueue index to be
notified.
<!--l. 174--><p class="noindent" >However, as VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE is
also used for slow path configuration a separate dedicated mechanism for
sending such driver notifications to the member device can be made available
by the owner device. For the SR-IOV group type, the optional command
VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO addresses this need by returning
to the driver one or more addresses which can be used to send such driver
notifications. The notification address returned can be in the device memory (PCI
BAR or VF BAR) of the device.
                                                                  

                                                                  
<!--l. 183--><p class="noindent" >In this alternative approach, driver notifications are sent by writing a 16-bit
virtqueue index to be notified, in the little-endian format, to the notification
address returned by the VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO
command.
<!--l. 188--><p class="noindent" >Any driver notification sent through the notification address has the same effect as if
it was sent using the VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE
command with the <span 
class="aeti-10">offset </span>matching <span 
class="aeti-10">Queue Notify</span>.
<!--l. 192--><p class="noindent" >This command is only defined for the SR-IOV group type.
<!--l. 194--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO, <span 
class="aeti-10">opcode </span>is set
to 0x6. The <span 
class="aeti-10">group_member_id </span>refers to the member device to be accessed. This
command does not use <span 
class="aeti-10">command_specific_data</span>.
<!--l. 199--><p class="noindent" >When the device supports the VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO
command, the group owner device hardwires VF BAR0 to zero in the SR-IOV
Extended capability.
<!--l. 202-->
<pre class="lstlisting" id="listing-33"><span class="label"><a 
 id="x1-113001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_legacy_notify_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">end</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">list</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">owner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">member</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bar</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BAR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">member</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">owner</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">within</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bar</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_legacy_notify_info_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_legacy_notify_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">entries</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-113010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 215--><p class="noindent" >A <span 
class="aeti-10">flags </span>value of 0x1 indicates that the notification address is of the owner device, the
value of 0x2 indicates that the notification address is of the member device and the
value of 0x0 indicates that all the entries starting from that entry are invalid entries
in <span 
class="aeti-10">entries</span>. All other values in <span 
class="aeti-10">flags </span>are reserved.
<!--l. 221--><p class="noindent" >The <span 
class="aeti-10">bar </span>values 0x1 to 0x5 specify BAR1 to BAR5 respectively: when the <span 
class="aeti-10">flags </span>is 0x1
this is specified by the Base Address Registers in the PCI header of the device, when
the <span 
class="aeti-10">flags </span>is 0x2 this is specified by the VF BARn registers in the SR-IOV Extended
Capability of the device.
<!--l. 227--><p class="noindent" >The <span 
class="aeti-10">offset </span>indicates the notification address relative to BAR indicated in <span 
class="aeti-10">bar</span>. This
value is 2-byte aligned.
<!--l. 230--><p class="noindent" >When the command completes successfully, <span 
class="aeti-10">command_specific_result </span>is in the format
<span 
class="aeti-10">struct virtio_admin_cmd_legacy_notify_info_result</span>. The device can supply up to 4
entries each with a different notification address. In this case, any of the entries can
be used by the driver. The order of the entries serves as a preference hint to the
driver. The driver is expected to utilize the entries placed earlier in the array in
preference to the later ones. The driver is also expected to ignore any invalid entries,
as well as the end of list entry if present and any entries following the end of
list.
<a 
 id="x1-113011r113"></a>
<!--l. 239--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.1.6</span> <a 
 id="x1-1140006"></a>Device Requirements: Legacy Interface</h5>
A device MUST either support all of, or none of
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE,
                                                                  

                                                                  
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ,
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ commands.
<!--l. 247--><p class="noindent" >For VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE,
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ,
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ commands, the device MUST
decode and encode (respectively) the value of the <span 
class="aeti-10">data </span>using the little-endian
format.
<!--l. 254--><p class="noindent" >For the VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ commands, the device
MUST fail the command when the value of the <span 
class="aeti-10">offset </span>and the length of the <span 
class="aeti-10">data </span>do
not refer to a single field or are not completely within the virtio common
configuration excluding the device-specific configuration.
<!--l. 261--><p class="noindent" >For the VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ commands, the device MUST
fail the command when the value of the <span 
class="aeti-10">offset </span>and the length of the <span 
class="aeti-10">data </span>do not
refer to a single field or are not completely within the virtio device-specific
configuration.
<!--l. 268--><p class="noindent" >The command VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE MUST
have the same effect as writing into the virtio common configuration structure
through the legacy interface.
<!--l. 272--><p class="noindent" >The command VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ MUST
have the same effect as reading from the virtio common configuration structure
through the legacy interface.
<!--l. 276--><p class="noindent" >The command VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE MUST have
the same effect as writing into the virtio device-specific configuration through the
legacy interface.
<!--l. 280--><p class="noindent" >The command VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ MUST have the
same effect as reading from the virtio device-specific configuration through the legacy
interface.
<!--l. 284--><p class="noindent" >For the SR-IOV group type, when the owner device supports
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ,
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE,
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ,
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO commands,
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 290--><p class="noindent" >the owner device and the group member device SHOULD follow the rules
     for the PCI Revision ID and Subsystem Device ID of the non-transitional
                                                                  

                                                                  
     devices documented in section <a 
href="#x1-1650002">4.1.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery --></a>.
     </li>
     <li class="itemize">
     <!--l. 294--><p class="noindent" >the owner device SHOULD follow the rules for the PCI Device ID of the
     non-transitional devices documented in section <a 
href="#x1-1650002">4.1.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery --></a>.
     </li>
     <li class="itemize">
     <!--l. 298--><p class="noindent" >any                                  driver                                  notification
     received by the device at any of the notification address supplied in the
     command  result  of  VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO
     MUST  function  as  if  the  device  received  the  notification  through
     VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE   command
     at an offset <span 
class="aeti-10">offset </span>matching <span 
class="aeti-10">Queue Notify</span>.</li></ul>
<!--l. 305--><p class="noindent" >If the device supports the VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO
command,
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 307--><p class="noindent" >the         device         MUST         also         support         all         of
     VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE,
     VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ,
     VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE                   and
     VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ commands.
     </li>
     <li class="itemize">
     <!--l. 312--><p class="noindent" >in                                                                                         the
     command  result  of  VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO,
     the last <span 
class="aeti-10">struct virtio_pci_legacy_notify_info </span>entry MUST have <span 
class="aeti-10">flags </span>of zero.
     </li>
     <li class="itemize">
     <!--l. 316--><p class="noindent" >in                                      the                                      command
     result of VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO, valid entries
     MUST have a <span 
class="aeti-10">bar </span>which is not hardwired to zero.
     </li>
     <li class="itemize">
     <!--l. 319--><p class="noindent" >in                                      the                                      command
     result of VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO, valid entries
     MUST have an <span 
class="aeti-10">offset </span>aligned to 2-byte.
     </li>
     <li class="itemize">
                                                                  

                                                                  
     <!--l. 322--><p class="noindent" >the
     device MAY support VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO
     with entries of the owner device or the member device or both of them.
     </li>
     <li class="itemize">
     <!--l. 325--><p class="noindent" >for the SR-IOV group type, the group owner device MUST hardwire VF
     BAR0 to zero in the SR-IOV Extended capability.</li></ul>
<a 
 id="x1-114001r114"></a>
<!--l. 329--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.1.7</span> <a 
 id="x1-1150007"></a>Driver Requirements: Legacy Interface</h5>
For VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE,
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ,
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ commands, the driver MUST
encode and decode (respectively) the value of the <span 
class="aeti-10">data </span>using the little-endian
format.
<!--l. 338--><p class="noindent" >For the VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_COMMON_CFG_READ commands, the
driver SHOULD set <span 
class="aeti-10">offset </span>and the length of the <span 
class="aeti-10">data </span>to refer to a single field
within the virtio common configuration structure excluding the device-specific
configuration.
<!--l. 344--><p class="noindent" >For the VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_WRITE and
VIRTIO_ADMIN_CMD_LEGACY_DEV_CFG_READ commands, the driver
SHOULD set <span 
class="aeti-10">offset </span>and the length of the <span 
class="aeti-10">data </span>to refer to a single field within device
specific configuration.
<!--l. 349--><p class="noindent" >If VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO command is supported, the
driver SHOULD use the notification address to send all driver notifications to the
device.
<!--l. 353--><p class="noindent" >If within <span 
class="aeti-10">struct virtio_admin_cmd_legacy_notify_info_result </span>returned by
VIRTIO_ADMIN_CMD_LEGACY_NOTIFY_INFO, the <span 
class="aeti-10">flags </span>value for a specific
<span 
class="aeti-10">struct virtio_pci_legacy_notify_info </span>entry is 0x0, the driver MUST ignore this entry
and all the following <span 
class="aeti-10">entries</span>. Additionally, for all other entries, the driver MUST
validate that
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 359--><p class="noindent" >the <span 
class="aeti-10">flags </span>is either 0x1 or 0x2
     </li>
     <li class="itemize">
     <!--l. 360--><p class="noindent" >the <span 
class="aeti-10">bar </span>corresponds to a valid BAR of either the owner or the member
     device, depending on the <span 
class="aeti-10">flags</span>
                                                                  

                                                                  
     </li>
     <li class="itemize">
     <!--l. 362--><p class="noindent" >the <span 
class="aeti-10">offset </span>is 2-byte aligned and corresponds to an address within the BAR
     specified by the <span 
class="aeti-10">bar </span>on <span 
class="aeti-10">flags</span></li></ul>
<!--l. 365--><p class="noindent" >, any entry which does not meet these constraints MUST be ignored by the
driver.
<a 
 id="x1-115001r108"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.12.1.2   </span> <a 
 id="x1-1160002"></a>Device and driver capabilities</h5>
<!--l. 3--><p class="noindent" >Device and driver capabilities are implemented as structured groupings for specific
device functionality and their related resource objects. The device exposes its
supported functionality and resource object limits through an administration
command, utilizing the ’self group type.’ Each capability possesses a unique ID.
Through an administration command, also employing the ’self group type,’ the driver
reports the functionality and resource object limits it intends to use. Before executing
any operations related to the capabilities, the driver communicates these capabilities
to the device. The driver is allowed to set the capability at any time, provided
there are no pending operations at the device level associated with that
capability.
<!--l. 15--><p class="noindent" >The device presents the supported capability IDs to the driver as a bitmap. The
driver uses the administration command to learn about the supported capabilities
bitmap.
<!--l. 19--><p class="noindent" >A capability consists of one or more fields, where each field can be a limit number, a
bitmap, or an array of entries. In an array field, the structure depends on the specific
array and the capability type. For each bitmap field, the driver sets the desired bits -
but only out of those bits in a bitmap that the device has presented. The driver sets
each limit number field to a desired value that is smaller than or equal to the value
the device presented. Similarly, for an array field, the driver sets the desired
capability entries but only out of the capability entries that the device has
presented.
<!--l. 29--><p class="noindent" >It is anticipated that any necessary new fields for a capability will be appended to the
structure’s end, ensuring both forward and backward compatibility between the
device and driver. Furthermore, to avoid indefinite growth of a single capability, it is
expected that new functionality will lead to the creation of new capability rather
than expanding existing ones.
<!--l. 36--><p class="noindent" >Capabilities are categorized into two ranges by their IDs, as listed:
<div class="table">
                                                                  

                                                                  
<!--l. 38--><p class="noindent" ><a 
 id="x1-1160011"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Table 2.1: </span><span  
class="content">Capability ids</span></div><!--tex4ht:label?: x1-1160011 -->
<!--l. 51--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Id                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description                                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0000-0x07ff       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Generic capability for all device types                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0800-0x0fff       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device type specific capability                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x1000 - 0xFFFF  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved for future                                </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td></tr></table>
                                                                  

                                                                  
</div><hr class="endfloat" />
</div>
<!--l. 54--><p class="noindent" >Common capabilities are listed:
<div class="table">
                                                                  

                                                                  
<!--l. 56--><p class="noindent" ><a 
 id="x1-1160022"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Table 2.2: </span><span  
class="content">Common capability ids</span></div><!--tex4ht:label?: x1-1160022 -->
<!--l. 67--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Id                 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description               </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0000           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-1300001">VIRTIO_DEV_PARTS_CAP</a>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device parts capability      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0001-0x07ff  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Generic   capability   for   all
 device types               </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >              </td></tr></table>
                                                                  

                                                                  
</div><hr class="endfloat" />
</div>
<!--l. 70--><p class="noindent" >Device type specific capabilities are described separately for each device type under
<span 
class="aeti-10">Device and driver capabilities</span>.
<!--l. 73--><p class="noindent" >The device and driver capabilities commands are currently defined for self group
type.
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_DEVICE_CAP_GET
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_DRIVER_CAP_SET</dd></dl>
<a 
 id="x1-116006r115"></a>
<!--l. 82--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.2.1</span> <a 
 id="x1-1170001"></a>VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY</h5>
This command queries the bitmap of capability ids listed in <a 
href="#x1-1160011">2.1<!--tex4ht:ref: table:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device and driver capabilities / capability ids --></a>.
<!--l. 87--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY, <span 
class="aeti-10">opcode </span>is set to
0x7. <span 
class="aeti-10">group_member_id </span>is set to zero.
<!--l. 90--><p class="noindent" >This command has no command specific data.
<!--l. 92-->
<pre class="lstlisting" id="listing-34"><span class="label"><a 
 id="x1-117001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_query_cap_id_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-117002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported_caps</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-117003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 98--><p class="noindent" >When the command completes successfully, <span 
class="aeti-10">command_specific_result </span>is in the format
<span 
class="aeti-10">struct virtio_admin_cmd_query_cap_id_result</span>.
<!--l. 101--><p class="noindent" ><span 
class="aeti-10">supported_caps </span>is an array of 64 bit values in little-endian byte order, in which a bit is
set if the specific capability is supported. Thus, <span 
class="aeti-10">supported_caps[0] </span>refers to the first
64-bit value in this array corresponding to capability ids 0 to 63, <span 
class="aeti-10">supported_caps[1] </span>is
the second 64-bit value corresponding to capability ids 64 to 127, etc. For example,
the array of size 2 including the values 0x3 in <span 
class="aeti-10">supported_caps[0] </span>and 0x1 in
<span 
class="aeti-10">supported_caps[1] </span>indicates that only capability id 0, 1 and 64 are supported. The
length of the array depends on the supported capabilities - it is large enough to
include bits set for all supported capability ids, that is the length can be calculated
by starting with the largest supported capability id adding one, dividing by 64 and
rounding up. In other words, for VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY the
length of <span 
class="aeti-10">command_specific_result </span>will be <span 
class="cmmi-10">DIV</span> <sub><span 
class="cmmi-7">R</span></sub><span 
class="cmmi-10">OUND</span><sub><span 
class="cmmi-7">U</span></sub><span 
class="cmmi-10">P</span><span 
class="cmr-10">(</span><span 
class="cmmi-10">max</span><sub><span 
class="cmmi-7">c</span></sub><span 
class="cmmi-10">ap</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">d,</span><span 
class="cmr-10">64) </span><span 
class="cmsy-10">∗ </span><span 
class="cmr-10">8 </span>where
DIV_ROUND_UP is integer division with round up and <span 
class="aeti-10">max_cap_id </span>is the largest
available capability id.
                                                                  

                                                                  
<!--l. 119--><p class="noindent" >The array is also allowed to be larger and to additionally include an arbitrary number
of all-zero entries.
<a 
 id="x1-117004r119"></a>
<!--l. 122--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.2.2</span> <a 
 id="x1-1180002"></a>VIRTIO_ADMIN_CMD_DEVICE_CAP_GET</h5>
This command gets the device capability for the specified capability id <span 
class="aeti-10">id</span>.
<!--l. 127--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_DEVICE_CAP_GET, <span 
class="aeti-10">opcode </span>is set to 0x8.
<span 
class="aeti-10">group_member_id </span>is set to zero.
<!--l. 130--><p class="noindent" ><span 
class="aeti-10">command_specific_data </span>is in format <span 
class="aeti-10">struct virtio_admin_cmd_cap_get_data</span>.
<!--l. 133-->
<pre class="lstlisting" id="listing-35"><span class="label"><a 
 id="x1-118001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_cap_get_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-118002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-118003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-118004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 140--><p class="noindent" ><span 
class="aeti-10">id </span>refers to the capability id listed in <a 
href="#x1-1160011">2.1<!--tex4ht:ref: table:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device and driver capabilities / capability ids --></a>. <span 
class="aeti-10">reserved </span>is reserved for future use and set
to zero.
<!--l. 143-->
<pre class="lstlisting" id="listing-36"><span class="label"><a 
 id="x1-118005r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_cap_get_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-118006r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_specific_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-118007r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 149--><p class="noindent" >When the command completes successfully, <span 
class="aeti-10">command_specific_result </span>is in the
format <span 
class="aeti-10">struct virtio_admin_cmd_cap_get_result </span>responded by the device. Each
capability uses different capability specific <span 
class="aeti-10">cap_specific_data </span>and is described
separately.
<a 
 id="x1-118008r120"></a>
<!--l. 154--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.2.3</span> <a 
 id="x1-1190003"></a>VIRTIO_ADMIN_CMD_DRIVER_CAP_SET</h5>
This command sets the driver capability, indicating to the device which capability the
driver uses. The driver can set a resource object limit capability that is
smaller than or equal to the value published by the device capability. If the
capability is a set of flags, the driver sets the flag bits that are set in the
device capability; the driver does not set any flag bits that are not set by the
device.
<!--l. 163--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_DRIVER_CAP_SET, <span 
class="aeti-10">opcode </span>is set to 0x9.
<span 
class="aeti-10">group_member_id </span>is set to zero. The <span 
class="aeti-10">command_specific_data </span>is in the format <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_admin_cmd_cap_set_data</span>.
<!--l. 168-->
<pre class="lstlisting" id="listing-37"><span class="label"><a 
 id="x1-119001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_cap_set_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-119002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-119003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-119004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_specific_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-119005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 176--><p class="noindent" ><span 
class="aeti-10">id </span>refers to the capability id listed in <a 
href="#x1-1160011">2.1<!--tex4ht:ref: table:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device and driver capabilities / capability ids --></a>. <span 
class="aeti-10">reserved </span>is reserved for future use and set
to zero.
                                                                  

                                                                  
<!--l. 179--><p class="noindent" >There is no command specific result. When the command completes successfully, the
driver capability is updated to the values supplied in <span 
class="aeti-10">cap_specific_data</span>.
<a 
 id="x1-119006r121"></a>
<!--l. 183--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.2.4</span> <a 
 id="x1-1200004"></a>Device Requirements: Device and driver capabilities</h5>
If the device supports capabilities, it MUST support the commands
VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY, VIRTIO_ADMIN_CMD_DRIVER_CAP_SET,
and VIRTIO_ADMIN_CMD_DEVICE_CAP_GET.
<!--l. 190--><p class="noindent" >For the VIRTIO_ADMIN_CMD_DRIVER_CAP_SET command,
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 192--><p class="noindent" >the  device  MUST  support  the  setting  of  resource  object  limit  driver
     capability to a value that is same as or smaller than the one reported in
     the device capability,
     </li>
     <li class="itemize">
     <!--l. 195--><p class="noindent" >the device MUST support the setting of capability flags bits to all or fewer
     bits than the one reported in the device capability;</li></ul>
<!--l. 198--><p class="noindent" >this is applicable unless specific capability fields are explicitly stated as non-writable
in the VIRTIO_ADMIN_CMD_DEVICE_CAP_GET command.
<!--l. 201--><p class="noindent" >The device MAY complete the command VIRTIO_ADMIN_CMD_DRIVER_CAP_SET
with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL, if the capability resource
object limit is larger than the value reported by the device’s capability, or the
capability flag bit is set, which is not set in the device’s capability.
<!--l. 207--><p class="noindent" >The device MUST complete the commands VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY,
VIRTIO_ADMIN_CMD_DRIVER_CAP_GET, and VIRTIO_ADMIN_CMD_DRIVER_CAP_SET
with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL if the commands are not for
the self group type.
<!--l. 212--><p class="noindent" >The device SHOULD complete the commands VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY,
VIRTIO_ADMIN_CMD_DRIVER_CAP_GET, VIRTIO_ADMIN_CMD_DRIVER_CAP_SET
with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL if the commands are not for
the self group type.
<!--l. 217--><p class="noindent" >The device SHOULD complete the command VIRTIO_ADMIN_CMD_DRIVER_CAP_SET
with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EBUSY if the command requests to
disable a capability while the device still has valid resource objects related to the
capability being disabled.
<!--l. 222--><p class="noindent" >The device SHOULD complete the comands VIRTIO_ADMIN_CMD_DEVICE_CAP_GET
and VIRTIO_ADMIN_CMD_DRIVER_CAP_SET with <span 
class="aeti-10">status </span>set to
VIRTIO_ADMIN_STATUS_ENXIO if the capability id is not reported in command
                                                                  

                                                                  
VIRTIO_ADMIN_CMD_CAP_ID_LIST_QUERY.
<!--l. 227--><p class="noindent" >Upon a device reset, the device MUST reset all driver capabilities.
<!--l. 229--><p class="noindent" >The device SHOULD treat the driver resource limits as zero if the driver has not set
such capability, unless otherwise explicitly stated.
<a 
 id="x1-120001r122"></a>
<!--l. 232--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.2.5</span> <a 
 id="x1-1210005"></a>Driver Requirements: Device and driver capabilities</h5>
The driver MUST send the command VIRTIO_ADMIN_CMD_DRIVER_CAP_SET
before using any resource objects that depend on such a capability.
<!--l. 237--><p class="noindent" >In VIRTIO_ADMIN_CMD_DRIVER_CAP_SET command, the driver MUST NOT
set
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 239--><p class="noindent" >the resource object limit value larger than the value reported by the device
     in the command VIRTIO_ADMIN_CMD_DEVICE_CAP_GET,
     </li>
     <li class="itemize">
     <!--l. 241--><p class="noindent" >flags  bits  which  was  not  reported  by  the  device  in  the  command
     VIRTIO_ADMIN_CMD_DEVICE_CAP_GET,
     </li>
     <li class="itemize">
     <!--l. 243--><p class="noindent" >array   entries   not   reported   by   the   device   in   the   command
     VIRTIO_ADMIN_CMD_DEVICE_CAP_GET.</li></ul>
<!--l. 247--><p class="noindent" >The driver MUST NOT disable any of the driver capability using the command
VIRTIO_ADMIN_CMD_DRIVER_CAP_SET when related resource objects are
created but not destroyed.
<a 
 id="x1-121001r116"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.12.1.3   </span> <a 
 id="x1-1220003"></a>Device resource objects</h5>
<!--l. 3--><p class="noindent" >Providing certain functionality consumes limited device resources such as memory,
processing units, buffer memory, or end-to-end credits. A device may support
multiple types of resource objects, each controlling different device functionality. To
manage this, virtio provides <span 
class="aeti-10">Device resource objects </span>that the driver can create,
modify, and destroy using administration commands with the self group type.
Creating and destroying a resource object consume and release device resources,
respectively. The device resource object query command returns the resource object
as maintained by the device.
<!--l. 13--><p class="noindent" >For each resource type, the number of resource objects that can be created is
reported by the device as part of a device capability <a 
href="#x1-1160002">2.12.1.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device and driver capabilities --></a>. The driver reports the
desired (same or lower) number of resource objects as part of a driver capability
                                                                  

                                                                  
<a 
href="#x1-1160002">2.12.1.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device and driver capabilities --></a>. For each device object type, resource object limit is defined by field <span 
class="aeti-10">limit</span>
using <span 
class="aeti-10">Device and driver capabilities</span>.
<!--l. 21-->
<pre class="lstlisting" id="listing-38"><span class="label"><a 
 id="x1-122001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">maximum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">limit</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span></pre>
<!--l. 25--><p class="noindent" >Each resource object has a unique resource object ID - a driver-assigned number in
the range of 0 to <span 
class="aeti-10">limit - 1</span>, where the <span 
class="aeti-10">limit </span>is the maximum number set by the
driver for this resource object type. These resource IDs are unique within
each resource object type. The driver assigns the resource ID when creating
a device resource object. Once the resource object is successfully created,
subsequent resource modification, query, and destroy commands use this resource
object ID. No two resource objects share the same ID. Destroying a resource
object allows for the reuse of its ID for another resource object of the same
type.
<!--l. 35--><p class="noindent" >A valid resource object id is <span 
class="aeti-10">limit - 1</span>. For example, when a device reports a <span 
class="aeti-10">limit =</span>
<span 
class="aeti-10">10 </span>capability for a resource object, and drivers sets <span 
class="aeti-10">limit = 8</span>, the valid resource
object id range for the device and the driver is 0 to 7 for all the resource object
commands. In this example, the driver can only create 8 resource objects of a
specified type.
<!--l. 41--><p class="noindent" >A resource object of one type may depend on the resource object of another type.
Such dependency between resource objects is established by referring to the unique
resource ID in the administration commands. For example, a driver creates a resource
object identified by ID A of one type, then creates another resource object
identified by ID B of a different type, which depends on resource object
A. This dependency establishes the lifecycle of these resource objects. The
driver that creates the dependent resource object must destroy the resource
objects in the exact reverse order of their creation. In this example, the
driver would destroy resource object B before destroying resource object
A.
<!--l. 51--><p class="noindent" >Some resource object types are generic, common across multiple devices. Others are
specific for one device type.
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Resource object type  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000-0x1ff              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Generic resource object type common across all devices  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x200-0x4ff              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device type specific resource object                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x500-0xffff              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved for future use                                            </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \@testpach 1 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 66--><p class="noindent" >Following generic resource objects are defined which are described separately.
<!--l. 77--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Resource object type   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x000                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_RESOURCE_OBJ_DEV_PARTS</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Device parts object, see
 <a 
href="#x1-1310002">2.12.1.4.2<!--tex4ht:ref: par:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device parts / VIRTIO-RESOURCE-OBJ-DEV-PARTS --></a>             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x001-0x1ff           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Generic resource object
 range reserved         </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >                      </td>
</tr></table>
                                                                  

                                                                  
<!--l. 79--><p class="noindent" >When the device resets, it starts with zero resources of each type; the driver can
create resources up to the published <span 
class="aeti-10">limit</span>. The driver can destroy and recreate the
resource one or multiple times. Upon device reset, all resource objects created by the
driver are destroyed within the device.
<!--l. 84--><p class="noindent" >Following administration commands control device resource objects, they are
supported for the self group type, occasionally some resource objects can be created
for the SR-IOV group type as well. Such sr-iov group type specific resource objects
are listed where such objects is defined.
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY</dd></dl>
<!--l. 96--><p class="noindent" >Each resource object administration command uses a common header <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_admin_cmd_resource_obj_cmd_hdr</span>.
<!--l. 99-->
<pre class="lstlisting" id="listing-39"><span class="label"><a 
 id="x1-122006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_cmd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-122007r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-122008r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[2];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-122009r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Indicates</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unique</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">object</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">per</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">object</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-122010r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 108--><p class="noindent" ><span 
class="aeti-10">type </span>refers to the device resource object type. <span 
class="aeti-10">id </span>uniquely identifies the resource
object of a specified <span 
class="aeti-10">type</span>.
<a 
 id="x1-122013r123"></a>
<!--l. 111--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.3.1</span> <a 
 id="x1-1230001"></a>VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE</h5>
This command creates the specified resource object of <span 
class="aeti-10">type </span>identified by the resource
id <span 
class="aeti-10">id</span>. The valid range of <span 
class="aeti-10">id </span>is defined by the device in the related device
capability. The driver assigns the unique <span 
class="aeti-10">id </span>for the resource for the specified
<span 
class="aeti-10">type</span>.
<!--l. 119--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE, <span 
class="aeti-10">opcode </span>is set to
0xa. <span 
class="aeti-10">group_member_id </span>is set to zero for self-group type and set to the member device
to be accessed for the SR-IOV group type. The <span 
class="aeti-10">command_specific_data </span>is in the
format <span 
class="aeti-10">struct virtio_admin_cmd_resource_obj_create_data</span>. <span 
class="aeti-10">resource_obj_specific_data</span>
refers to the resource object specific data. Each resource uses a different
<span 
class="aeti-10">resource_obj_specific_data </span>and is described separately.
<!--l. 128--><p class="noindent" ><span 
class="aeti-10">flags </span>is reserved for future extension for optional resource object attributes and is set
to 0. Each resource object uses a different value for <span 
class="aeti-10">flags </span>and it is described
separately.
                                                                  

                                                                  
<!--l. 132-->
<pre class="lstlisting" id="listing-40"><span class="label"><a 
 id="x1-123001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_create_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-123002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_cmd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-123003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-123004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_obj_specific_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-123005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 140--><p class="noindent" >When the command completes successfully, the resource object is created by the
device and the device can immediately begin using it. This command has no
command specific result.
<a 
 id="x1-123006r125"></a>
<!--l. 144--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.3.2</span> <a 
 id="x1-1240002"></a>VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY</h5>
This command modifies the attributes of an existing device resource object.
For the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY,
<span 
class="aeti-10">opcode </span>is set to 0xb. The <span 
class="aeti-10">command_specific_data </span>is in the format <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_admin_cmd_resource_modify_data</span>. <span 
class="aeti-10">group_member_id </span>is set to zero for self-group
type and set to the member device to be accessed for the SR-IOV group type. <span 
class="aeti-10">id</span>
identifies the resource object of type <span 
class="aeti-10">type </span>whose attributes to modify. This command
modifies the attributes supplied in <span 
class="aeti-10">resource_obj_specific_data</span>.
<!--l. 157-->
<pre class="lstlisting" id="listing-41"><span class="label"><a 
 id="x1-124001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_modify_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-124002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_cmd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-124003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-124004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_obj_specific_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-124005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 165--><p class="noindent" >This command has no command specific result. When the command completes
successfully, attributes of the resource object is set to the values supplied in
<span 
class="aeti-10">resource_obj_specific_data</span>.
<a 
 id="x1-124006r126"></a>
<!--l. 169--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.3.3</span> <a 
 id="x1-1250003"></a>VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY</h5>
This command queries attributes of the existing resource object. For the command
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY, <span 
class="aeti-10">opcode </span>is set to 0xc.
<span 
class="aeti-10">group_member_id </span>is set to zero for self-group type and set to the member device to be
accessed for the SR-IOV group type. The <span 
class="aeti-10">command_specific_data </span>is in the format
<span 
class="aeti-10">struct virtio_admin_cmd_resource_obj_query_data</span>. <span 
class="aeti-10">id </span>identifies the existing resource
object of type <span 
class="aeti-10">type </span>whose attributes to query.
<!--l. 181-->
<pre class="lstlisting" id="listing-42"><span class="label"><a 
 id="x1-125001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_query_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-125002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_cmd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-125003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-125004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 188-->
<pre class="lstlisting" id="listing-43"><span class="label"><a 
 id="x1-125005r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_query_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-125006r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_obj_specific_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-125007r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 194--><p class="noindent" ><span 
class="aeti-10">command_specific_result </span>is in the format <span 
class="aeti-10">virtio_admin_cmd_resource_obj_query_result</span>.
                                                                  

                                                                  
<!--l. 197--><p class="noindent" >When the command completes successfully, the attributes of the specified resource
object are are set in <span 
class="aeti-10">resource_obj_specific_data</span>.
<a 
 id="x1-125008r127"></a>
<!--l. 200--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.3.4</span> <a 
 id="x1-1260004"></a>VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY</h5>
This command destroys the previously created device resource object. For the command
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY, <span 
class="aeti-10">opcode </span>is set to 0xd. The
<span 
class="aeti-10">command_specific_data </span>is in the format <span 
class="aeti-10">struct virtio_admin_cmd_resource_obj_cmd_hdr</span>.
<span 
class="aeti-10">group_member_id </span>is set to zero for self-group type and set to the member device to be
accessed for the SR-IOV group type. <span 
class="aeti-10">id </span>identifies the existing resource object of type
<span 
class="aeti-10">type</span>.
<!--l. 211--><p class="noindent" >This command destroys the specified resource object of <span 
class="aeti-10">type </span>identified by <span 
class="aeti-10">id</span>, which is
previously created using VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE
command.
<!--l. 215--><p class="noindent" >This command has no command specific result. When the command completes
successfully, the resource object is destroyed from the device.
<a 
 id="x1-126001r128"></a>
<!--l. 218--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.3.5</span> <a 
 id="x1-1270005"></a>Device Requirements: Device resource objects</h5>
The device SHOULD complete the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE
with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EEXIST if a resource object already
exists with supplied resource <span 
class="aeti-10">id </span>for the specified <span 
class="aeti-10">type</span>.
<!--l. 224--><p class="noindent" >The device SHOULD complete the commands VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY,
VIRTIO_ADMIN_CMD_RESOURCE_QUERY and
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY with <span 
class="aeti-10">status </span>set to
VIRTIO_ADMIN_STATUS_ENXIO if the specified resource object does not
exist.
<!--l. 229--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_ENOSPC for the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE if the device fail to
create the resource object.
<!--l. 233--><p class="noindent" >The device SHOULD complete the commands VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY
or VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY commands with <span 
class="aeti-10">status </span>set
to VIRTIO_ADMIN_STATUS_EBUSY if other resource objects depend on the
resource object being modified or destroyed.
<!--l. 238--><p class="noindent" >The device MUST allow recreating the resource object using the command
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE which was previously destroyed
using the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY
respectively without undergoing a device reset.
<!--l. 243--><p class="noindent" >The device SHOULD allow creating the resource object using the command
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE with any resource id as long as
the resource object is not created.
                                                                  

                                                                  
<!--l. 247--><p class="noindent" >The device MAY fail the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE
even if the resources within the device have not reached up to the <span 
class="aeti-10">max_limit </span>but the
device MAY have reached an internal limit.
<!--l. 251--><p class="noindent" >When a capability represents a number of resource objects, the device SHOULD
allow creating as many resource objects as represented by the driver capability.
<!--l. 254--><p class="noindent" >The device MUST NOT have any side effects on the resource object when the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY fails.
<!--l. 257--><p class="noindent" >The device MUST complete the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY
with <span 
class="aeti-10">resource_obj_specific_data </span>which is matching the <span 
class="aeti-10">resource_obj_specific_data</span>
of last VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE or
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY command.
<!--l. 262--><p class="noindent" >On device reset, the device MUST destroy all the resource objects which have been
created.
<a 
 id="x1-127001r129"></a>
<!--l. 265--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.3.6</span> <a 
 id="x1-1280006"></a>Driver Requirements: Device resource objects</h5>
The driver MUST not create a second resource object of the same type with same ID
using command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE before
destroying the previously created resource object.
<!--l. 271--><p class="noindent" >The driver MUST NOT create more resource objects of a specified <span 
class="aeti-10">type </span>using
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE than the maximum
limit set by the driver capability.
<!--l. 275--><p class="noindent" >The driver SHOULD NOT modify, query and destroy the resource object which is
already destroyed previously by the driver.
<!--l. 278--><p class="noindent" >The driver SHOULD NOT destroy the resource object on which other resource
objects are depending; the driver SHOULD destroy all the resource objects which do
not depend on other resource objects.
<!--l. 282--><p class="noindent" >The driver MUST NOT set the capability related to the resource
objects if the resource objects have been created using the command
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE and not yet destroyed.
<!--l. 286--><p class="noindent" >The driver MUST send the command VIRTIO_ADMIN_CMD_DRIVER_CAP_SET
before using any resources related to such capability.
<a 
 id="x1-128001r124"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.12.1.4   </span> <a 
 id="x1-1290004"></a>Device parts</h5>
<!--l. 3--><p class="noindent" >In some systems, there is a need to capture the state of all or part of a device and
subsequently restore either the same device or a different one to this captured state.
A group owner device can support administration commands to facilitate these get
and set operations for the group member devices.
<!--l. 9--><p class="noindent" >For example, a hypervisor can use the administration commands to capture parts of
                                                                  

                                                                  
the device state and save the result as part of a VM snapshot. Later, the hypervisor
can retrieve the snapshot and use the administration commands to restore parts of a
device to resume VM operation.
<!--l. 15--><p class="noindent" >As another example, these commands can be used to facilitate VM migration by the
hypervisor: one (source) hypervisor can get parts of a device and send the results to
another (destination) hypervisor, which will in turn set (restore) parts of (another)
device to resume the VM operation on the destination.
<!--l. 21--><p class="noindent" >The device comprises many device parts which the driver can get and set.
Administration commands are provided to either get and set all the device parts at
once, or to get the device parts metadata that indicates which device parts are
present, and later to get and set specific device parts. To get and set the device parts
or their metadata, the driver first creates a device parts resource object, indicating
whether the object should handle get or set operations but not both simultaneously.
The device and the driver indicate the device parts resource objects’ limit using the
capability VIRTIO_DEV_PARTS_CAP.
<!--l. 31--><p class="noindent" >The device can be stopped to prevent device parts from changing. When the device is
stopped, it does not initiate any transport requests. For instance, the device
refrains from sending any configuration or virtqueue notifications and does not
access any virtqueues or the driver’s buffer memory. While the driver may
remain active and continue to send notifications to the device, potentially
updating some device parts, the device itself will not initiate any transport
requests.
<a 
 id="x1-129001r130"></a>
<!--l. 39--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.4.1</span> <a 
 id="x1-1300001"></a>VIRTIO_DEV_PARTS_CAP</h5>
The capability VIRTIO_DEV_PARTS_CAP indicates the device parts resource
objects limit. <span 
class="aeti-10">cap_specific_data </span>is in the format <span 
class="aeti-10">struct virtio_dev_parts_cap</span>.
<!--l. 45-->
<pre class="lstlisting" id="listing-44"><span class="label"><a 
 id="x1-130001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_parts_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-130002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">get_parts_resource_objects_limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-130003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">set_parts_resource_objects_limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-130004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 52--><p class="noindent" ><span 
class="aeti-10">get_parts_resource_objects_limit </span>indicates the supported device parts resource objects
for retrieving the device parts. <span 
class="aeti-10">set_parts_resource_objects_limit </span>indicates the
supported device parts resource objects for restoring the device parts.
<a 
 id="x1-130005r132"></a>
<!--l. 57--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.4.2</span> <a 
 id="x1-1310002"></a>VIRTIO_RESOURCE_OBJ_DEV_PARTS</h5>
A device parts resource object is used to either get or set the device parts. Before
performing any get or set operation for the device parts, the driver creates the device
parts resource object VIRTIO_RESOURCE_OBJ_DEV_PARTS using the
administration command <a 
href="#x1-1230001">VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE<!--tex4ht:ref: par:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device resource objects / VIRTIO-ADMIN-CMD-RESOURCE-OBJ-CREATE --></a>. The
driver indicates the intended purpose (get or set) at the time of creating
                                                                  

                                                                  
the device parts resource object. For the device parts resource object, both
<span 
class="aeti-10">resource_obj_specific_data </span>and <span 
class="aeti-10">resource_obj_specific_result </span>are in the format <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_resource_obj_dev_parts</span>.
<!--l. 70-->
<pre class="lstlisting" id="listing-45"><span class="label"><a 
 id="x1-131001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_resource_obj_dev_parts</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-131002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-131003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RESOURCE_OBJ_DEV_PARTS_TYPE_GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-131004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RESOURCE_OBJ_DEV_PARTS_TYPE_SET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-131005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-131006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 79--><p class="noindent" >When <span 
class="aeti-10">type </span>is set to VIRTIO_RESOURCE_OBJ_DEV_PARTS_TYPE_GET, the driver
can use the object to capture the device parts and the metadata of these device
parts. When <span 
class="aeti-10">type </span>is set to VIRTIO_RESOURCE_OBJ_DEV_PARTS_TYPE_SET, the
driver can use the object to restore the device parts.
<a 
 id="x1-131007r133"></a>
<!--l. 85--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.4.3</span> <a 
 id="x1-1320003"></a>Device parts handling commands</h5>
The owner driver uses the following resource object handling administration
commands. These commands are only used for the device parts resource
object after the driver creates the VIRTIO_RESOURCE_OBJ_DEV_PARTS
object. These commands are currently only defined for the SR-IOV group
type:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_DEV_PARTS_GET
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">VIRTIO_ADMIN_CMD_DEV_PARTS_SET</dd></dl>
<a 
 id="x1-132004r1"></a>
<!--l. 98--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">2.12.1.4.3.1</span> <a 
 id="x1-1330001"></a>VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET</h6>
This command obtains the metadata of the device parts. This metadata includes the
maximum size of the device parts, the count of device parts, and a list of the device
part headers.
<!--l. 105--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET,
<span 
class="aeti-10">opcode </span>is set to 0xe. The <span 
class="aeti-10">command_specific_data </span>is in the format <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_admin_cmd_dev_parts_metadata_data</span>. <span 
class="aeti-10">group_member_id </span>refers to the
member device to be accessed. The resource object <span 
class="aeti-10">type </span>in the <span 
class="aeti-10">hdr </span>is set to
VIRTIO_RESOURCE_OBJ_DEV_PARTS and <span 
class="aeti-10">id </span>is set to the ID of the device parts
resource object.
<!--l. 113-->
<pre class="lstlisting" id="listing-46"><span class="label"><a 
 id="x1-133001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_dev_parts_metadata_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_cmd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_TYPE_SIZE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_TYPE_COUNT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_TYPE_LIST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_dev_parts_metadata_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parts_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr_list_count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdrs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr_list</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-133027r27"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
                                                                  

                                                                  
<!--l. 143--><p class="noindent" >When the command completes successfully, the <span 
class="aeti-10">command_specific_result </span>is in the
format <span 
class="aeti-10">struct virtio_admin_cmd_dev_parts_metadata_result</span>.
<!--l. 147--><p class="noindent" >When <span 
class="aeti-10">type </span>is set to VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_TYPE_SIZE,
the device responds with <span 
class="aeti-10">parts_size</span>. <span 
class="aeti-10">parts_size.size </span>indicates the maximum size in
bytes for all the device parts.
<!--l. 151--><p class="noindent" >When <span 
class="aeti-10">type </span>is set to VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_TYPE_COUNT,
the device responds with <span 
class="aeti-10">hdr_list_count.count</span>. The <span 
class="aeti-10">hdr_list_count.count </span>indicates an
count of <span 
class="aeti-10">struct virtio_dev_part_hdr </span>metadata entries that the device can provide when
the <span 
class="aeti-10">type </span>is set to VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_TYPE_LIST
in a subsequent VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET
command.
<!--l. 158--><p class="noindent" >When <span 
class="aeti-10">type </span>is set to VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_TYPE_LIST,
the device responds with <span 
class="aeti-10">hdr_list</span>. <span 
class="aeti-10">hdr_list </span>indicates the device parts metadata.
<!--l. 162--><p class="noindent" ><span 
class="aeti-10">reserved </span>is reserved and set to 0.
<!--l. 164--><p class="noindent" >The command responds with the <span 
class="aeti-10">status </span>VIRTIO_ADMIN_STATUS_ENOMEM
when the size of <span 
class="aeti-10">command_specific_result </span>is not sufficient enough for the
response.
<a 
 id="x1-133028r135"></a>
<!--l. 168--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">2.12.1.4.3.2</span> <a 
 id="x1-1340002"></a>VIRTIO_ADMIN_CMD_DEV_PARTS_GET</h6>
This command captures the device parts. For the command
VIRTIO_ADMIN_CMD_DEV_PARTS_GET, <span 
class="aeti-10">opcode </span>is set to 0xf. The
<span 
class="aeti-10">command_specific_data </span>is in the format <span 
class="aeti-10">struct virtio_admin_cmd_dev_parts_get_data</span>.
<span 
class="aeti-10">group_member_id </span>refers to the member device to be accessed. The resource object
<span 
class="aeti-10">type </span>in the <span 
class="aeti-10">hdr </span>is set to VIRTIO_RESOURCE_OBJ_DEV_PARTS and <span 
class="aeti-10">id </span>is set to the
ID of the device parts resource object.
<!--l. 180-->
<pre class="lstlisting" id="listing-47"><span class="label"><a 
 id="x1-134001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_dev_parts_get_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_cmd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr_list</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_ADMIN_CMD_DEV_PARTS_GET_TYPE_SELECTED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_ADMIN_CMD_DEV_PARTS_GET_TYPE_ALL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_dev_parts_get_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parts</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-134013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 197--><p class="noindent" >When the driver wants to capture specific device parts, <span 
class="aeti-10">type </span>is set to
VIRTIO_ADMIN_CMD_DEV_PARTS_GET_TYPE_SELECTED and <span 
class="aeti-10">hdr_list </span>is set
to the device parts of interest.
<!--l. 201--><p class="noindent" >When the driver wants to retrieve all the device parts, <span 
class="aeti-10">type </span>is set to
VIRTIO_ADMIN_CMD_DEV_PARTS_GET_TYPE_ALL, and <span 
class="aeti-10">hdr_list </span>is
empty.
<!--l. 204--><p class="noindent" ><span 
class="aeti-10">reserved </span>is reserved and set to 0.
<!--l. 206--><p class="noindent" >When the command completes successfully, the <span 
class="aeti-10">command_specific_result </span>is in the
format <span 
class="aeti-10">struct virtio_admin_cmd_dev_parts_get_result</span>, containing either the selected
device parts or all the device parts.
                                                                  

                                                                  
<!--l. 210--><p class="noindent" >If the requested device part does not exist, the device skips the device part without
any error.
<a 
 id="x1-134016r136"></a>
<!--l. 213--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">2.12.1.4.3.3</span> <a 
 id="x1-1350003"></a>VIRTIO_ADMIN_CMD_DEV_PARTS_SET</h6>
This command sets one or multiple device parts. For the command
VIRTIO_ADMIN_CMD_DEV_PARTS_SET, <span 
class="aeti-10">opcode </span>is set to 0x10. The <span 
class="aeti-10">group_member_id</span>
refers to the member device to be accessed. The resource object <span 
class="aeti-10">type </span>in the <span 
class="aeti-10">hdr </span>is set
to VIRTIO_RESOURCE_OBJ_DEV_PARTS and <span 
class="aeti-10">id </span>is set to the ID of the device
parts resource object.
<!--l. 222-->
<pre class="lstlisting" id="listing-48"><span class="label"><a 
 id="x1-135001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_dev_parts_set_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-135002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_resource_obj_cmd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-135003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parts</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-135004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 229--><p class="noindent" >The <span 
class="aeti-10">command_specific_data </span>is in the format <span 
class="aeti-10">struct virtio_admin_cmd_dev_parts_set_data</span>.
<!--l. 232--><p class="noindent" >This command has no command specific result.
<!--l. 234--><p class="noindent" >The driver stops the device before setting any device parts.
<!--l. 236--><p class="noindent" >When the command completes successfully, the device has updated device parts to
the value supplied in <span 
class="aeti-10">virtio_admin_cmd_dev_parts_set_data</span>.
<!--l. 239--><p class="noindent" >The device parts set by this command take effect when the device is resumed using
the VIRTIO_ADMIN_CMD_DEV_MODE_SET command.
<!--l. 242--><p class="noindent" >When the command fails with a status other than VIRTIO_ADMIN_STATUS_OK,
the device does not have any side effects.
<a 
 id="x1-135005r137"></a>
<!--l. 245--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">2.12.1.4.3.4</span> <a 
 id="x1-1360004"></a>VIRTIO_ADMIN_CMD_DEV_MODE_SET</h6>
This command either stops the device from initiating any transport requests or resumes
the device operation. For the command VIRTIO_ADMIN_CMD_DEV_MODE_SET,
<span 
class="aeti-10">opcode </span>is set to 0x11. <span 
class="aeti-10">group_member_id </span>indicates the member device to be
accessed.
<!--l. 252--><p class="noindent" >The <span 
class="aeti-10">command_specific_data </span>is in the format <span 
class="aeti-10">struct virtio_admin_cmd_dev_mode_set_data</span>.
<!--l. 255-->
<pre class="lstlisting" id="listing-49"><span class="label"><a 
 id="x1-136001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_admin_cmd_dev_mode_set_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-136002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-136003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-136004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-136005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_ADMIN_CMD_DEV_MODE_F_STOPPED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span></pre>
<!--l. 263--><p class="noindent" >This command has no command specific result.
<!--l. 265--><p class="noindent" >When the command completes successfully and if the <span 
class="aeti-10">flags </span>field is set to
VIRTIO_ADMIN_CMD_DEV_MODE_F_STOPPED (bit 0), the device is stopped.
When the device is stopped, the device stops initiating all transport communications,
which includes:
                                                                  

                                                                  
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">stopping configuration change notifications
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">stopping all virtqueue notifications
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">stops accessing all virtqueues and the driver buffer memory</dd></dl>
<!--l. 276--><p class="noindent" >After the device is stopped, the device parts remain unchanged unless the driver
initiates any transport requests.
<!--l. 279--><p class="noindent" >When the device is stopped, it writes back any associated descriptors for all observed
buffers to prevent out-of-order processing if the device is resumed.
<!--l. 282--><p class="noindent" >When the command completes successfully and if the <span 
class="aeti-10">flags </span>field is set to zero, the
device resumes its operation. If the command completes with an error, it does not
produce any side effects on the device.
<a 
 id="x1-136009r134"></a>
<!--l. 286--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">2.12.1.4.4</span> <a 
 id="x1-1370004"></a>Device parts order</h5>
Device parts are usually captured and restored using get and set administration
commands respectively; when multiple device parts are captured or restored, they are
arranged in the specific order listed:
<!--l. 292--><p class="noindent" >Some of the device parts do not need to be written to the device when restored,
such device parts are listed as <span 
class="aeti-10">O</span>. When a such an optional device part is
exchanged using <span 
class="aeti-10">struct virtio_dev_part</span>, it is marked as optional by setting
VIRTIO_DEV_PART_F_OPTIONAL(bit 0) in the <span 
class="aeti-10">flags</span>.
<div class="table">
                                                                  

                                                                  
<!--l. 297--><p class="noindent" ><a 
 id="x1-1370013"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Table 2.3: </span><span  
class="content">Device parts order</span></div><!--tex4ht:label?: x1-1370013 -->
<!--l. 320--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Part name                                              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Optional  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Mandatory
 preceding parts   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEV_FEATURES      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > O           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Nil             </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >VIRTIO_DEV_PART_DRV_FEATURES </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >- </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Nil</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_PCI_COMMON_CFG  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEV_FEATURES,
 VIRTIO_DEV_PART_DRV_FEATURES</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEVICE_STATUS      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEV_FEATURES,
 VIRTIO_DEV_PART_DRV_FEATURES,
 VIRTIO_DEV_PART_PCI_COMMON_CFG</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_VQ_CFG                  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEV_FEATURES,
 VIRTIO_DEV_PART_DRV_FEATURES,
 VIRTIO_DEV_PART_PCI_COMMON_CFG,
 VIRTIO_DEV_PART_DEVICE_STATUS</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_VQ_NOTIFY_CFG     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEV_FEATURES,
 VIRTIO_DEV_PART_DRV_FEATURES,
 VIRTIO_DEV_PART_PCI_COMMON_CFG,
 VIRTIO_DEV_PART_DEVICE_STATUS,
 VIRTIO_DEV_PART_VQ_CFG</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >                                       </td></tr></table>
                                                                  

                                                                  
</div><hr class="endfloat" />
</div>
<a 
 id="x1-137002r138"></a>
<!--l. 323--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">2.12.1.4.4.1</span> <a 
 id="x1-1380001"></a>Device Requirements: Device parts</h6>
A device MUST either support all of, or none of VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET,
VIRTIO_ADMIN_CMD_DEV_PARTS_GET, VIRTIO_ADMIN_CMD_DEV_PARTS_SET,
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE,
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY,
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY, and
VIRTIO_ADMIN_CMD_DEV_MODE_SET commands, where resource commands
apply to the resource object VIRTIO_RESOURCE_OBJ_DEV_PARTS.
<!--l. 334--><p class="noindent" >The device MUST support getting the device parts multiple times with the command
VIRTIO_ADMIN_CMD_DEV_PARTS_GET.
<!--l. 337--><p class="noindent" >When there are multiple device parts in the command VIRTIO_ADMIN_CMD_DEV_PARTS_GET,
the device MUST respond the device parts in the same order as listed in the table
<a 
href="#x1-1370013">Device parts order<!--tex4ht:ref: table:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device parts / Device parts order/ Device parts order --></a>.
<!--l. 342--><p class="noindent" >The device SHOULD respond with an error status for the command
VIRTIO_ADMIN_CMD_DEV_PARTS_SET if the device is not stopped.
<!--l. 345--><p class="noindent" >The device MUST support the command VIRTIO_ADMIN_CMD_DEV_PARTS_SET,
allowing the same or different device parts to be set multiple times.
<!--l. 348--><p class="noindent" >The device MUST respond with an error for the command
VIRTIO_ADMIN_CMD_DEV_PARTS_SET, if there is a mismatch between the
device part length supplied in the VIRTIO_ADMIN_CMD_DEV_PARTS_SET and
the device part length in the device.
<!--l. 353--><p class="noindent" >The device MUST NOT set the device part VIRTIO_DEV_PART_DEV_FEATURES
in the command VIRTIO_ADMIN_CMD_DEV_PARTS_SET; instead, it must verify
that the device features supplied in VIRTIO_DEV_PART_DEV_FEATURES match
those the device has.
<!--l. 358--><p class="noindent" >The device may ignore the setting of a device part that has the
VIRTIO_DEV_PART_F_OPTIONAL bit set.
<!--l. 361--><p class="noindent" >For the SR-IOV group type, when the device is stopped using the command
VIRTIO_ADMIN_CMD_DEV_MODE_SET,
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 364--><p class="noindent" >the device MUST not initiate any PCI transaction,
     </li>
     <li class="itemize">
                                                                  

                                                                  
     <!--l. 365--><p class="noindent" >the  device  MUST  finish  all  the  outstanding  PCI  transactions  before
     completing the command VIRTIO_ADMIN_CMD_DEV_MODE_SET,
     </li>
     <li class="itemize">
     <!--l. 367--><p class="noindent" >the device MUST write any associated descriptors to the driver memory
     for all the observed buffers,
     </li>
     <li class="itemize">
     <!--l. 369--><p class="noindent" >the device MUST accept driver notifications and the device MAY update
     any device parts,
     </li>
     <li class="itemize">
     <!--l. 371--><p class="noindent" >the device MUST respond with valid values for PCI read requests,
     </li>
     <li class="itemize">
     <!--l. 372--><p class="noindent" >the  device  MUST  operate  in  the  same  way  for  the  PCI  architected
     interfaces regardless of the device mode.
     </li>
     <li class="itemize">
     <!--l. 374--><p class="noindent" >the device MUST not generate any PCI PME.</li></ul>
<!--l. 377--><p class="noindent" >When the device is stopped,
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 379--><p class="noindent" >the  device  MUST  not  access  any  virtqueue  memory  or  any  memory
     referred by the virtqueue.
     </li>
     <li class="itemize">
     <!--l. 381--><p class="noindent" >the device MUST not generate any configuration change notification or
     any virtqueue notification.</li></ul>
<!--l. 385--><p class="noindent" >For the SR-IOV group type,
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 387--><p class="noindent" >the                                      device                                      MUST
     respond  to  the  commands  VIRTIO_ADMIN_CMD_DEV_MODE_SET,
     VIRTIO_ADMIN_CMD_DEV_PARTS_SET   after   the   member   device
     completes FLR, if the FLR is in progress on the device when the device
     receives any of these commands.
                                                                  

                                                                  
     </li>
     <li class="itemize">
     <!--l. 392--><p class="noindent" >the                      member                      device                      MUST
     respond  to  the  commands  VIRTIO_ADMIN_CMD_DEV_MODE_SET
     and  VIRTIO_ADMIN_CMD_DEV_PARTS_SET  after  the  device  reset
     completes in the device, if the device reset is in progress when the device
     receives any of these commands.
     </li>
     <li class="itemize">
     <!--l. 397--><p class="noindent" >the                                     member                                     device
     MUST respond to commands VIRTIO_ADMIN_CMD_DEV_MODE_SET
     and  VIRTIO_ADMIN_CMD_DEV_PARTS_SET  after  the  device  power
     management  state  transition  completes  on  the  device,  if  the  power
     management state transition is in progress when the device receives any
     of these commands.</li></ul>
<!--l. 404--><p class="noindent" >When the <span 
class="aeti-10">flags </span>is set to VIRTIO_ADMIN_CMD_DEV_MODE_FLAGS_STOPPED in
the command VIRTIO_ADMIN_CMD_DEV_MODE_SET, and if the device is already
stopped before, the device MUST complete the command successfully.
<!--l. 408--><p class="noindent" >When the VIRTIO_ADMIN_CMD_DEV_MODE_FLAGS_STOPPED <span 
class="aeti-10">flags</span>
clear, in the command VIRTIO_ADMIN_CMD_DEV_MODE_SET, and if
the device is not stopped before, the device MUST complete the command
successfully.
<!--l. 412--><p class="noindent" >For the SR-IOV group type, the device MUST clear all the device parts
to the default value when the member device is reset or undergo an PCI
FLR.
<!--l. 415--><p class="noindent" >The device MAY NOT respond to the selected device part in <span 
class="aeti-10">hdr_list </span>in the
command VIRTIO_ADMIN_CMD_DEV_PARTS_GET if the device part is invalid in
the device.
<!--l. 419--><p class="noindent" >For the commands VIRTIO_ADMIN_CMD_DEV_PARTS_GET and
VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET, when the device responds
with:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 423--><p class="noindent" >VIRTIO_DEV_PART_DRV_FEATURES
     or VIRTIO_DEV_PART_PCI_COMMON_CFG, it MUST be preceded by
     VIRTIO_DEV_PART_DEV_FEATURES.
     </li>
     <li class="itemize">
     <!--l. 426--><p class="noindent" >VIRTIO_DEV_PART_PCI_COMMON_CFG,  it  MUST  be  preceded  by
     VIRTIO_DEV_PART_DEV_FEATURES.
                                                                  

                                                                  
     </li>
     <li class="itemize">
     <!--l. 429--><p class="noindent" >VIRTIO_DEV_PART_PCI_COMMON_CFG,
     it  MUST  be  preceded  by  VIRTIO_DEV_PART_DEV_FEATURES  and
     VIRTIO_DEV_PART_DRV_FEATURES.
     </li>
     <li class="itemize">
     <!--l. 432--><p class="noindent" >VIRTIO_DEV_PART_DEV_CFG,     it     MUST     be     preceded     by
     VIRTIO_DEV_PART_DEV_FEATURES.
     </li>
     <li class="itemize">
     <!--l. 434--><p class="noindent" >VIRTIO_DEV_PART_DRV_CFG,        it        be        preceded        by
     VIRTIO_DEV_PART_DEV_FEATURES,
     VIRTIO_DEV_PART_DRV_FEATURES                                      and
     VIRTIO_DEV_PART_DEV_CFG.
     </li>
     <li class="itemize">
     <!--l. 437--><p class="noindent" >VIRTIO_DEV_PART_DEVICE_STAtUS,      it      is      preceded      by
     VIRTIO_DEV_PART_DEV_FEATURES,
     VIRTIO_DEV_PART_DRV_FEATURES,                                     and
     VIRTIO_DEV_PART_DEV_CFG.</li></ul>
<!--l. 441--><p class="noindent" >When the device receives a VIRTIO_ADMIN_CMD_DEV_PARTS_SET
command containing the parts VIRTIO_DEV_PART_DEV_FEATURES,
VIRTIO_DEV_PART_PCI_COMMON_CFG and VIRTIO_DEV_PART_DEV_CFG,
the device SHOULD only verify that the provided configuration is correct
but SHOULD NOT apply it, especially for the fields that are designated as
read-only and invariant. This ensures that the device respects the immutability
of certain configuration aspects while still performing necessary validation
checks.
<a 
 id="x1-138001r141"></a>
<!--l. 449--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">2.12.1.4.4.2</span> <a 
 id="x1-1390002"></a>Driver Requirements: Device parts</h6>
The driver MUST set the mode to VIRTIO_ADMIN_CMD_DEV_MODE_F_STOPPED
in the command VIRTIO_ADMIN_CMD_DEV_MODE_SET before setting parts
using the command VIRTIO_ADMIN_CMD_DEV_PARTS_SET.
<!--l. 455--><p class="noindent" >When there are multiple device parts in the command VIRTIO_ADMIN_CMD_DEV_PARTS_SET,
the driver MUST set the device parts in the same order as listed in the table <a 
href="#x1-1370013">Device
parts order<!--tex4ht:ref: table:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device parts / Device parts order/ Device parts order --></a>.
<!--l. 460--><p class="noindent" >For the SR-IOV group type, the driver SHOULD NOT access the device
configuration space described in section <a 
href="#x1-220005">2.5<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Configuration Space --></a> when the device is stopped.
                                                                  

                                                                  
<!--l. 465--><p class="noindent" >The driver SHOULD allocate sufficient response buffer to receive all the device parts
metadata in the command VIRTIO_ADMIN_CMD_DEV_PARTS_METADATA_GET.
<!--l. 468--><p class="noindent" >The driver SHOULD allocate sufficient response buffer to receive all the device parts
in the command VIRTIO_ADMIN_CMD_DEV_PARTS_GET.
<a 
 id="x1-139001r131"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.12.1.5   </span> <a 
 id="x1-1400005"></a>Device Requirements: Group administration commands</h5>
<!--l. 344--><p class="noindent" >The device MUST validate <span 
class="aeti-10">opcode</span>, <span 
class="aeti-10">group_type </span>and <span 
class="aeti-10">group_member_id</span>, and if any of these
has an invalid or unsupported value, set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_EINVAL
and set <span 
class="aeti-10">status_qualifier </span>accordingly:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 350--><p class="noindent" >if    <span 
class="aeti-10">group_type    </span>is    invalid,    <span 
class="aeti-10">status_qualifier    </span>MUST    be    set    to
     VIRTIO_ADMIN_STATUS_Q_INVALID_GROUP;
     </li>
     <li class="itemize">
     <!--l. 352--><p class="noindent" >otherwise,   if   <span 
class="aeti-10">opcode   </span>is   invalid,   <span 
class="aeti-10">status_qualifier   </span>MUST   be   set   to
     VIRTIO_ADMIN_STATUS_Q_INVALID_OPCODE;
     </li>
     <li class="itemize">
     <!--l. 355--><p class="noindent" >otherwise,                             if                             <span 
class="aeti-10">group_member_id</span>
     is used by the specific command and is invalid, <span 
class="aeti-10">status_qualifier </span>MUST be
     set to VIRTIO_ADMIN_STATUS_Q_INVALID_MEMBER.</li></ul>
<!--l. 360--><p class="noindent" >If a command completes successfully, the device MUST set <span 
class="aeti-10">status </span>to
VIRTIO_ADMIN_STATUS_OK.
<!--l. 363--><p class="noindent" >If a command fails, the device MUST set <span 
class="aeti-10">status </span>to a value different from
VIRTIO_ADMIN_STATUS_OK.
<!--l. 366--><p class="noindent" >If <span 
class="aeti-10">status </span>is set to VIRTIO_ADMIN_STATUS_EINVAL, the device state MUST NOT
change, that is the command MUST NOT have any side effects on the device, in
particular the device MUST NOT enter an error state as a result of this
command.
<!--l. 371--><p class="noindent" >If a command fails, the device state generally SHOULD NOT change, as far as
possible.
<!--l. 374--><p class="noindent" >The device MAY enforce additional restrictions and dependencies on opcodes used by
the driver and MAY fail the command VIRTIO_ADMIN_CMD_LIST_USE with
<span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL and <span 
class="aeti-10">status_qualifier </span>set to
VIRTIO_ADMIN_STATUS_Q_INVALID_FIELD if the list of commands used violate
internal device dependencies.
<!--l. 380--><p class="noindent" >If the device supports multiple group types, commands for each group type MUST
                                                                  

                                                                  
operate independently of each other, in particular, the device MAY return
different results for VIRTIO_ADMIN_CMD_LIST_QUERY for different group
types.
<!--l. 385--><p class="noindent" >After reset, if the device supports a given group type and before receiving
VIRTIO_ADMIN_CMD_LIST_USE for this group type the device MUST assume that
the list of legal commands used by the driver consists of the two commands
VIRTIO_ADMIN_CMD_LIST_QUERY and VIRTIO_ADMIN_CMD_LIST_USE.
<!--l. 391--><p class="noindent" >After completing VIRTIO_ADMIN_CMD_LIST_USE successfully, the device MUST
set the list of legal commands used by the driver to the one supplied in
<span 
class="aeti-10">command_specific_data</span>.
<!--l. 395--><p class="noindent" >The device MUST validate commands against the list used by the driver and MUST fail
any commands not in the list with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL
and <span 
class="aeti-10">status_qualifier </span>set to VIRTIO_ADMIN_STATUS_Q_INVALID_OPCODE.
<!--l. 401--><p class="noindent" >The list of supported commands reported by the device MUST NOT shrink
(but MAY expand): after reporting a given command as supported through
VIRTIO_ADMIN_CMD_LIST_QUERY the device MUST NOT later report
it as unsupported. Further, after a given set of commands has been used
(via a successful VIRTIO_ADMIN_CMD_LIST_USE), then after a device or
system reset the device SHOULD complete successfully any following calls to
VIRTIO_ADMIN_CMD_LIST_USE with the same list of commands; if this command
VIRTIO_ADMIN_CMD_LIST_USE fails after a device or system reset, the device
MUST not fail it solely because of the command list used. Failure to do so would
interfere with resuming from suspend and error recovery. Exceptions MAY apply if
the system configuration assures, in some way, that the driver does not cache the
previous value of VIRTIO_ADMIN_CMD_LIST_USE, such as in the case of a
firmware upgrade or downgrade.
<!--l. 417--><p class="noindent" >When processing a command with the SR-IOV group type, if the device does not
have an SR-IOV Extended Capability or if <span 
class="aeti-10">VF Enable </span>is clear then the device MUST
fail all commands with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL and
<span 
class="aeti-10">status_qualifier </span>set to VIRTIO_ADMIN_STATUS_Q_INVALID_GROUP; otherwise, if
<span 
class="aeti-10">group_member_id </span>is not between <span 
class="cmr-10">1 </span>and <span 
class="aeti-10">NumVFs </span>inclusive, the device MUST fail
all commands with <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL and
<span 
class="aeti-10">status_qualifier </span>set to VIRTIO_ADMIN_STATUS_Q_INVALID_MEMBER; <span 
class="aeti-10">NumVFs</span>,
<span 
class="aeti-10">VF Migration Capable </span>and <span 
class="aeti-10">VF Enable </span>refer to registers within the SR-IOV Extended
Capability as specified by <a 
href="#x1-3007x6">[PCIe]</a>.
<a 
 id="x1-140001r143"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.12.1.6   </span> <a 
 id="x1-1410006"></a>Driver Requirements: Group administration commands</h5>
<!--l. 436--><p class="noindent" >The driver MAY discover whether device supports a specific group type by issuing
VIRTIO_ADMIN_CMD_LIST_QUERY with the matching <span 
class="aeti-10">group_type</span>.
<!--l. 440--><p class="noindent" >The driver MUST issue VIRTIO_ADMIN_CMD_LIST_USE and wait for it to be
completed with status VIRTIO_ADMIN_STATUS_OK before issuing any
                                                                  

                                                                  
commands (except for the initial VIRTIO_ADMIN_CMD_LIST_QUERY and
VIRTIO_ADMIN_CMD_LIST_USE).
<!--l. 446--><p class="noindent" >The driver MAY issue VIRTIO_ADMIN_CMD_LIST_USE any number of times but
MUST NOT issue VIRTIO_ADMIN_CMD_LIST_USE commands if any other
command has been submitted to the device and has not yet completed processing by
the device.
<!--l. 451--><p class="noindent" >The driver SHOULD NOT set bits in device_admin_cmd_opcodes if it is not familiar
with how the command opcode is used, as dependencies between command opcodes
might exist.
<!--l. 455--><p class="noindent" >The driver MUST NOT request (via VIRTIO_ADMIN_CMD_LIST_USE) the use of
any commands not previously reported as supported for the same group type by
VIRTIO_ADMIN_CMD_LIST_QUERY.
<!--l. 459--><p class="noindent" >The driver MUST NOT use any commands for a given group type before sending
VIRTIO_ADMIN_CMD_LIST_USE with the correct list of command opcodes and
group type.
<!--l. 463--><p class="noindent" >The driver MAY block use of VIRTIO_ADMIN_CMD_LIST_QUERY and
VIRTIO_ADMIN_CMD_LIST_USE by issuing VIRTIO_ADMIN_CMD_LIST_USE
with respective bits cleared in <span 
class="aeti-10">command_specific_data</span>.
<!--l. 467--><p class="noindent" >The driver MUST handle a command error with a reserved <span 
class="aeti-10">status </span>value in the same
way as <span 
class="aeti-10">status </span>set to VIRTIO_ADMIN_STATUS_EINVAL (except possibly for
different error reporting/diagnostic messages).
<!--l. 471--><p class="noindent" >The driver MUST handle a command error with a reserved <span 
class="aeti-10">status_qualifier </span>value in the
same way as <span 
class="aeti-10">status_qualifier </span>set to VIRTIO_ADMIN_STATUS_Q_INVALID_COMMAND
(except possibly for different error reporting/diagnostic messages).
<!--l. 477--><p class="noindent" >When sending commands with the SR-IOV group type, the driver specify a value for
<span 
class="aeti-10">group_member_id </span>between <span 
class="cmr-10">1 </span>and <span 
class="aeti-10">NumVFs </span>inclusive, the driver MUST also make sure
that as long as any such command is outstanding, <span 
class="aeti-10">VF Migration Capable </span>is
clear and <span 
class="aeti-10">VF Enable </span>is set; <span 
class="aeti-10">NumVFs</span>, <span 
class="aeti-10">VF Migration Capable </span>and <span 
class="aeti-10">VF Enable</span>
refer to registers within the SR-IOV Extended Capability as specified by
<a 
href="#x1-3007x6">[PCIe]</a>.
<a 
 id="x1-141001r106"></a>
<h3 class="sectionHead"><span class="titlemark">2.13   </span> <a 
 id="x1-14200013"></a>Administration Virtqueues</h3>
<!--l. 489--><p class="noindent" >An administration virtqueue of an owner device is used to submit group
administration commands. An owner device can have more than one administration
virtqueue.
<!--l. 493--><p class="noindent" >If VIRTIO_F_ADMIN_VQ has been negotiated, an owner device exposes
one or more administration virtqueues. The number and locations of the
administration virtqueues are exposed by the owner device in a transport specific
manner.
                                                                  

                                                                  
<!--l. 498--><p class="noindent" >The driver enqueues requests to an arbitrary administration virtqueue, and they are
used by the device on that same virtqueue. It is the responsibility of the
driver to ensure strict request ordering for commands, because they will be
consumed with no order constraints. For example, if consistency is required then
the driver can wait for the processing of a first command by the device to
be completed before submitting another command depending on the first
one.
<!--l. 507--><p class="noindent" >Administration virtqueues are used as follows:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 509--><p class="noindent" >The  driver  submits  the  command  using  the  <span 
class="aeti-10">struct  virtio_admin_cmd</span>
     structure using a buffer consisting of two parts: a device-readable one
     followed by a device-writable one.
     </li>
     <li class="itemize">
     <!--l. 512--><p class="noindent" >the   device-readable   part   includes   fields   from   <span 
class="aeti-10">opcode   </span>through
     <span 
class="aeti-10">command_specific_data</span>.
     </li>
     <li class="itemize">
     <!--l. 514--><p class="noindent" >the   device-writeable   buffer   includes   fields   from   <span 
class="aeti-10">status   </span>through
     <span 
class="aeti-10">command_specific_result </span>inclusive.</li></ul>
<!--l. 518--><p class="noindent" >For each command, this specification describes a distinct format structure used for
<span 
class="aeti-10">command_specific_data </span>and <span 
class="aeti-10">command_specific_result</span>, the length of these fields
depends on the command.
<!--l. 523--><p class="noindent" >However, to ensure forward compatibility
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 525--><p class="noindent" >drivers   are   allowed   to   submit   buffers   that   are   longer   than   the
     device  expects  (that  is,  longer  than  the  length  of  <span 
class="aeti-10">opcode  </span>through
     <span 
class="aeti-10">command_specific_data</span>). This allows the driver to maintain a single format
     structure even if some structure fields are unused by the device.
     </li>
     <li class="itemize">
     <!--l. 532--><p class="noindent" >drivers  are  allowed  to  submit  buffers  that  are  shorter  than  what  the
     device  expects  (that  is,  shorter  than  the  length  of  <span 
class="aeti-10">status  </span>through
     <span 
class="aeti-10">command_specific_result</span>).  This  allows  the  device  to  maintain  a  single
     format structure even if some structure fields are unused by the driver.</li></ul>
<!--l. 540--><p class="noindent" >The device compares the length of each part (device-readable and device-writeable)
of the buffer as submitted by driver to what it expects and then silently truncates the
                                                                  

                                                                  
structures to either the length submitted by the driver, or the length described in this
specification, whichever is shorter. The device silently ignores any data falling outside
the shorter of the two lengths. Any missing fields are interpreted as set to
zero.
<!--l. 548--><p class="noindent" >Similarly, the driver compares the used buffer length of the buffer to what it expects
and then silently truncates the structure to the used buffer length. The driver silently
ignores any data falling outside the used buffer length reported by the device. Any
missing fields are interpreted as set to zero.
<!--l. 555--><p class="noindent" >This simplifies driver and device implementations since the driver/device can simply
maintain a single large structure (such as a C structure) for a command and its
result. As new versions of the specification are designed, new fields can be added to
the tail of a structure, with the driver/device using the full structure without concern
for versioning.
<a 
 id="x1-142001r107"></a>
<h4 class="subsectionHead"><span class="titlemark">2.13.1   </span> <a 
 id="x1-1430001"></a>Device Requirements: Group administration commands</h4>
<!--l. 564--><p class="noindent" >The device MUST support device-readable and device-writeable buffers shorter than
described in this specification, by
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">acting as if any data that would be read outside the device-readable buffers
     is set to zero, and
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">discarding   data   that   would   be   written   outside   the   specified
     device-writeable buffers.</dd></dl>
<!--l. 573--><p class="noindent" >The device MUST support device-readable and device-writeable buffers longer than
described in this specification, by
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">ignoring any data in device-readable buffers outside the expected length,
     and
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">only  writing  the  expected  structure  to  the  device-writeable  buffers,
     ignoring any extra buffers, and reporting the actual length of data written,
     in bytes, as buffer used length.</dd></dl>
<!--l. 584--><p class="noindent" >The device SHOULD initialize the device-writeable buffer up to the length
of the structure described by this specification or the length of the buffer
supplied by the driver (even if the buffer is all set to zero), whichever is
shorter.
<!--l. 589--><p class="noindent" >The device MUST NOT fail a command solely because the buffers provided are
shorter or longer than described in this specification.
<!--l. 593--><p class="noindent" >The device MUST initialize the device-writeable part of <span 
class="aeti-10">struct virtio_admin_cmd </span>that
                                                                  

                                                                  
is a multiple of 64 bit in size.
<!--l. 597--><p class="noindent" >The device MUST initialize <span 
class="aeti-10">status </span>and <span 
class="aeti-10">status_qualifier </span>in <span 
class="aeti-10">struct virtio_admin_cmd</span>.
<!--l. 600--><p class="noindent" >The device MUST process commands on a given administration virtqueue in the
order in which they are queued.
<!--l. 603--><p class="noindent" >If multiple administration virtqueues have been configured, device MAY process
commands on distinct virtqueues with no order constraints.
<!--l. 607--><p class="noindent" >If the device sets <span 
class="aeti-10">status </span>to either VIRTIO_ADMIN_STATUS_EAGAIN or
VIRTIO_ADMIN_STATUS_ENOMEM, then the command MUST NOT have any
side effects, making it safe to retry.
<a 
 id="x1-143005r146"></a>
<h4 class="subsectionHead"><span class="titlemark">2.13.2   </span> <a 
 id="x1-1440002"></a>Driver Requirements: Group administration commands</h4>
<!--l. 613--><p class="noindent" >The driver MAY supply device-readable or device-writeable parts of <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_admin_cmd </span>that are longer than described in this specification.
<!--l. 617--><p class="noindent" >The driver SHOULD supply device-readable part of <span 
class="aeti-10">struct virtio_admin_cmd </span>that is
at least as large as the structure described by this specification (even if the structure
is all set to zero).
<!--l. 622--><p class="noindent" >The driver MUST supply both device-readable or device-writeable parts of <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_admin_cmd </span>that are a multiple of 64 bit in length.
<!--l. 626--><p class="noindent" >The device MUST supply both device-readable or device-writeable parts
of <span 
class="aeti-10">struct virtio_admin_cmd </span>that are larger than zero in length. However,
<span 
class="aeti-10">command_specific_data </span>and <span 
class="aeti-10">command_specific_result </span>MAY be zero in length, unless
specified otherwise for the command.
<!--l. 632--><p class="noindent" >The driver MUST NOT assume that the device will initialize the whole
device-writeable part of <span 
class="aeti-10">struct virtio_admin_cmd </span>as described in the specification;
instead, the driver MUST act as if the structure outside the part of the buffer used
by the device is set to zero.
<!--l. 638--><p class="noindent" >If multiple administration virtqueues have been configured, the driver MUST ensure
ordering for commands placed on different administration virtqueues.
<!--l. 642--><p class="noindent" >The driver SHOULD retry a command that completed with <span 
class="aeti-10">status</span>
VIRTIO_ADMIN_STATUS_EAGAIN.
<a 
 id="x1-144001r145"></a>
<h3 class="sectionHead"><span class="titlemark">2.14   </span> <a 
 id="x1-14500014"></a>Device parts</h3>
<!--l. 3--><p class="noindent" >Device parts represent the device state, with parts for basic device facilities such as
driver features, as well as transport specific and device type specific parts. In
memory, each device part consists of a header <span 
class="aeti-10">struct virtio_dev_part_hdr </span>followed by
the device part data in <span 
class="aeti-10">value</span>. The driver can get and set these device parts using
administration commands.
<!--l. 10-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-50"><span class="label"><a 
 id="x1-145001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pci_common_cfg</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">selector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_DEV_PART_F_OPTIONAL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-145023r23"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 37--><p class="noindent" >Each device part consists of a fixed size <span 
class="aeti-10">hdr </span>followed by optional part data in field
<span 
class="aeti-10">value</span>. The device parts are divided into two categories and identified by <span 
class="aeti-10">part_type</span>.
The common device parts are independent of the device type and, are in the
range <span 
class="aeti-10">0x0000 - 0x01FF</span>. Common device parts are listed in <a 
href="#x1-1460014">2.4<!--tex4ht:ref: table:Basic Facilities of a Virtio Device / Device parts / Common device parts --></a> The device
parts in the range <span 
class="aeti-10">0x0200 - 0x05FF </span>are specific to a device type such as a
network or console device. The device part is identified by the <span 
class="aeti-10">part_type </span>field as
listed:
     <dl class="description"><dt class="description">
     <!--l. 48--><p class="noindent" >
<span 
class="aeb10-">0x0000 - 0x01FF</span> </dt><dd 
class="description">
     <!--l. 48--><p class="noindent" >- common part - used to describe a part of the device that is independent
     of the device type
     </dd><dt class="description">
     <!--l. 50--><p class="noindent" >
<span 
class="aeb10-">0x0200 - 0x05FF</span> </dt><dd 
class="description">
     <!--l. 50--><p class="noindent" >- device type specific part - used to indicate parts that are device type
     specific
     </dd><dt class="description">
     <!--l. 52--><p class="noindent" >
<span 
class="aeb10-">0x0600 - 0xFFFF</span> </dt><dd 
class="description">
     <!--l. 52--><p class="noindent" >- reserved</dd></dl>
<!--l. 55--><p class="noindent" >Some device parts are optional, the device can function without them. For example,
such parts can help improve performance, with the device working slower, yet still
correctly, even without the parts. In another example, optional parts can be
used for validation, with the device being able to deduce the part itself,
the part being helpful to detect driver or user errors. Such device parts are
marked optional by setting bit 0 (VIRTIO_DEV_PART_F_OPTIONAL) in the
<span 
class="aeti-10">flags</span>.
<!--l. 63--><p class="noindent" ><span 
class="aeti-10">reserved </span>is reserved and set to zero.
<!--l. 65--><p class="noindent" ><span 
class="aeti-10">length </span>indicates the length of the <span 
class="aeti-10">value </span>in bytes. The length of the device part
depends on the device part itself and is described separately. The device part data is
in <span 
class="aeti-10">value </span>and is <span 
class="aeti-10">part_type </span>specific.
<!--l. 69--><p class="noindent" ><span 
class="aeti-10">selector </span>further specifies the part. It is only used for some <span 
class="aeti-10">part_type </span>values.
<!--l. 72--><p class="noindent" ><span 
class="aeti-10">selector.pci_common_cfg.offset </span>is the offset of the field in the <a 
href="#x1-1750003">Common
configuration structure layout<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>. It is valid only when the <span 
class="aeti-10">part_type </span>is set to
VIRTIO_DEV_PART_PCI_COMMON_CFG, otherwise it is reserved and set to
                                                                  

                                                                  
0.
<!--l. 76--><p class="noindent" ><span 
class="aeti-10">selector.vq_index.index </span>is the index of the virtqueue. It is valid only when the
<span 
class="aeti-10">part_type </span>is VIRTIO_DEV_PART_VQ_CFG or VIRTIO_DEV_PART_VQ_CFG.
<a 
 id="x1-145026r147"></a>
<h4 class="subsectionHead"><span class="titlemark">2.14.1   </span> <a 
 id="x1-1460001"></a>Common device parts</h4>
<!--l. 82--><p class="noindent" >Common parts are independent of the device type. <span 
class="aeti-10">part_type </span>and <span 
class="aeti-10">value </span>for each part
are documented as follows:
<div class="table">
                                                                  

                                                                  
<!--l. 86--><p class="noindent" ><a 
 id="x1-1460014"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Table 2.4: </span><span  
class="content">Common device parts</span></div><!--tex4ht:label?: x1-1460014 -->
<!--l. 107--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Type              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                                                    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x100             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEV_FEATURES      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device
 features, see
 <a 
href="#x1-1470001">2.14.1.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device parts / Common device parts / VIRTIO-DEV-PART-DEV-FEATURES --></a>     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x101             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DRV_FEATURES       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Driver
 features,
 <a 
href="#x1-1480002">2.14.1.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device parts / Common device parts / VIRTIO-DEV-PART-DRV-FEATURES --></a>     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x102             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_PCI_COMMON_CFG  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > PCI
 common
 configuration,
 see <a 
href="#x1-1490003">2.14.1.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device parts / Common device parts / VIRTIO-DEV-PART-PCI-COMMON-CFG --></a>  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x103             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_DEVICE_STATUS      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device
 status,   see
 <a 
href="#x1-1500004">2.14.1.4<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device parts / Common device parts / VIRTIO-DEV-PART-DEVICE-STATUS --></a>     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x104             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_VQ_CFG                  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Virtqueue
 configuration,
 see <a 
href="#x1-1510005">2.14.1.5<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device parts / Common device parts / VIRTIO-DEV-PART-VQ-CFG --></a>  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x105             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_DEV_PART_VQ_NOTIFY_CFG     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Virtqueue
 notification
 configuration,
 see <a 
href="#x1-1520006">2.14.1.6<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device parts / Common device parts / VIRTIO-DEV-PART-VQ-NOTIFY-CFG --></a>  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x106 - 0x2FF  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                                                           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Common
 device parts
 range
 reserved for
 future      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-9"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >              </td></tr></table>
                                                                  

                                                                  
</div><hr class="endfloat" />
</div>
<a 
 id="x1-146002r144"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.14.1.1   </span> <a 
 id="x1-1470001"></a>VIRTIO_DEV_PART_DEV_FEATURES</h5>
<!--l. 113--><p class="noindent" >For VIRTIO_DEV_PART_DEV_FEATURES, <span 
class="aeti-10">part_type </span>is set to 0x100. The
VIRTIO_DEV_PART_DEV_FEATURES field indicates features offered by the device.
<span 
class="aeti-10">value </span>is in the format of <span 
class="aeti-10">struct virtio_dev_part_features</span>. <span 
class="aeti-10">feature_bits </span>is in the format
listed in <a 
href="#x1-140002">2.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a>. <span 
class="aeti-10">length </span>is the length of the <span 
class="aeti-10">struct virtio_dev_part_features</span>.
<!--l. 120--><p class="noindent" >If the VIRTIO_DEV_PART_DEV_FEATURES device part is present, there is exactly
one instance of it in the get or set commands.
<!--l. 123--><p class="noindent" >The VIRTIO_DEV_PART_DEV_FEATURES part is optional for which the
VIRTIO_DEV_PART_F_OPTIONAL (bit 0) <span 
class="aeti-10">flags </span>is set.
<!--l. 126-->
<pre class="lstlisting" id="listing-51"><span class="label"><a 
 id="x1-147001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part_features</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-147002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">feature_bits</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-147003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-147004r151"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.14.1.2   </span> <a 
 id="x1-1480002"></a>VIRTIO_DEV_PART_DRV_FEATURES</h5>
<!--l. 135--><p class="noindent" >For VIRTIO_DEV_PART_DRV_FEATURES, <span 
class="aeti-10">part_type </span>is set to 0x101. The
VIRTIO_DEV_PART_DRV_FEATURES field indicates features set by the driver.
<span 
class="aeti-10">value </span>is in the format of <span 
class="aeti-10">struct virtio_dev_part_features</span>. <span 
class="aeti-10">feature_bits </span>is in the format
listed in <a 
href="#x1-140002">2.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a>. <span 
class="aeti-10">length </span>is the length of the <span 
class="aeti-10">struct virtio_dev_part_features</span>.
<!--l. 142--><p class="noindent" >If the VIRTIO_DEV_PART_DEV_FEATURES device part present, there is exactly
one instance of it in the get or set commands.
<a 
 id="x1-148001r152"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.14.1.3   </span> <a 
 id="x1-1490003"></a>VIRTIO_DEV_PART_PCI_COMMON_CFG</h5>
<!--l. 148--><p class="noindent" >For VIRTIO_DEV_PART_PCI_COMMON_CFG, <span 
class="aeti-10">part_type </span>is set to 0x102.
VIRTIO_DEV_PART_PCI_COMMON_CFG refers to the common device
configuration fields. <span 
class="aeti-10">offset </span>refers to the byte offset of single field in the common
configuration layout described in <span 
class="aeti-10">struct virtio_pci_common_cfg</span>. <span 
class="aeti-10">value </span>is in the format
depending on the <span 
class="aeti-10">offset</span>, for example when <span 
class="aeti-10">cfg_offset = 18</span>, <span 
class="aeti-10">value </span>is in the format of
<span 
class="aeti-10">num_queues</span>. <span 
class="aeti-10">length </span>is the length of <span 
class="aeti-10">value </span>in bytes of a single structure field whose
offset is <span 
class="aeti-10">offset</span>.
<!--l. 157--><p class="noindent" >One or multiple VIRTIO_DEV_PART_PCI_COMMON_CFG parts may exist in the
get or set commands; each such part corresponds to a unique <span 
class="aeti-10">offset</span>.
<a 
 id="x1-149001r153"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.14.1.4   </span> <a 
 id="x1-1500004"></a>VIRTIO_DEV_PART_DEVICE_STATUS</h5>
<!--l. 163--><p class="noindent" >For VIRTIO_DEV_PART_DEVICE_STATUS, <span 
class="aeti-10">part_type </span>is set to 0x103. The
                                                                  

                                                                  
VIRTIO_DEV_PART_DEVICE_STATUS field indicates the device status as listed in
<a 
href="#x1-110001">2.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Status Field --></a>. <span 
class="aeti-10">value </span>is in the format <span 
class="aeti-10">device_status </span>of <span 
class="aeti-10">struct virtio_pci_common_cfg</span>.
<!--l. 169--><p class="noindent" >If the VIRTIO_DEV_PART_DEV_FEATURES device part is present, there is exactly
one instance of it in the get or set commands.
<!--l. 172--><p class="noindent" >There is exactly one part may exist in the get or set commands.
<a 
 id="x1-150001r154"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.14.1.5   </span> <a 
 id="x1-1510005"></a>VIRTIO_DEV_PART_VQ_CFG</h5>
<!--l. 178--><p class="noindent" >For VIRTIO_DEV_PART_VQ_CFG, <span 
class="aeti-10">part_type </span>is set to 0x104. <span 
class="aeti-10">value </span>is in the format
<span 
class="aeti-10">struct virtio_dev_part_vq_cfg</span>. <span 
class="aeti-10">length </span>is the length of <span 
class="aeti-10">struct virtio_dev_part_vq_cfg</span>.
<!--l. 182-->
<pre class="lstlisting" id="listing-52"><span class="label"><a 
 id="x1-151001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part_vq_cfg</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_driver</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-151009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 194--><p class="noindent" ><span 
class="aeti-10">queue_size</span>, <span 
class="aeti-10">vector</span>, <span 
class="aeti-10">queue_desc</span>, <span 
class="aeti-10">queue_driver </span>and <span 
class="aeti-10">queue_device </span>correspond to the fields
of <span 
class="aeti-10">struct virtio_pci_common_cfg </span>when used for PCI transport.
<!--l. 198--><p class="noindent" >One or multiple instances of the device part VIRTIO_DEV_PART_VQ_CFG may
exist in the get and set commands. Each such device part corresponds to a unique
virtqueue identified by the <span 
class="aeti-10">vq_index.index</span>.
<a 
 id="x1-151010r155"></a>
<h5 class="subsubsectionHead"><span class="titlemark">2.14.1.6   </span> <a 
 id="x1-1520006"></a>VIRTIO_DEV_PART_VQ_NOTIFY_CFG</h5>
<!--l. 205--><p class="noindent" >For VIRTIO_DEV_PART_VQ_NOTIFY_CFG, <span 
class="aeti-10">part_type </span>is set to 0x105. <span 
class="aeti-10">value </span>is in
the format <span 
class="aeti-10">struct virtio_dev_part_vq_notify_data</span>. <span 
class="aeti-10">length </span>is the length of <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_dev_part_vq_notify_data</span>.
<!--l. 209-->
<pre class="lstlisting" id="listing-53"><span class="label"><a 
 id="x1-152001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_dev_part_vq_notify_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-152002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notify_off</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-152003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notif_config_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-152004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-152005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 217--><p class="noindent" ><span 
class="aeti-10">queue_notify_off  </span>and <span 
class="aeti-10">queue_notif_config_data </span>corresponds to the fields in <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_pci_common_cfg </span>described in the <a 
href="#x1-1750003">Common configuration structure
layout<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>.
<!--l. 221--><p class="noindent" >One or multiple instance of the device part VIRTIO_DEV_PART_VQ_NOTIFY_CFG
may exist in the get and set commands, each such device part corresponds to a
unique virtqueue identified by the <span 
class="aeti-10">vq_index.index</span>.
<!--l. 225--><p class="noindent" ><span 
class="aeti-10">reserved </span>is reserved and set to 0.
<a 
 id="x1-152006r149"></a>
<h4 class="subsectionHead"><span class="titlemark">2.14.2   </span> <a 
 id="x1-1530002"></a>Assumptions</h4>
<!--l. 228--><p class="noindent" >For the SR-IOV group type, some hypervisors do not allow the driver to
access the PCI configuration space and the MSI-X Table space directly. Such
                                                                  

                                                                  
hypervisors query and save these fields without the need for this device parts.
Therefore, this version of the specification does not have it in the device parts. A
future extension of the device part may further include them as new device
part.
                                                                  

                                                                  
<!--l. 508--><p class="noindent" ><h2 class="chapterHead"><hr><span class="titlemark">3</span> <a 
 id="x1-1540003"></a>General Initialization And Device Operation</h2>
We start with an overview of device initialization, then expand on the details of the
device and how each step is performed. This section is best read along with the
bus-specific section which describes how to communicate with the specific
device.
<a 
 id="x1-154001r148"></a>
<h3 class="sectionHead"><span class="titlemark">3.1   </span> <a 
 id="x1-1550001"></a>Device Initialization</h3>
<a 
 id="x1-155001r157"></a>
<h4 class="subsectionHead"><span class="titlemark">3.1.1   </span> <a 
 id="x1-1560001"></a>Driver Requirements: Device Initialization</h4>
<!--l. 518--><p class="noindent" >The driver MUST follow this sequence to initialize a device:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Reset the device.
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Set the ACKNOWLEDGE status bit: the guest OS has noticed the device.
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Set the DRIVER status bit: the guest OS knows how to drive the device.
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-1560044"></a> Read device feature bits, and write the subset of feature bits understood
     by the OS and driver to the device. During this step the driver MAY read
     (but MUST NOT write) the device-specific configuration fields to check
     that it can support the device before accepting it.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-1560055"></a> Set the FEATURES_OK status bit. The driver MUST NOT accept new
     feature bits after this step.
     </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-1560066"></a>  Re-read  <span 
class="aeti-10">device  status  </span>to  ensure  the  FEATURES_OK  bit  is  still  set:
     otherwise, the device does not support our subset of features and the
     device is unusable.
     </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-1560077"></a> Perform device-specific setup, including discovery of virtqueues for the
     device, optional per-bus setup, reading and possibly writing the device’s
     virtio configuration space, and population of virtqueues.
     </dd><dt class="enumerate-enumitem">
  8. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-1560088"></a> Set the DRIVER_OK status bit. At this point the device is “live”.</dd></dl>
<!--l. 547--><p class="noindent" >If any of these steps go irrecoverably wrong, the driver SHOULD set the FAILED
status bit to indicate that it has given up on the device (it can reset the device later
to restart if desired). The driver MUST NOT continue initialization in that
case.
                                                                  

                                                                  
<!--l. 552--><p class="noindent" >The driver MUST NOT send any buffer available notifications to the device before
setting DRIVER_OK.
<a 
 id="x1-156009r160"></a>
<h4 class="subsectionHead"><span class="titlemark">3.1.2   </span> <a 
 id="x1-1570002"></a>Legacy Interface: Device Initialization</h4>
<!--l. 556--><p class="noindent" >Legacy devices did not support the FEATURES_OK status bit, and thus did not
have a graceful way for the device to indicate unsupported feature combinations.
They also did not provide a clear mechanism to end feature negotiation,
which meant that devices finalized features on first-use, and no features
could be introduced which radically changed the initial operation of the
device.
<!--l. 563--><p class="noindent" >Legacy driver implementations often used the device before setting the DRIVER_OK
bit, and sometimes even before writing the feature bits to the device.
<!--l. 567--><p class="noindent" >The result was the steps <a 
href="#x1-1560055">5<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Set FEATURES-OK --></a> and <a 
href="#x1-1560066">6<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Re-read FEATURES-OK --></a> were omitted, and steps <a 
href="#x1-1560044">4<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Read feature bits --></a>, <a 
href="#x1-1560077">7<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Device-specific Setup --></a> and <a 
href="#x1-1560088">8<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Set DRIVER-OK --></a> were
conflated.
<!--l. 576--><p class="noindent" >Therefore, when using the legacy interface:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 579--><p class="noindent" >The  transitional  driver  MUST  execute  the  initialization  sequence  as
     described in <a 
href="#x1-1550001">3.1<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a> but omitting the steps <a 
href="#x1-1560055">5<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Set FEATURES-OK --></a> and <a 
href="#x1-1560066">6<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Re-read FEATURES-OK --></a>.
     </li>
     <li class="itemize">
     <!--l. 588--><p class="noindent" >The  transitional  device  MUST  support  the  driver  writing  device
     configuration fields before the step <a 
href="#x1-1560044">4<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Read feature bits --></a>.
     </li>
     <li class="itemize">
     <!--l. 593--><p class="noindent" >The transitional device MUST support the driver using the device before
     the step <a 
href="#x1-1560088">8<!--tex4ht:ref: itm:General Initialization And Device Operation / Device Initialization / Set DRIVER-OK --></a>.</li></ul>
<a 
 id="x1-157001r159"></a>
<h3 class="sectionHead"><span class="titlemark">3.2   </span> <a 
 id="x1-1580002"></a>Device Operation</h3>
<!--l. 600--><p class="noindent" >When operating the device, each field in the device configuration space can be
changed by either the driver or the device.
<!--l. 603--><p class="noindent" >Whenever such a configuration change is triggered by the device, driver is notified.
This makes it possible for drivers to cache device configuration, avoiding expensive
configuration reads unless notified.
<a 
 id="x1-158001r161"></a>
<h4 class="subsectionHead"><span class="titlemark">3.2.1   </span> <a 
 id="x1-1590001"></a>Notification of Device Configuration Changes</h4>
<!--l. 611--><p class="noindent" >For devices where the device-specific configuration information can be changed, a
                                                                  

                                                                  
configuration change notification is sent when a device-specific configuration change
occurs.
<!--l. 615--><p class="noindent" >In addition, this notification is triggered by the device setting DEVICE_NEEDS_RESET
(see <a 
href="#x1-130002">2.1.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Status Field / DEVICENEEDSRESET --></a>).
<a 
 id="x1-159001r162"></a>
<h3 class="sectionHead"><span class="titlemark">3.3   </span> <a 
 id="x1-1600003"></a>Device Cleanup</h3>
<!--l. 620--><p class="noindent" >Once the driver has set the DRIVER_OK status bit, all the configured virtqueue of
the device are considered live. None of the virtqueues of a device are live once the
device has been reset.
<a 
 id="x1-160001r163"></a>
<h4 class="subsectionHead"><span class="titlemark">3.3.1   </span> <a 
 id="x1-1610001"></a>Driver Requirements: Device Cleanup</h4>
<!--l. 626--><p class="noindent" >A driver MUST NOT alter virtqueue entries for exposed buffers, i.e., buffers which
have been made available to the device (and not been used by the device) of a live
virtqueue.
<!--l. 631--><p class="noindent" >Thus a driver MUST ensure a virtqueue isn’t live (by device reset) before removing
exposed buffers.
                                                                  

                                                                  
<!--l. 633--><p class="noindent" ><h2 class="chapterHead"><hr><span class="titlemark">4</span> <a 
 id="x1-1620004"></a>Virtio Transport Options</h2>
Virtio can use various different buses, thus the standard is split into virtio general
and bus-specific sections.
<a 
 id="x1-162001r164"></a>
<h3 class="sectionHead"><span class="titlemark">4.1   </span> <a 
 id="x1-1630001"></a>Virtio Over PCI Bus</h3>
<!--l. 3--><p class="noindent" >Virtio devices are commonly implemented as PCI devices.
<!--l. 5--><p class="noindent" >A Virtio device can be implemented as any kind of PCI device: a Conventional PCI
device or a PCI Express device. To assure designs meet the latest level requirements,
see the PCI-SIG home page at     <a 
href="http://www.pcisig.com" class="url" >http://www.pcisig.com</a> for any approved
changes.
<a 
 id="x1-163001r165"></a>
<h4 class="subsectionHead"><span class="titlemark">4.1.1   </span> <a 
 id="x1-1640001"></a>Device Requirements: Virtio Over PCI Bus</h4>
<!--l. 13--><p class="noindent" >A Virtio device using Virtio Over PCI Bus MUST expose to guest an interface that
meets the specification requirements of the appropriate PCI specification: <a 
href="#x1-3006x5">[PCI]</a> and
<a 
href="#x1-3007x6">[PCIe]</a> respectively.
<a 
 id="x1-164001r168"></a>
<h4 class="subsectionHead"><span class="titlemark">4.1.2   </span> <a 
 id="x1-1650002"></a>PCI Device Discovery</h4>
<!--l. 21--><p class="noindent" >Any PCI device with PCI Vendor ID 0x1AF4, and PCI Device ID 0x1000 through
0x107F inclusive is a virtio device. The actual value within this range indicates which
virtio device is supported by the device. The PCI Device ID is calculated by adding
0x1040 to the Virtio Device ID, as indicated in section <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>. Additionally, devices MAY
utilize a Transitional PCI Device ID range, 0x1000 to 0x103F depending on the
device type.
<a 
 id="x1-165001r156"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.2.1   </span> <a 
 id="x1-1660001"></a>Device Requirements: PCI Device Discovery</h5>
<!--l. 31--><p class="noindent" >Devices MUST have the PCI Vendor ID 0x1AF4. Devices MUST either have the PCI
Device ID calculated by adding 0x1040 to the Virtio Device ID, as indicated in
section <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a> or have the Transitional PCI Device ID depending on the device type, as
follows:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Transitional PCI Device ID  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         Virtio Device              </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0x1000 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >network device</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x1001                             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         block device               </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x1002                             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > memory ballooning (traditional)  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x1003                             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >            console                  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x1004                             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          SCSI host                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x1005                             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         entropy source             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x1009                             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         9P transport               </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-9"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 57--><p class="noindent" >For example, the network device with the Virtio Device ID 1 has the PCI Device ID
0x1041 or the Transitional PCI Device ID 0x1000.
<!--l. 60--><p class="noindent" >The PCI Subsystem Vendor ID and the PCI Subsystem Device ID MAY reflect the
PCI Vendor and Device ID of the environment (for informational purposes by the
                                                                  

                                                                  
driver).
<!--l. 63--><p class="noindent" >Non-transitional devices SHOULD have a PCI Device ID in the range 0x1040 to
0x107f. Non-transitional devices SHOULD have a PCI Revision ID of 1 or higher.
Non-transitional devices SHOULD have a PCI Subsystem Device ID of 0x40 or
higher.
<!--l. 68--><p class="noindent" >This is to reduce the chance of a legacy driver attempting to drive the device.
<a 
 id="x1-166001r170"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.2.2   </span> <a 
 id="x1-1670002"></a>Driver Requirements: PCI Device Discovery</h5>
<!--l. 72--><p class="noindent" >Drivers MUST match devices with the PCI Vendor ID 0x1AF4 and the PCI Device
ID in the range 0x1040 to 0x107f, calculated by adding 0x1040 to the Virtio Device
ID, as indicated in section <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>. Drivers for device types listed in section <a 
href="#x1-1650002">4.1.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery --></a> MUST
match devices with the PCI Vendor ID 0x1AF4 and the Transitional PCI Device ID
indicated in section <a 
href="#x1-1650002">4.1.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery --></a>.
<!--l. 83--><p class="noindent" >Drivers MUST match any PCI Revision ID value. Drivers MAY match any PCI
Subsystem Vendor ID and any PCI Subsystem Device ID value.
<a 
 id="x1-167001r171"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.2.3   </span> <a 
 id="x1-1680003"></a>Legacy Interfaces: A Note on PCI Device Discovery</h5>
<!--l. 88--><p class="noindent" >Transitional devices MUST have a PCI Revision ID of 0. Transitional devices MUST
have the PCI Subsystem Device ID matching the Virtio Device ID, as indicated in
section <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>. Transitional devices MUST have the Transitional PCI Device ID in the
range 0x1000 to 0x103f.
<!--l. 94--><p class="noindent" >This is to match legacy drivers.
<a 
 id="x1-168001r169"></a>
<h4 class="subsectionHead"><span class="titlemark">4.1.3   </span> <a 
 id="x1-1690003"></a>PCI Device Layout</h4>
<!--l. 98--><p class="noindent" >The device is configured via I/O and/or memory regions (though see <a 
href="#x1-1900009">4.1.4.9<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / PCI configuration access capability --></a> for
access via the PCI configuration space), as specified by Virtio Structure PCI
Capabilities.
<!--l. 103--><p class="noindent" >Fields of different sizes are present in the device configuration regions. All 64-bit,
32-bit and 16-bit fields are little-endian. 64-bit fields are to be treated as two 32-bit
fields, with low 32 bit part followed by the high 32 bit part.
<a 
 id="x1-169001r172"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.3.1   </span> <a 
 id="x1-1700001"></a>Driver Requirements: PCI Device Layout</h5>
<!--l. 111--><p class="noindent" >For device configuration access, the driver MUST use 8-bit wide accesses for 8-bit
wide fields, 16-bit wide and aligned accesses for 16-bit wide fields and 32-bit
wide and aligned accesses for 32-bit and 64-bit wide fields. For 64-bit fields,
the driver MAY access each of the high and low 32-bit parts of the field
independently.
<a 
 id="x1-170001r174"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">4.1.3.2   </span> <a 
 id="x1-1710002"></a>Device Requirements: PCI Device Layout</h5>
<!--l. 120--><p class="noindent" >For 64-bit device configuration fields, the device MUST allow driver independent
access to high and low 32-bit parts of the field.
<a 
 id="x1-171001r173"></a>
<h4 class="subsectionHead"><span class="titlemark">4.1.4   </span> <a 
 id="x1-1720004"></a>Virtio Structure PCI Capabilities</h4>
<!--l. 125--><p class="noindent" >The virtio device configuration layout includes several structures:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 127--><p class="noindent" >Common configuration
     </li>
     <li class="itemize">
     <!--l. 128--><p class="noindent" >Notifications
     </li>
     <li class="itemize">
     <!--l. 129--><p class="noindent" >ISR Status
     </li>
     <li class="itemize">
     <!--l. 130--><p class="noindent" >Device-specific configuration (optional)
     </li>
     <li class="itemize">
     <!--l. 131--><p class="noindent" >PCI configuration access</li></ul>
<!--l. 134--><p class="noindent" >Each structure can be mapped by a Base Address register (BAR) belonging to the
function, or accessed via the special VIRTIO_PCI_CAP_PCI_CFG field in the PCI
configuration space.
<!--l. 137--><p class="noindent" >The location of each structure is specified using a vendor-specific PCI capability
located on the capability list in PCI configuration space of the device. This virtio
structure capability uses little-endian format; all fields are read-only for the driver
unless stated otherwise:
<!--l. 142-->
<pre class="lstlisting" id="listing-54"><span class="label"><a 
 id="x1-172001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_vndr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Generic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI_CAP_ID_VNDR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_next</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Generic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ptr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Generic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capability</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cfg_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Identifies</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">structure</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bar</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Where</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">find</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">it</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Multiple</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capabilities</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">same</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[2];</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Pad</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">full</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dword</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">within</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bar</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">structure</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 156--><p class="noindent" >This structure can be followed by extra data, depending on <span 
class="aeti-10">cfg_type</span>, as documented
below.
<!--l. 159--><p class="noindent" >The fields are interpreted as follows:
                                                                  

                                                                  
     <dl class="description"><dt class="description">
     <!--l. 162--><p class="noindent" >
<span 
class="aebxti-10">cap_vndr</span> </dt><dd 
class="description">
     <!--l. 162--><p class="noindent" >0x09; Identifies a vendor-specific capability.
     </dd><dt class="description">
     <!--l. 165--><p class="noindent" >
<span 
class="aebxti-10">cap_next</span> </dt><dd 
class="description">
     <!--l. 165--><p class="noindent" >Link to next capability in the capability list in the PCI configuration space.
     </dd><dt class="description">
     <!--l. 168--><p class="noindent" >
<span 
class="aebxti-10">cap_len</span> </dt><dd 
class="description">
     <!--l. 168--><p class="noindent" >Length  of  this  capability  structure,  including  the  whole  of  struct
     virtio_pci_cap, and extra data if any. This length MAY include padding,
     or fields unused by the driver.
     </dd><dt class="description">
     <!--l. 173--><p class="noindent" >
<span 
class="aebxti-10">cfg_type</span> </dt><dd 
class="description">
     <!--l. 173--><p class="noindent" >identifies the structure, according to the following table:
     <!--l. 176-->
     <pre class="lstlisting" id="listing-55"><span class="label"><a 
 id="x1-172012r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Common</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172013r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PCI_CAP_COMMON_CFG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172014r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Notifications</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172015r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PCI_CAP_NOTIFY_CFG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172016r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ISR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172017r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PCI_CAP_ISR_CFG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172018r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172019r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PCI_CAP_DEVICE_CFG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172020r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configuration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">access</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172021r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PCI_CAP_PCI_CFG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172022r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Shared</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">memory</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">region</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172023r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PCI_CAP_SHARED_MEMORY_CFG</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172024r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vendor</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172025r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PCI_CAP_VENDOR_CFG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span></pre>
     
     <!--l. 193--><p class="noindent" >Any other value is reserved for future use.
     <!--l. 195--><p class="noindent" >Each structure is detailed individually below.
     <!--l. 197--><p class="noindent" >The device MAY offer more than one structure of any type - this makes it
     possible for the device to expose multiple interfaces to drivers. The order of the
     capabilities in the capability list specifies the order of preference suggested by
     the device. A device may specify that this ordering mechanism be overridden by
     the use of the <span 
class="aeti-10">id </span>field.
     <span 
class="aeb10-">Note:</span> For   example,   on   some   hypervisors,   notifications   using   IO
          accesses  are  faster  than  memory  accesses.  In  this  case,  the
          device   would   expose   two   capabilities   with   <span 
class="aeti-10">cfg_type   </span>set   to
          VIRTIO_PCI_CAP_NOTIFY_CFG: the first one addressing an I/O
          BAR, the second one addressing a memory BAR. In this example,
          the driver would use the I/O BAR if I/O resources are available,
          and fall back on memory BAR when I/O resources are unavailable.
                                                                  

                                                                  
     </dd><dt class="description">
     <!--l. 211--><p class="noindent" >
<span 
class="aebxti-10">bar</span> </dt><dd 
class="description">
     <!--l. 211--><p class="noindent" >values 0x0 to 0x5 specify a Base Address register (BAR) belonging to the
     function located beginning at 10h in PCI Configuration Space and
     used to map the structure into Memory or I/O Space. The BAR is
     permitted to be either 32-bit or 64-bit, it can map Memory Space or I/O
     Space.
     <!--l. 218--><p class="noindent" >Any other value is reserved for future use.
     </dd><dt class="description">
     <!--l. 220--><p class="noindent" >
<span 
class="aebxti-10">id</span> </dt><dd 
class="description">
     <!--l. 220--><p class="noindent" >Used by some device types to uniquely identify multiple capabilities of a certain
     type. If the device type does not specify the meaning of this field, its contents
     are undefined.
     </dd><dt class="description">
     <!--l. 226--><p class="noindent" >
<span 
class="aebxti-10">offset</span> </dt><dd 
class="description">
     <!--l. 226--><p class="noindent" >indicates where the structure begins relative to the base address associated with
     the BAR. The alignment requirements of <span 
class="aeti-10">offset </span>are indicated in each
     structure-specific section below.
     </dd><dt class="description">
     <!--l. 231--><p class="noindent" >
<span 
class="aebxti-10">length</span> </dt><dd 
class="description">
     <!--l. 231--><p class="noindent" >indicates the length of the structure.
     <!--l. 234--><p class="noindent" ><span 
class="aeti-10">length </span>MAY include padding, or fields unused by the driver, or future
     extensions.
     <span 
class="aeb10-">Note:</span> For example, a future device might present a large structure size of
          several MBytes. As current devices never utilize structures larger
          than 4KBytes in size, driver MAY limit the mapped structure size
          to  e.g.  4KBytes  (thus  ignoring  parts  of  structure  after  the  first
          4KBytes) to allow forward compatibility with such devices without
          loss of functionality and without wasting resources.
     </dd></dl>
<!--l. 248--><p class="noindent" >A variant of this type, struct virtio_pci_cap64, is defined for those capabilities that
require offsets or lengths larger than 4GiB:
                                                                  

                                                                  
<!--l. 252-->
<pre class="lstlisting" id="listing-56"><span class="label"><a 
 id="x1-172026r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_cap64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172027r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172028r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset_hi</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172029r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length_hi</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-172030r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 260--><p class="noindent" >Given that the <span 
class="aeti-10">cap.length </span>and <span 
class="aeti-10">cap.offset </span>fields are only 32 bit, the additional <span 
class="aeti-10">offset_hi</span>
and <span 
class="aeti-10">length_hi </span>fields provide the most significant 32 bits of a total 64 bit offset and
length within the BAR specified by <span 
class="aeti-10">cap.bar</span>.
<a 
 id="x1-172031r175"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.1   </span> <a 
 id="x1-1730001"></a>Driver Requirements: Virtio Structure PCI Capabilities</h5>
<!--l. 267--><p class="noindent" >The driver MUST ignore any vendor-specific capability structure which has a
reserved <span 
class="aeti-10">cfg_type </span>value.
<!--l. 270--><p class="noindent" >The driver SHOULD use the first instance of each virtio structure type they can
support.
<!--l. 273--><p class="noindent" >The driver MUST accept a <span 
class="aeti-10">cap_len </span>value which is larger than specified here.
<!--l. 275--><p class="noindent" >The driver MUST ignore any vendor-specific capability structure which has a
reserved <span 
class="aeti-10">bar </span>value.
<!--l. 278--><p class="noindent" >The drivers SHOULD only map part of configuration structure large enough for
device operation. The drivers MUST handle an unexpectedly large <span 
class="aeti-10">length</span>, but MAY
check that <span 
class="aeti-10">length </span>is large enough for device operation.
<!--l. 283--><p class="noindent" >The driver MUST NOT write into any field of the capability structure, with the
exception of those with <span 
class="aeti-10">cap_type </span>VIRTIO_PCI_CAP_PCI_CFG as detailed in
<a 
href="#x1-1920002">4.1.4.9.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / PCI configuration access capability --></a>.
<a 
 id="x1-173001r177"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.2   </span> <a 
 id="x1-1740002"></a>Device Requirements: Virtio Structure PCI Capabilities</h5>
<!--l. 289--><p class="noindent" >The device MUST include any extra data (from the beginning of the <span 
class="aeti-10">cap_vndr </span>field
through end of the extra data fields if any) in <span 
class="aeti-10">cap_len</span>. The device MAY append extra
data or padding to any structure beyond that.
<!--l. 294--><p class="noindent" >If the device presents multiple structures of the same type, it SHOULD order them
from optimal (first) to least-optimal (last).
<a 
 id="x1-174001r178"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.3   </span> <a 
 id="x1-1750003"></a>Common configuration structure layout</h5>
<!--l. 299--><p class="noindent" >The common configuration structure is found at the <span 
class="aeti-10">bar </span>and <span 
class="aeti-10">offset </span>within the
VIRTIO_PCI_CAP_COMMON_CFG capability; its layout is below.
<!--l. 301-->
<pre class="lstlisting" id="listing-57"><span class="label"><a 
 id="x1-175001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_common_cfg</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">About</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">whole</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device_feature_select</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device_feature</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver_feature_select</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver_feature</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">config_msix_vector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_queues</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device_status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">config_generation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">About</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtqueue</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_select</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_msix_vector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_enable</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notify_off</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_driver</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notif_config_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_reset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">About</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">administration</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtqueue</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">admin_queue_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">admin_queue_num</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-175027r27"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
                                                                  

                                                                  
     <dl class="description"><dt class="description">
     <!--l. 332--><p class="noindent" >
<span 
class="aebxti-10">device_feature_select</span> </dt><dd 
class="description">
     <!--l. 332--><p class="noindent" >The driver uses this to select which feature bits <span 
class="aeti-10">device_feature </span>shows. Value
     0x0 selects Feature Bits 0 to 31, 0x1 selects Feature Bits 32 to 63, etc.
     </dd><dt class="description">
     <!--l. 336--><p class="noindent" >
<span 
class="aebxti-10">device_feature</span> </dt><dd 
class="description">
     <!--l. 336--><p class="noindent" >The device uses this to report which feature bits it is offering to the driver:
     the driver writes to <span 
class="aeti-10">device_feature_select </span>to select which feature bits are
     presented.
     </dd><dt class="description">
     <!--l. 341--><p class="noindent" >
<span 
class="aebxti-10">driver_feature_select</span> </dt><dd 
class="description">
     <!--l. 341--><p class="noindent" >The driver uses this to select which feature bits <span 
class="aeti-10">driver_feature </span>shows. Value
     0x0 selects Feature Bits 0 to 31, 0x1 selects Feature Bits 32 to 63, etc.
     </dd><dt class="description">
     <!--l. 345--><p class="noindent" >
<span 
class="aebxti-10">driver_feature</span> </dt><dd 
class="description">
     <!--l. 345--><p class="noindent" >The driver writes this to accept feature bits offered by the device. Driver
     Feature Bits selected by <span 
class="aeti-10">driver_feature_select</span>.
     </dd><dt class="description">
     <!--l. 349--><p class="noindent" >
<span 
class="aebxti-10">config_msix_vector</span> </dt><dd 
class="description">
     <!--l. 349--><p class="noindent" >Set  by  the  driver  to  the  MSI-X  vector  for  configuration  change
     notifications.
     </dd><dt class="description">
     <!--l. 352--><p class="noindent" >
<span 
class="aebxti-10">num_queues</span> </dt><dd 
class="description">
     <!--l. 352--><p class="noindent" >The device specifies the maximum number of virtqueues supported here.
     This excludes administration virtqueues if any are supported.
     </dd><dt class="description">
     <!--l. 356--><p class="noindent" >
<span 
class="aebxti-10">device_status</span> </dt><dd 
class="description">
     <!--l. 356--><p class="noindent" >The driver writes the device status here (see <a 
href="#x1-110001">2.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Status Field --></a>). Writing 0 into this field
     resets the device.
                                                                  

                                                                  
     </dd><dt class="description">
     <!--l. 360--><p class="noindent" >
<span 
class="aebxti-10">config_generation</span> </dt><dd 
class="description">
     <!--l. 360--><p class="noindent" >Configuration atomicity value. The device changes this every time the
     configuration noticeably changes.
     </dd><dt class="description">
     <!--l. 364--><p class="noindent" >
<span 
class="aebxti-10">queue_select</span> </dt><dd 
class="description">
     <!--l. 364--><p class="noindent" >Queue Select. The driver selects which virtqueue the following fields refer
     to.
     </dd><dt class="description">
     <!--l. 368--><p class="noindent" >
<span 
class="aebxti-10">queue_size</span> </dt><dd 
class="description">
     <!--l. 368--><p class="noindent" >Queue Size. On reset, specifies the maximum queue size supported by the
     device. This can be modified by the driver to reduce memory requirements.
     A 0 means the queue is unavailable.
     </dd><dt class="description">
     <!--l. 373--><p class="noindent" >
<span 
class="aebxti-10">queue_msix_vector</span> </dt><dd 
class="description">
     <!--l. 373--><p class="noindent" >Set by the driver to the MSI-X vector for virtqueue notifications.
     </dd><dt class="description">
     <!--l. 376--><p class="noindent" >
<span 
class="aebxti-10">queue_enable</span> </dt><dd 
class="description">
     <!--l. 376--><p class="noindent" >The  driver  uses  this  to  selectively  prevent  the  device  from  executing
     requests from this virtqueue. 1 - enabled; 0 - disabled.
     </dd><dt class="description">
     <!--l. 380--><p class="noindent" >
<span 
class="aebxti-10">queue_notify_off</span> </dt><dd 
class="description">
     <!--l. 380--><p class="noindent" >The driver reads this to calculate the offset from start of Notification structure
     at which this virtqueue is located.
     <span 
class="aeb10-">Note:</span> this is <span 
class="aeti-10">not an offset in bytes. See </span><a 
href="#x1-1780004"><span 
class="aeti-10">4.1.4.4</span><!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Notification capability --></a> <span 
class="aeti-10">below.</span>
     </dd><dt class="description">
     <!--l. 387--><p class="noindent" >
<span 
class="aebxti-10">queue_desc</span> </dt><dd 
class="description">
                                                                  

                                                                  
     <!--l. 387--><p class="noindent" >The driver writes the physical address of Descriptor Area here. See section
     <a 
href="#x1-270006">2.6<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues --></a>.
     </dd><dt class="description">
     <!--l. 390--><p class="noindent" >
<span 
class="aebxti-10">queue_driver</span> </dt><dd 
class="description">
     <!--l. 390--><p class="noindent" >The driver writes the physical address of Driver Area here. See section
     <a 
href="#x1-270006">2.6<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues --></a>.
     </dd><dt class="description">
     <!--l. 393--><p class="noindent" >
<span 
class="aebxti-10">queue_device</span> </dt><dd 
class="description">
     <!--l. 393--><p class="noindent" >The driver writes the physical address of Device Area here. See section
     <a 
href="#x1-270006">2.6<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues --></a>.
     </dd><dt class="description">
     <!--l. 396--><p class="noindent" >
<span 
class="aebxti-10">queue_notif_config_data</span> </dt><dd 
class="description">
     <!--l. 396--><p class="noindent" >This field exists only if VIRTIO_F_NOTIF_CONFIG_DATA has been
     negotiated. The driver will use this value when driver sends available buffer
     notification to the device. See section <a 
href="#x1-2050002">4.1.5.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Available Buffer Notifications --></a>.
     <span 
class="aeb10-">Note:</span> This  field  provides  the  device  with  flexibility  to  determine  how
          virtqueues will be referred to in available buffer notifications. In
          a  trivial  case  the  device  can  set  <span 
class="aeti-10">queue_notif_config_data  </span>to  the
          virtqueue index. Some devices may benefit from providing another
          value, for example an internal virtqueue identifier, or an internal
          offset related to the virtqueue index.
     <span 
class="aeb10-">Note:</span> This field was previously known as queue_notify_data.
     </dd><dt class="description">
     <!--l. 413--><p class="noindent" >
<span 
class="aebxti-10">queue_reset</span> </dt><dd 
class="description">
     <!--l. 413--><p class="noindent" >The driver uses this to selectively reset the queue. This field exists only if
     VIRTIO_F_RING_RESET has been negotiated. (see <a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>).
     </dd><dt class="description">
     <!--l. 418--><p class="noindent" >
<span 
class="aebxti-10">admin_queue_index</span> </dt><dd 
class="description">
     <!--l. 418--><p class="noindent" >The device uses this to report the index of the first administration
     virtqueue. This field is valid only if VIRTIO_F_ADMIN_VQ has been
                                                                  

                                                                  
     negotiated.
     </dd><dt class="description">
     <!--l. 421--><p class="noindent" >
<span 
class="aebxti-10">admin_queue_num</span> </dt><dd 
class="description">
     <!--l. 421--><p class="noindent" >The device uses this to report the number of the supported administration
     virtqueues. Virtqueues with index between <span 
class="aeti-10">admin_queue_index </span>and
     (<span 
class="aeti-10">admin_queue_index </span>+ <span 
class="aeti-10">admin_queue_num </span>- 1) inclusive serve as administration
     virtqueues. The value 0 indicates no supported administration virtqueues. This
     field is valid only if VIRTIO_F_ADMIN_VQ has been negotiated.</dd></dl>
<a 
 id="x1-175028r139"></a>
<!--l. 433--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.3.1</span> <a 
 id="x1-1760001"></a>Device Requirements: Common configuration structure layout</h5>
<span 
class="aeti-10">offset </span>MUST be 4-byte aligned.
<!--l. 436--><p class="noindent" >The device MUST present at least one common configuration capability.
<!--l. 438--><p class="noindent" >The device MUST present the feature bits it is offering in <span 
class="aeti-10">device_feature</span>, starting at
bit <span 
class="aeti-10">device_feature_select </span><span 
class="cmsy-10">∗ </span>32 for any <span 
class="aeti-10">device_feature_select </span>written by the
driver.
<span 
class="aeb10-">Note:</span> This means that it will present 0 for any <span 
class="aeti-10">device_feature_select </span>other than
      0 or 1, since no feature defined here exceeds 63.
<!--l. 443--><p class="noindent" >The device MUST present any valid feature bits the driver has written in
<span 
class="aeti-10">driver_feature</span>, starting at bit <span 
class="aeti-10">driver_feature_select </span><span 
class="cmsy-10">∗ </span>32 for any <span 
class="aeti-10">driver_feature_select</span>
written by the driver. Valid feature bits are those which are subset of the
corresponding <span 
class="aeti-10">device_feature </span>bits. The device MAY present invalid bits written by the
driver.
<span 
class="aeb10-">Note:</span> This  means  that  a  device  can  ignore  writes  for  feature  bits  it  never
      offers, and simply present 0 on reads. Or it can just mirror what the
      driver wrote (but it will still have to check them when the driver sets
      FEATURES_OK).
<span 
class="aeb10-">Note:</span> A  driver  shouldn’t  write  invalid  bits  anyway,  as  per  <a 
href="#x1-1560001">3.1.1<!--tex4ht:ref: drivernormative:General Initialization And Device Operation / Device Initialization --></a>,  but  this
      attempts to handle it.
<!--l. 455--><p class="noindent" >The device MUST present a changed <span 
class="aeti-10">config_generation </span>after the driver has read a
device-specific configuration value which has changed since any part of the
device-specific configuration was last read.
<span 
class="aeb10-">Note:</span> As <span 
class="aeti-10">config_generation </span>is an 8-bit value, simply incrementing it on every
      configuration change could violate this requirement due to wrap. Better
                                                                  

                                                                  
      would be to set an internal flag when it has changed, and if that flag is set
      when the driver reads from the device-specific configuration, increment
      <span 
class="aeti-10">config_generation </span>and clear the flag.
<!--l. 467--><p class="noindent" >The device MUST reset when 0 is written to <span 
class="aeti-10">device_status</span>, and present a 0 in
<span 
class="aeti-10">device_status </span>once that is done.
<!--l. 470--><p class="noindent" >The device MUST present a 0 in <span 
class="aeti-10">queue_enable </span>on reset.
<!--l. 472--><p class="noindent" >If VIRTIO_F_RING_RESET has been negotiated, the device MUST present a 0 in
<span 
class="aeti-10">queue_reset </span>on reset.
<!--l. 475--><p class="noindent" >If VIRTIO_F_RING_RESET has been negotiated, the device MUST present a 0 in
<span 
class="aeti-10">queue_reset </span>after the virtqueue is enabled with <span 
class="aeti-10">queue_enable</span>.
<!--l. 478--><p class="noindent" >The device MUST reset the queue when 1 is written to <span 
class="aeti-10">queue_reset</span>. The device
MUST continue to present 1 in <span 
class="aeti-10">queue_reset </span>as long as the queue reset is ongoing. The
device MUST present 0 in both <span 
class="aeti-10">queue_reset </span>and <span 
class="aeti-10">queue_enable </span>when queue reset has
completed. (see <a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>).
<!--l. 484--><p class="noindent" >The device MUST present a 0 in <span 
class="aeti-10">queue_size </span>if the virtqueue corresponding to the
current <span 
class="aeti-10">queue_select </span>is unavailable.
<!--l. 487--><p class="noindent" >If VIRTIO_F_RING_PACKED has not been negotiated, the device MUST present
either a value of 0 or a power of 2 in <span 
class="aeti-10">queue_size</span>.
<!--l. 491--><p class="noindent" >If VIRTIO_F_ADMIN_VQ has been negotiated, the value <span 
class="aeti-10">admin_queue_index</span>
MUST be equal to, or bigger than <span 
class="aeti-10">num_queues</span>; also, <span 
class="aeti-10">admin_queue_num</span>
MUST be smaller than, or equal to 0x10000 - <span 
class="aeti-10">admin_queue_index</span>, to ensure
that indices of valid admin queues fit into a 16 bit range beyond all other
virtqueues.
<a 
 id="x1-176001r180"></a>
<!--l. 498--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.3.2</span> <a 
 id="x1-1770002"></a>Driver Requirements: Common configuration structure layout</h5>
The driver MUST NOT write to <span 
class="aeti-10">device_feature</span>, <span 
class="aeti-10">num_queues</span>, <span 
class="aeti-10">config_generation</span>,
<span 
class="aeti-10">queue_notify_off  </span>or <span 
class="aeti-10">queue_notif_config_data</span>.
<!--l. 504--><p class="noindent" >If VIRTIO_F_RING_PACKED has been negotiated, the driver MUST NOT
write the value 0 to <span 
class="aeti-10">queue_size</span>. If VIRTIO_F_RING_PACKED has not been
negotiated, the driver MUST NOT write a value which is not a power of 2 to
<span 
class="aeti-10">queue_size</span>.
<!--l. 509--><p class="noindent" >The driver MUST configure the other virtqueue fields before enabling the virtqueue
with <span 
class="aeti-10">queue_enable</span>.
<!--l. 512--><p class="noindent" >After writing 0 to <span 
class="aeti-10">device_status</span>, the driver MUST wait for a read of <span 
class="aeti-10">device_status </span>to
return 0 before reinitializing the device.
<!--l. 515--><p class="noindent" >The driver MUST NOT write a 0 to <span 
class="aeti-10">queue_enable</span>.
<!--l. 517--><p class="noindent" >If VIRTIO_F_RING_RESET has been negotiated, after the driver writes 1 to
<span 
class="aeti-10">queue_reset </span>to reset the queue, the driver MUST NOT consider queue reset to be
                                                                  

                                                                  
complete until it reads back 0 in <span 
class="aeti-10">queue_reset</span>. The driver MAY re-enable the queue by
writing 1 to <span 
class="aeti-10">queue_enable </span>after ensuring that other virtqueue fields have been set up
correctly. The driver MAY set driver-writeable queue configuration values
to different values than those that were used before the queue reset. (see
<a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>).
<!--l. 526--><p class="noindent" >If VIRTIO_F_ADMIN_VQ has been negotiated, and if the driver configures any
administration virtqueues, the driver MUST configure the administration virtqueues
using the index in the range <span 
class="aeti-10">admin_queue_index </span>to <span 
class="aeti-10">admin_queue_index </span>+
<span 
class="aeti-10">admin_queue_num </span>- 1 inclusive. The driver MAY configure fewer administration
virtqueues than supported by the device.
<a 
 id="x1-177001r179"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.4   </span> <a 
 id="x1-1780004"></a>Notification structure layout</h5>
<!--l. 536--><p class="noindent" >The notification location is found using the VIRTIO_PCI_CAP_NOTIFY_CFG
capability. This capability is immediately followed by an additional field, like
so:
<!--l. 540-->
<pre class="lstlisting" id="listing-58"><span class="label"><a 
 id="x1-178001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_notify_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-178002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-178003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notify_off_multiplier</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Multiplier</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notify_off</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-178004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 547--><p class="noindent" ><span 
class="aeti-10">notify_off_multiplier </span>is combined with the <span 
class="aeti-10">queue_notify_off  </span>to derive the Queue
Notify address within a BAR for a virtqueue:
<!--l. 550-->
<pre class="lstlisting" id="listing-59"><span class="label"><a 
 id="x1-178005r1"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notify_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notify_off_multiplier</span></span></pre>
<!--l. 554--><p class="noindent" >The <span 
class="aeti-10">cap.offset </span>and <span 
class="aeti-10">notify_off_multiplier </span>are taken from the notification capability
structure above, and the <span 
class="aeti-10">queue_notify_off </span>is taken from the common configuration
structure.
<span 
class="aeb10-">Note:</span> For example, if <span 
class="aeti-10">notifier_off_multiplier </span>is 0, the device uses the same Queue
      Notify address for all queues.
<a 
 id="x1-178006r181"></a>
<!--l. 563--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.4.1</span> <a 
 id="x1-1790001"></a>Device Requirements: Notification capability</h5>
The device MUST present at least one notification capability.
<!--l. 566--><p class="noindent" >For devices not offering VIRTIO_F_NOTIFICATION_DATA:
<!--l. 568--><p class="noindent" >The <span 
class="aeti-10">cap.offset </span>MUST be 2-byte aligned.
<!--l. 570--><p class="noindent" >The device MUST either present <span 
class="aeti-10">notify_off_multiplier </span>as an even power of 2, or
present <span 
class="aeti-10">notify_off_multiplier </span>as 0.
                                                                  

                                                                  
<!--l. 573--><p class="noindent" >The value <span 
class="aeti-10">cap.length </span>presented by the device MUST be at least 2 and MUST be large
enough to support queue notification offsets for all supported queues in all possible
configurations.
<!--l. 577--><p class="noindent" >For all queues, the value <span 
class="aeti-10">cap.length </span>presented by the device MUST satisfy:
<!--l. 578-->
<pre class="lstlisting" id="listing-60"><span class="label"><a 
 id="x1-179001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notify_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notify_off_multiplier</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<!--l. 582--><p class="noindent" >For devices offering VIRTIO_F_NOTIFICATION_DATA:
<!--l. 584--><p class="noindent" >The device MUST either present <span 
class="aeti-10">notify_off_multiplier </span>as a number that is
a power of 2 that is also a multiple 4, or present <span 
class="aeti-10">notify_off_multiplier </span>as
0.
<!--l. 588--><p class="noindent" >The <span 
class="aeti-10">cap.offset </span>MUST be 4-byte aligned.
<!--l. 590--><p class="noindent" >The value <span 
class="aeti-10">cap.length </span>presented by the device MUST be at least 4 and MUST be large
enough to support queue notification offsets for all supported queues in all possible
configurations.
<!--l. 594--><p class="noindent" >For all queues, the value <span 
class="aeti-10">cap.length </span>presented by the device MUST satisfy:
<!--l. 595-->
<pre class="lstlisting" id="listing-61"><span class="label"><a 
 id="x1-179002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue_notify_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notify_off_multiplier</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span></pre>
<a 
 id="x1-179003r182"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.5   </span> <a 
 id="x1-1800005"></a>ISR status capability</h5>
<!--l. 601--><p class="noindent" >The VIRTIO_PCI_CAP_ISR_CFG capability refers to at least a single byte,
which contains the 8-bit ISR status field to be used for INT#x interrupt
handling.
<!--l. 605--><p class="noindent" >The <span 
class="aeti-10">offset </span>for the <span 
class="aeti-10">ISR status </span>has no alignment requirements.
<!--l. 607--><p class="noindent" >The ISR bits allow the driver to distinguish between device-specific configuration
change interrupts and normal virtqueue interrupts:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Bits       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1                                         </td><td style="text-align: left; min-width: \@testpach 4 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 2 to 31    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Purpose  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Queue Interrupt  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device Configuration Interrupt  </td><td style="text-align: left; min-width: \@testpach 4 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
</div>
<!--l. 618--><p class="noindent" >To avoid an extra access, simply reading this register resets it to 0 and causes the
device to de-assert the interrupt.
<!--l. 621--><p class="noindent" >In this way, driver read of ISR status causes the device to de-assert an interrupt.
<!--l. 624--><p class="noindent" >See sections <a 
href="#x1-2070003">4.1.5.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Used Buffer Notifications --></a> and <a 
href="#x1-2090004">4.1.5.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Notification of Device Configuration Changes --></a> for how this is used.
<a 
 id="x1-180001r183"></a>
<!--l. 626--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.5.1</span> <a 
 id="x1-1810001"></a>Device Requirements: ISR status capability</h5>
The device MUST present at least one VIRTIO_PCI_CAP_ISR_CFG capability.
                                                                  

                                                                  
<!--l. 630--><p class="noindent" >The device MUST set the Device Configuration Interrupt bit in <span 
class="aeti-10">ISR status </span>before
sending a device configuration change notification to the driver.
<!--l. 634--><p class="noindent" >If MSI-X capability is disabled, the device MUST set the Queue Interrupt bit in <span 
class="aeti-10">ISR</span>
<span 
class="aeti-10">status </span>before sending a virtqueue notification to the driver.
<!--l. 638--><p class="noindent" >If MSI-X capability is disabled, the device MUST set the Interrupt Status bit
in the PCI Status register in the PCI Configuration Header of the device
to the logical OR of all bits in <span 
class="aeti-10">ISR status </span>of the device. The device then
asserts/deasserts INT#x interrupts unless masked according to standard PCI rules
<a 
href="#x1-3006x5">[PCI]</a>.
<!--l. 644--><p class="noindent" >The device MUST reset <span 
class="aeti-10">ISR status </span>to 0 on driver read.
<a 
 id="x1-181001r185"></a>
<!--l. 646--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.5.2</span> <a 
 id="x1-1820002"></a>Driver Requirements: ISR status capability</h5>
If MSI-X capability is enabled, the driver SHOULD NOT access <span 
class="aeti-10">ISR status </span>upon
detecting a Queue Interrupt.
<a 
 id="x1-182001r184"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.6   </span> <a 
 id="x1-1830006"></a>Device-specific configuration</h5>
<!--l. 653--><p class="noindent" >The device MUST present at least one VIRTIO_PCI_CAP_DEVICE_CFG capability
for any device type which has a device-specific configuration.
<a 
 id="x1-183001r186"></a>
<!--l. 656--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.6.1</span> <a 
 id="x1-1840001"></a>Device Requirements: Device-specific configuration</h5>
The <span 
class="aeti-10">offset </span>for the device-specific configuration MUST be 4-byte aligned.
<a 
 id="x1-184001r187"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.7   </span> <a 
 id="x1-1850007"></a>Shared memory capability</h5>
<!--l. 662--><p class="noindent" >Shared memory regions <a 
href="#x1-10200010">2.10<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Shared Memory Regions --></a> are enumerated on the PCI transport as a sequence of
VIRTIO_PCI_CAP_SHARED_MEMORY_CFG capabilities, one per region.
<!--l. 666--><p class="noindent" >The capability is defined by a struct virtio_pci_cap64 and utilises the <span 
class="aeti-10">cap.id </span>to allow
multiple shared memory regions per device. The identifier in <span 
class="aeti-10">cap.id </span>does not
denote a certain order of preference; it is only used to uniquely identify a
region.
<a 
 id="x1-185001r188"></a>
<!--l. 672--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.7.1</span> <a 
 id="x1-1860001"></a>Device Requirements: Shared memory capability</h5>
The region defined by the combination of the <span 
class="aeti-10">cap.offset</span>, <span 
class="aeti-10">offset_hi</span>, and <span 
class="aeti-10">cap.length</span>,
<span 
class="aeti-10">length_hi </span>fields MUST be contained within the BAR specified by <span 
class="aeti-10">cap.bar</span>.
<!--l. 679--><p class="noindent" >The <span 
class="aeti-10">cap.id </span>MUST be unique for any one device instance.
<a 
 id="x1-186001r189"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.8   </span> <a 
 id="x1-1870008"></a>Vendor data capability</h5>
<!--l. 685--><p class="noindent" >The optional Vendor data capability allows the device to present vendor-specific data
to the driver, without conflicts, for debugging and/or reporting purposes, and
without conflicting with standard functionality.
<!--l. 690--><p class="noindent" >This capability augments but does not replace the standard subsystem ID and
subsystem vendor ID fields (offsets 0x2C and 0x2E in the PCI configuration space
header) as specified by <a 
href="#x1-3006x5">[PCI]</a>.
<!--l. 695--><p class="noindent" >Vendor data capability is enumerated on the PCI transport as a
VIRTIO_PCI_CAP_VENDOR_CFG capability.
<!--l. 698--><p class="noindent" >The capability has the following structure: <!--l. 699-->
<pre class="lstlisting" id="listing-62"><span class="label"><a 
 id="x1-187001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_vndr_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_vndr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Generic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI_CAP_ID_VNDR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_next</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Generic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ptr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Generic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capability</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cfg_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Identifies</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">structure</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vendor_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Identifies</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vendor</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">format</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vendor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Definition</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Pads</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">structure</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">multiple</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Reads</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">must</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">not</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">have</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">side</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">effects</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-187010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 712--><p class="noindent" >Where <span 
class="aeti-10">vendor_id </span>identifies the PCI-SIG assigned Vendor ID as specified by
<a 
href="#x1-3006x5">[PCI]</a>.
<!--l. 715--><p class="noindent" >Note that the capability size is required to be a multiple of 4.
<!--l. 717--><p class="noindent" >To make it safe for a generic driver to access the capability, reads from this capability
MUST NOT have any side effects.
<a 
 id="x1-187011r190"></a>
<!--l. 722--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.8.1</span> <a 
 id="x1-1880001"></a>Device Requirements: Vendor data capability</h5>
Devices CAN present <span 
class="aeti-10">vendor_id </span>that does not match either the PCI Vendor ID or the
PCI Subsystem Vendor ID.
<!--l. 727--><p class="noindent" >Devices CAN present multiple Vendor data capabilities with either different or
identical <span 
class="aeti-10">vendor_id </span>values.
<!--l. 730--><p class="noindent" >The value <span 
class="aeti-10">vendor_id </span>MUST NOT equal 0x1AF4.
<!--l. 732--><p class="noindent" >The size of the Vendor data capability MUST be a multiple of 4 bytes.
<!--l. 734--><p class="noindent" >Reads of the Vendor data capability by the driver MUST NOT have any side
effects.
<a 
 id="x1-188001r192"></a>
<!--l. 739--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.8.2</span> <a 
 id="x1-1890002"></a>Driver Requirements: Vendor data capability</h5>
The driver SHOULD NOT use the Vendor data capability except for debugging and
reporting purposes.
<!--l. 744--><p class="noindent" >The driver MUST qualify the <span 
class="aeti-10">vendor_id </span>before interpreting or writing into the
Vendor data capability.
<a 
 id="x1-189001r191"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.9   </span> <a 
 id="x1-1900009"></a>PCI configuration access capability</h5>
<!--l. 749--><p class="noindent" >The VIRTIO_PCI_CAP_PCI_CFG capability creates an alternative (and likely
suboptimal) access method to the common configuration, notification, ISR and
device-specific configuration regions.
<!--l. 753--><p class="noindent" >The capability is immediately followed by an additional field like so:
<!--l. 755-->
<pre class="lstlisting" id="listing-63"><span class="label"><a 
 id="x1-190001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_cfg_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-190002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pci_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-190003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pci_cfg_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BAR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">access</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-190004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 762--><p class="noindent" >The fields <span 
class="aeti-10">cap.bar</span>, <span 
class="aeti-10">cap.length</span>, <span 
class="aeti-10">cap.offset </span>and <span 
class="aeti-10">pci_cfg_data </span>are read-write (RW) for the
driver.
<!--l. 765--><p class="noindent" >To access a device region, the driver writes into the capability structure (ie. within
the PCI configuration space) as follows:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 769--><p class="noindent" >The driver sets the BAR to access by writing to <span 
class="aeti-10">cap.bar</span>.
     </li>
     <li class="itemize">
     <!--l. 771--><p class="noindent" >The driver sets the size of the access by writing 1, 2 or 4 to <span 
class="aeti-10">cap.length</span>.
     </li>
     <li class="itemize">
     <!--l. 774--><p class="noindent" >The driver sets the offset within the BAR by writing to <span 
class="aeti-10">cap.offset</span>.</li></ul>
<!--l. 778--><p class="noindent" >At that point, <span 
class="aeti-10">pci_cfg_data </span>will provide a window of size <span 
class="aeti-10">cap.length </span>into the given
<span 
class="aeti-10">cap.bar </span>at offset <span 
class="aeti-10">cap.offset</span>.
<a 
 id="x1-190005r193"></a>
<!--l. 781--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.9.1</span> <a 
 id="x1-1910001"></a>Device Requirements: PCI configuration access capability</h5>
The device MUST present at least one VIRTIO_PCI_CAP_PCI_CFG capability.
<!--l. 785--><p class="noindent" >Upon detecting driver write access to <span 
class="aeti-10">pci_cfg_data</span>, the device MUST execute a write
access at offset <span 
class="aeti-10">cap.offset </span>at BAR selected by <span 
class="aeti-10">cap.bar </span>using the first <span 
class="aeti-10">cap.length </span>bytes
from <span 
class="aeti-10">pci_cfg_data</span>.
<!--l. 790--><p class="noindent" >Upon detecting driver read access to <span 
class="aeti-10">pci_cfg_data</span>, the device MUST execute a read
access of length cap.length at offset <span 
class="aeti-10">cap.offset </span>at BAR selected by <span 
class="aeti-10">cap.bar </span>and store
the first <span 
class="aeti-10">cap.length </span>bytes in <span 
class="aeti-10">pci_cfg_data</span>.
<a 
 id="x1-191001r195"></a>
<!--l. 796--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.4.9.2</span> <a 
 id="x1-1920002"></a>Driver Requirements: PCI configuration access capability</h5>
The driver MUST NOT write a <span 
class="aeti-10">cap.offset </span>which is not a multiple of <span 
class="aeti-10">cap.length </span>(ie. all
                                                                  

                                                                  
accesses MUST be aligned).
<!--l. 801--><p class="noindent" >The driver MUST NOT read or write <span 
class="aeti-10">pci_cfg_data </span>unless <span 
class="aeti-10">cap.bar</span>, <span 
class="aeti-10">cap.length </span>and
<span 
class="aeti-10">cap.offset </span>address <span 
class="aeti-10">cap.length </span>bytes within a BAR range specified by some other
Virtio Structure PCI Capability of type other than <span 
class="aeti-10">VIRTIO_PCI_CAP_PCI_CFG</span>.
<a 
 id="x1-192001r194"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.10   </span> <a 
 id="x1-19300010"></a>Legacy Interfaces: A Note on PCI Device Layout</h5>
<!--l. 809--><p class="noindent" >Transitional devices MUST present part of configuration registers in a legacy
configuration structure in BAR0 in the first I/O region of the PCI device, as
documented below. When using the legacy interface, transitional drivers MUST use
the legacy configuration structure in BAR0 in the first I/O region of the PCI device,
as documented below.
<!--l. 816--><p class="noindent" >When using the legacy interface the driver MAY access the device-specific
configuration region using any width accesses, and a transitional device MUST
present driver with the same results as when accessed using the “natural” access
method (i.e. 32-bit accesses for 32-bit fields, etc).
<!--l. 822--><p class="noindent" >Note that this is possible because while the virtio common configuration structure is
PCI (i.e. little) endian, when using the legacy interface the device-specific
configuration region is encoded in the native endian of the guest (where such
distinction is applicable).
<!--l. 827--><p class="noindent" >When used through the legacy interface, the virtio common configuration structure
looks as follows:
<!--l. 839--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Bits   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 32    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 32    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 32    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 8     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 8     </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Read
 /
 Write  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R+W </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R+W </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R+W </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R+W </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R+W </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Purpose</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device
 Features
 bits
 0:31   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Driver
 Features
 bits
 0:31   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Queue
 Address</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">queue_size</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ><span 
class="aeti-10">queue_select</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Queue
 Notify </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device
 Status </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > ISR <br 
class="newline" />Status </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >       </td>
</tr></table>
<!--l. 841--><p class="noindent" >If MSI-X is enabled for the device, two additional fields immediately follow this
header:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Bits                   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16                       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 16                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Read/Write         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R+W                  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > R+W                  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Purpose (MSI-X)  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">config_msix_vector  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">queue_msix_vector  </span></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 854--><p class="noindent" >Note: When MSI-X capability is enabled, device-specific configuration starts at byte
offset 24 in virtio common configuration structure. When MSI-X capability is not
enabled, device-specific configuration starts at byte offset 20 in virtio header. ie. once
you enable MSI-X on the device, the other fields move. If you turn it off again, they
move back!
<!--l. 860--><p class="noindent" >Any device-specific configuration space immediately follows these general
                                                                  

                                                                  
headers:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Bits              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device Specific  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <div class="multirow"><!-- rows=13 -->
…</div>  </td></tr><tr class="row-2"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >
</td></tr><tr 
class="cline"><td><hr></td><td><hr></td><td></td></tr><tr class="row-3"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Read / Write  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device Specific  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >   </td></tr><tr class="row-4"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >
</td></tr><tr 
class="cline"><td><hr></td><td><hr></td><td></td></tr><tr class="row-5"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Purpose         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Device Specific  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 873--><p class="noindent" >When accessing the device-specific configuration space using the legacy interface,
transitional drivers MUST access the device-specific configuration space at an offset
immediately following the general headers.
<!--l. 878--><p class="noindent" >When using the legacy interface, transitional devices MUST present the
device-specific configuration space if any at an offset immediately following the
general headers.
<!--l. 882--><p class="noindent" >Note that only Feature Bits 0 to 31 are accessible through the Legacy Interface.
When used through the Legacy Interface, Transitional Devices MUST assume that
Feature Bits 32 to 63 are not acknowledged by Driver.
<!--l. 887--><p class="noindent" >As legacy devices had no <span 
class="aeti-10">config_generation </span>field, see <a 
href="#x1-260004">2.5.4<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Configuration Space / Legacy Interface: Device Configuration Space --></a> <a 
href="#x1-260004">Legacy Interface: Device
Configuration Space<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Configuration Space / Legacy Interface: Device Configuration Space --></a> for workarounds.
<a 
 id="x1-193001r197"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.4.11   </span> <a 
 id="x1-19400011"></a>Non-transitional Device With Legacy Driver: A Note on PCI Device
Layout</h5>
<!--l. 897--><p class="noindent" >All known legacy drivers check either the PCI Revision or the Device and Vendor
IDs, and thus won’t attempt to drive a non-transitional device.
<!--l. 901--><p class="noindent" >A buggy legacy driver might mistakenly attempt to drive a non-transitional device. If
support for such drivers is required (as opposed to fixing the bug), the following
would be the recommended way to detect and handle them.
<span 
class="aeb10-">Note:</span> Such buggy drivers are not currently known to be used in production.
<a 
 id="x1-194001r142"></a>
<!--l. 910--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">4.1.4.11.0.1</span> <a 
 id="x1-1950001"></a>Device Requirements: Non-transitional Device With Legacy Driver</h6>
Non-transitional devices, on a platform where a legacy driver for a legacy device with
the same ID (including PCI Revision, Device and Vendor IDs) is known to have
previously existed, SHOULD take the following steps to cause the legacy driver to fail
gracefully when it attempts to drive them:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Present an I/O BAR in BAR0, and
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Respond to a single-byte zero write to offset 18 (corresponding to Device
     Status register in the legacy layout) of BAR0 by presenting zeroes on every
     BAR and ignoring writes.</dd></dl>
<a 
 id="x1-195003r176"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">4.1.5   </span> <a 
 id="x1-1960005"></a>PCI-specific Initialization And Device Operation</h4>
<a 
 id="x1-196001r198"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.5.1   </span> <a 
 id="x1-1970001"></a>Device Initialization</h5>
<!--l. 937--><p class="noindent" >This documents PCI-specific steps executed during Device Initialization.
<a 
 id="x1-197001r196"></a>
<!--l. 939--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.5.1.1</span> <a 
 id="x1-1980001"></a>Virtio Device Configuration Layout Detection</h5>
As a prerequisite to device initialization, the driver scans the PCI capability list,
detecting virtio configuration layout using Virtio Structure PCI capabilities as
detailed in <a 
href="#x1-1720004">4.1.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / Virtio Structure PCI Capabilities --></a>
<a 
 id="x1-198001r199"></a>
<!--l. 945--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">4.1.5.1.1.1</span> <a 
 id="x1-1990001"></a>Legacy Interface: A Note on Device Layout Detection</h6>
Legacy drivers skipped the Device Layout Detection step, assuming legacy device
configuration space in BAR0 in I/O space unconditionally.
<!--l. 950--><p class="noindent" >Legacy devices did not have the Virtio PCI Capability in their capability
list.
<!--l. 953--><p class="noindent" >Therefore:
<!--l. 955--><p class="noindent" >Transitional devices MUST expose the Legacy Interface in I/O space in
BAR0.
<!--l. 958--><p class="noindent" >Transitional drivers MUST look for the Virtio PCI Capabilities on the capability list.
If these are not present, driver MUST assume a legacy device, and use it through the
legacy interface.
<!--l. 963--><p class="noindent" >Non-transitional drivers MUST look for the Virtio PCI Capabilities on the capability
list. If these are not present, driver MUST assume a legacy device, and fail
gracefully.
<a 
 id="x1-199001r202"></a>
<!--l. 968--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.5.1.2</span> <a 
 id="x1-2000002"></a>MSI-X Vector Configuration</h5>
When MSI-X capability is present and enabled in the device (through standard PCI
configuration space) <span 
class="aeti-10">config_msix_vector </span>and <span 
class="aeti-10">queue_msix_vector </span>are used to map
configuration change and queue interrupts to MSI-X vectors. In this case, the ISR
Status is unused.
<!--l. 974--><p class="noindent" >Writing a valid MSI-X Table entry number, 0 to 0x7FF, to <span 
class="aeti-10">config_msix_vector</span>/<span 
class="aeti-10">queue_msix_vector</span>
maps interrupts triggered by the configuration change/selected queue events
respectively to the corresponding MSI-X vector. To disable interrupts for an
event type, the driver unmaps this event by writing a special NO_VECTOR
value:
<!--l. 981-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-64"><span class="label"><a 
 id="x1-200001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">disable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">MSI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-200002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MSI_NO_VECTOR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">xffff</span></span></pre>
<!--l. 986--><p class="noindent" >Note that mapping an event to vector might require device to allocate internal device
resources, and thus could fail.
<a 
 id="x1-200003r203"></a>
<!--l. 989--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">4.1.5.1.2.1</span> <a 
 id="x1-2010001"></a>Device Requirements: MSI-X Vector Configuration</h6>
A device that has an MSI-X capability SHOULD support at least 2 and at most
0x800 MSI-X vectors. Device MUST report the number of vectors supported in <span 
class="aeti-10">Table</span>
<span 
class="aeti-10">Size </span>in the MSI-X Capability as specified in <a 
href="#x1-3006x5">[PCI]</a>. The device SHOULD restrict
the reported MSI-X Table Size field to a value that might benefit system
performance.
<span 
class="aeb10-">Note:</span> For example, a device which does not expect to send interrupts at a high
      rate might only specify 2 MSI-X vectors.
<!--l. 1002--><p class="noindent" >Device MUST support mapping any event type to any valid vector 0 to MSI-X <span 
class="aeti-10">Table</span>
<span 
class="aeti-10">Size</span>. Device MUST support unmapping any event type.
<!--l. 1006--><p class="noindent" >The device MUST return vector mapped to a given event, (NO_VECTOR if
unmapped) on read of <span 
class="aeti-10">config_msix_vector</span>/<span 
class="aeti-10">queue_msix_vector</span>. The device
MUST have all queue and configuration change events are unmapped upon
reset.
<!--l. 1011--><p class="noindent" >Devices SHOULD NOT cause mapping an event to vector to fail unless it is
impossible for the device to satisfy the mapping request. Devices MUST report
mapping failures by returning the NO_VECTOR value when the relevant
<span 
class="aeti-10">config_msix_vector</span>/<span 
class="aeti-10">queue_msix_vector </span>field is read.
<a 
 id="x1-201001r205"></a>
<!--l. 1017--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">4.1.5.1.2.2</span> <a 
 id="x1-2020002"></a>Driver Requirements: MSI-X Vector Configuration</h6>
Driver MUST support device with any MSI-X Table Size 0 to 0x7FF. Driver MAY
fall back on using INT#x interrupts for a device which only supports one MSI-X
vector (MSI-X Table Size = 0).
<!--l. 1023--><p class="noindent" >Driver MAY interpret the Table Size as a hint from the device for the suggested
number of MSI-X vectors to use.
<!--l. 1026--><p class="noindent" >Driver MUST NOT attempt to map an event to a vector outside the MSI-X Table
supported by the device, as reported by <span 
class="aeti-10">Table Size </span>in the MSI-X Capability.
<!--l. 1030--><p class="noindent" >After mapping an event to vector, the driver MUST verify success by reading the
Vector field value: on success, the previously written value is returned, and on
failure, NO_VECTOR is returned. If a mapping failure is detected, the driver
MAY retry mapping with fewer vectors, disable MSI-X or report device
failure.
                                                                  

                                                                  
<a 
 id="x1-202001r204"></a>
<!--l. 1037--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.5.1.3</span> <a 
 id="x1-2030003"></a>Virtqueue Configuration</h5>
As a device can have zero or more virtqueues for bulk data
transport<span class="footnote-mark"><a 
href="#fn8x4" id="fn8x4-bk"><sup class="textsuperscript">8</sup></a></span><a 
 id="x1-203001f8"></a>,
the driver needs to configure them as part of the device-specific configuration.
<!--l. 1044--><p class="noindent" >The driver typically does this as follows, for each virtqueue a device has:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Write the virtqueue index to <span 
class="aeti-10">queue_select</span>.
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Read  the  virtqueue  size  from  <span 
class="aeti-10">queue_size</span>.  This  controls  how  big  the
     virtqueue is (see <a 
href="#x1-270006">2.6<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues --></a> <a 
href="#x1-270006">Virtqueues<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues --></a>). If this field is 0, the virtqueue does not
     exist.
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Optionally, select a smaller virtqueue size and write it to <span 
class="aeti-10">queue_size</span>.
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Allocate  and  zero  Descriptor  Table,  Available  and  Used  rings  for  the
     virtqueue in contiguous physical memory.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">Optionally,  if  MSI-X  capability  is  present  and  enabled  on  the  device,
     select a vector to use to request interrupts triggered by virtqueue events.
     Write the MSI-X Table entry number corresponding to this vector into
     <span 
class="aeti-10">queue_msix_vector</span>. Read <span 
class="aeti-10">queue_msix_vector</span>: on success, previously written
     value is returned; on failure, NO_VECTOR value is returned.</dd></dl>
<a 
 id="x1-203007r206"></a>
<!--l. 1065--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">4.1.5.1.3.1</span> <a 
 id="x1-2040001"></a>Legacy Interface: A Note on Virtqueue Configuration</h6>
When using the legacy interface, the queue layout follows <a 
href="#x1-370002">2.7.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Layout --></a> <a 
href="#x1-370002">Legacy
Interfaces: A Note on Virtqueue Layout<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Layout --></a> with an alignment of 4096. Driver
writes the physical address, divided by 4096 to the Queue Address
field<span class="footnote-mark"><a 
href="#fn9x4" id="fn9x4-bk"><sup class="textsuperscript">9</sup></a></span><a 
 id="x1-204001f9"></a>.
There was no mechanism to negotiate the queue size.
<a 
 id="x1-204002r201"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.5.2   </span> <a 
 id="x1-2050002"></a>Available Buffer Notifications</h5>
<!--l. 1075--><p class="noindent" >When VIRTIO_F_NOTIFICATION_DATA has not been negotiated, the driver sends
an available buffer notification to the device by writing only the 16-bit notification
value to the Queue Notify address of the virtqueue. A notification value depends on
the negotiation of VIRTIO_F_NOTIF_CONFIG_DATA.
<!--l. 1081--><p class="noindent" >If VIRTIO_F_NOTIFICATION_DATA has been negotiated, the driver sends an
available buffer notification to the device by writing the following 32-bit value to the
                                                                  

                                                                  
Queue Notify address: <!--l. 1084--><pre class="lstinputlisting">
<a 
 id="x1-205001"></a>
<span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205003r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205004r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_NOTIF_CONFIG_DATA</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">not</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205005r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_notif_config_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_NOTIF_CONFIG_DATA</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205006r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205007r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205008r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_wrap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-205009r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span>
</pre>
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1087--><p class="noindent" >When VIRTIO_F_NOTIF_CONFIG_DATA is not negotiated <span 
class="aeti-10">vq_index </span>is
     set to the virtqueue index.
     </li>
     <li class="itemize">
     <!--l. 1090--><p class="noindent" >When
     VIRTIO_F_NOTIFICATION_DATA is negotiated, <span 
class="aeti-10">vq_notif_config_data </span>is
     set to <span 
class="aeti-10">queue_notif_config_data</span>.</li></ul>
<!--l. 1094--><p class="noindent" >See <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> <a 
href="#x1-1010009">Driver Notifications<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> for the definition of the components.
<!--l. 1097--><p class="noindent" >See <a 
href="#x1-1780004">4.1.4.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Notification capability --></a> for how to calculate the Queue Notify address.
<a 
 id="x1-205010r207"></a>
<!--l. 1100--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.5.2.1</span> <a 
 id="x1-2060001"></a>Driver Requirements: Available Buffer Notifications</h5>
If VIRTIO_F_NOTIFICATION_DATA is not negotiated, the driver notification
MUST be a 16-bit notification.
<!--l. 1105--><p class="noindent" >If VIRTIO_F_NOTIFICATION_DATA is negotiated, the driver notification MUST be
a 32-bit notification.
<!--l. 1108--><p class="noindent" >If VIRTIO_F_NOTIF_CONFIG_DATA is not negotiated:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1110--><p class="noindent" >If VIRTIO_F_NOTIFICATION_DATA is not negotiated, the driver MUST
     set the notification value to the virtqueue index.
     </li>
     <li class="itemize">
     <!--l. 1113--><p class="noindent" >If VIRTIO_F_NOTIFICATION_DATA is negotiated, the driver MUST set
     the <span 
class="aeti-10">vq_index </span>to the virtqueue index.
     </li></ul>
<!--l. 1118--><p class="noindent" >If VIRTIO_F_NOTIF_CONFIG_DATA is negotiated:
     <ul class="itemize1">
     <li class="itemize">
                                                                  

                                                                  
     <!--l. 1120--><p class="noindent" >If VIRTIO_F_NOTIFICATION_DATA is not negotiated, the driver MUST
     set the notification value to <span 
class="aeti-10">queue_notif_config_data</span>.
     </li>
     <li class="itemize">
     <!--l. 1123--><p class="noindent" >If VIRTIO_F_NOTIFICATION_DATA is negotiated, the driver MUST set
     the <span 
class="aeti-10">vq_notify_config_data </span>to the <span 
class="aeti-10">queue_notif_config_data </span>value.</li></ul>
<a 
 id="x1-206001r209"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.5.3   </span> <a 
 id="x1-2070003"></a>Used Buffer Notifications</h5>
<!--l. 1129--><p class="noindent" >If a used buffer notification is necessary for a virtqueue, the device would typically
act as follows:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1132--><p class="noindent" >If MSI-X capability is disabled:
         <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
       1. </dt><dd 
class="enumerate-enumitem">Set the lower bit of the ISR Status field for the device.
         </dd><dt class="enumerate-enumitem">
       2. </dt><dd 
class="enumerate-enumitem">Send the appropriate PCI interrupt for the device.</dd></dl>
     </li>
     <li class="itemize">
     <!--l. 1139--><p class="noindent" >If MSI-X capability is enabled:
         <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
       1. </dt><dd 
class="enumerate-enumitem">If <span 
class="aeti-10">queue_msix_vector </span>is not NO_VECTOR, request the appropriate
         MSI-X interrupt message for the device, <span 
class="aeti-10">queue_msix_vector </span>sets the
         MSI-X Table entry number.</dd></dl>
     </li></ul>
<a 
 id="x1-207004r211"></a>
<!--l. 1148--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.5.3.1</span> <a 
 id="x1-2080001"></a>Device Requirements: Used Buffer Notifications</h5>
If MSI-X capability is enabled and <span 
class="aeti-10">queue_msix_vector </span>is NO_VECTOR for a
virtqueue, the device MUST NOT deliver an interrupt for that virtqueue.
<a 
 id="x1-208001r212"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.5.4   </span> <a 
 id="x1-2090004"></a>Notification of Device Configuration Changes</h5>
<!--l. 1156--><p class="noindent" >Some virtio PCI devices can change the device configuration state, as reflected in the
device-specific configuration region of the device. In this case:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1160--><p class="noindent" >If MSI-X capability is disabled:
                                                                  

                                                                  
         <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
       1. </dt><dd 
class="enumerate-enumitem">Set the second lower bit of the ISR Status field for the device.
         </dd><dt class="enumerate-enumitem">
       2. </dt><dd 
class="enumerate-enumitem">Send the appropriate PCI interrupt for the device.</dd></dl>
     </li>
     <li class="itemize">
     <!--l. 1167--><p class="noindent" >If MSI-X capability is enabled:
         <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
       1. </dt><dd 
class="enumerate-enumitem">If <span 
class="aeti-10">config_msix_vector </span>is not NO_VECTOR, request the appropriate
         MSI-X interrupt message for the device, <span 
class="aeti-10">config_msix_vector </span>sets the
         MSI-X Table entry number.</dd></dl>
     </li></ul>
<!--l. 1176--><p class="noindent" >A single interrupt MAY indicate both that one or more virtqueue has been used and
that the configuration space has changed.
<a 
 id="x1-209004r213"></a>
<!--l. 1179--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.5.4.1</span> <a 
 id="x1-2100001"></a>Device Requirements: Notification of Device Configuration Changes</h5>
If MSI-X capability is enabled and <span 
class="aeti-10">config_msix_vector </span>is NO_VECTOR,
the device MUST NOT deliver an interrupt for device configuration space
changes.
<a 
 id="x1-210001r215"></a>
<!--l. 1185--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">4.1.5.4.2</span> <a 
 id="x1-2110002"></a>Driver Requirements: Notification of Device Configuration Changes</h5>
A driver MUST handle the case where the same interrupt is used to indicate
both device configuration space change and one or more virtqueues being
used.
<a 
 id="x1-211001r214"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.1.5.5   </span> <a 
 id="x1-2120005"></a>Driver Handling Interrupts</h5>
<!--l. 1191--><p class="noindent" >The driver interrupt handler would typically:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 1194--><p class="noindent" >If MSI-X capability is disabled:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 1196--><p class="noindent" >Read the ISR Status field, which will reset it to zero.
         </li>
         <li class="itemize">
                                                                  

                                                                  
         <!--l. 1197--><p class="noindent" >If the lower bit is set: look through all virtqueues for the device, to see
         if any progress has been made by the device which requires servicing.
         </li>
         <li class="itemize">
         <!--l. 1201--><p class="noindent" >If the second lower bit is set: re-examine the configuration space to
         see what changed.</li></ul>
     </li>
     <li class="itemize">
     <!--l. 1204--><p class="noindent" >If MSI-X capability is enabled:
         <ul class="itemize2">
         <li class="itemize">
         <!--l. 1207--><p class="noindent" >Look through all virtqueues mapped to that MSI-X vector for the
         device, to see if any progress has been made by the device which
         requires servicing.
         </li>
         <li class="itemize">
         <!--l. 1211--><p class="noindent" >If the MSI-X vector is equal to <span 
class="aeti-10">config_msix_vector</span>, re-examine the
         configuration space to see what changed.</li></ul>
     </li></ul>
<a 
 id="x1-212001r167"></a>
<h3 class="sectionHead"><span class="titlemark">4.2   </span> <a 
 id="x1-2130002"></a>Virtio Over MMIO</h3>
<!--l. 3--><p class="noindent" >Virtual environments without PCI support (a common situation in embedded devices
models) might use simple memory mapped device (“virtio-mmio”) instead of the PCI
device.
<!--l. 7--><p class="noindent" >The memory mapped virtio device behaviour is based on the PCI device
specification. Therefore most operations including device initialization, queues
configuration and buffer transfers are nearly identical. Existing differences are
described in the following sections.
<a 
 id="x1-213001r200"></a>
<h4 class="subsectionHead"><span class="titlemark">4.2.1   </span> <a 
 id="x1-2140001"></a>MMIO Device Discovery</h4>
<!--l. 15--><p class="noindent" >Unlike PCI, MMIO provides no generic device discovery mechanism. For each device,
the guest OS will need to know the location of the registers and interrupt(s) used.
The suggested binding for systems using flattened device trees is shown in this
example:
<!--l. 20-->
<pre class="lstlisting" id="listing-65"><span class="label"><a 
 id="x1-214001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">EXAMPLE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">taking</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">512</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">at</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1e000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">interrupt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">42.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-214002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_block@1e000</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-214003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">compatible</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">"</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mmio</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">";</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-214004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reg</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1e000</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x200</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-214005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">interrupts</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;42&gt;;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-214006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
                                                                  

                                                                  
<a 
 id="x1-214007r219"></a>
<h4 class="subsectionHead"><span class="titlemark">4.2.2   </span> <a 
 id="x1-2150002"></a>MMIO Device Register Layout</h4>
<!--l. 31--><p class="noindent" >MMIO virtio devices provide a set of memory mapped control registers followed by a
device-specific configuration space, described in the table <a 
href="#x1-215001r1">4.1<!--tex4ht:ref: tab:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a>.
<!--l. 35--><p class="noindent" >All register values are organized as Little Endian.
<a 
 id="x1-215001r1"></a>
<!--l. 46--><div class="longtable"> <table id="TBL-36" class="longtable" 
 
><colgroup id="TBL-36-1g"><col 
id="TBL-36-1"><col 
id="TBL-36-2"></colgroup>
                                                                  

                                                                  
<tr  
 style="vertical-align:baseline;" id="TBL-36-1-"><td colspan="2" style="white-space:normal; text-align:left;" id="TBL-36-1-1"  
class="td11">    <div class="multicolumn"  style="white-space:nowrap; text-align:center;"> <div class="caption" 
><span class="id">Table 4.1: </span><span  
class="content">MMIO Device Register Layout</span></div><!--tex4ht:label?: x1-215001r1 -->                               </div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-2-"><td  style="white-space:normal; text-align:left;" id="TBL-36-2-1"  
class="td11">
 <!--l. 50--><p class="noindent" ><span 
class="aeti-10">Name </span><br 
class="newline" />Offset       from
  base <br 
class="newline" />Direction          </td><td  style="white-space:normal; text-align:left;" id="TBL-36-2-2"  
class="td11">
 <!--l. 50--><p class="noindent" ><span 
class="aeb10-">Function </span><br 
class="newline" />Description                                                           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-3-"><td  style="white-space:normal; text-align:left;" id="TBL-36-3-1"  
class="td11">
 <!--l. 53--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-36-4-"><td  style="white-space:normal; text-align:left;" id="TBL-36-4-1"  
class="td11">               </td><td  style="white-space:normal; text-align:left;" id="TBL-36-4-2"  
class="td11">
</td></tr>
<tr  
 style="vertical-align:baseline;" id="TBL-36-12-"><td  style="white-space:normal; text-align:left;" id="TBL-36-12-1"  
class="td11">
 <!--l. 64--><p class="noindent" ><span 
class="aeti-10">MagicValue </span><br 
class="newline" />0x000 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-12-2"  
class="td11">
 <!--l. 64--><p class="noindent" ><span 
class="aeb10-">Magic value </span><br 
class="newline" />0x74726976  (a  Little  Endian  equivalent  of  the  “virt”
  string).                                                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-13-"><td  style="white-space:normal; text-align:left;" id="TBL-36-13-1"  
class="td11">
 <!--l. 71--><p class="noindent" ><span 
class="aeti-10">Version </span><br 
class="newline" />0x004 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-13-2"  
class="td11">
 <!--l. 71--><p class="noindent" ><span 
class="aeb10-">Device version number </span><br 
class="newline" />0x2.
  <span 
class="aeb10-">Note:</span>  Legacy devices (see <a 
href="#x1-2250004">4.2.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Legacy interface --></a> <a 
href="#x1-2250004">Legacy interface<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Legacy interface --></a>) used
           0x1.
  <!--l. 72--><p class="noindent" >                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-14-"><td  style="white-space:normal; text-align:left;" id="TBL-36-14-1"  
class="td11">
 <!--l. 79--><p class="noindent" ><span 
class="aeti-10">DeviceID </span><br 
class="newline" />0x008 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-14-2"  
class="td11">
 <!--l. 79--><p class="noindent" ><span 
class="aeb10-">Virtio Subsystem Device ID </span><br 
class="newline" />See  <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a> <a 
href="#x1-2660005">Device  Types<!--tex4ht:ref: sec:Device Types --></a>  for  possible  values.  Value  zero
  (0x0)  is  used  to  define  a  system  memory  map  with
  placeholder  devices  at  static,  well  known  addresses,
  assigning functions to them depending on user’s needs.  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-15-"><td  style="white-space:normal; text-align:left;" id="TBL-36-15-1"  
class="td11">
 <!--l. 81--><p class="noindent" ><span 
class="aeti-10">VendorID </span><br 
class="newline" />0x00c <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-15-2"  
class="td11">
 <!--l. 81--><p class="noindent" ><span 
class="aeb10-">Virtio Subsystem Vendor ID </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-16-"><td  style="white-space:normal; text-align:left;" id="TBL-36-16-1"  
class="td11">
 <!--l. 91--><p class="noindent" ><span 
class="aeti-10">DeviceFeatures </span><br 
class="newline" />0x010 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-16-2"  
class="td11">
 <!--l. 91--><p class="noindent" ><span 
class="aeb10-">Flags representing features the device supports </span><br 
class="newline" />Reading  from  this  register  returns  32  consecutive
  flag  bits,  the  least  significant  bit  depending  on  the
  last  value  written  to  <span 
class="aeti-10">DeviceFeaturesSel</span>.  Access  to
  this  register  returns  bits  <span 
class="aeti-10">DeviceFeaturesSel</span> <span 
class="cmsy-10">∗ </span><span 
class="cmr-10">32  </span>to
  <span 
class="cmr-10">(</span><span 
class="aeti-10">DeviceFeaturesSel</span> <span 
class="cmsy-10">∗ </span><span 
class="cmr-10">32) + 31</span>, eg. feature bits 0 to 31 if
  <span 
class="aeti-10">DeviceFeaturesSel </span>is set to 0 and features bits 32 to 63 if
  <span 
class="aeti-10">DeviceFeaturesSel </span>is set to 1. Also see <a 
href="#x1-140002">2.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a> <a 
href="#x1-140002">Feature Bits<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a>.  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-17-"><td  style="white-space:normal; text-align:left;" id="TBL-36-17-1"  
class="td11">
 <!--l. 96--><p class="noindent" ><span 
class="aeti-10">DeviceFeaturesSel</span>
  <br 
class="newline" />0x014 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-17-2"  
class="td11">
 <!--l. 96--><p class="noindent" ><span 
class="aeb10-">Device (host) features word selection. </span><br 
class="newline" />Writing to this register selects a set of 32 device feature
  bits accessible by reading from <span 
class="aeti-10">DeviceFeatures</span>.             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-18-"><td  style="white-space:normal; text-align:left;" id="TBL-36-18-1"  
class="td11">
 <!--l. 105--><p class="noindent" ><span 
class="aeti-10">DriverFeatures </span><br 
class="newline" />0x020 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-18-2"  
class="td11">
 <!--l. 105--><p class="noindent" ><span 
class="aeb10-">Flags  representing  device  features  understood  and</span>
  <span 
class="aeb10-">activated by the driver </span><br 
class="newline" />Writing to this register sets 32 consecutive flag bits, the
  least significant bit depending on the last value written
  to <span 
class="aeti-10">DriverFeaturesSel</span>. Access to this register sets bits
  <span 
class="aeti-10">DriverFeaturesSel</span> <span 
class="cmsy-10">∗ </span><span 
class="cmr-10">32 </span>to <span 
class="cmr-10">(</span><span 
class="aeti-10">DriverFeaturesSel</span> <span 
class="cmsy-10">∗ </span><span 
class="cmr-10">32) + 31</span>,
  eg. feature bits 0 to 31 if <span 
class="aeti-10">DriverFeaturesSel </span>is set to 0
  and features bits 32 to 63 if <span 
class="aeti-10">DriverFeaturesSel </span>is set to
  1. Also see <a 
href="#x1-140002">2.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a> <a 
href="#x1-140002">Feature Bits<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a>.                                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-19-"><td  style="white-space:normal; text-align:left;" id="TBL-36-19-1"  
class="td11">
 <!--l. 110--><p class="noindent" ><span 
class="aeti-10">DriverFeaturesSel</span>
  <br 
class="newline" />0x024 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-19-2"  
class="td11">
 <!--l. 110--><p class="noindent" ><span 
class="aeb10-">Activated (guest) features word selection </span><br 
class="newline" />Writing  to  this  register  selects  a  set  of  32  activated
  feature bits accessible by writing to <span 
class="aeti-10">DriverFeatures</span>.       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-20-"><td  style="white-space:normal; text-align:left;" id="TBL-36-20-1"  
class="td11">
 <!--l. 118--><p class="noindent" ><span 
class="aeti-10">QueueSel </span><br 
class="newline" />0x030 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-20-2"  
class="td11">
 <!--l. 118--><p class="noindent" ><span 
class="aeb10-">Virtqueue index </span><br 
class="newline" />Writing  to  this  register  selects  the  virtqueue  that
  the following operations on <span 
class="aeti-10">QueueSizeMax</span>, <span 
class="aeti-10">QueueSize</span>,
  <span 
class="aeti-10">QueueReady</span>,       <span 
class="aeti-10">QueueDescLow</span>,       <span 
class="aeti-10">QueueDescHigh</span>,
  <span 
class="aeti-10">QueueDriverlLow</span>, <span 
class="aeti-10">QueueDriverHigh</span>, <span 
class="aeti-10">QueueDeviceLow</span>,
  <span 
class="aeti-10">QueueDeviceHigh </span>and <span 
class="aeti-10">QueueReset </span>apply to.                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-21-"><td  style="white-space:normal; text-align:left;" id="TBL-36-21-1"  
class="td11">
 <!--l. 128--><p class="noindent" ><span 
class="aeti-10">QueueSizeMax </span><br 
class="newline" />0x034 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-21-2"  
class="td11">
 <!--l. 128--><p class="noindent" ><span 
class="aeb10-">Maximum virtqueue size </span><br 
class="newline" />Reading from the register returns the maximum size
  (number of elements) of the queue the device is ready to
  process or zero (0x0) if the queue is not available. This
  applies to the queue selected by writing to <span 
class="aeti-10">QueueSel</span>.
  <span 
class="aeb10-">Note:</span>  <span 
class="aeti-10">QueueSizeMax    </span>was    previously    known    as
           <span 
class="aeti-10">QueueNumMax</span>.
  <!--l. 129--><p class="noindent" >                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-22-"><td  style="white-space:normal; text-align:left;" id="TBL-36-22-1"  
class="td11">
 <!--l. 138--><p class="noindent" ><span 
class="aeti-10">QueueSize </span><br 
class="newline" />0x038 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-22-2"  
class="td11">
 <!--l. 138--><p class="noindent" ><span 
class="aeb10-">Virtqueue size </span><br 
class="newline" />Queue size is the number of elements in the queue. Writing
  to this register notifies the device what size of the queue the
  driver will use. This applies to the queue selected by
  writing to <span 
class="aeti-10">QueueSel</span>.
  <span 
class="aeb10-">Note:</span>  <span 
class="aeti-10">QueueSize </span>was previously known as <span 
class="aeti-10">QueueNum</span>.
  <!--l. 139--><p class="noindent" >                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-23-"><td  style="white-space:normal; text-align:left;" id="TBL-36-23-1"  
class="td11">
 <!--l. 145--><p class="noindent" ><span 
class="aeti-10">QueueReady </span><br 
class="newline" />0x044 <br 
class="newline" />RW                  </td><td  style="white-space:normal; text-align:left;" id="TBL-36-23-2"  
class="td11">
 <!--l. 145--><p class="noindent" ><span 
class="aeb10-">Virtqueue ready bit </span><br 
class="newline" />Writing one (0x1) to this register notifies the device that
  it  can  execute  requests  from  this  virtqueue.  Reading
  from this register returns the last value written to it.
  Both read and write accesses apply to the queue selected
  by writing to <span 
class="aeti-10">QueueSel</span>.                                           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-24-"><td  style="white-space:normal; text-align:left;" id="TBL-36-24-1"  
class="td11">
 <!--l. 161--><p class="noindent" ><span 
class="aeti-10">QueueNotify </span><br 
class="newline" />0x050 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-24-2"  
class="td11">
 <!--l. 161--><p class="noindent" ><span 
class="aeb10-">Queue notifier </span><br 
class="newline" />Writing a value to this register notifies the device that
  there are new buffers to process in a queue.
  <!--l. 161--><p class="noindent" >When   VIRTIO_F_NOTIFICATION_DATA   has   not
  been negotiated, the value written is the queue index.
  <!--l. 161--><p class="noindent" >When  VIRTIO_F_NOTIFICATION_DATA  has  been
  negotiated, the <span 
class="aeti-10">Notification data </span>value has the following
  format:
  <!--l. 161--><pre class="lstinputlisting">
  <a 
 id="x1-215002"></a>
  <span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-215003r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-215004r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">previously</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">known</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vqn</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-215005r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-215006r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_wrap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-215007r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span>
 
</pre>
<!--l. 161--><p class="noindent" >See  <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> <a 
href="#x1-1010009">Driver  Notifications<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a>  for  the  definition  of  the
components.                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-25-"><td  style="white-space:normal; text-align:left;" id="TBL-36-25-1"  
class="td11">
 <!--l. 174--><p class="noindent" ><span 
class="aeti-10">InterruptStatus</span>
  <br 
class="newline" />0x60 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-25-2"  
class="td11">
 <!--l. 174--><p class="noindent" ><span 
class="aeb10-">Interrupt status </span><br 
class="newline" />Reading from this register returns a bit mask of events that
  caused the device interrupt to be asserted. The following
  events are possible:
         <dl class="description"><dt class="description">
         <!--l. 174--><p class="noindent" >
  <span 
class="aeb10-">Used Buffer Notification</span>  </dt><dd 
class="description">
         <!--l. 174--><p class="noindent" >- bit 0 - the interrupt was asserted because the
         device has used a buffer in at least one of the active
         virtqueues.
         </dd><dt class="description">
         <!--l. 174--><p class="noindent" >
  <span 
class="aeb10-">Configuration Change Notification</span>  </dt><dd 
class="description">
         <!--l. 174--><p class="noindent" >- bit 1 - the interrupt was asserted because the
         configuration of the device has changed.</dd></dl>
  <!--l. 175--><p class="noindent" >                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-26-"><td  style="white-space:normal; text-align:left;" id="TBL-36-26-1"  
class="td11">
 <!--l. 180--><p class="noindent" ><span 
class="aeti-10">InterruptACK </span><br 
class="newline" />0x064 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-26-2"  
class="td11">
 <!--l. 180--><p class="noindent" ><span 
class="aeb10-">Interrupt acknowledge </span><br 
class="newline" />Writing           a           value           with           bits
  set as defined in <span 
class="aeti-10">InterruptStatus </span>to this register notifies
  the device that events causing the interrupt have been
  handled.                                                               </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-27-"><td  style="white-space:normal; text-align:left;" id="TBL-36-27-1"  
class="td11">
 <!--l. 189--><p class="noindent" ><span 
class="aeti-10">Status </span><br 
class="newline" />0x070 <br 
class="newline" />RW                  </td><td  style="white-space:normal; text-align:left;" id="TBL-36-27-2"  
class="td11">
 <!--l. 189--><p class="noindent" ><span 
class="aeb10-">Device status </span><br 
class="newline" />Reading from this register returns the current device
  status flags. Writing non-zero values to this register sets
  the status flags, indicating the driver progress. Writing
  zero (0x0) to this register triggers a device reset. See
  also p. <a 
href="#x1-2190001">4.2.3.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / MMIO-specific Initialization And Device Operation / Device Initialization --></a> <a 
href="#x1-2190001">Device Initialization<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / MMIO-specific Initialization And Device Operation / Device Initialization --></a>.                           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-28-"><td  style="white-space:normal; text-align:left;" id="TBL-36-28-1"  
class="td11">
 <!--l. 196--><p class="noindent" ><span 
class="aeti-10">QueueDescLow</span>
  <br 
class="newline" />0x080 <br 
class="newline" /><span 
class="aeti-10">QueueDescHigh</span>
  <br 
class="newline" />0x084 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-28-2"  
class="td11">
 <!--l. 196--><p class="noindent" ><span 
class="aeb10-">Virtqueue’s  Descriptor  Area  64  bit  long  physical</span>
  <span 
class="aeb10-">address </span><br 
class="newline" />Writing  to  these  two  registers  (lower  32  bits  of
  the  address  to  <span 
class="aeti-10">QueueDescLow</span>,  higher  32  bits  to
  <span 
class="aeti-10">QueueDescHigh</span>) notifies the device about location of
  the Descriptor Area of the queue selected by writing to
  <span 
class="aeti-10">QueueSel </span>register.                                                  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-29-"><td  style="white-space:normal; text-align:left;" id="TBL-36-29-1"  
class="td11">
 <!--l. 203--><p class="noindent" ><span 
class="aeti-10">QueueDriverLow</span>
  <br 
class="newline" />0x090 <br 
class="newline" /><span 
class="aeti-10">QueueDriverHigh</span>
  <br 
class="newline" />0x094 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-29-2"  
class="td11">
 <!--l. 203--><p class="noindent" ><span 
class="aeb10-">Virtqueue’s Driver Area 64 bit long physical address </span><br 
class="newline" />Writing  to  these  two  registers  (lower  32  bits  of
  the  address  to  <span 
class="aeti-10">QueueDriverLow</span>,  higher  32  bits  to
  <span 
class="aeti-10">QueueDriverHigh</span>) notifies the device about location of
  the  Driver  Area  of  the  queue  selected  by  writing  to
  <span 
class="aeti-10">QueueSel</span>.                                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-30-"><td  style="white-space:normal; text-align:left;" id="TBL-36-30-1"  
class="td11">
 <!--l. 210--><p class="noindent" ><span 
class="aeti-10">QueueDeviceLow</span>
  <br 
class="newline" />0x0a0 <br 
class="newline" /><span 
class="aeti-10">QueueDeviceHigh</span>
  <br 
class="newline" />0x0a4 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-30-2"  
class="td11">
 <!--l. 210--><p class="noindent" ><span 
class="aeb10-">Virtqueue’s Device Area 64 bit long physical address </span><br 
class="newline" />Writing  to  these  two  registers  (lower  32  bits  of
  the  address  to  <span 
class="aeti-10">QueueDeviceLow</span>,  higher  32  bits  to
  <span 
class="aeti-10">QueueDeviceHigh</span>) notifies the device about location of
  the  Device  Area  of  the  queue  selected  by  writing  to
  <span 
class="aeti-10">QueueSel</span>.                                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-31-"><td  style="white-space:normal; text-align:left;" id="TBL-36-31-1"  
class="td11">
 <!--l. 216--><p class="noindent" ><span 
class="aeti-10">SHMSel </span><br 
class="newline" />0x0ac <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-36-31-2"  
class="td11">
 <!--l. 216--><p class="noindent" ><span 
class="aeb10-">Shared memory id </span><br 
class="newline" />Writing  to  this  register  selects  the  shared  memory
  region   <a 
href="#x1-10200010">2.10<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Shared Memory Regions --></a>   following   operations   on   <span 
class="aeti-10">SHMLenLow</span>,
  <span 
class="aeti-10">SHMLenHigh</span>, <span 
class="aeti-10">SHMBaseLow </span>and <span 
class="aeti-10">SHMBaseHigh </span>apply
  to.                                                                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-32-"><td  style="white-space:normal; text-align:left;" id="TBL-36-32-1"  
class="td11">
 <!--l. 226--><p class="noindent" ><span 
class="aeti-10">SHMLenLow </span><br 
class="newline" />0x0b0 <br 
class="newline" /><span 
class="aeti-10">SHMLenHigh </span><br 
class="newline" />0x0b4 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-32-2"  
class="td11">
 <!--l. 226--><p class="noindent" ><span 
class="aeb10-">Shared memory region 64 bit long length </span><br 
class="newline" />These registers return the length of the shared memory
  region in bytes, as defined by the device for the region
  selected by the <span 
class="aeti-10">SHMSel </span>register. The lower 32 bits of
  the length are read from <span 
class="aeti-10">SHMLenLow </span>and the higher
  32 bits from <span 
class="aeti-10">SHMLenHigh</span>. Reading from a non-existent
  region (i.e. where the ID written to <span 
class="aeti-10">SHMSel </span>is unused)
  results in a length of -1.                                           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-33-"><td  style="white-space:normal; text-align:left;" id="TBL-36-33-1"  
class="td11">
 <!--l. 237--><p class="noindent" ><span 
class="aeti-10">SHMBaseLow </span><br 
class="newline" />0x0b8 <br 
class="newline" /><span 
class="aeti-10">SHMBaseHigh </span><br 
class="newline" />0x0bc <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-33-2"  
class="td11">
 <!--l. 237--><p class="noindent" ><span 
class="aeb10-">Shared memory region 64 bit long physical address </span><br 
class="newline" />The  driver  reads  these  registers  to  discover  the  base
  address of the region in physical address space. This
  address  is  chosen  by  the  device  (or  other  part  of
  the  VMM).  The  lower  32  bits  of  the  address  are
  read from <span 
class="aeti-10">SHMBaseLow </span>with the higher 32 bits from
  <span 
class="aeti-10">SHMBaseHigh</span>. Reading from a non-existent region (i.e.
  where the ID written to <span 
class="aeti-10">SHMSel </span>is unused) results in a
  base address of 0xffffffffffffffff.                                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-34-"><td  style="white-space:normal; text-align:left;" id="TBL-36-34-1"  
class="td11">
 <!--l. 243--><p class="noindent" ><span 
class="aeti-10">QueueReset </span><br 
class="newline" />0x0c0 <br 
class="newline" />RW                  </td><td  style="white-space:normal; text-align:left;" id="TBL-36-34-2"  
class="td11">
 <!--l. 243--><p class="noindent" ><span 
class="aeb10-">Virtqueue reset bit </span><br 
class="newline" />If   VIRTIO_F_RING_RESET   has   been   negotiated,
  writing one (0x1) to this register selectively resets the
  queue. Both read and write accesses apply to the queue
  selected by writing to <span 
class="aeti-10">QueueSel</span>.                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-35-"><td  style="white-space:normal; text-align:left;" id="TBL-36-35-1"  
class="td11">
 <!--l. 251--><p class="noindent" ><span 
class="aeti-10">ConfigGeneration</span>
  <br 
class="newline" />0x0fc <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-36-35-2"  
class="td11">
 <!--l. 251--><p class="noindent" ><span 
class="aeb10-">Configuration atomicity value </span><br 
class="newline" /> Reading from this register returns a value describing
  a version of the device-specific configuration space (see
  <span 
class="aeti-10">Config</span>). The driver can then access the configuration
  space and, when finished, read <span 
class="aeti-10">ConfigGeneration </span>again.
  If  no  part  of  the  configuration  space  has  changed
  between these two <span 
class="aeti-10">ConfigGeneration </span>reads, the returned
  values  are  identical.  If  the  values  are  different,  the
  configuration space accesses were not atomic and the
  driver has to perform the operations again. See also <a 
href="#x1-220005">2.5<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Configuration Space --></a>.  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-36-"><td  style="white-space:normal; text-align:left;" id="TBL-36-36-1"  
class="td11">
 <!--l. 257--><p class="noindent" ><span 
class="aeti-10">Config </span><br 
class="newline" />0x100+ <br 
class="newline" />RW                  </td><td  style="white-space:normal; text-align:left;" id="TBL-36-36-2"  
class="td11">
 <!--l. 257--><p class="noindent" ><span 
class="aeb10-">Configuration space </span><br 
class="newline" /> Device-specific configuration space starts at the offset
  0x100 and is accessed with byte alignment. Its meaning
  and size depend on the device and the driver.              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-36-37-"><td  style="white-space:normal; text-align:left;" id="TBL-36-37-1"  
class="td11">             </td>                                                

                                                                  
</tr><tr  
 style="vertical-align:baseline;" id="TBL-36-38-"><td  style="white-space:normal; text-align:left;" id="TBL-36-38-1"  
class="td11">             </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-36-39-"><td  style="white-space:normal; text-align:left;" id="TBL-36-39-1"  
class="td11">
 <!--l. 259--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-36-40-"><td  style="white-space:normal; text-align:left;" id="TBL-36-40-1"  
class="td11">
 <!--l. 259--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-36-41-"><td  style="white-space:normal; text-align:left;" id="TBL-36-41-1"  
class="td11">
 <!--l. 259--><p class="noindent" >            </td>
</tr>
<tr  
 style="vertical-align:baseline;" id="TBL-36-10-"><td  style="white-space:normal; text-align:left;" id="TBL-36-10-1"  
class="td11">
 <!--l. 60--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-36-11-"><td  style="white-space:normal; text-align:left;" id="TBL-36-11-1"  
class="td11">
 <!--l. 60--><p class="noindent" >            </td>
</tr>
</table></div>
<a 
 id="x1-215008r217"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.2.2.1   </span> <a 
 id="x1-2160001"></a>Device Requirements: MMIO Device Register Layout</h5>
<!--l. 263--><p class="nopar" >The device MUST return 0x74726976 in <span 
class="aeti-10">MagicValue</span>.
<!--l. 265--><p class="noindent" >The device MUST return value 0x2 in <span 
class="aeti-10">Version</span>.
<!--l. 267--><p class="noindent" >The device MUST present each event by setting the corresponding bit in
<span 
class="aeti-10">InterruptStatus </span>from the moment it takes place, until the driver acknowledges
the interrupt by writing a corresponding bit mask to the <span 
class="aeti-10">InterruptACK</span>
register. Bits which do not represent events which took place MUST be
zero.
<!--l. 272--><p class="noindent" >Upon reset, the device MUST clear all bits in <span 
class="aeti-10">InterruptStatus </span>and ready bits in the
<span 
class="aeti-10">QueueReady </span>register for all queues in the device.
<!--l. 275--><p class="noindent" >The device MUST change value returned in <span 
class="aeti-10">ConfigGeneration </span>if there is any risk of a
driver seeing an inconsistent configuration state.
<!--l. 278--><p class="noindent" >The device MUST NOT access virtqueue contents when <span 
class="aeti-10">QueueReady </span>is zero
(0x0).
<!--l. 280--><p class="noindent" >If VIRTIO_F_RING_RESET has been negotiated, the device MUST present a 0 in
<span 
class="aeti-10">QueueReset </span>on reset.
<!--l. 283--><p class="noindent" >If VIRTIO_F_RING_RESET has been negotiated, The device MUST present a 0 in
<span 
class="aeti-10">QueueReset </span>after the virtqueue is enabled with <span 
class="aeti-10">QueueReady</span>.
<!--l. 286--><p class="noindent" >The device MUST reset the queue when 1 is written to <span 
class="aeti-10">QueueReset</span>. The device
MUST continue to present 1 in <span 
class="aeti-10">QueueReset </span>as long as the queue reset is ongoing.
The device MUST present 0 in both <span 
class="aeti-10">QueueReset </span>and <span 
class="aeti-10">QueueReady </span>when queue reset
has completed. (see <a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>).
<a 
 id="x1-216001r223"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.2.2.2   </span> <a 
 id="x1-2170002"></a>Driver Requirements: MMIO Device Register Layout</h5>
<!--l. 293--><p class="nopar" >The driver MUST NOT access memory locations not described in the table <a 
href="#x1-215001r1">4.1<!--tex4ht:ref: tab:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a> (or, in
                                                                  

                                                                  
case of the configuration space, described in the device specification), MUST NOT
write to the read-only registers (direction R) and MUST NOT read from the
write-only registers (direction W).
<!--l. 299--><p class="noindent" >The driver MUST only use 32 bit wide and aligned reads and writes to access the
control registers described in table <a 
href="#x1-215001r1">4.1<!--tex4ht:ref: tab:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a>. For the device-specific configuration space,
the driver MUST use 8 bit wide accesses for 8 bit wide fields, 16 bit wide and aligned
accesses for 16 bit wide fields and 32 bit wide and aligned accesses for 32 and 64 bit
wide fields.
<!--l. 305--><p class="noindent" >The driver MUST ignore a device with <span 
class="aeti-10">MagicValue </span>which is not 0x74726976,
although it MAY report an error.
<!--l. 308--><p class="noindent" >The driver MUST ignore a device with <span 
class="aeti-10">Version </span>which is not 0x2, although it MAY
report an error.
<!--l. 311--><p class="noindent" >The driver MUST ignore a device with <span 
class="aeti-10">DeviceID </span>0x0, but MUST NOT report any
error.
<!--l. 314--><p class="noindent" >Before reading from <span 
class="aeti-10">DeviceFeatures</span>, the driver MUST write a value to
<span 
class="aeti-10">DeviceFeaturesSel</span>.
<!--l. 316--><p class="noindent" >Before writing to the <span 
class="aeti-10">DriverFeatures </span>register, the driver MUST write a value to the
<span 
class="aeti-10">DriverFeaturesSel </span>register.
<!--l. 318--><p class="noindent" >The driver MUST write a value to <span 
class="aeti-10">QueueSize </span>which is less than or equal to the value
presented by the device in <span 
class="aeti-10">QueueSizeMax</span>.
<!--l. 321--><p class="noindent" >When <span 
class="aeti-10">QueueReady </span>is not zero, the driver MUST NOT access <span 
class="aeti-10">QueueSize</span>,
<span 
class="aeti-10">QueueDescLow</span>, <span 
class="aeti-10">QueueDescHigh</span>, <span 
class="aeti-10">QueueDriverLow</span>, <span 
class="aeti-10">QueueDriverHigh</span>, <span 
class="aeti-10">QueueDeviceLow</span>,
<span 
class="aeti-10">QueueDeviceHigh</span>.
<!--l. 325--><p class="noindent" >To stop using the queue the driver MUST write zero (0x0) to this <span 
class="aeti-10">QueueReady </span>and
MUST read the value back to ensure synchronization.
<!--l. 329--><p class="noindent" >The driver MUST ignore undefined bits in <span 
class="aeti-10">InterruptStatus</span>.
<!--l. 331--><p class="noindent" >The driver MUST write a value with a bit mask describing events it handled into
<span 
class="aeti-10">InterruptACK </span>when it finishes handling an interrupt and MUST NOT set any of the
undefined bits in the value.
<!--l. 334--><p class="noindent" >If VIRTIO_F_RING_RESET has been negotiated, after the driver writes 1 to
<span 
class="aeti-10">QueueReset </span>to reset the queue, the driver MUST NOT consider queue reset to be
complete until it reads back 0 in <span 
class="aeti-10">QueueReset</span>. The driver MAY re-enable the queue
by writing 1 to <span 
class="aeti-10">QueueReady </span>after ensuring that other virtqueue fields have been set
up correctly. The driver MAY set driver-writeable queue configuration values
to different values than those that were used before the queue reset. (see
<a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>).
<a 
 id="x1-217001r220"></a>
<h4 class="subsectionHead"><span class="titlemark">4.2.3   </span> <a 
 id="x1-2180003"></a>MMIO-specific Initialization And Device Operation</h4>
<a 
 id="x1-218001r224"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">4.2.3.1   </span> <a 
 id="x1-2190001"></a>Device Initialization</h5>
<a 
 id="x1-219001r216"></a>
<!--l. 347--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.2.3.1.1</span> <a 
 id="x1-2200001"></a>Driver Requirements: Device Initialization</h5>
The driver MUST start the device initialization by reading and checking values from
<span 
class="aeti-10">MagicValue </span>and <span 
class="aeti-10">Version</span>. If both values are valid, it MUST read <span 
class="aeti-10">DeviceID </span>and if its
value is zero (0x0) MUST abort initialization and MUST NOT access any other
register.
<!--l. 355--><p class="noindent" >Drivers not expecting shared memory MUST NOT use the shared memory
registers.
<!--l. 358--><p class="noindent" >Further initialization MUST follow the procedure described in <a 
href="#x1-1550001">3.1<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a> <a 
href="#x1-1550001">Device
Initialization<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a>.
<a 
 id="x1-220001r226"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.2.3.2   </span> <a 
 id="x1-2210002"></a>Virtqueue Configuration</h5>
<!--l. 363--><p class="nopar" >The driver will typically initialize the virtqueue in the following way:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Select the queue by writing its index to <span 
class="aeti-10">QueueSel</span>.
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Check if the queue is not already in use: read <span 
class="aeti-10">QueueReady</span>, and expect a
     returned value of zero (0x0).
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Read maximum queue size (number of elements) from <span 
class="aeti-10">QueueSizeMax</span>. If
     the returned value is zero (0x0) the queue is not available.
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Allocate and zero the queue memory, making sure the memory is physically
     contiguous.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">Notify the device about the queue size by writing the size to <span 
class="aeti-10">QueueSize</span>.
     </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">Write physical addresses of the queue’s Descriptor Area, Driver Area and
     Device                    Area                    to                    (respectively)
     the <span 
class="aeti-10">QueueDescLow</span>/<span 
class="aeti-10">QueueDescHigh</span>, <span 
class="aeti-10">QueueDriverLow</span>/<span 
class="aeti-10">QueueDriverHigh</span>
     and <span 
class="aeti-10">QueueDeviceLow</span>/<span 
class="aeti-10">QueueDeviceHigh </span>register pairs.
     </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">Write 0x1 to <span 
class="aeti-10">QueueReady</span>.</dd></dl>
<a 
 id="x1-221008r228"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.2.3.3   </span> <a 
 id="x1-2220003"></a>Available Buffer Notifications</h5>
<!--l. 392--><p class="nopar" >When VIRTIO_F_NOTIFICATION_DATA has not been negotiated, the driver sends
an available buffer notification to the device by writing the 16-bit virtqueue index of
                                                                  

                                                                  
the queue to be notified to <span 
class="aeti-10">QueueNotify</span>.
<!--l. 397--><p class="noindent" >When VIRTIO_F_NOTIFICATION_DATA has been negotiated, the driver sends an
available buffer notification to the device by writing the following 32-bit value to
<span 
class="aeti-10">QueueNotify</span>: <!--l. 400--><pre class="lstinputlisting">
<a 
 id="x1-222001"></a>
<span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-222002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-222003r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">previously</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">known</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vqn</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-222004r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-222005r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_wrap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-222006r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span>
</pre>
<!--l. 402--><p class="noindent" >See <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> <a 
href="#x1-1010009">Driver Notifications<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> for the definition of the components.
<a 
 id="x1-222007r229"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.2.3.4   </span> <a 
 id="x1-2230004"></a>Notifications From The Device</h5>
<!--l. 407--><p class="nopar" >The memory mapped virtio device is using a single, dedicated interrupt signal,
which is asserted when at least one of the bits described in the description of
<span 
class="aeti-10">InterruptStatus </span>is set. This is how the device sends a used buffer notification or a
configuration change notification to the device.
<a 
 id="x1-223001r227"></a>
<!--l. 413--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.2.3.4.1</span> <a 
 id="x1-2240001"></a>Driver Requirements: Notifications From The Device</h5>
After receiving an interrupt, the driver MUST read <span 
class="aeti-10">InterruptStatus </span>to check what
caused the interrupt (see the register description). The used buffer notification bit
being set SHOULD be interpreted as a used buffer notification for each active
virtqueue. After the interrupt is handled, the driver MUST acknowledge it by
writing a bit mask corresponding to the handled events to the InterruptACK
register.
<a 
 id="x1-224001r225"></a>
<h4 class="subsectionHead"><span class="titlemark">4.2.4   </span> <a 
 id="x1-2250004"></a>Legacy interface</h4>
<!--l. 424--><p class="nopar" >The legacy MMIO transport used page-based addressing, resulting in a slightly
different control register layout, the device initialization and the virtqueue
configuration procedure.
<!--l. 428--><p class="noindent" >Table <a 
href="#x1-225001r2">4.2<!--tex4ht:ref: tab:Virtio Transport Options / Virtio Over MMIO / MMIO Device Legacy Register Layout --></a> presents control registers layout, omitting descriptions of registers which
did not change their function nor behaviour:
<a 
 id="x1-225001r2"></a>
<!--l. 434--><div class="longtable"> <table id="TBL-37" class="longtable" 
 
><colgroup id="TBL-37-1g"><col 
id="TBL-37-1"><col 
id="TBL-37-2"></colgroup>
                                                                  

                                                                  
<tr  
 style="vertical-align:baseline;" id="TBL-37-1-"><td colspan="2" style="white-space:normal; text-align:left;" id="TBL-37-1-1"  
class="td11">    <div class="multicolumn"  style="white-space:nowrap; text-align:center;"> <div class="caption" 
><span class="id">Table 4.2: </span><span  
class="content">MMIO Device Legacy Register Layout</span></div><!--tex4ht:label?: x1-225001r2 -->                     </div>
</td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-2-"><td  style="white-space:normal; text-align:left;" id="TBL-37-2-1"  
class="td11">
 <!--l. 438--><p class="noindent" ><span 
class="aeti-10">Name </span><br 
class="newline" />Offset       from
  base <br 
class="newline" />Direction          </td><td  style="white-space:normal; text-align:left;" id="TBL-37-2-2"  
class="td11">
 <!--l. 438--><p class="noindent" ><span 
class="aeb10-">Function </span><br 
class="newline" />Description                                                           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-3-"><td  style="white-space:normal; text-align:left;" id="TBL-37-3-1"  
class="td11">
 <!--l. 441--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-37-4-"><td  style="white-space:normal; text-align:left;" id="TBL-37-4-1"  
class="td11">               </td><td  style="white-space:normal; text-align:left;" id="TBL-37-4-2"  
class="td11">
</td></tr>
<tr  
 style="vertical-align:baseline;" id="TBL-37-12-"><td  style="white-space:normal; text-align:left;" id="TBL-37-12-1"  
class="td11">
 <!--l. 449--><p class="noindent" ><span 
class="aeti-10">MagicValue </span><br 
class="newline" />0x000 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-37-12-2"  
class="td11">
 <!--l. 449--><p class="noindent" ><span 
class="aeb10-">Magic value </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-13-"><td  style="white-space:normal; text-align:left;" id="TBL-37-13-1"  
class="td11">
 <!--l. 451--><p class="noindent" ><span 
class="aeti-10">Version </span><br 
class="newline" />0x004 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-37-13-2"  
class="td11">
 <!--l. 451--><p class="noindent" ><span 
class="aeb10-">Device version number </span><br 
class="newline" />Legacy device returns value 0x1.                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-14-"><td  style="white-space:normal; text-align:left;" id="TBL-37-14-1"  
class="td11">
 <!--l. 453--><p class="noindent" ><span 
class="aeti-10">DeviceID </span><br 
class="newline" />0x008 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-37-14-2"  
class="td11">
 <!--l. 453--><p class="noindent" ><span 
class="aeb10-">Virtio Subsystem Device ID </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-15-"><td  style="white-space:normal; text-align:left;" id="TBL-37-15-1"  
class="td11">
 <!--l. 455--><p class="noindent" ><span 
class="aeti-10">VendorID </span><br 
class="newline" />0x00c <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-37-15-2"  
class="td11">
 <!--l. 455--><p class="noindent" ><span 
class="aeb10-">Virtio Subsystem Vendor ID </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-16-"><td  style="white-space:normal; text-align:left;" id="TBL-37-16-1"  
class="td11">
 <!--l. 457--><p class="noindent" ><span 
class="aeti-10">HostFeatures </span><br 
class="newline" />0x010 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-37-16-2"  
class="td11">
 <!--l. 457--><p class="noindent" ><span 
class="aeb10-">Flags representing features the device supports </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-17-"><td  style="white-space:normal; text-align:left;" id="TBL-37-17-1"  
class="td11">
 <!--l. 459--><p class="noindent" ><span 
class="aeti-10">HostFeaturesSel</span>
  <br 
class="newline" />0x014 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-17-2"  
class="td11">
 <!--l. 459--><p class="noindent" ><span 
class="aeb10-">Device (host) features word selection. </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-18-"><td  style="white-space:normal; text-align:left;" id="TBL-37-18-1"  
class="td11">
 <!--l. 461--><p class="noindent" ><span 
class="aeti-10">GuestFeatures </span><br 
class="newline" />0x020 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-18-2"  
class="td11">
 <!--l. 461--><p class="noindent" ><span 
class="aeb10-">Flags  representing  device  features  understood  and</span>
  <span 
class="aeb10-">activated by the driver </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-19-"><td  style="white-space:normal; text-align:left;" id="TBL-37-19-1"  
class="td11">
 <!--l. 463--><p class="noindent" ><span 
class="aeti-10">GuestFeaturesSel</span>
  <br 
class="newline" />0x024 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-19-2"  
class="td11">
 <!--l. 463--><p class="noindent" ><span 
class="aeb10-">Activated (guest) features word selection </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-20-"><td  style="white-space:normal; text-align:left;" id="TBL-37-20-1"  
class="td11">
 <!--l. 471--><p class="noindent" ><span 
class="aeti-10">GuestPageSize </span><br 
class="newline" />0x028 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-20-2"  
class="td11">
 <!--l. 471--><p class="noindent" ><span 
class="aeb10-">Guest page size </span><br 
class="newline" />The driver writes the guest page size in bytes to the
  register during initialization, before any queues are used.
  This value should be a power of 2 and is used by the
  device to calculate the Guest address of the first queue
  page (see QueuePFN).                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-21-"><td  style="white-space:normal; text-align:left;" id="TBL-37-21-1"  
class="td11">
 <!--l. 478--><p class="noindent" ><span 
class="aeti-10">QueueSel </span><br 
class="newline" />0x030 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-21-2"  
class="td11">
 <!--l. 478--><p class="noindent" ><span 
class="aeb10-">Virtqueue index </span><br 
class="newline" />Writing to this register selects the virtqueue that the
  following operations on the <span 
class="aeti-10">QueueSizeMax</span>, <span 
class="aeti-10">QueueSize</span>,
  <span 
class="aeti-10">QueueAlign </span>and <span 
class="aeti-10">QueuePFN </span>registers apply to.            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-22-"><td  style="white-space:normal; text-align:left;" id="TBL-37-22-1"  
class="td11">
 <!--l. 489--><p class="noindent" ><span 
class="aeti-10">QueueSizeMax </span><br 
class="newline" />0x034 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-37-22-2"  
class="td11">
 <!--l. 489--><p class="noindent" ><span 
class="aeb10-">Maximum virtqueue size </span><br 
class="newline" />Reading from the register returns the maximum size of the
  queue the device is ready to process or zero (0x0) if the
  queue is not available. This applies to the queue selected by
  writing to <span 
class="aeti-10">QueueSel </span>and is allowed only when <span 
class="aeti-10">QueuePFN</span>
  is set to zero (0x0), so when the queue is not actively
  used.
  <span 
class="aeb10-">Note:</span>  <span 
class="aeti-10">QueueSizeMax    </span>was    previously    known    as
           <span 
class="aeti-10">QueueNumMax</span>.
  <!--l. 490--><p class="nopar" >                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-23-"><td  style="white-space:normal; text-align:left;" id="TBL-37-23-1"  
class="td11">
 <!--l. 499--><p class="noindent" ><span 
class="aeti-10">QueueSize </span><br 
class="newline" />0x038 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-23-2"  
class="td11">
 <!--l. 499--><p class="noindent" ><span 
class="aeb10-">Virtqueue size </span><br 
class="newline" />Queue size is the number of elements in the queue. Writing
  to this register notifies the device what size of the queue the
  driver will use. This applies to the queue selected by
  writing to <span 
class="aeti-10">QueueSel</span>.
  <span 
class="aeb10-">Note:</span>  <span 
class="aeti-10">QueueSize </span>was previously known as <span 
class="aeti-10">QueueNum</span>.
  <!--l. 500--><p class="nopar" >                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-24-"><td  style="white-space:normal; text-align:left;" id="TBL-37-24-1"  
class="td11">
 <!--l. 505--><p class="noindent" ><span 
class="aeti-10">QueueAlign </span><br 
class="newline" />0x03c <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-24-2"  
class="td11">
 <!--l. 505--><p class="noindent" ><span 
class="aeb10-">Used Ring alignment in the virtqueue </span><br 
class="newline" />Writing  to  this  register  notifies  the  device  about
  alignment boundary of the Used Ring in bytes. This
  value should be a power of 2 and applies to the queue
  selected by writing to <span 
class="aeti-10">QueueSel</span>.                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-25-"><td  style="white-space:normal; text-align:left;" id="TBL-37-25-1"  
class="td11">
 <!--l. 519--><p class="noindent" ><span 
class="aeti-10">QueuePFN </span><br 
class="newline" />0x040 <br 
class="newline" />RW                  </td><td  style="white-space:normal; text-align:left;" id="TBL-37-25-2"  
class="td11">
 <!--l. 519--><p class="noindent" ><span 
class="aeb10-">Guest physical page number of the virtqueue </span><br 
class="newline" />Writing to this register notifies the device about location
  of the virtqueue in the Guest’s physical address space.
  This value is the index number of a page starting with
  the  queue  Descriptor  Table.  Value  zero  (0x0)  means
  physical address zero (0x00000000) and is illegal. When
  the driver stops using the queue it writes zero (0x0)
  to this register. Reading from this register returns the
  currently used page number of the queue, therefore a
  value other than zero (0x0) means that the queue is in
  use. Both read and write accesses apply to the queue
  selected by writing to <span 
class="aeti-10">QueueSel</span>.                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-26-"><td  style="white-space:normal; text-align:left;" id="TBL-37-26-1"  
class="td11">
 <!--l. 521--><p class="noindent" ><span 
class="aeti-10">QueueNotify </span><br 
class="newline" />0x050 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-26-2"  
class="td11">
 <!--l. 521--><p class="noindent" ><span 
class="aeb10-">Queue notifier </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-27-"><td  style="white-space:normal; text-align:left;" id="TBL-37-27-1"  
class="td11">
 <!--l. 523--><p class="noindent" ><span 
class="aeti-10">InterruptStatus</span>
  <br 
class="newline" />0x60 <br 
class="newline" />R                    </td><td  style="white-space:normal; text-align:left;" id="TBL-37-27-2"  
class="td11">
 <!--l. 523--><p class="noindent" ><span 
class="aeb10-">Interrupt status </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-28-"><td  style="white-space:normal; text-align:left;" id="TBL-37-28-1"  
class="td11">
 <!--l. 525--><p class="noindent" ><span 
class="aeti-10">InterruptACK </span><br 
class="newline" />0x064 <br 
class="newline" />W                   </td><td  style="white-space:normal; text-align:left;" id="TBL-37-28-2"  
class="td11">
 <!--l. 525--><p class="noindent" ><span 
class="aeb10-">Interrupt acknowledge </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-29-"><td  style="white-space:normal; text-align:left;" id="TBL-37-29-1"  
class="td11">
 <!--l. 535--><p class="noindent" ><span 
class="aeti-10">Status </span><br 
class="newline" />0x070 <br 
class="newline" />RW                  </td><td  style="white-space:normal; text-align:left;" id="TBL-37-29-2"  
class="td11">
 <!--l. 535--><p class="noindent" ><span 
class="aeb10-">Device status </span><br 
class="newline" />Reading from this register returns the current device
  status  flags.  Writing  non-zero  values  to  this  register
  sets the status flags, indicating the OS/driver progress.
  Writing zero (0x0) to this register triggers a device reset.
  The device sets <span 
class="aeti-10">QueuePFN </span>to zero (0x0) for all queues
  in the device. Also see <a 
href="#x1-1550001">3.1<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a> <a 
href="#x1-1550001">Device Initialization<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization --></a>.           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-30-"><td  style="white-space:normal; text-align:left;" id="TBL-37-30-1"  
class="td11">
 <!--l. 537--><p class="noindent" ><span 
class="aeti-10">Config </span><br 
class="newline" />0x100+ <br 
class="newline" />RW                  </td><td  style="white-space:normal; text-align:left;" id="TBL-37-30-2"  
class="td11">
 <!--l. 537--><p class="noindent" ><span 
class="aeb10-">Configuration space </span><br 
class="newline" />                                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-37-31-"><td  style="white-space:normal; text-align:left;" id="TBL-37-31-1"  
class="td11">             </td>                                                

                                                                  
</tr><tr  
 style="vertical-align:baseline;" id="TBL-37-32-"><td  style="white-space:normal; text-align:left;" id="TBL-37-32-1"  
class="td11">             </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-37-33-"><td  style="white-space:normal; text-align:left;" id="TBL-37-33-1"  
class="td11">
 <!--l. 539--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-37-34-"><td  style="white-space:normal; text-align:left;" id="TBL-37-34-1"  
class="td11">
 <!--l. 539--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-37-35-"><td  style="white-space:normal; text-align:left;" id="TBL-37-35-1"  
class="td11">
 <!--l. 539--><p class="noindent" >            </td>
</tr>
<tr  
 style="vertical-align:baseline;" id="TBL-37-10-"><td  style="white-space:normal; text-align:left;" id="TBL-37-10-1"  
class="td11">
 <!--l. 448--><p class="noindent" >            </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-37-11-"><td  style="white-space:normal; text-align:left;" id="TBL-37-11-1"  
class="td11">
 <!--l. 448--><p class="noindent" >            </td>
</tr>
</table></div>
<!--l. 541--><p class="noindent" >The virtqueue page size is defined by writing to <span 
class="aeti-10">GuestPageSize</span>, as written by the
guest. The driver does this before the virtqueues are configured.
<!--l. 545--><p class="noindent" >The virtqueue layout follows p. <a 
href="#x1-370002">2.7.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Layout --></a> <a 
href="#x1-370002">Legacy Interfaces: A Note on Virtqueue Layout<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Layout --></a>,
with the alignment defined in <span 
class="aeti-10">QueueAlign</span>.
<!--l. 549--><p class="noindent" >The virtqueue is configured as follows:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Select the queue by writing its index to <span 
class="aeti-10">QueueSel</span>.
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Check if the queue is not already in use: read <span 
class="aeti-10">QueuePFN</span>, expecting a
     returned value of zero (0x0).
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Read maximum queue size (number of elements) from <span 
class="aeti-10">QueueSizeMax</span>. If
     the returned value is zero (0x0) the queue is not available.
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Allocate and zero the queue pages in contiguous virtual memory, aligning
     the Used Ring to an optimal boundary (usually page size). The driver
     should choose a queue size smaller than or equal to <span 
class="aeti-10">QueueSizeMax</span>.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">Notify the device about the queue size by writing the size to <span 
class="aeti-10">QueueSize</span>.
     </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">Notify the device about the used alignment by writing its value in bytes
     to <span 
class="aeti-10">QueueAlign</span>.
     </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">Write the physical number of the first page of the queue to the <span 
class="aeti-10">QueuePFN</span>
     register.</dd></dl>
<!--l. 575--><p class="noindent" >Notification mechanisms did not change.
<a 
 id="x1-225009r233"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">4.2.5   </span> <a 
 id="x1-2260005"></a>Features reserved for future use</h4>
<!--l. 579--><p class="nopar" >Devices and drivers utilizing Virtio Over MMIO do not support the following
features:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 583--><p class="noindent" >VIRTIO_F_ADMIN_VQ
     </li></ul>
<!--l. 587--><p class="noindent" >These features are reserved for future use.
<a 
 id="x1-226001r218"></a>
<h3 class="sectionHead"><span class="titlemark">4.3   </span> <a 
 id="x1-2270003"></a>Virtio Over Channel I/O</h3>
<!--l. 3--><p class="nopar" >S/390 based virtual machines support neither PCI nor MMIO, so a different
transport is needed there.
<!--l. 6--><p class="noindent" >virtio-ccw uses the standard channel I/O based mechanism used for the majority of
devices on S/390. A virtual channel device with a special control unit type acts as
proxy to the virtio device (similar to the way virtio-pci uses a PCI device) and
configuration and operation of the virtio device is accomplished (mostly) via channel
commands. This means virtio devices are discoverable via standard operating system
algorithms, and adding virtio support is mainly a question of supporting a new
control unit type.
<!--l. 16--><p class="noindent" >As the S/390 is a big endian machine, the data structures transmitted via channel
commands are big-endian: this is made clear by use of the types be16, be32 and
be64.
<a 
 id="x1-227001r235"></a>
<h4 class="subsectionHead"><span class="titlemark">4.3.1   </span> <a 
 id="x1-2280001"></a>Basic Concepts</h4>
<!--l. 22--><p class="nopar" >As a proxy device, virtio-ccw uses a channel-attached I/O control unit with a special
control unit type (0x3832) and a control unit model corresponding to the attached
virtio device’s subsystem device ID, accessed via a virtual I/O subchannel and a
virtual channel path of type 0x32. This proxy device is discoverable via normal
channel subsystem device discovery (usually a STORE SUBCHANNEL loop) and
answers to the basic channel commands:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 31--><p class="noindent" >NO-OPERATION (0x03)
     </li>
     <li class="itemize">
     <!--l. 32--><p class="noindent" >BASIC SENSE (0x04)
     </li>
                                                                  

                                                                  
     <li class="itemize">
     <!--l. 33--><p class="noindent" >TRANSFER IN CHANNEL (0x08)
     </li>
     <li class="itemize">
     <!--l. 34--><p class="noindent" >SENSE ID (0xe4)</li></ul>
<!--l. 37--><p class="noindent" >For a virtio-ccw proxy device, SENSE ID will return the following information:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Bytes  </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Contents              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0        </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > reserved                     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0xff                     </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >1-2 </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >control unit type </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0x3832</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 3        </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > control unit model       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <virtio device id>  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4-5     </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > device type                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > zeroes (unset)        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 6        </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > device model              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > zeroes (unset)        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 7-255  </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > extended SenseId data  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > zeroes (unset)        </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 58--><p class="noindent" >A virtio-ccw proxy device facilitates:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 60--><p class="noindent" >Discovery and attachment of virtio devices (as described above).
     </li>
     <li class="itemize">
     <!--l. 61--><p class="noindent" >Initialization   of   virtqueues   and   transport-specific   facilities   (using
     virtio-specific channel commands).
     </li>
     <li class="itemize">
     <!--l. 63--><p class="noindent" >Notifications  (via  hypercall  and  a  combination  of  I/O  interrupts  and
     indicator bits).</li></ul>
<a 
 id="x1-228001r231"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.1.1   </span> <a 
 id="x1-2290001"></a>Channel Commands for Virtio</h5>
<!--l. 70--><p class="nopar" >In addition to the basic channel commands, virtio-ccw defines a set of channel
commands related to configuration and operation of virtio:
<!--l. 74-->
<pre class="lstlisting" id="listing-66"><span class="label"><a 
 id="x1-229001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_SET_VQ</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x13</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_VDEV_RESET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x33</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_SET_IND</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x43</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_SET_CONF_IND</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x53</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_SET_IND_ADAPTER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x73</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_READ_FEAT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x12</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_WRITE_FEAT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x11</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_READ_CONF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x22</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_WRITE_CONF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x21</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_WRITE_STATUS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x31</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_READ_VQ_CONF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x32</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_SET_VIRTIO_REV</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x83</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-229013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCW_CMD_READ_STATUS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x72</span></span></pre>
<a 
 id="x1-229014r238"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.1.2   </span> <a 
 id="x1-2300002"></a>Notifications</h5>
<!--l. 93--><p class="nopar" >Available buffer notifications are realized as a hypercall. No additional setup by the
driver is needed. The operation of available buffer notifications is described in section
<a 
href="#x1-2590002">4.3.3.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Operation / Guest->Host Notification --></a>.
                                                                  

                                                                  
<!--l. 98--><p class="noindent" >Used buffer notifications are realized either as so-called classic or adapter I/O
interrupts depending on a transport level negotiation. The initialization is described
in sections <a 
href="#x1-2470001">4.3.2.6.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting Up Indicators / Setting Up Classic Queue Indicators --></a> and <a 
href="#x1-2490003">4.3.2.6.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting Up Indicators / Setting Up Two-Stage Queue Indicators --></a> respectively. The operation of each flavor is
described in sections <a 
href="#x1-2540001">4.3.3.1.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Operation / Host->Guest Notification / Notification via Classic I/O Interrupts --></a> and <a 
href="#x1-2550002">4.3.3.1.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Operation / Host->Guest Notification / Notification via Adapter I/O Interrupts --></a> respectively.
<!--l. 112--><p class="noindent" >Configuration change notifications are done using so-called classic I/O interrupts.
The initialization is described in section <a 
href="#x1-2480002">4.3.2.6.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting Up Indicators / Setting Up Configuration Change Indicators --></a> and the operation in section
<a 
href="#x1-2540001">4.3.3.1.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Operation / Host->Guest Notification / Notification via Classic I/O Interrupts --></a>.
<a 
 id="x1-230001r239"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.1.3   </span> <a 
 id="x1-2310003"></a>Device Requirements: Basic Concepts</h5>
<!--l. 122--><p class="nopar" >The virtio-ccw device acts like a normal channel device, as specified in <a 
href="#x1-3004x3">[S390 PoP]</a>
and <a 
href="#x1-3005x4">[S390 Common I/O]</a>. In particular:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 126--><p class="noindent" >A device MUST post a unit check with command reject for any command
     it does not support.
     </li>
     <li class="itemize">
     <!--l. 129--><p class="noindent" >If a driver did not suppress length checks for a channel command, the
     device MUST present a subchannel status as detailed in the architecture
     when the actual length did not match the expected length.
     </li>
     <li class="itemize">
     <!--l. 133--><p class="noindent" >If a driver did suppress length checks for a channel command, the device
     MUST present a check condition if the transmitted data does not contain
     enough data to process the command. If the driver submitted a buffer that
     was too long, the device SHOULD accept the command.</li></ul>
<a 
 id="x1-231001r240"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.1.4   </span> <a 
 id="x1-2320004"></a>Driver Requirements: Basic Concepts</h5>
<!--l. 141--><p class="nopar" >A driver for virtio-ccw devices MUST check for a control unit type of 0x3832 and
MUST ignore the device type and model.
<!--l. 144--><p class="noindent" >A driver SHOULD attempt to provide the correct length in a channel command even
if it suppresses length checks for that command.
<a 
 id="x1-232001r237"></a>
<h4 class="subsectionHead"><span class="titlemark">4.3.2   </span> <a 
 id="x1-2330002"></a>Device Initialization</h4>
<!--l. 149--><p class="nopar" >virtio-ccw uses several channel commands to set up a device.
<a 
 id="x1-233001r241"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">4.3.2.1   </span> <a 
 id="x1-2340001"></a>Setting the Virtio Revision</h5>
<!--l. 153--><p class="nopar" >CCW_CMD_SET_VIRTIO_REV is issued by the driver to set the revision of the
virtio-ccw transport it intends to drive the device with. It uses the following
communication structure:
<!--l. 157-->
<pre class="lstlisting" id="listing-67"><span class="label"><a 
 id="x1-234001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_rev_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-234002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">revision</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-234003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-234004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-234005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 165--><p class="noindent" ><span 
class="aeti-10">revision </span>contains the desired revision id, <span 
class="aeti-10">length </span>the length of the data portion and
<span 
class="aeti-10">data </span>revision-dependent additional desired options.
<!--l. 168--><p class="noindent" >The following values are supported:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">revision  </span></td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">length  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">data        </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > remarks                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0           </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <empty>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > legacy interface; transitional devices only  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1           </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <empty>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Virtio 1                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 2           </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <empty>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > CCW_CMD_READ_STATUS support      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 3-n        </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > reserved for later revisions                     </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 184--><p class="noindent" >Note that a change in the virtio standard does not necessarily correspond to a change
in the virtio-ccw revision.
<a 
 id="x1-234006r232"></a>
<!--l. 187--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.1.1</span> <a 
 id="x1-2350001"></a>Device Requirements: Setting the Virtio Revision</h5>
A device MUST post a unit check with command reject for any <span 
class="aeti-10">revision </span>it does not
support. For any invalid combination of <span 
class="aeti-10">revision</span>, <span 
class="aeti-10">length </span>and <span 
class="aeti-10">data</span>, it MUST post a
unit check with command reject as well. A non-transitional device MUST reject
revision id 0.
<!--l. 194--><p class="noindent" >A device SHOULD answer with command reject to any virtio-ccw specific channel
command that is not contained in the revision selected by the driver.
<!--l. 198--><p class="noindent" >A device MUST answer with command reject to any attempt to select a different
revision after a revision has been successfully selected by the driver.
<!--l. 201--><p class="noindent" >A device MUST treat the revision as unset from the time the associated subchannel
has been enabled until a revision has been successfully set by the driver. This implies
that revisions are not persistent across disabling and enabling of the associated
subchannel.
<a 
 id="x1-235001r244"></a>
<!--l. 206--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.1.2</span> <a 
 id="x1-2360002"></a>Driver Requirements: Setting the Virtio Revision</h5>
A driver SHOULD start with trying to set the highest revision it supports and
continue with lower revisions if it gets a command reject.
<!--l. 211--><p class="noindent" >A driver MUST NOT issue any other virtio-ccw specific channel commands prior to
setting the revision.
                                                                  

                                                                  
<!--l. 214--><p class="noindent" >After a revision has been successfully selected by the driver, it MUST NOT attempt
to select a different revision.
<a 
 id="x1-236001r245"></a>
<!--l. 217--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.1.3</span> <a 
 id="x1-2370003"></a>Legacy Interfaces: A Note on Setting the Virtio Revision</h5>
A legacy device will not support the CCW_CMD_SET_VIRTIO_REV and answer
with a command reject. A non-transitional driver MUST stop trying to operate this
device in that case. A transitional driver MUST operate the device as if it had been
able to set revision 0.
<!--l. 224--><p class="noindent" >A legacy driver will not issue the CCW_CMD_SET_VIRTIO_REV prior
to issuing other virtio-ccw specific channel commands. A non-transitional
device therefore MUST answer any such attempts with a command reject. A
transitional device MUST assume in this case that the driver is a legacy driver and
continue as if the driver selected revision 0. This implies that the device
MUST reject any command not valid for revision 0, including a subsequent
CCW_CMD_SET_VIRTIO_REV.
<a 
 id="x1-237001r243"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.2.2   </span> <a 
 id="x1-2380002"></a>Configuring a Virtqueue</h5>
<!--l. 234--><p class="nopar" >CCW_CMD_READ_VQ_CONF is issued by the driver to obtain information about a
queue. It uses the following structure for communicating:
<!--l. 237-->
<pre class="lstlisting" id="listing-68"><span class="label"><a 
 id="x1-238001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_config_block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_queue_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">previously</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">known</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_num</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 244--><p class="noindent" >The requested number of buffers for queue <span 
class="aeti-10">index </span>is returned in <span 
class="aeti-10">max_queue_size</span>.
<!--l. 247--><p class="noindent" >Afterwards, CCW_CMD_SET_VQ is issued by the driver to inform the device about
the location used for its queue. The transmitted structure is
<!--l. 251-->
<pre class="lstlisting" id="listing-69"><span class="label"><a 
 id="x1-238005r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_info_block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238006r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238007r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">res0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238008r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238009r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">previously</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">known</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238010r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238011r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-238012r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 262--><p class="noindent" ><span 
class="aeti-10">desc</span>, <span 
class="aeti-10">driver </span>and <span 
class="aeti-10">device </span>contain the guest addresses for the descriptor area, available
area and used area for queue <span 
class="aeti-10">index</span>, respectively. The actual virtqueue size (number
of allocated buffers) is transmitted in <span 
class="aeti-10">size</span>.
<a 
 id="x1-238013r246"></a>
<!--l. 267--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.2.1</span> <a 
 id="x1-2390001"></a>Device Requirements: Configuring a Virtqueue</h5>
<span 
class="aeti-10">res0 </span>is reserved and MUST be ignored by the device.
<a 
 id="x1-239001r248"></a>
                                                                  

                                                                  
<!--l. 271--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.2.2</span> <a 
 id="x1-2400002"></a>Legacy Interface: A Note on Configuring a Virtqueue</h5>
For a legacy driver or for a driver that selected revision 0, CCW_CMD_SET_VQ uses
the following communication block:
<!--l. 276-->
<pre class="lstlisting" id="listing-70"><span class="label"><a 
 id="x1-240001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_info_block_legacy</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-240002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">queue</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-240003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">align</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-240004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-240005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">previously</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">known</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-240006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 285--><p class="noindent" ><span 
class="aeti-10">queue </span>contains the guest address for queue <span 
class="aeti-10">index</span>, <span 
class="aeti-10">size </span>the number of buffers and
<span 
class="aeti-10">align </span>the alignment. The queue layout follows <a 
href="#x1-370002">2.7.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Layout --></a> <a 
href="#x1-370002">Legacy Interfaces: A Note on
Virtqueue Layout<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Layout --></a>.
<a 
 id="x1-240007r247"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.2.3   </span> <a 
 id="x1-2410003"></a>Communicating Status Information</h5>
<!--l. 291--><p class="nopar" >The driver changes the status of a device via the CCW_CMD_WRITE_STATUS
command, which transmits an 8 bit status value.
<!--l. 295--><p class="noindent" >As described in <a 
href="#x1-160002">2.2.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Feature Bits --></a>, a device sometimes fails to set the <span 
class="aeti-10">device status </span>field: For
example, it might fail to accept the FEATURES_OK status bit during device
initialization.
<!--l. 300--><p class="noindent" >With revision 2, CCW_CMD_READ_STATUS is defined: It reads an 8 bit status value
from the device and acts as a reverse operation to CCW_CMD_WRITE_STATUS.
<a 
 id="x1-241001r249"></a>
<!--l. 303--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.3.1</span> <a 
 id="x1-2420001"></a>Driver Requirements: Communicating Status Information</h5>
If the device posts a unit check with command reject in response to the
CCW_CMD_WRITE_STATUS command, the driver MUST assume that the
device failed to set the status and the <span 
class="aeti-10">device status </span>field retained its previous
value.
<!--l. 310--><p class="noindent" >If at least revision 2 has been negotiated, the driver SHOULD use the
CCW_CMD_READ_STATUS command to retrieve the <span 
class="aeti-10">device status </span>field after a
configuration change has been detected.
<!--l. 314--><p class="noindent" >If not at least revision 2 has been negotiated, the driver MUST NOT attempt to issue
the CCW_CMD_READ_STATUS command.
<a 
 id="x1-242001r251"></a>
<!--l. 317--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.3.2</span> <a 
 id="x1-2430002"></a>Device Requirements: Communicating Status Information</h5>
If the device fails to set the <span 
class="aeti-10">device status </span>field to the value written by the driver, the
device MUST assure that the <span 
class="aeti-10">device status </span>field is left unchanged and MUST post a
unit check with command reject.
<!--l. 324--><p class="noindent" >If at least revision 2 has been negotiated, the device MUST return the current <span 
class="aeti-10">device</span>
<span 
class="aeti-10">status </span>field if the CCW_CMD_READ_STATUS command is issued.
                                                                  

                                                                  
<a 
 id="x1-243001r250"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.2.4   </span> <a 
 id="x1-2440004"></a>Handling Device Features</h5>
<!--l. 330--><p class="nopar" >Feature bits are arranged in an array of 32 bit values, making for a total of 8192
feature bits. Feature bits are in little-endian byte order.
<!--l. 334--><p class="noindent" >The CCW commands dealing with features use the following communication
block:
<!--l. 337-->
<pre class="lstlisting" id="listing-71"><span class="label"><a 
 id="x1-244001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_feature_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-244002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">features</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-244003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-244004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 344--><p class="noindent" ><span 
class="aeti-10">features </span>are the 32 bits of features currently accessed, while <span 
class="aeti-10">index </span>describes which of
the feature bit values is to be accessed. No padding is added at the end of the
structure, it is exactly 5 bytes in length.
<!--l. 349--><p class="noindent" >The guest obtains the device’s device feature set via the CCW_CMD_READ_FEAT
command. The device stores the features at <span 
class="aeti-10">index </span>to <span 
class="aeti-10">features</span>.
<!--l. 353--><p class="noindent" >For communicating its supported features to the device, the driver uses the
CCW_CMD_WRITE_FEAT command, denoting a <span 
class="aeti-10">features</span>/<span 
class="aeti-10">index </span>combination.
<a 
 id="x1-244005r253"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.2.5   </span> <a 
 id="x1-2450005"></a>Device Configuration</h5>
<!--l. 359--><p class="nopar" >The device’s configuration space is located in host memory.
<!--l. 361--><p class="noindent" >To obtain information from the configuration space, the driver uses
CCW_CMD_READ_CONF, specifying the guest memory for the device to write
to.
<!--l. 365--><p class="noindent" >For changing configuration information, the driver uses CCW_CMD_WRITE_CONF,
specifying the guest memory for the device to read from.
<!--l. 369--><p class="noindent" >In both cases, the complete configuration space is transmitted. This allows the driver
to compare the new configuration space with the old version, and keep a generation
count internally whenever it changes.
<a 
 id="x1-245001r254"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.2.6   </span> <a 
 id="x1-2460006"></a>Setting Up Indicators</h5>
<!--l. 375--><p class="nopar" >In order to set up the indicator bits for host->guest notification, the driver
uses different channel commands depending on whether it wishes to use
traditional I/O interrupts tied to a subchannel or adapter I/O interrupts for
virtqueue notifications. For any given device, the two mechanisms are mutually
exclusive.
<!--l. 381--><p class="noindent" >For the configuration change indicators, only a mechanism using traditional I/O
interrupts is provided, regardless of whether traditional or adapter I/O interrupts are
used for virtqueue notifications.
                                                                  

                                                                  
<a 
 id="x1-246001r252"></a>
<!--l. 386--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.6.1</span> <a 
 id="x1-2470001"></a>Setting Up Classic Queue Indicators</h5>
Indicators for notification via classic I/O interrupts are contained in a 64 bit value
per virtio-ccw proxy device.
<!--l. 391--><p class="noindent" >To communicate the location of the indicator bits for host->guest notification, the
driver uses the CCW_CMD_SET_IND command, pointing to a location containing
the guest address of the indicators in a 64 bit value.
<!--l. 396--><p class="noindent" >If the driver has already set up two-staged queue indicators via the
CCW_CMD_SET_IND_ADAPTER command, the device MUST post a unit check
with command reject to any subsequent CCW_CMD_SET_IND command.
<a 
 id="x1-247001r256"></a>
<!--l. 400--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.6.2</span> <a 
 id="x1-2480002"></a>Setting Up Configuration Change Indicators</h5>
Indicators for configuration change host->guest notification are contained in a 64 bit
value per virtio-ccw proxy device.
<!--l. 405--><p class="noindent" >To communicate the location of the indicator bits used in the configuration change
host->guest notification, the driver issues the CCW_CMD_SET_CONF_IND
command, pointing to a location containing the guest address of the indicators in a
64 bit value.
<a 
 id="x1-248001r257"></a>
<!--l. 410--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.6.3</span> <a 
 id="x1-2490003"></a>Setting Up Two-Stage Queue Indicators</h5>
Indicators for notification via adapter I/O interrupts consist of two stages:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 415--><p class="noindent" >a  summary  indicator  byte  covering  the  virtqueues  for  one  or  more
     virtio-ccw proxy devices
     </li>
     <li class="itemize">
     <!--l. 417--><p class="noindent" >a set of contiguous indicator bits for the virtqueues for a virtio-ccw proxy
     device</li></ul>
<!--l. 421--><p class="noindent" >To communicate the location of the summary and queue indicator bits, the driver
uses the CCW_CMD_SET_IND_ADAPTER command with the following
payload:
<!--l. 425-->
<pre class="lstlisting" id="listing-72"><span class="label"><a 
 id="x1-249001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_thinint_area</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-249002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">summary_indicator</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-249003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indicator</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-249004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bit_nr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-249005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">isc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-249006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">__attribute__</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">((</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">packed</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
<!--l. 434--><p class="noindent" ><span 
class="aeti-10">summary_indicator </span>contains the guest address of the 8 bit summary indicator.
                                                                  

                                                                  
<span 
class="aeti-10">indicator </span>contains the guest address of an area wherein the indicators for the devices
are contained, starting at <span 
class="aeti-10">bit_nr</span>, one bit per virtqueue of the device. Bit numbers
start at the left, i.e. the most significant bit in the first byte is assigned the bit
number 0. <span 
class="aeti-10">isc </span>contains the I/O interruption subclass to be used for the adapter I/O
interrupt. It MAY be different from the isc used by the proxy virtio-ccw device’s
subchannel. No padding is added at the end of the structure, it is exactly 25 bytes in
length.
<a 
 id="x1-249007r208"></a>
<!--l. 447--><p class="nopar" ><h6 class="subparagraphHead"><span class="titlemark">4.3.2.6.3.1</span> <a 
 id="x1-2500001"></a>Device Requirements: Setting Up Two-Stage Queue Indicators</h6>
If the driver has already set up classic queue indicators via the CCW_CMD_SET_IND
command, the device MUST post a unit check with command reject to any
subsequent CCW_CMD_SET_IND_ADAPTER command.
<a 
 id="x1-250001r258"></a>
<!--l. 452--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.2.6.4</span> <a 
 id="x1-2510004"></a>Legacy Interfaces: A Note on Setting Up Indicators</h5>
In some cases, legacy devices will only support classic queue indicators; in that case,
they will reject CCW_CMD_SET_IND_ADAPTER as they don’t know that
command. Some legacy devices will support two-stage queue indicators, though, and
a driver will be able to successfully use CCW_CMD_SET_IND_ADAPTER to set
them up.
<a 
 id="x1-251001r242"></a>
<h4 class="subsectionHead"><span class="titlemark">4.3.3   </span> <a 
 id="x1-2520003"></a>Device Operation</h4>
<a 
 id="x1-252001r255"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.3.1   </span> <a 
 id="x1-2530001"></a>Host->Guest Notification</h5>
<!--l. 464--><p class="nopar" >There are two modes of operation regarding host->guest notification, classic I/O
interrupts and adapter I/O interrupts. The mode to be used is determined by the driver
by using CCW_CMD_SET_IND respectively CCW_CMD_SET_IND_ADAPTER to
set up queue indicators.
<!--l. 469--><p class="noindent" >For configuration changes, the driver always uses classic I/O interrupts.
<a 
 id="x1-253001r260"></a>
<!--l. 472--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.3.1.1</span> <a 
 id="x1-2540001"></a>Notification via Classic I/O Interrupts</h5>
If the driver used the CCW_CMD_SET_IND command to set up queue indicators,
the device will use classic I/O interrupts for host->guest notification about virtqueue
activity.
<!--l. 478--><p class="noindent" >For notifying the driver of virtqueue buffers, the device sets the corresponding bit in
the guest-provided indicators. If an interrupt is not already pending for the
subchannel, the device generates an unsolicited I/O interrupt.
<!--l. 483--><p class="noindent" >If the device wants to notify the driver about configuration changes, it sets bit 0
in the configuration indicators and generates an unsolicited I/O interrupt,
                                                                  

                                                                  
if needed. This also applies if adapter I/O interrupts are used for queue
notifications.
<a 
 id="x1-254001r263"></a>
<!--l. 488--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.3.1.2</span> <a 
 id="x1-2550002"></a>Notification via Adapter I/O Interrupts</h5>
If the driver used the CCW_CMD_SET_IND_ADAPTER command to set up queue
indicators, the device will use adapter I/O interrupts for host->guest notification
about virtqueue activity.
<!--l. 494--><p class="noindent" >For notifying the driver of virtqueue buffers, the device sets the bit in the
guest-provided indicator area at the corresponding offset. The guest-provided
summary indicator is set to 0x01. An adapter I/O interrupt for the corresponding
interruption subclass is generated.
<!--l. 499--><p class="noindent" >The recommended way to process an adapter I/O interrupt by the driver is as
follows:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 503--><p class="noindent" >Process all queue indicator bits associated with the summary indicator.
     </li>
     <li class="itemize">
     <!--l. 504--><p class="noindent" >Clear  the  summary  indicator,  performing  a  synchronization  (memory
     barrier) afterwards.
     </li>
     <li class="itemize">
     <!--l. 506--><p class="noindent" >Process all queue indicator bits associated with the summary indicator
     again.</li></ul>
<a 
 id="x1-255001r259"></a>
<!--l. 510--><p class="nopar" ><h6 class="subparagraphHead"><span class="titlemark">4.3.3.1.2.1</span> <a 
 id="x1-2560001"></a>Device Requirements: Notification via Adapter I/O Interrupts</h6>
The device SHOULD only generate an adapter I/O interrupt if the summary
indicator had not been set prior to notification.
<a 
 id="x1-256001r265"></a>
<!--l. 515--><p class="nopar" ><h6 class="subparagraphHead"><span class="titlemark">4.3.3.1.2.2</span> <a 
 id="x1-2570002"></a>Driver Requirements: Notification via Adapter I/O Interrupts</h6>
The driver MUST clear the summary indicator after receiving an adapter I/O
interrupt before it processes the queue indicators.
<a 
 id="x1-257001r264"></a>
<!--l. 520--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.3.1.3</span> <a 
 id="x1-2580003"></a>Legacy Interfaces: A Note on Host->Guest Notification</h5>
As legacy devices and drivers support only classic queue indicators, host->guest
notification will always be done via classic I/O interrupts.
                                                                  

                                                                  
<a 
 id="x1-258001r262"></a>
<h5 class="subsubsectionHead"><span class="titlemark">4.3.3.2   </span> <a 
 id="x1-2590002"></a>Guest->Host Notification</h5>
<!--l. 527--><p class="nopar" >For notifying the device of virtqueue buffers, the driver unfortunately can’t use a
channel command (the asynchronous characteristics of channel I/O interact badly
with the host block I/O backend). Instead, it uses a diagnose 0x500 call with subcode
3 specifying the queue, as follows:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > GPR  </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Input Value        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Output Value  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1       </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x3                   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >              </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >2 </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Subchannel ID </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Host Cookie</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 3       </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Notification data  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4       </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Host Cookie        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >              </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 547--><p class="noindent" >When VIRTIO_F_NOTIFICATION_DATA has not been negotiated, the <span 
class="aeti-10">Notification</span>
<span 
class="aeti-10">data </span>contains the virtqueue index.
<!--l. 550--><p class="noindent" >When VIRTIO_F_NOTIFICATION_DATA has been negotiated, the value has the
following format: <!--l. 552--><pre class="lstinputlisting">
<a 
 id="x1-259001"></a>
<span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-259002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-259003r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">previously</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">known</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vqn</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-259004r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_off</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-259005r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next_wrap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-259006r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span>
</pre>
<!--l. 554--><p class="noindent" >See <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> <a 
href="#x1-1010009">Driver Notifications<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> for the definition of the components.
<a 
 id="x1-259007r267"></a>
<!--l. 557--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.3.2.1</span> <a 
 id="x1-2600001"></a>Device Requirements: Guest->Host Notification</h5>
The device MUST ignore bits 0-31 (counting from the left) of GPR2. This aligns
passing the subchannel ID with the way it is passed for the existing I/O
instructions.
<!--l. 562--><p class="noindent" >The device MAY return a 64-bit host cookie in GPR2 to speed up the notification
execution.
<a 
 id="x1-260001r270"></a>
<!--l. 565--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.3.2.2</span> <a 
 id="x1-2610002"></a>Driver Requirements: Guest->Host Notification</h5>
For each notification, the driver SHOULD use GPR4 to pass the host cookie received
in GPR2 from the previous notification.
<span 
class="aeb10-">Note:</span> For example: <!--l. 571-->
      <pre class="lstlisting" id="listing-73"><span class="label"><a 
 id="x1-261001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">info</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cookie</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">do_notify</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">schid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-261002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtqueue_get_queue_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-261003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">info</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cookie</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
      
<a 
 id="x1-261004r268"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">4.3.3.3   </span> <a 
 id="x1-2620003"></a>Resetting Devices</h5>
<!--l. 580--><p class="nopar" >In order to reset a device, a driver sends the CCW_CMD_VDEV_RESET command.
This command does not carry any payload.
<!--l. 583--><p class="noindent" >The device signals completion of the virtio reset operation through successful
conclusion of the CCW_CMD_VDEV_RESET channel command. In particular, the
command not only triggers the reset operation, but the reset operation is already
completed when the operation concludes successfully.
<a 
 id="x1-262001r271"></a>
<!--l. 588--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.3.3.1</span> <a 
 id="x1-2630001"></a>Device Requirements: Resetting Devices</h5>
The device MUST finish the virtio reset operation and reinitialize <span 
class="aeti-10">device</span>
<span 
class="aeti-10">status </span>to zero before it concludes the CCW_CMD_VDEV_RESET command
successfully.
<!--l. 594--><p class="noindent" >The device MUST NOT send notifications or interact with the queues after it
signaled successful conclusion of the CCW_CMD_VDEV_RESET command.
<a 
 id="x1-263001r273"></a>
<!--l. 597--><p class="nopar" ><h5 class="paragraphHead"><span class="titlemark">4.3.3.3.2</span> <a 
 id="x1-2640002"></a>Driver Requirements: Resetting Devices</h5>
The driver MAY consider the virtio reset operation to be complete already after
successful conclusion of the CCW_CMD_VDEV_RESET channel command, although
it MAY also choose to verify reset completion by reading <span 
class="aeti-10">device status </span>via
CCW_CMD_READ_STATUS and checking whether it is 0 afterwards.
<a 
 id="x1-264001r261"></a>
<h4 class="subsectionHead"><span class="titlemark">4.3.4   </span> <a 
 id="x1-2650004"></a>Features reserved for future use</h4>
<!--l. 606--><p class="nopar" >Devices and drivers utilizing Virtio over channel I/O do not support the following
features:
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 610--><p class="noindent" >VIRTIO_F_ADMIN_VQ
     </li>
     <li class="itemize">
     <!--l. 611--><p class="noindent" >VIRTIO_F_RING_RESET
     </li>
     <li class="itemize">
     <!--l. 612--><p class="noindent" >Shared memory regions including VIRTIO_PMEM_F_SHMEM_REGION
     </li></ul>
<!--l. 616--><p class="noindent" >These features are reserved for future use.
                                                                  

                                                                  
<!--l. 642--><p class="nopar" ><h2 class="chapterHead"><hr><span class="titlemark">5</span> <a 
 id="x1-2660005"></a>Device Types</h2>
On top of the queues, config space and feature negotiation facilities built into virtio,
several devices are defined.
<!--l. 647--><p class="noindent" >The following device IDs are used to identify different types of virtio devices. Some
device IDs are reserved for devices which are not currently defined in this
standard.
<!--l. 651--><p class="noindent" >Discovering what devices are available and their type is bus-dependent.
<a 
 id="x1-266001r1"></a><!--l. 655--><div class="longtable"> <table id="TBL-41" class="longtable" 
 
><colgroup id="TBL-41-1g"><col 
id="TBL-41-1"></colgroup><colgroup id="TBL-41-2g"><col 
id="TBL-41-2"></colgroup>
<tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-1-1"  
class="td11"> Device ID  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-1-2"  
class="td11">            Virtio Device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-2-1"  
class="td11"> 0             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-2-2"  
class="td11">          reserved (invalid)                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-3-1"  
class="td11"> 1             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-3-2"  
class="td11">           network device                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-4-1"  
class="td11"> 2             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-4-2"  
class="td11">            block device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-5-1"  
class="td11"> 3             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-5-2"  
class="td11">              console                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-6-1"  
class="td11"> 4             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-6-2"  
class="td11">           entropy source                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-7-1"  
class="td11"> 5             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-7-2"  
class="td11">     memory ballooning (traditional)         </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-8-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-8-1"  
class="td11"> 6             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-8-2"  
class="td11">             ioMemory                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-9-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-9-1"  
class="td11"> 7             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-9-2"  
class="td11">               rpmsg                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-10-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-10-1"  
class="td11"> 8             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-10-2"  
class="td11">             SCSI host                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-11-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-11-1"  
class="td11"> 9             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-11-2"  
class="td11">            9P transport                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-12-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-12-1"  
class="td11"> 10            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-12-2"  
class="td11">           mac80211 wlan                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-13-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-13-1"  
class="td11"> 11            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-13-2"  
class="td11">             rproc serial                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-14-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-14-1"  
class="td11"> 12            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-14-2"  
class="td11">            virtio CAIF                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-15-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-15-1"  
class="td11"> 13            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-15-2"  
class="td11">           memory balloon                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-16-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-16-1"  
class="td11"> 16            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-16-2"  
class="td11">            GPU device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-17-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-17-1"  
class="td11"> 17            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-17-2"  
class="td11">          Timer/Clock device                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-18-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-18-1"  
class="td11"> 18            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-18-2"  
class="td11">            Input device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-19-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-19-1"  
class="td11"> 19            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-19-2"  
class="td11">            Socket device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-20-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-20-1"  
class="td11"> 20            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-20-2"  
class="td11">            Crypto device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-21-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-21-1"  
class="td11"> 21            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-21-2"  
class="td11">       Signal Distribution Module            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-22-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-22-1"  
class="td11"> 22            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-22-2"  
class="td11">            pstore device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-23-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-23-1"  
class="td11"> 23            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-23-2"  
class="td11">           IOMMU device                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-24-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-24-1"  
class="td11"> 24            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-24-2"  
class="td11">           Memory device                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-25-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-25-1"  
class="td11"> 25            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-25-2"  
class="td11">            Sound device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-26-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-26-1"  
class="td11"> 26            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-26-2"  
class="td11">          file system device                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-27-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-27-1"  
class="td11"> 27            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-27-2"  
class="td11">            PMEM device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-28-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-28-1"  
class="td11"> 28            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-28-2"  
class="td11">            RPMB device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-29-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-29-1"  
class="td11"> 29            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-29-2"  
class="td11"> mac80211 hwsim wireless simulation device  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-30-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-30-1"  
class="td11"> 30            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-30-2"  
class="td11">         Video encoder device                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-31-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-31-1"  
class="td11"> 31            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-31-2"  
class="td11">         Video decoder device                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-32-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-32-1"  
class="td11"> 32            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-32-2"  
class="td11">            SCMI device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-33-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-33-1"  
class="td11"> 33            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-33-2"  
class="td11">          NitroSecureModule                  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-34-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-34-1"  
class="td11"> 34            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-34-2"  
class="td11">            I2C adapter                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-35-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-35-1"  
class="td11"> 35            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-35-2"  
class="td11">             Watchdog                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-36-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-36-1"  
class="td11"> 36            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-36-2"  
class="td11">            CAN device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-37-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-37-1"  
class="td11"> 38            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-37-2"  
class="td11">          Parameter Server                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-38-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-38-1"  
class="td11"> 39            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-38-2"  
class="td11">          Audio policy device                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-39-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-39-1"  
class="td11"> 40            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-39-2"  
class="td11">           Bluetooth device                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-40-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-40-1"  
class="td11"> 41            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-40-2"  
class="td11">            GPIO device                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-41-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-41-1"  
class="td11"> 42            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-41-2"  
class="td11">            RDMA device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-42-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-42-1"  
class="td11"> 43            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-42-2"  
class="td11">           Camera device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-43-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-43-1"  
class="td11"> 44            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-43-2"  
class="td11">             ISM device                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-44-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-44-1"  
class="td11"> 45            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-44-2"  
class="td11">            SPI controller                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-45-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-45-1"  
class="td11"> 46            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-45-2"  
class="td11">             TEE device                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-46-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-46-1"  
class="td11"> 47            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-46-2"  
class="td11">          CPU balloon device                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-41-47-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-47-1"  
class="td11">         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-41-48-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-48-1"  
class="td11">         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-41-49-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-49-1"  
class="td11">         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-41-50-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-50-1"  
class="td11">         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-41-51-"><td  style="white-space:nowrap; text-align:left;" id="TBL-41-51-1"  
class="td11">           </td><td  style="white-space:nowrap; text-align:center;" id="TBL-41-51-2"  
class="td11">
</td></tr>
</table></div>
                                                                  

                                                                  
<!--l. 749--><p class="noindent" >Some of the devices above are unspecified by this document, because they are seen as
immature or especially niche. Be warned that some are only specified by the sole
existing implementation; they could become part of a future specification, be
abandoned entirely, or live on outside this standard. We shall speak of them no
further.
<a 
 id="x1-266002r236"></a>
<h3 class="sectionHead"><span class="titlemark">5.1   </span> <a 
 id="x1-2670001"></a>Network Device</h3>
<!--l. 3--><p class="noindent" >The virtio network device is a virtual network interface controller. It consists of a
virtual Ethernet link which connects the device to the Ethernet network. The device
has transmit and receive queues. The driver adds empty buffers to the receive
virtqueue. The device receives incoming packets from the link; the device places these
incoming packets in the receive virtqueue buffers. The driver adds outgoing packets
to the transmit virtqueue. The device removes these packets from the transmit
virtqueue and sends them to the link. The device may have a control virtqueue. The
driver uses the control virtqueue to dynamically manipulate various features of the
initialized device.
<a 
 id="x1-267001r275"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.1   </span> <a 
 id="x1-2680001"></a>Device ID</h4>
<!--l. 17--><p class="noindent" >1
<a 
 id="x1-268001r278"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.2   </span> <a 
 id="x1-2690002"></a>Virtqueues</h4>
     <dl class="description"><dt class="description">
     <!--l. 22--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
     <!--l. 22--><p class="noindent" >receiveq1
     </dd><dt class="description">
     <!--l. 23--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
     <!--l. 23--><p class="noindent" >transmitq1
     </dd><dt class="description">
     <!--l. 24--><p class="noindent" >
<span 
class="aeb10-">…</span> </dt><dd 
class="description">
     <!--l. 24--><p class="noindent" >
     </dd><dt class="description">
     <!--l. 25--><p class="noindent" >
<span 
class="aeb10-">2(N-1)</span> </dt><dd 
class="description">
                                                                  

                                                                  
     <!--l. 25--><p class="noindent" >receiveqN
     </dd><dt class="description">
     <!--l. 26--><p class="noindent" >
<span 
class="aeb10-">2(N-1)+1</span> </dt><dd 
class="description">
     <!--l. 26--><p class="noindent" >transmitqN
     </dd><dt class="description">
     <!--l. 27--><p class="noindent" >
<span 
class="aeb10-">2N</span> </dt><dd 
class="description">
     <!--l. 27--><p class="noindent" >controlq</dd></dl>
<!--l. 30--><p class="noindent" >N=1 if neither VIRTIO_NET_F_MQ nor VIRTIO_NET_F_RSS are negotiated,
otherwise N is set by <span 
class="aeti-10">max_virtqueue_pairs</span>.
<!--l. 33--><p class="noindent" >controlq is optional; it only exists if VIRTIO_NET_F_CTRL_VQ is negotiated.
<a 
 id="x1-269001r279"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.3   </span> <a 
 id="x1-2700003"></a>Feature bits</h4>
     <dl class="description"><dt class="description">
     <!--l. 39--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CSUM (0)</span> </dt><dd 
class="description">
     <!--l. 39--><p class="noindent" >Device handles packets with partial checksum offload.
     </dd><dt class="description">
     <!--l. 41--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_CSUM (1)</span> </dt><dd 
class="description">
     <!--l. 41--><p class="noindent" >Driver handles packets with partial checksum.
     </dd><dt class="description">
     <!--l. 43--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_GUEST_OFFLOADS (2)</span> </dt><dd 
class="description">
     <!--l. 43--><p class="noindent" >Control channel offloads reconfiguration support.
     </dd><dt class="description">
     <!--l. 46--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_MTU(3)</span> </dt><dd 
class="description">
     <!--l. 46--><p class="noindent" >Device maximum MTU reporting is supported. If offered by the device,
     device advises driver about the value of its maximum MTU. If negotiated,
     the driver uses <span 
class="aeti-10">mtu </span>as the maximum MTU value.
     </dd><dt class="description">
                                                                  

                                                                  
     <!--l. 51--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_MAC (5)</span> </dt><dd 
class="description">
     <!--l. 51--><p class="noindent" >Device has given MAC address.
     </dd><dt class="description">
     <!--l. 53--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_TSO4 (7)</span> </dt><dd 
class="description">
     <!--l. 53--><p class="noindent" >Driver can receive TSOv4.
     </dd><dt class="description">
     <!--l. 55--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_TSO6 (8)</span> </dt><dd 
class="description">
     <!--l. 55--><p class="noindent" >Driver can receive TSOv6.
     </dd><dt class="description">
     <!--l. 57--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_ECN (9)</span> </dt><dd 
class="description">
     <!--l. 57--><p class="noindent" >Driver can receive TSO with ECN.
     </dd><dt class="description">
     <!--l. 59--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_UFO (10)</span> </dt><dd 
class="description">
     <!--l. 59--><p class="noindent" >Driver can receive UFO.
     </dd><dt class="description">
     <!--l. 61--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_TSO4 (11)</span> </dt><dd 
class="description">
     <!--l. 61--><p class="noindent" >Device can receive TSOv4.
     </dd><dt class="description">
     <!--l. 63--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_TSO6 (12)</span> </dt><dd 
class="description">
     <!--l. 63--><p class="noindent" >Device can receive TSOv6.
     </dd><dt class="description">
     <!--l. 65--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_ECN (13)</span> </dt><dd 
class="description">
     <!--l. 65--><p class="noindent" >Device can receive TSO with ECN.
     </dd><dt class="description">
     <!--l. 67--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_UFO (14)</span> </dt><dd 
class="description">
                                                                  

                                                                  
     <!--l. 67--><p class="noindent" >Device can receive UFO.
     </dd><dt class="description">
     <!--l. 69--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_MRG_RXBUF (15)</span> </dt><dd 
class="description">
     <!--l. 69--><p class="noindent" >Driver can merge receive buffers.
     </dd><dt class="description">
     <!--l. 71--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_STATUS (16)</span> </dt><dd 
class="description">
     <!--l. 71--><p class="noindent" >Configuration status field is available.
     </dd><dt class="description">
     <!--l. 74--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_VQ (17)</span> </dt><dd 
class="description">
     <!--l. 74--><p class="noindent" >Control channel is available.
     </dd><dt class="description">
     <!--l. 76--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_RX (18)</span> </dt><dd 
class="description">
     <!--l. 76--><p class="noindent" >Control channel RX mode support.
     </dd><dt class="description">
     <!--l. 78--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_VLAN (19)</span> </dt><dd 
class="description">
     <!--l. 78--><p class="noindent" >Control channel VLAN filtering.
     </dd><dt class="description">
     <!--l. 80--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_RX_EXTRA (20)</span> </dt><dd 
class="description">
     <!--l. 80--><p class="noindent" >Control channel RX extra mode support.
     </dd><dt class="description">
     <!--l. 82--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_ANNOUNCE(21)</span> </dt><dd 
class="description">
     <!--l. 82--><p class="noindent" >Driver can send gratuitous packets.
     </dd><dt class="description">
     <!--l. 85--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_MQ(22)</span> </dt><dd 
class="description">
     <!--l. 85--><p class="noindent" >Device supports multiqueue with automatic receive steering.
                                                                  

                                                                  
     </dd><dt class="description">
     <!--l. 88--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_MAC_ADDR(23)</span> </dt><dd 
class="description">
     <!--l. 88--><p class="noindent" >Set MAC address through control channel.
     </dd><dt class="description">
     <!--l. 91--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_DEVICE_STATS(50)</span> </dt><dd 
class="description">
     <!--l. 91--><p class="noindent" >Device can provide device-level statistics to the driver through the control
     virtqueue.
     </dd><dt class="description">
     <!--l. 94--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HASH_TUNNEL(51)</span> </dt><dd 
class="description">
     <!--l. 94--><p class="noindent" >Device supports inner header hash for encapsulated packets.
     </dd><dt class="description">
     <!--l. 96--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_VQ_NOTF_COAL(52)</span> </dt><dd 
class="description">
     <!--l. 96--><p class="noindent" >Device supports virtqueue notification coalescing.
     </dd><dt class="description">
     <!--l. 98--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_NOTF_COAL(53)</span> </dt><dd 
class="description">
     <!--l. 98--><p class="noindent" >Device supports notifications coalescing.
     </dd><dt class="description">
     <!--l. 100--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_USO4 (54)</span> </dt><dd 
class="description">
     <!--l. 100--><p class="noindent" >Driver can receive USOv4 packets.
     </dd><dt class="description">
     <!--l. 102--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_USO6 (55)</span> </dt><dd 
class="description">
     <!--l. 102--><p class="noindent" >Driver can receive USOv6 packets.
     </dd><dt class="description">
     <!--l. 104--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_USO (56)</span> </dt><dd 
class="description">
     <!--l. 104--><p class="noindent" >Device can receive USO packets. Unlike UFO (fragmenting the packet)
     the USO splits large UDP packet to several segments when each of these
                                                                  

                                                                  
     smaller packets has UDP header.
     </dd><dt class="description">
     <!--l. 108--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HASH_REPORT(57)</span> </dt><dd 
class="description">
     <!--l. 108--><p class="noindent" >Device can report per-packet hash value and a type of calculated hash.
     </dd><dt class="description">
     <!--l. 111--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_HDRLEN(59)</span> </dt><dd 
class="description">
     <!--l. 111--><p class="noindent" >Driver can provide the exact <span 
class="aeti-10">hdr_len </span>value. Device benefits from knowing
     the exact header length.
     </dd><dt class="description">
     <!--l. 114--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_RSS(60)</span> </dt><dd 
class="description">
     <!--l. 114--><p class="noindent" >Device supports RSS (receive-side scaling) with Toeplitz hash calculation
     and configurable hash parameters for receive steering.
     </dd><dt class="description">
     <!--l. 118--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_RSC_EXT(61)</span> </dt><dd 
class="description">
     <!--l. 118--><p class="noindent" >Device  can  process  duplicated  ACKs  and  report  number  of  coalesced
     segments and duplicated ACKs.
     </dd><dt class="description">
     <!--l. 121--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_STANDBY(62)</span> </dt><dd 
class="description">
     <!--l. 121--><p class="noindent" >Device may act as a standby for a primary device with the same MAC
     address.
     </dd><dt class="description">
     <!--l. 124--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_SPEED_DUPLEX(63)</span> </dt><dd 
class="description">
     <!--l. 124--><p class="noindent" >Device reports speed and duplex.
     </dd><dt class="description">
     <!--l. 126--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_RSS_CONTEXT(64)</span> </dt><dd 
class="description">
     <!--l. 126--><p class="noindent" >Device supports multiple RSS contexts.</dd></dl>
<a 
 id="x1-270001r272"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.1.3.1   </span> <a 
 id="x1-2710001"></a>Feature bit requirements</h5>
<!--l. 131--><p class="noindent" >Some networking feature bits require other networking feature bits (see <a 
href="#x1-150001">2.2.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Feature Bits --></a>):
     <dl class="description"><dt class="description">
     <!--l. 135--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_TSO4</span> </dt><dd 
class="description">
     <!--l. 135--><p class="noindent" >Requires VIRTIO_NET_F_GUEST_CSUM.
     </dd><dt class="description">
     <!--l. 136--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_TSO6</span> </dt><dd 
class="description">
     <!--l. 136--><p class="noindent" >Requires VIRTIO_NET_F_GUEST_CSUM.
     </dd><dt class="description">
     <!--l. 137--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_ECN</span> </dt><dd 
class="description">
     <!--l. 137--><p class="noindent" >Requires                    VIRTIO_NET_F_GUEST_TSO4                    or
     VIRTIO_NET_F_GUEST_TSO6.
     </dd><dt class="description">
     <!--l. 138--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_UFO</span> </dt><dd 
class="description">
     <!--l. 138--><p class="noindent" >Requires VIRTIO_NET_F_GUEST_CSUM.
     </dd><dt class="description">
     <!--l. 139--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_USO4</span> </dt><dd 
class="description">
     <!--l. 139--><p class="noindent" >Requires VIRTIO_NET_F_GUEST_CSUM.
     </dd><dt class="description">
     <!--l. 140--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_USO6</span> </dt><dd 
class="description">
     <!--l. 140--><p class="noindent" >Requires VIRTIO_NET_F_GUEST_CSUM.
     </dd><dt class="description">
     <!--l. 142--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_TSO4</span> </dt><dd 
class="description">
     <!--l. 142--><p class="noindent" >Requires VIRTIO_NET_F_CSUM.
     </dd><dt class="description">
                                                                  

                                                                  
     <!--l. 143--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_TSO6</span> </dt><dd 
class="description">
     <!--l. 143--><p class="noindent" >Requires VIRTIO_NET_F_CSUM.
     </dd><dt class="description">
     <!--l. 144--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_ECN</span> </dt><dd 
class="description">
     <!--l. 144--><p class="noindent" >Requires                     VIRTIO_NET_F_HOST_TSO4                     or
     VIRTIO_NET_F_HOST_TSO6.
     </dd><dt class="description">
     <!--l. 145--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_UFO</span> </dt><dd 
class="description">
     <!--l. 145--><p class="noindent" >Requires VIRTIO_NET_F_CSUM.
     </dd><dt class="description">
     <!--l. 146--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HOST_USO</span> </dt><dd 
class="description">
     <!--l. 146--><p class="noindent" >Requires VIRTIO_NET_F_CSUM.
     </dd><dt class="description">
     <!--l. 148--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_RX</span> </dt><dd 
class="description">
     <!--l. 148--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
     <!--l. 149--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_VLAN</span> </dt><dd 
class="description">
     <!--l. 149--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
     <!--l. 150--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_ANNOUNCE</span> </dt><dd 
class="description">
     <!--l. 150--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
     <!--l. 151--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_MQ</span> </dt><dd 
class="description">
     <!--l. 151--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
                                                                  

                                                                  
     <!--l. 152--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_CTRL_MAC_ADDR</span> </dt><dd 
class="description">
     <!--l. 152--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
     <!--l. 153--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_NOTF_COAL</span> </dt><dd 
class="description">
     <!--l. 153--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
     <!--l. 154--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_RSC_EXT</span> </dt><dd 
class="description">
     <!--l. 154--><p class="noindent" >Requires                     VIRTIO_NET_F_HOST_TSO4                     or
     VIRTIO_NET_F_HOST_TSO6.
     </dd><dt class="description">
     <!--l. 155--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_RSS</span> </dt><dd 
class="description">
     <!--l. 155--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
     <!--l. 156--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_VQ_NOTF_COAL</span> </dt><dd 
class="description">
     <!--l. 156--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ.
     </dd><dt class="description">
     <!--l. 157--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_HASH_TUNNEL</span> </dt><dd 
class="description">
     <!--l. 157--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ along with VIRTIO_NET_F_RSS or
     VIRTIO_NET_F_HASH_REPORT.
     </dd><dt class="description">
     <!--l. 158--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_RSS_CONTEXT</span> </dt><dd 
class="description">
     <!--l. 158--><p class="noindent" >Requires VIRTIO_NET_F_CTRL_VQ and VIRTIO_NET_F_RSS.</dd></dl>
<a 
 id="x1-271001r281"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.3.2   </span> <a 
 id="x1-2720002"></a>Legacy Interface: Feature bits</h5>
     <dl class="description"><dt class="description">
     <!--l. 163--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GSO (6)</span> </dt><dd 
class="description">
                                                                  

                                                                  
     <!--l. 163--><p class="noindent" >Device handles packets with any GSO type. This was supposed to indicate
     segmentation offload support, but upon further investigation it became
     clear that multiple bits were needed.
     </dd><dt class="description">
     <!--l. 165--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_RSC4 (41)</span> </dt><dd 
class="description">
     <!--l. 165--><p class="noindent" >Device coalesces TCPIP v4 packets. This was implemented by hypervisor
     patch for certification purposes and current Windows driver depends on
     it. It will not function if virtio-net device reports this feature.
     </dd><dt class="description">
     <!--l. 167--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_NET_F_GUEST_RSC6 (42)</span> </dt><dd 
class="description">
     <!--l. 167--><p class="noindent" >Device       coalesces       TCPIP       v6       packets.       Similar       to
     VIRTIO_NET_F_GUEST_RSC4.</dd></dl>
<a 
 id="x1-272001r280"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.4   </span> <a 
 id="x1-2730004"></a>Device configuration layout</h4>
<!--l. 173--><p class="noindent" >The network device has the following device configuration layout. All of the device
configuration fields are read-only for the driver.
<!--l. 176-->
<pre class="lstlisting" id="listing-74"><span class="label"><a 
 id="x1-273001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mac</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_virtqueue_pairs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mtu</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">speed</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">duplex</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss_max_key_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss_max_indirection_table_length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported_hash_types</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported_tunnel_types</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 191--><p class="noindent" >The <span 
class="aeti-10">mac </span>address field always exists (although it is only valid if VIRTIO_NET_F_MAC is
set).
<!--l. 194--><p class="noindent" >The <span 
class="aeti-10">status </span>only exists if VIRTIO_NET_F_STATUS is set. Two bits are currently defined
for the status field: VIRTIO_NET_S_LINK_UP and VIRTIO_NET_S_ANNOUNCE.
<!--l. 198-->
<pre class="lstlisting" id="listing-75"><span class="label"><a 
 id="x1-273013r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_S_LINK_UP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-273014r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_S_ANNOUNCE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<!--l. 203--><p class="noindent" >The following field, <span 
class="aeti-10">max_virtqueue_pairs </span>only exists if VIRTIO_NET_F_MQ or
VIRTIO_NET_F_RSS is set. This field specifies the maximum number of each of
transmit and receive virtqueues (receiveq1…receiveqN and transmitq1…transmitqN
respectively) that can be configured once at least one of these features is
negotiated.
<!--l. 209--><p class="noindent" >The following field, <span 
class="aeti-10">mtu </span>only exists if VIRTIO_NET_F_MTU is set. This field
specifies the maximum MTU for the driver to use.
<!--l. 213--><p class="noindent" >The following two fields, <span 
class="aeti-10">speed </span>and <span 
class="aeti-10">duplex</span>, only exist if VIRTIO_NET_F_SPEED_DUPLEX
is set.
                                                                  

                                                                  
<!--l. 216--><p class="noindent" ><span 
class="aeti-10">speed </span>contains the device speed, in units of 1 MBit per second, 0 to 0x7fffffff, or
0xffffffff for unknown speed.
<!--l. 219--><p class="noindent" ><span 
class="aeti-10">duplex </span>has the values of 0x01 for full duplex, 0x00 for half duplex and 0xff for
unknown duplex state.
<!--l. 222--><p class="noindent" >Both <span 
class="aeti-10">speed </span>and <span 
class="aeti-10">duplex </span>can change, thus the driver is expected to re-read these values
after receiving a configuration change notification.
<!--l. 226--><p class="noindent" >The following field, <span 
class="aeti-10">rss_max_key_size </span>only exists if VIRTIO_NET_F_RSS or
VIRTIO_NET_F_HASH_REPORT is set. It specifies the maximum supported length
of RSS key in bytes.
<!--l. 229--><p class="noindent" >The following field, <span 
class="aeti-10">rss_max_indirection_table_length </span>only exists if VIRTIO_NET_F_RSS
is set. It specifies the maximum number of 16-bit entries in RSS indirection
table.
<!--l. 232--><p class="noindent" >The next field, <span 
class="aeti-10">supported_hash_types </span>only exists if the device supports hash
calculation, i.e. if VIRTIO_NET_F_RSS or VIRTIO_NET_F_HASH_REPORT is
set.
<!--l. 235--><p class="noindent" >Field <span 
class="aeti-10">supported_hash_types </span>contains the bitmask of supported hash types. See
<a 
href="#x1-2930001">5.1.8.4.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets / Supported/enabled hash types --></a> for details of supported hash types.
<!--l. 238--><p class="noindent" >Field <span 
class="aeti-10">supported_tunnel_types </span>only exists if the device supports inner header hash, i.e.
if VIRTIO_NET_F_HASH_TUNNEL is set.
<!--l. 240--><p class="noindent" >Field <span 
class="aeti-10">supported_tunnel_types </span>contains the bitmask of encapsulation types
supported by the device for inner header hash. Encapsulation types are defined in
<a 
href="#x1-2990002">5.1.8.4.4.2<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets / Encapsulation types supported/enabled for inner header hash --></a>.
<a 
 id="x1-273015r282"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.4.1   </span> <a 
 id="x1-2740001"></a>Device Requirements: Device configuration layout</h5>
<!--l. 246--><p class="noindent" >The device MUST set <span 
class="aeti-10">max_virtqueue_pairs </span>to between 1 and 0x8000 inclusive, if it
offers VIRTIO_NET_F_MQ.
<!--l. 249--><p class="noindent" >The device MUST set <span 
class="aeti-10">mtu </span>to between 68 and 65535 inclusive, if it offers
VIRTIO_NET_F_MTU.
<!--l. 252--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">mtu </span>to at least 1280, if it offers VIRTIO_NET_F_MTU.
<!--l. 255--><p class="noindent" >The device MUST NOT modify <span 
class="aeti-10">mtu </span>once it has been set.
<!--l. 257--><p class="noindent" >The device MUST NOT pass received packets that exceed <span 
class="aeti-10">mtu </span>(plus low level ethernet
header length) size with <span 
class="aeti-10">gso_type </span>NONE or ECN after VIRTIO_NET_F_MTU has
been successfully negotiated.
<!--l. 261--><p class="noindent" >The device MUST forward transmitted packets of up to <span 
class="aeti-10">mtu </span>(plus low level ethernet
header length) size with <span 
class="aeti-10">gso_type </span>NONE or ECN, and do so without fragmentation,
after VIRTIO_NET_F_MTU has been successfully negotiated.
                                                                  

                                                                  
<!--l. 266--><p class="noindent" >The device MUST set <span 
class="aeti-10">rss_max_key_size </span>to at least 40, if it offers VIRTIO_NET_F_RSS
or VIRTIO_NET_F_HASH_REPORT.
<!--l. 269--><p class="noindent" >The device MUST set <span 
class="aeti-10">rss_max_indirection_table_length </span>to at least 128, if it offers
VIRTIO_NET_F_RSS.
<!--l. 272--><p class="noindent" >If the driver negotiates the VIRTIO_NET_F_STANDBY feature, the device
MAY act as a standby device for a primary device with the same MAC
address.
<!--l. 275--><p class="noindent" >If VIRTIO_NET_F_SPEED_DUPLEX has been negotiated, <span 
class="aeti-10">speed </span>MUST contain the
device speed, in units of 1 MBit per second, 0 to 0x7ffffffff, or 0xfffffffff for
unknown.
<!--l. 279--><p class="noindent" >If VIRTIO_NET_F_SPEED_DUPLEX has been negotiated, <span 
class="aeti-10">duplex </span>MUST have the
values of 0x00 for full duplex, 0x01 for half duplex, or 0xff for unknown.
<!--l. 283--><p class="noindent" >If VIRTIO_NET_F_SPEED_DUPLEX and VIRTIO_NET_F_STATUS have both been
negotiated, the device SHOULD NOT change the <span 
class="aeti-10">speed </span>and <span 
class="aeti-10">duplex </span>fields as long as
VIRTIO_NET_S_LINK_UP is set in the <span 
class="aeti-10">status</span>.
<!--l. 288--><p class="noindent" >The device SHOULD NOT offer VIRTIO_NET_F_HASH_REPORT if it does not
offer VIRTIO_NET_F_CTRL_VQ.
<!--l. 291--><p class="noindent" >The device SHOULD NOT offer VIRTIO_NET_F_CTRL_RX_EXTRA if it does not
offer VIRTIO_NET_F_CTRL_VQ.
<a 
 id="x1-274001r284"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.4.2   </span> <a 
 id="x1-2750002"></a>Driver Requirements: Device configuration layout</h5>
<!--l. 296--><p class="noindent" >The driver MUST NOT write to any of the device configuration fields.
<!--l. 298--><p class="noindent" >A driver SHOULD negotiate VIRTIO_NET_F_MAC if the device offers it. If
the driver negotiates the VIRTIO_NET_F_MAC feature, the driver MUST
set the physical address of the NIC to <span 
class="aeti-10">mac</span>. Otherwise, it SHOULD use a
locally-administered MAC address (see <a 
href="#x1-3008x7">IEEE 802</a>, “9.2 48-bit universal LAN MAC
addresses”).
<!--l. 304--><p class="noindent" >If the driver does not negotiate the VIRTIO_NET_F_STATUS feature, it SHOULD
assume the link is active, otherwise it SHOULD read the link status from the bottom
bit of <span 
class="aeti-10">status</span>.
<!--l. 308--><p class="noindent" >A driver SHOULD negotiate VIRTIO_NET_F_MTU if the device offers it.
<!--l. 310--><p class="noindent" >If the driver negotiates VIRTIO_NET_F_MTU, it MUST supply enough receive
buffers to receive at least one receive packet of size <span 
class="aeti-10">mtu </span>(plus low level ethernet
header length) with <span 
class="aeti-10">gso_type </span>NONE or ECN.
<!--l. 314--><p class="noindent" >If the driver negotiates VIRTIO_NET_F_MTU, it MUST NOT transmit packets of
size exceeding the value of <span 
class="aeti-10">mtu </span>(plus low level ethernet header length) with <span 
class="aeti-10">gso_type</span>
NONE or ECN.
<!--l. 318--><p class="noindent" >A driver SHOULD negotiate the VIRTIO_NET_F_STANDBY feature if the device
                                                                  

                                                                  
offers it.
<!--l. 320--><p class="noindent" >If VIRTIO_NET_F_SPEED_DUPLEX has been negotiated, the driver MUST treat
any value of <span 
class="aeti-10">speed </span>above 0x7fffffff as well as any value of <span 
class="aeti-10">duplex </span>not matching 0x00 or
0x01 as an unknown value.
<!--l. 325--><p class="noindent" >If VIRTIO_NET_F_SPEED_DUPLEX has been negotiated, the driver SHOULD
re-read <span 
class="aeti-10">speed </span>and <span 
class="aeti-10">duplex </span>after a configuration change notification.
<!--l. 329--><p class="noindent" >A driver SHOULD NOT negotiate VIRTIO_NET_F_HASH_REPORT if it does not
negotiate VIRTIO_NET_F_CTRL_VQ.
<!--l. 332--><p class="noindent" >A driver SHOULD NOT negotiate VIRTIO_NET_F_CTRL_RX_EXTRA if it does
not negotiate VIRTIO_NET_F_CTRL_VQ.
<a 
 id="x1-275001r285"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.4.3   </span> <a 
 id="x1-2760003"></a>Legacy Interface: Device configuration layout</h5>
<!--l. 337--><p class="noindent" >When using the legacy interface, transitional devices and drivers MUST format <span 
class="aeti-10">status</span>
and <span 
class="aeti-10">max_virtqueue_pairs </span>in struct virtio_net_config according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<!--l. 343--><p class="noindent" >When using the legacy interface, <span 
class="aeti-10">mac </span>is driver-writable which provided a way for drivers
to update the MAC without negotiating VIRTIO_NET_F_CTRL_MAC_ADDR.
<a 
 id="x1-276001r283"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.5   </span> <a 
 id="x1-2770005"></a>Device Initialization</h4>
<!--l. 349--><p class="noindent" >A driver would perform a typical initialization routine like so:
     <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Identify  and  initialize  the  receive  and  transmission  virtqueues,  up  to
     N  of  each  kind.  If  VIRTIO_NET_F_MQ  feature  bit  is  negotiated,
     N=<span 
class="aeti-10">max_virtqueue_pairs</span>, otherwise identify N=1.
     </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_NET_F_CTRL_VQ feature bit is negotiated, identify the
     control virtqueue.
     </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Fill the receive queues with buffers: see <a 
href="#x1-2860003">5.1.8.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Setting Up Receive Buffers --></a>.
     </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Even with VIRTIO_NET_F_MQ, only receiveq1, transmitq1 and controlq
     are       used       by       default.       The       driver       would       send
     the VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET command specifying the
     number of the transmit and receive queues to use.
     </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_NET_F_MAC feature bit is set, the configuration space
     <span 
class="aeti-10">mac </span>entry indicates the “physical” address of the device, otherwise the
                                                                  

                                                                  
     driver would typically generate a random local MAC address.
     </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_NET_F_STATUS feature bit is negotiated, the link status
     comes from the bottom bit of <span 
class="aeti-10">status</span>. Otherwise, the driver assumes it’s
     active.
     </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">A performant driver would indicate that it will generate checksumless
     packets by negotiating the VIRTIO_NET_F_CSUM feature.
     </dd><dt class="enumerate-enumitem">
  8. </dt><dd 
class="enumerate-enumitem">If                that                feature                is                negotiated,
     a driver can use TCP segmentation or UDP segmentation/fragmentation
     offload  by  negotiating  the  VIRTIO_NET_F_HOST_TSO4  (IPv4  TCP),
     VIRTIO_NET_F_HOST_TSO6
     (IPv6  TCP),  VIRTIO_NET_F_HOST_UFO  (UDP  fragmentation)  and
     VIRTIO_NET_F_HOST_USO (UDP segmentation) features.
     </dd><dt class="enumerate-enumitem">
  9. </dt><dd 
class="enumerate-enumitem">The converse features are also available: a driver can save the virtual device
     some work by negotiating these features.
     <span 
class="aeb10-">Note:</span> For example, a network packet transported between two guests on
          the                                  same                                  system
          might  not  need  checksumming  at  all,  nor  segmentation,  if  both
          guests are amenable. The VIRTIO_NET_F_GUEST_CSUM feature
          indicates  that  partially  checksummed  packets  can  be  received,
          and  if  it  can  do  that  then  the  VIRTIO_NET_F_GUEST_TSO4,
          VIRTIO_NET_F_GUEST_TSO6,  VIRTIO_NET_F_GUEST_UFO,
          VIRTIO_NET_F_GUEST_ECN,   VIRTIO_NET_F_GUEST_USO4
          and VIRTIO_NET_F_GUEST_USO6 are the input equivalents of
          the features described above. See <a 
href="#x1-2860003">5.1.8.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Setting Up Receive Buffers --></a> <a 
href="#x1-2860003">Setting Up Receive Buffers<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Setting Up Receive Buffers --></a>
          and <a 
href="#x1-2890004">5.1.8.4<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets --></a> <a 
href="#x1-2890004">Processing of Incoming Packets<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets --></a> below.
<!--l. 401--><p class="noindent" >A truly minimal driver would only accept VIRTIO_NET_F_MAC and ignore
everything else.
<a 
 id="x1-277010r287"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.6   </span> <a 
 id="x1-2780006"></a>Device and driver capabilities</h4>
<!--l. 406--><p class="noindent" >The network device has the following capabilities.
<!--l. 418--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Identifier  </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                                            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0800     </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-3610001">VIRTIO_NET_FF_RESOURCE_CAP</a>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Flow    filter    resource
 capability             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0801     </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-3620002">VIRTIO_NET_FF_SELECTOR_CAP</a>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Flow    filter    classifier
 capability             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0802     </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-3630003">VIRTIO_NET_FF_ACTION_CAP</a>      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Flow      filter      action
 capability             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td>
</tr></table>
                                                                  

                                                                  
<a 
 id="x1-278001r288"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.7   </span> <a 
 id="x1-2790007"></a>Device resource objects</h4>
<!--l. 422--><p class="noindent" >The network device has the following resource objects.
<!--l. 434--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > type     </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                                                              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0200  </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-3650001">VIRTIO_NET_RESOURCE_OBJ_FF_GROUP</a>         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Flow
 filter  group
 resource
 object      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0201  </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-3660002">VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER</a>  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Flow   filter
 mask object </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0202  </td><td style="text-align: left; min-width: 0.7\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <a 
href="#x1-3670003">VIRTIO_NET_RESOURCE_OBJ_FF_RULE</a>            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Flow   filter
 rule object  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >        </td>
</tr></table>
<a 
 id="x1-279001r289"></a>
<h4 class="subsectionHead"><span class="titlemark">5.1.8   </span> <a 
 id="x1-2800008"></a>Device Operation</h4>
<!--l. 438--><p class="noindent" >Packets are transmitted by placing them in the transmitq1…transmitqN, and buffers
for incoming packets are placed in the receiveq1…receiveqN. In each case, the packet
itself is preceded by a header:
<!--l. 443-->
<pre class="lstlisting" id="listing-76"><span class="label"><a 
 id="x1-280001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_F_NEEDS_CSUM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_F_DATA_VALID</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_F_RSC_INFO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_GSO_NONE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_GSO_TCPV4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_GSO_UDP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_GSO_TCPV6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_GSO_UDP_L4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HDR_GSO_ECN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x80</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">gso_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">gso_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">csum_start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">csum_offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_buffers</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_HASH_REPORT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_report</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_HASH_REPORT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding_reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_HASH_REPORT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-280021r21"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 467--><p class="noindent" >The controlq is used to control various device features described further in section
<a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.
<a 
 id="x1-280022r286"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.8.1   </span> <a 
 id="x1-2810001"></a>Legacy Interface: Device Operation</h5>
<!--l. 471--><p class="noindent" >When using the legacy interface, transitional devices and drivers MUST format the
fields in <span 
class="aeti-10">struct virtio_net_hdr </span>according to the native endian of the guest rather than
(necessarily when not using the legacy interface) little-endian.
<!--l. 476--><p class="noindent" >The legacy driver only presented <span 
class="aeti-10">num_buffers </span>in the <span 
class="aeti-10">struct virtio_net_hdr </span>when
VIRTIO_NET_F_MRG_RXBUF was negotiated; without that feature the structure
was 2 bytes shorter.
<!--l. 480--><p class="noindent" >When using the legacy interface, the driver SHOULD ignore the used length for the
transmit queues and the controlq queue.
<span 
class="aeb10-">Note:</span> Historically,  some  devices  put  the  total  descriptor  length  there,  even
      though no data was actually written.
<a 
 id="x1-281001r291"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.1.8.2   </span> <a 
 id="x1-2820002"></a>Packet Transmission</h5>
<!--l. 491--><p class="noindent" >Transmitting a single packet is simple, but varies depending on the different features
the driver negotiated.
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The driver can send a completely checksummed packet. In this case, <span 
class="aeti-10">flags</span>
    will be zero, and <span 
class="aeti-10">gso_type </span>will be VIRTIO_NET_HDR_GSO_NONE.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If the driver negotiated VIRTIO_NET_F_CSUM, it can skip checksumming the
    packet:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 501--><p class="noindent" ><span 
class="aeti-10">flags </span>has the VIRTIO_NET_HDR_F_NEEDS_CSUM set,
        </li>
        <li class="itemize">
        <!--l. 503--><p class="noindent" ><span 
class="aeti-10">csum_start   </span>is   set   to   the   offset   within   the   packet   to   begin
        checksumming, and
        </li>
        <li class="itemize">
        <!--l. 506--><p class="noindent" ><span 
class="aeti-10">csum_offset </span>indicates how many bytes after the csum_start the new
        (16 bit ones’ complement) checksum is placed by the device.
        </li>
        <li class="itemize">
        <!--l. 509--><p class="noindent" >The TCP checksum field in the packet is set to the sum of the TCP
        pseudo header, so that replacing it by the ones’ complement checksum
        of the TCP header and body will give the correct result.</li></ul>
    <span 
class="aeb10-">Note:</span> For example, consider a partially checksummed TCP (IPv4) packet.
          It will have a 14 byte ethernet header and 20 byte IP header followed
          by the TCP header (with the TCP checksum field 16 bytes into that
          header). <span 
class="aeti-10">csum_start </span>will be 14+20 = 34 (the TCP checksum includes
          the header), and <span 
class="aeti-10">csum_offset </span>will be 16.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If the driver negotiated VIRTIO_NET_F_HOST_TSO4, TSO6, USO or UFO, and
    the packet requires TCP segmentation, UDP segmentation or fragmentation,
    then <span 
class="aeti-10">gso_type </span>is set to VIRTIO_NET_HDR_GSO_TCPV4, TCPV6, UDP_L4 or
    UDP. (Otherwise, it is set to VIRTIO_NET_HDR_GSO_NONE). In this case,
    packets larger than 1514 bytes can be transmitted: the metadata indicates how
    to replicate the packet header to cut it into smaller packets. The other gso fields
    are set:
                                                                  

                                                                  
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 533--><p class="noindent" >If the VIRTIO_NET_F_GUEST_HDRLEN feature has been negotiated,
        <span 
class="aeti-10">hdr_len </span>indicates the header length that needs to be replicated for each
        packet. It’s the number of bytes from the beginning of the packet to the
        beginning of the transport payload. Otherwise, if the VIRTIO_NET_F_GUEST_HDRLEN
        feature has not been negotiated, <span 
class="aeti-10">hdr_len </span>is a hint to the device as to
        how much of the header needs to be kept to copy into each packet,
        usually set to the length of the headers, including the transport header<span class="footnote-mark"><a 
href="#fn10x5" id="fn10x5-bk"><sup class="textsuperscript">10</sup></a></span><a 
 id="x1-282004f10"></a>.
        <span 
class="aeb10-">Note:</span> Some devices benefit from knowledge of the exact header length.
        </li>
        <li class="itemize">
        <!--l. 548--><p class="noindent" ><span 
class="aeti-10">gso_size </span>is the maximum size of each packet beyond that header (ie.
        MSS).
        </li>
        <li class="itemize">
        <!--l. 551--><p class="noindent" >If the driver negotiated the VIRTIO_NET_F_HOST_ECN
        feature, the VIRTIO_NET_HDR_GSO_ECN bit in
        <span 
class="aeti-10">gso_type </span>indicates that the TCP packet has the ECN bit
        set<span class="footnote-mark"><a 
href="#fn11x5" id="fn11x5-bk"><sup class="textsuperscript">11</sup></a></span><a 
 id="x1-282005f11"></a>.</li></ul>
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem"><span 
class="aeti-10">num_buffers </span>is set to zero. This field is unused on transmitted packets.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">The header and packet are added as one output descriptor to the transmitq, and
    the device is notified of the new entry (see <a 
href="#x1-2770005">5.1.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Initialization --></a> <a 
href="#x1-2770005">Device Initialization<!--tex4ht:ref: sec:Device Types / Network Device / Device Initialization --></a>).</dd></dl>
<a 
 id="x1-282008r274"></a>
<!--l. 564--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.2.1</span> <a 
 id="x1-2830001"></a>Driver Requirements: Packet Transmission</h5>
For the transmit packet buffer, the driver MUST use the size of the structure <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_net_hdr </span>same as the receive packet buffer.
<!--l. 569--><p class="noindent" >The driver MUST set <span 
class="aeti-10">num_buffers </span>to zero.
<!--l. 571--><p class="noindent" >If VIRTIO_NET_F_CSUM is not negotiated, the driver MUST set <span 
class="aeti-10">flags </span>to zero and
SHOULD supply a fully checksummed packet to the device.
<!--l. 575--><p class="noindent" >If VIRTIO_NET_F_HOST_TSO4 is negotiated, the driver MAY set <span 
class="aeti-10">gso_type </span>to
VIRTIO_NET_HDR_GSO_TCPV4 to request TCPv4 segmentation, otherwise the
driver MUST NOT set <span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_TCPV4.
<!--l. 580--><p class="noindent" >If VIRTIO_NET_F_HOST_TSO6 is negotiated, the driver MAY set <span 
class="aeti-10">gso_type </span>to
VIRTIO_NET_HDR_GSO_TCPV6 to request TCPv6 segmentation, otherwise the
                                                                  

                                                                  
driver MUST NOT set <span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_TCPV6.
<!--l. 585--><p class="noindent" >If VIRTIO_NET_F_HOST_UFO is negotiated, the driver MAY set <span 
class="aeti-10">gso_type </span>to
VIRTIO_NET_HDR_GSO_UDP to request UDP fragmentation, otherwise the driver
MUST NOT set <span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_UDP.
<!--l. 590--><p class="noindent" >If VIRTIO_NET_F_HOST_USO is negotiated, the driver MAY set <span 
class="aeti-10">gso_type </span>to
VIRTIO_NET_HDR_GSO_UDP_L4 to request UDP segmentation, otherwise the
driver MUST NOT set <span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_UDP_L4.
<!--l. 595--><p class="noindent" >The driver SHOULD NOT send to the device TCP packets requiring segmentation
offload which have the Explicit Congestion Notification bit set, unless the
VIRTIO_NET_F_HOST_ECN feature is negotiated, in which case the driver MUST
set the VIRTIO_NET_HDR_GSO_ECN bit in <span 
class="aeti-10">gso_type</span>.
<!--l. 601--><p class="noindent" >If the VIRTIO_NET_F_CSUM feature has been negotiated, the driver MAY set the
VIRTIO_NET_HDR_F_NEEDS_CSUM bit in <span 
class="aeti-10">flags</span>, if so:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">the driver MUST validate the packet checksum at offset <span 
class="aeti-10">csum_offset </span>from
    <span 
class="aeti-10">csum_start </span>as well as all preceding offsets;
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">the  driver  MUST  set  the  packet  checksum  stored  in  the  buffer  to  the
    TCP/UDP pseudo header;
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">the driver MUST set <span 
class="aeti-10">csum_start </span>and <span 
class="aeti-10">csum_offset </span>such that calculating a
    ones’ complement checksum from <span 
class="aeti-10">csum_start </span>up until the end of the packet
    and storing the result at offset <span 
class="aeti-10">csum_offset </span>from <span 
class="aeti-10">csum_start </span>will result in
    a fully checksummed packet;</dd></dl>
<!--l. 618--><p class="noindent" >If none of the VIRTIO_NET_F_HOST_TSO4, TSO6, USO or UFO options have been
negotiated, the driver MUST set <span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_NONE.
<!--l. 622--><p class="noindent" >If <span 
class="aeti-10">gso_type </span>differs from VIRTIO_NET_HDR_GSO_NONE, then the driver MUST also
set the VIRTIO_NET_HDR_F_NEEDS_CSUM bit in <span 
class="aeti-10">flags </span>and MUST set <span 
class="aeti-10">gso_size </span>to
indicate the desired MSS.
<!--l. 627--><p class="noindent" >If one of the VIRTIO_NET_F_HOST_TSO4, TSO6, USO or UFO options have been
negotiated:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 630--><p class="noindent" >If  the  VIRTIO_NET_F_GUEST_HDRLEN  feature  has  been  negotiated,
    and  <span 
class="aeti-10">gso_type  </span>differs  from  VIRTIO_NET_HDR_GSO_NONE,  the  driver
    MUST set <span 
class="aeti-10">hdr_len </span>to a value equal to the length of the headers, including
    the transport header.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 635--><p class="noindent" >If the VIRTIO_NET_F_GUEST_HDRLEN feature has not been negotiated,
    or <span 
class="aeti-10">gso_type </span>is VIRTIO_NET_HDR_GSO_NONE, the driver SHOULD set
    <span 
class="aeti-10">hdr_len </span>to a value not less than the length of the headers, including the
    transport header.</li></ul>
<!--l. 642--><p class="noindent" >The driver SHOULD accept the VIRTIO_NET_F_GUEST_HDRLEN feature if it has
been offered, and if it’s able to provide the exact header length.
<!--l. 645--><p class="noindent" >The driver MUST NOT set the VIRTIO_NET_HDR_F_DATA_VALID and
VIRTIO_NET_HDR_F_RSC_INFO bits in <span 
class="aeti-10">flags</span>.
<a 
 id="x1-283004r293"></a>
<!--l. 648--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.2.2</span> <a 
 id="x1-2840002"></a>Device Requirements: Packet Transmission</h5>
The device MUST ignore <span 
class="aeti-10">flag </span>bits that it does not recognize.
<!--l. 651--><p class="noindent" >If VIRTIO_NET_HDR_F_NEEDS_CSUM bit in <span 
class="aeti-10">flags </span>is not set, the device MUST
NOT use the <span 
class="aeti-10">csum_start </span>and <span 
class="aeti-10">csum_offset</span>.
<!--l. 654--><p class="noindent" >If one of the VIRTIO_NET_F_HOST_TSO4, TSO6, USO or UFO options have been
negotiated:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 657--><p class="noindent" >If  the  VIRTIO_NET_F_GUEST_HDRLEN  feature  has  been  negotiated,
    and  <span 
class="aeti-10">gso_type  </span>differs  from  VIRTIO_NET_HDR_GSO_NONE,  the  device
    MAY use <span 
class="aeti-10">hdr_len </span>as the transport header size.
    <span 
class="aeb10-">Note:</span> Caution should be taken by the implementation so as to prevent a
          malicious driver from attacking the device by setting an incorrect
          hdr_len.
    </li>
    <li class="itemize">
    <!--l. 666--><p class="noindent" >If the VIRTIO_NET_F_GUEST_HDRLEN feature has not been negotiated, or
    <span 
class="aeti-10">gso_type </span>is VIRTIO_NET_HDR_GSO_NONE, the device MAY use <span 
class="aeti-10">hdr_len </span>only
    as a hint about the transport header size. The device MUST NOT rely on
    <span 
class="aeti-10">hdr_len </span>to be correct.
    <span 
class="aeb10-">Note:</span> This is due to various bugs in implementations.
    </li></ul>
<!--l. 677--><p class="noindent" >If VIRTIO_NET_HDR_F_NEEDS_CSUM is not set, the device MUST NOT rely on
the packet checksum being correct.
<a 
 id="x1-284001r294"></a>
                                                                  

                                                                  
<!--l. 679--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.2.3</span> <a 
 id="x1-2850003"></a>Packet Transmission Interrupt</h5>
Often a driver will suppress transmission virtqueue interrupts and check for used
packets in the transmit path of following packets.
<!--l. 685--><p class="noindent" >The normal behavior in this interrupt handler is to retrieve used buffers from the
virtqueue and free the corresponding headers and packets.
<a 
 id="x1-285001r292"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.8.3   </span> <a 
 id="x1-2860003"></a>Setting Up Receive Buffers</h5>
<!--l. 691--><p class="noindent" >It is generally a good idea to keep the receive virtqueue as fully populated as
possible: if it runs out, network performance will suffer.
<!--l. 695--><p class="noindent" >If the VIRTIO_NET_F_GUEST_TSO4, VIRTIO_NET_F_GUEST_TSO6,
VIRTIO_NET_F_GUEST_UFO, VIRTIO_NET_F_GUEST_USO4 or
VIRTIO_NET_F_GUEST_USO6 features are used, the maximum incoming packet
will be 65589 bytes long (14 bytes of Ethernet header, plus 40 bytes of the IPv6
header, plus 65535 bytes of maximum IPv6 payload including any extension
header), otherwise 1514 bytes. When VIRTIO_NET_F_HASH_REPORT is not
negotiated, the required receive buffer size is either 65601 or 1526 bytes
accounting for 20 bytes of <span 
class="aeti-10">struct virtio_net_hdr </span>followed by receive packet. When
VIRTIO_NET_F_HASH_REPORT is negotiated, the required receive buffer size is
either 65609 or 1534 bytes accounting for 12 bytes of <span 
class="aeti-10">struct virtio_net_hdr </span>followed by
receive packet.
<a 
 id="x1-286001r295"></a>
<!--l. 708--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.3.1</span> <a 
 id="x1-2870001"></a>Driver Requirements: Setting Up Receive Buffers</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 711--><p class="noindent" >If VIRTIO_NET_F_MRG_RXBUF is not negotiated:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 713--><p class="noindent" >If  VIRTIO_NET_F_GUEST_TSO4,  VIRTIO_NET_F_GUEST_TSO6,
        VIRTIO_NET_F_GUEST_UFO,  VIRTIO_NET_F_GUEST_USO4  or
        VIRTIO_NET_F_GUEST_USO6 are negotiated, the driver SHOULD
        populate the receive queue(s) with buffers of at least 65609 bytes if
        VIRTIO_NET_F_HASH_REPORT is negotiated, and of at least 65601
        bytes if not.
        </li>
        <li class="itemize">
        <!--l. 717--><p class="noindent" >Otherwise, the driver SHOULD populate the receive queue(s) with
        buffers of at least 1534 bytes if VIRTIO_NET_F_HASH_REPORT is
        negotiated, and of at least 1526 bytes if not.</li></ul>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 721--><p class="noindent" >If VIRTIO_NET_F_MRG_RXBUF is negotiated, each buffer MUST be at least
    size of <span 
class="aeti-10">struct virtio_net_hdr</span>, i.e. 20 bytes if VIRTIO_NET_F_HASH_REPORT is
    negotiated, and 12 bytes if not.</li></ul>
<span 
class="aeb10-">Note:</span> Obviously each buffer can be split across multiple descriptor elements.
<!--l. 730--><p class="noindent" >When calculating the size of <span 
class="aeti-10">struct virtio_net_hdr</span>, the driver MUST consider all the
fields inclusive up to <span 
class="aeti-10">padding_reserved</span>, i.e. 20 bytes if VIRTIO_NET_F_HASH_REPORT
is negotiated, and 12 bytes if not.
<!--l. 734--><p class="noindent" >If VIRTIO_NET_F_MQ is negotiated, each of receiveq1…receiveqN that will be used
SHOULD be populated with receive buffers.
<a 
 id="x1-287001r297"></a>
<!--l. 737--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.3.2</span> <a 
 id="x1-2880002"></a>Device Requirements: Setting Up Receive Buffers</h5>
The device MUST set <span 
class="aeti-10">num_buffers </span>to the number of descriptors used to hold the
incoming packet.
<!--l. 742--><p class="noindent" >The device MUST use only a single descriptor if VIRTIO_NET_F_MRG_RXBUF was
not negotiated.
<span 
class="aeb10-">Note:</span> This     means     that     <span 
class="aeti-10">num_buffers     </span>will     always     be     1     if
      VIRTIO_NET_F_MRG_RXBUF is not negotiated.
<a 
 id="x1-288001r296"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.8.4   </span> <a 
 id="x1-2890004"></a>Processing of Incoming Packets</h5>
<!--l. 752--><p class="noindent" >When a packet is copied into a buffer in the receiveq, the optimal path is to disable
further used buffer notifications for the receiveq and process packets until no more
are found, then re-enable them.
<!--l. 757--><p class="noindent" >Processing incoming packets involves:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem"><span 
class="aeti-10">num_buffers                              </span>indicates                                how
    many descriptors this packet is spread over (including this one): this will
    always be 1 if VIRTIO_NET_F_MRG_RXBUF was not negotiated. This
    allows receipt of large packets without having to allocate large buffers: a
    packet that does not fit in a single buffer can flow over to the next buffer,
    and so on. In this case, there will be at least <span 
class="aeti-10">num_buffers </span>used buffers in the
    virtqueue, and the device chains them together to form a single packet in a
    way similar to how it would store it in a single buffer spread over multiple
    descriptors. The other buffers will not begin with a <span 
class="aeti-10">struct virtio_net_hdr</span>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If <span 
class="aeti-10">num_buffers </span>is one, then the entire packet will be contained within this
                                                                  

                                                                  
    buffer, immediately following the struct virtio_net_hdr.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If  the  VIRTIO_NET_F_GUEST_CSUM  feature  was  negotiated,  the
    VIRTIO_NET_HDR_F_DATA_VALID bit in <span 
class="aeti-10">flags </span>can be set: if so, device
    has  validated  the  packet  checksum.  In  case  of  multiple  encapsulated
    protocols, one level of checksums has been validated.</dd></dl>
<!--l. 783--><p class="noindent" >Additionally, VIRTIO_NET_F_GUEST_CSUM, TSO4, TSO6, UDP and ECN
features enable receive checksum, large receive offload and ECN support which are
the input equivalents of the transmit checksum, transmit segmentation offloading and
ECN features, as described in <a 
href="#x1-2820002">5.1.8.2<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Packet Transmission --></a>:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">If  the  VIRTIO_NET_F_GUEST_TSO4,  TSO6,  UFO,  USO4  or  USO6
    options  were  negotiated,  then  <span 
class="aeti-10">gso_type  </span>MAY  be  something  other  than
    VIRTIO_NET_HDR_GSO_NONE, and <span 
class="aeti-10">gso_size </span>field indicates the desired
    MSS (see Packet Transmission point 2).
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If  the  VIRTIO_NET_F_RSC_EXT  option  was  negotiated  (this  implies
    one of VIRTIO_NET_F_GUEST_TSO4, TSO6), the device processes also
    duplicated ACK segments, reports number of coalesced TCP segments in
    <span 
class="aeti-10">csum_start </span>field and number of duplicated ACK segments in <span 
class="aeti-10">csum_offset</span>
    field and sets bit VIRTIO_NET_HDR_F_RSC_INFO in <span 
class="aeti-10">flags</span>.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If  the  VIRTIO_NET_F_GUEST_CSUM  feature  was  negotiated,  the
    VIRTIO_NET_HDR_F_NEEDS_CSUM bit in <span 
class="aeti-10">flags </span>can be set: if so, the
    packet checksum at offset <span 
class="aeti-10">csum_offset </span>from <span 
class="aeti-10">csum_start </span>and any preceding
    checksums have been validated. The checksum on the packet is incomplete
    and  if  bit  VIRTIO_NET_HDR_F_RSC_INFO  is  not  set  in  <span 
class="aeti-10">flags</span>,  then
    <span 
class="aeti-10">csum_start  </span>and  <span 
class="aeti-10">csum_offset  </span>indicate  how  to  calculate  it  (see  Packet
    Transmission point 1).
    </dd></dl>
<!--l. 811--><p class="noindent" >If applicable, the device calculates per-packet hash for incoming packets as defined in
<a 
href="#x1-2920003">5.1.8.4.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets --></a>.
<!--l. 814--><p class="noindent" >If applicable, the device reports hash information for incoming packets as defined in
<a 
href="#x1-3030005">5.1.8.4.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash reporting for incoming packets --></a>.
<a 
 id="x1-289007r298"></a>
<!--l. 817--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.4.1</span> <a 
 id="x1-2900001"></a>Device Requirements: Processing of Incoming Packets</h5>
If VIRTIO_NET_F_MRG_RXBUF has not been negotiated, the device MUST set
<span 
class="aeti-10">num_buffers </span>to 1.
<!--l. 823--><p class="noindent" >If VIRTIO_NET_F_MRG_RXBUF has been negotiated, the device MUST set
<span 
class="aeti-10">num_buffers </span>to indicate the number of buffers the packet (including the header) is
                                                                  

                                                                  
spread over.
<!--l. 827--><p class="noindent" >If a receive packet is spread over multiple buffers, the device MUST use all buffers
but the last (i.e. the first <span 
class="aeti-10">num_buffers </span>- 1 buffers) completely up to the full length of
each buffer supplied by the driver.
<!--l. 832--><p class="noindent" >The device MUST use all buffers used by a single receive packet together, such that
at least <span 
class="aeti-10">num_buffers </span>are observed by driver as used.
<!--l. 836--><p class="noindent" >If VIRTIO_NET_F_GUEST_CSUM is not negotiated, the device MUST
set <span 
class="aeti-10">flags </span>to zero and SHOULD supply a fully checksummed packet to the
driver.
<!--l. 840--><p class="noindent" >If VIRTIO_NET_F_GUEST_TSO4 is not negotiated, the device MUST NOT set
<span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_TCPV4.
<!--l. 843--><p class="noindent" >If VIRTIO_NET_F_GUEST_UDP is not negotiated, the device MUST NOT set
<span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_UDP.
<!--l. 846--><p class="noindent" >If VIRTIO_NET_F_GUEST_TSO6 is not negotiated, the device MUST NOT set
<span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_TCPV6.
<!--l. 849--><p class="noindent" >If none of VIRTIO_NET_F_GUEST_USO4 or VIRTIO_NET_F_GUEST_USO6 have been
negotiated, the device MUST NOT set <span 
class="aeti-10">gso_type </span>to VIRTIO_NET_HDR_GSO_UDP_L4.
<!--l. 852--><p class="noindent" >The device SHOULD NOT send to the driver TCP packets requiring segmentation
offload which have the Explicit Congestion Notification bit set, unless the
VIRTIO_NET_F_GUEST_ECN feature is negotiated, in which case the device MUST
set the VIRTIO_NET_HDR_GSO_ECN bit in <span 
class="aeti-10">gso_type</span>.
<!--l. 858--><p class="noindent" >If the VIRTIO_NET_F_GUEST_CSUM feature has been negotiated, the
device MAY set the VIRTIO_NET_HDR_F_NEEDS_CSUM bit in <span 
class="aeti-10">flags</span>, if
so:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">the device MUST validate the packet checksum at offset <span 
class="aeti-10">csum_offset </span>from
    <span 
class="aeti-10">csum_start </span>as well as all preceding offsets;
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">the device MUST set the packet checksum stored in the receive buffer to
    the TCP/UDP pseudo header;
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">the device MUST set <span 
class="aeti-10">csum_start </span>and <span 
class="aeti-10">csum_offset </span>such that calculating a
    ones’ complement checksum from <span 
class="aeti-10">csum_start </span>up until the end of the packet
    and storing the result at offset <span 
class="aeti-10">csum_offset </span>from <span 
class="aeti-10">csum_start </span>will result in
    a fully checksummed packet;</dd></dl>
<!--l. 875--><p class="noindent" >If none of the VIRTIO_NET_F_GUEST_TSO4, TSO6, UFO, USO4 or
USO6 options have been negotiated, the device MUST set <span 
class="aeti-10">gso_type </span>to
VIRTIO_NET_HDR_GSO_NONE.
                                                                  

                                                                  
<!--l. 879--><p class="noindent" >If <span 
class="aeti-10">gso_type </span>differs from VIRTIO_NET_HDR_GSO_NONE, then the device MUST also
set the VIRTIO_NET_HDR_F_NEEDS_CSUM bit in <span 
class="aeti-10">flags </span>MUST set <span 
class="aeti-10">gso_size </span>to
indicate the desired MSS. If VIRTIO_NET_F_RSC_EXT was negotiated, the device
MUST also set VIRTIO_NET_HDR_F_RSC_INFO bit in <span 
class="aeti-10">flags</span>, set <span 
class="aeti-10">csum_start </span>to
number of coalesced TCP segments and set <span 
class="aeti-10">csum_offset </span>to number of received
duplicated ACK segments.
<!--l. 887--><p class="noindent" >If VIRTIO_NET_F_RSC_EXT was not negotiated, the device MUST not set
VIRTIO_NET_HDR_F_RSC_INFO bit in <span 
class="aeti-10">flags</span>.
<!--l. 890--><p class="noindent" >If one of the VIRTIO_NET_F_GUEST_TSO4, TSO6, UFO, USO4 or USO6 options
have been negotiated, the device SHOULD set <span 
class="aeti-10">hdr_len </span>to a value not less than the
length of the headers, including the transport header.
<!--l. 895--><p class="noindent" >If the VIRTIO_NET_F_GUEST_CSUM feature has been negotiated, the device MAY
set the VIRTIO_NET_HDR_F_DATA_VALID bit in <span 
class="aeti-10">flags</span>, if so, the device MUST
validate the packet checksum (in case of multiple encapsulated protocols, one level of
checksums is validated).
<a 
 id="x1-290004r300"></a>
<!--l. 903--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.4.2</span> <a 
 id="x1-2910002"></a>Driver Requirements: Processing of Incoming Packets</h5>
The driver MUST ignore <span 
class="aeti-10">flag </span>bits that it does not recognize.
<!--l. 907--><p class="noindent" >If VIRTIO_NET_HDR_F_NEEDS_CSUM bit in <span 
class="aeti-10">flags </span>is not set or if
VIRTIO_NET_HDR_F_RSC_INFO bit <span 
class="aeti-10">flags </span>is set, the driver MUST NOT use the
<span 
class="aeti-10">csum_start </span>and <span 
class="aeti-10">csum_offset</span>.
<!--l. 911--><p class="noindent" >If one of the VIRTIO_NET_F_GUEST_TSO4, TSO6, UFO, USO4 or USO6 options
have been negotiated, the driver MAY use <span 
class="aeti-10">hdr_len </span>only as a hint about
the transport header size. The driver MUST NOT rely on <span 
class="aeti-10">hdr_len </span>to be
correct.
<span 
class="aeb10-">Note:</span> This is due to various bugs in implementations.
<!--l. 919--><p class="noindent" >If neither VIRTIO_NET_HDR_F_NEEDS_CSUM nor VIRTIO_NET_HDR_F_DATA_VALID
is set, the driver MUST NOT rely on the packet checksum being correct.
<a 
 id="x1-291001r301"></a>
<!--l. 923--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.4.3</span> <a 
 id="x1-2920003"></a>Hash calculation for incoming packets</h5>
A device attempts to calculate a per-packet hash in the following cases:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 928--><p class="noindent" >The feature VIRTIO_NET_F_RSS was negotiated. The device uses the hash
    to determine the receive virtqueue to place incoming packets.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 929--><p class="noindent" >The feature VIRTIO_NET_F_HASH_REPORT was negotiated. The device
    reports the hash value and the hash type with the packet.</li></ul>
<!--l. 932--><p class="noindent" >If the feature VIRTIO_NET_F_RSS was negotiated:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 934--><p class="noindent" >The  device  uses  <span 
class="aeti-10">hash_types  </span>of  the  virtio_net_rss_config  structure  as
    ’Enabled hash types’ bitmask.
    </li>
    <li class="itemize">
    <!--l. 935--><p class="noindent" >If   additionally   the   feature   VIRTIO_NET_F_HASH_TUNNEL   was
    negotiated, the device uses <span 
class="aeti-10">enabled_tunnel_types </span>of the virtnet_hash_tunnel
    structure as ’Encapsulation types enabled for inner header hash’ bitmask.
    </li>
    <li class="itemize">
    <!--l. 937--><p class="noindent" >The device uses a key as defined in <span 
class="aeti-10">hash_key_data </span>and <span 
class="aeti-10">hash_key_length </span>of
    the virtio_net_rss_config structure (see <a 
href="#x1-3250001">5.1.8.5.7.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS) / Setting RSS parameters --></a>).</li></ul>
<!--l. 941--><p class="noindent" >If the feature VIRTIO_NET_F_RSS was not negotiated:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 943--><p class="noindent" >The  device  uses  <span 
class="aeti-10">hash_types  </span>of  the  virtio_net_hash_config  structure  as
    ’Enabled hash types’ bitmask.
    </li>
    <li class="itemize">
    <!--l. 944--><p class="noindent" >If   additionally   the   feature   VIRTIO_NET_F_HASH_TUNNEL   was
    negotiated, the device uses <span 
class="aeti-10">enabled_tunnel_types </span>of the virtnet_hash_tunnel
    structure as ’Encapsulation types enabled for inner header hash’ bitmask.
    </li>
    <li class="itemize">
    <!--l. 946--><p class="noindent" >The device uses a key as defined in <span 
class="aeti-10">hash_key_data </span>and <span 
class="aeti-10">hash_key_length </span>of
    the virtio_net_hash_config structure (see <a 
href="#x1-3230004">5.1.8.5.6.4<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Automatic receive steering in multiqueue mode / Hash calculation --></a>).</li></ul>
<!--l. 950--><p class="noindent" >Note that if the device offers VIRTIO_NET_F_HASH_REPORT, even if
it supports only one pair of virtqueues, it MUST support at least one of
commands of VIRTIO_NET_CTRL_MQ class to configure reported hash
parameters:
    <ul class="itemize1">
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 953--><p class="noindent" >If    the    device    offers    VIRTIO_NET_F_RSS,    it    MUST    support
    VIRTIO_NET_CTRL_MQ_RSS_CONFIG command per <a 
href="#x1-3250001">5.1.8.5.7.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS) / Setting RSS parameters --></a>.
    </li>
    <li class="itemize">
    <!--l. 955--><p class="noindent" >Otherwise             the             device             MUST             support
    VIRTIO_NET_CTRL_MQ_HASH_CONFIG command per <a 
href="#x1-3230004">5.1.8.5.6.4<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Automatic receive steering in multiqueue mode / Hash calculation --></a>.</li></ul>
<!--l. 959--><p class="noindent" >The per-packet hash calculation can depend on the IP packet type. See <a 
href="#x1-3035x34">[IP]</a>, <a 
href="#x1-3038x37">[UDP]</a>
and <a 
href="#x1-3039x38">[TCP]</a>.
<a 
 id="x1-292001r266"></a>
<!--l. 962--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.3.1</span> <a 
 id="x1-2930001"></a>Supported/enabled hash types</h6>
Hash types applicable for IPv4 packets: <!--l. 965-->
<pre class="lstlisting" id="listing-77"><span class="label"><a 
 id="x1-293001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_IPv4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-293002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_TCPv4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-293003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_UDPv4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2)</span></span></pre>
<!--l. 970--><p class="noindent" >Hash types applicable for IPv6 packets without extension headers <!--l. 971-->
<pre class="lstlisting" id="listing-78"><span class="label"><a 
 id="x1-293004r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_IPv6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-293005r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_TCPv6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-293006r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_UDPv6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5)</span></span></pre>
<!--l. 976--><p class="noindent" >Hash types applicable for IPv6 packets with extension headers <!--l. 977-->
<pre class="lstlisting" id="listing-79"><span class="label"><a 
 id="x1-293007r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_IP_EX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-293008r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_TCP_EX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-293009r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TYPE_UDP_EX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8)</span></span></pre>
<a 
 id="x1-293010r303"></a>
<!--l. 983--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.3.2</span> <a 
 id="x1-2940002"></a>IPv4 packets</h6>
The device calculates the hash on IPv4 packets according to ’Enabled hash types’
bitmask as follows:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 987--><p class="noindent" >If VIRTIO_NET_HASH_TYPE_TCPv4 is set and the packet has a TCP header,
    the hash is calculated over the following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 990--><p class="noindent" >Source IP address
        </li>
        <li class="itemize">
        <!--l. 991--><p class="noindent" >Destination IP address
        </li>
        <li class="itemize">
                                                                  

                                                                  
        <!--l. 992--><p class="noindent" >Source TCP port
        </li>
        <li class="itemize">
        <!--l. 993--><p class="noindent" >Destination TCP port</li></ul>
    </li>
    <li class="itemize">
    <!--l. 995--><p class="noindent" >Else if VIRTIO_NET_HASH_TYPE_UDPv4 is set and the packet has a UDP
    header, the hash is calculated over the following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 998--><p class="noindent" >Source IP address
        </li>
        <li class="itemize">
        <!--l. 999--><p class="noindent" >Destination IP address
        </li>
        <li class="itemize">
        <!--l. 1000--><p class="noindent" >Source UDP port
        </li>
        <li class="itemize">
        <!--l. 1001--><p class="noindent" >Destination UDP port</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1003--><p class="noindent" >Else if VIRTIO_NET_HASH_TYPE_IPv4 is set, the hash is calculated over the
    following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1006--><p class="noindent" >Source IP address
        </li>
        <li class="itemize">
        <!--l. 1007--><p class="noindent" >Destination IP address</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1009--><p class="noindent" >Else the device does not calculate the hash</li></ul>
<a 
 id="x1-294001r304"></a>
                                                                  

                                                                  
<!--l. 1012--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.3.3</span> <a 
 id="x1-2950003"></a>IPv6 packets without extension header</h6>
The device calculates the hash on IPv6 packets without extension headers according
to ’Enabled hash types’ bitmask as follows:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1017--><p class="noindent" >If VIRTIO_NET_HASH_TYPE_TCPv6 is set and the packet has a TCPv6
    header, the hash is calculated over the following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1020--><p class="noindent" >Source IPv6 address
        </li>
        <li class="itemize">
        <!--l. 1021--><p class="noindent" >Destination IPv6 address
        </li>
        <li class="itemize">
        <!--l. 1022--><p class="noindent" >Source TCP port
        </li>
        <li class="itemize">
        <!--l. 1023--><p class="noindent" >Destination TCP port</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1025--><p class="noindent" >Else if VIRTIO_NET_HASH_TYPE_UDPv6 is set and the packet has a UDPv6
    header, the hash is calculated over the following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1028--><p class="noindent" >Source IPv6 address
        </li>
        <li class="itemize">
        <!--l. 1029--><p class="noindent" >Destination IPv6 address
        </li>
        <li class="itemize">
        <!--l. 1030--><p class="noindent" >Source UDP port
        </li>
        <li class="itemize">
        <!--l. 1031--><p class="noindent" >Destination UDP port</li></ul>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 1033--><p class="noindent" >Else if VIRTIO_NET_HASH_TYPE_IPv6 is set, the hash is calculated over the
    following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1036--><p class="noindent" >Source IPv6 address
        </li>
        <li class="itemize">
        <!--l. 1037--><p class="noindent" >Destination IPv6 address</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1039--><p class="noindent" >Else the device does not calculate the hash</li></ul>
<a 
 id="x1-295001r305"></a>
<!--l. 1042--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.3.4</span> <a 
 id="x1-2960004"></a>IPv6 packets with extension header</h6>
The device calculates the hash on IPv6 packets with extension headers according to
’Enabled hash types’ bitmask as follows:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1047--><p class="noindent" >If VIRTIO_NET_HASH_TYPE_TCP_EX is set and the packet has a TCPv6
    header, the hash is calculated over the following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1050--><p class="noindent" >Home address from the home address option in the IPv6 destination
        options header. If the extension header is not present, use the Source
        IPv6 address.
        </li>
        <li class="itemize">
        <!--l. 1051--><p class="noindent" >IPv6 address that is contained in the Routing-Header-Type-2 from the
        associated extension header. If the extension header is not present, use
        the Destination IPv6 address.
        </li>
        <li class="itemize">
        <!--l. 1052--><p class="noindent" >Source TCP port
        </li>
        <li class="itemize">
                                                                  

                                                                  
        <!--l. 1053--><p class="noindent" >Destination TCP port</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1055--><p class="noindent" >Else if VIRTIO_NET_HASH_TYPE_UDP_EX is set and the packet has a
    UDPv6 header, the hash is calculated over the following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1058--><p class="noindent" >Home address from the home address option in the IPv6 destination
        options header. If the extension header is not present, use the Source
        IPv6 address.
        </li>
        <li class="itemize">
        <!--l. 1059--><p class="noindent" >IPv6 address that is contained in the Routing-Header-Type-2 from the
        associated extension header. If the extension header is not present, use
        the Destination IPv6 address.
        </li>
        <li class="itemize">
        <!--l. 1060--><p class="noindent" >Source UDP port
        </li>
        <li class="itemize">
        <!--l. 1061--><p class="noindent" >Destination UDP port</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1063--><p class="noindent" >Else if VIRTIO_NET_HASH_TYPE_IP_EX is set, the hash is calculated over the
    following fields:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1066--><p class="noindent" >Home address from the home address option in the IPv6 destination
        options header. If the extension header is not present, use the Source
        IPv6 address.
        </li>
        <li class="itemize">
        <!--l. 1067--><p class="noindent" >IPv6 address that is contained in the Routing-Header-Type-2 from the
        associated extension header. If the extension header is not present, use
        the Destination IPv6 address.</li></ul>
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 1069--><p class="noindent" >Else skip IPv6 extension headers and calculate the hash as defined for an IPv6
    packet without extension headers (see <a 
href="#x1-2950003">5.1.8.4.3.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets / IPv6 packets without extension header --></a>).</li></ul>
<a 
 id="x1-296001r302"></a>
<!--l. 1074--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.4.4</span> <a 
 id="x1-2970004"></a>Inner Header Hash</h5>
If VIRTIO_NET_F_HASH_TUNNEL has been negotiated, the driver can send the
command VIRTIO_NET_CTRL_HASH_TUNNEL_SET to configure the calculation
of the inner header hash.
<!--l. 1080-->
<pre class="lstlisting" id="listing-80"><span class="label"><a 
 id="x1-297001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtnet_hash_tunnel</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-297002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enabled_tunnel_types</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-297003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-297004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-297005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_HASH_TUNNEL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-297006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_HASH_TUNNEL_SET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span></pre>
<!--l. 1089--><p class="noindent" >Field <span 
class="aeti-10">enabled_tunnel_types </span>contains the bitmask of encapsulation types enabled for
inner header hash. See <a 
href="#x1-2990002">5.1.8.4.4.2<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets / Encapsulation types supported/enabled for inner header hash --></a>.
<!--l. 1093--><p class="noindent" >The class VIRTIO_NET_CTRL_HASH_TUNNEL has one command:
VIRTIO_NET_CTRL_HASH_TUNNEL_SET sets <span 
class="aeti-10">enabled_tunnel_types </span>for the
device using the virtnet_hash_tunnel structure, which is read-only for the
device.
<!--l. 1097--><p class="noindent" >Inner header hash is disabled by VIRTIO_NET_CTRL_HASH_TUNNEL_SET with
<span 
class="aeti-10">enabled_tunnel_types </span>set to 0.
<!--l. 1099--><p class="noindent" >Initially (before the driver sends any VIRTIO_NET_CTRL_HASH_TUNNEL_SET
command) all encapsulation types are disabled for inner header hash.
<a 
 id="x1-297007r306"></a>
<!--l. 1102--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.4.1</span> <a 
 id="x1-2980001"></a>Encapsulated packet</h6>
Multiple tunneling protocols allow encapsulating an inner, payload packet in an
outer, encapsulated packet. The encapsulated packet thus contains an outer header
and an inner header, and the device calculates the hash over either the inner header
or the outer header.
<!--l. 1109--><p class="noindent" >If VIRTIO_NET_F_HASH_TUNNEL is negotiated and a received encapsulated
packet’s outer header matches one of the encapsulation types enabled in
<span 
class="aeti-10">enabled_tunnel_types</span>, then the device uses the inner header for hash calculations (only
a single level of encapsulation is currently supported).
<!--l. 1113--><p class="noindent" >If VIRTIO_NET_F_HASH_TUNNEL is negotiated and a received packet’s (outer)
header does not match any encapsulation types enabled in <span 
class="aeti-10">enabled_tunnel_types</span>, then
the device uses the outer header for hash calculations.
<a 
 id="x1-298001r308"></a>
<!--l. 1116--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.4.2</span> <a 
 id="x1-2990002"></a>Encapsulation types supported/enabled for inner header hash</h6>
Encapsulation types applicable for inner header hash: <!--l. 1121-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-81"><span class="label"><a 
 id="x1-299001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_GRE_2784</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3026x25"><span 
class="pcrr8t-x-x-80">[RFC2784]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_GRE_2890</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3027x26"><span 
class="pcrr8t-x-x-80">[RFC2890]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_GRE_7676</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3028x27"><span 
class="pcrr8t-x-x-80">[RFC7676]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_GRE_UDP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3029x28"><span 
class="pcrr8t-x-x-80">[GRE-in-UDP]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_VXLAN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3030x29"><span 
class="pcrr8t-x-x-80">[VXLAN]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_VXLAN_GPE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3031x30"><span 
class="pcrr8t-x-x-80">[VXLAN-GPE]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_GENEVE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3032x31"><span 
class="pcrr8t-x-x-80">[GENEVE]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_IPIP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3033x32"><span 
class="pcrr8t-x-x-80">[IPIP]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-299009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_TUNNEL_TYPE_NVGRE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><a 
href="#x1-3034x33"><span 
class="pcrr8t-x-x-80">[NVGRE]</span></a><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span></pre>
<a 
 id="x1-299010r309"></a>
<!--l. 1133--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.4.3</span> <a 
 id="x1-3000003"></a>Advice</h6>
Example uses of the inner header hash:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1136--><p class="noindent" >Legacy tunneling protocols, lacking the outer header entropy, can use RSS
    with the inner header hash to distribute flows with identical outer but
    different inner headers across various queues, improving performance.
    </li>
    <li class="itemize">
    <!--l. 1138--><p class="noindent" >Identify an inner flow distributed across multiple outer tunnels.</li></ul>
<!--l. 1141--><p class="noindent" >As using the inner header hash completely discards the outer header entropy, care
must be taken if the inner header is controlled by an adversary, as the adversary can
then intentionally create configurations with insufficient entropy.
<!--l. 1145--><p class="noindent" >Besides disabling the inner header hash, mitigations would depend on how the hash is
used. When the hash use is limited to the RSS queue selection, the inner header hash
may have quality of service (QoS) limitations.
<a 
 id="x1-300001r310"></a>
<!--l. 1148--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.4.4</span> <a 
 id="x1-3010004"></a>Device Requirements: Inner Header Hash</h6>
If the (outer) header of the received packet does not match any encapsulation types
enabled in <span 
class="aeti-10">enabled_tunnel_types</span>, the device MUST calculate the hash on the outer
header.
<!--l. 1153--><p class="noindent" >If the device receives any bits in <span 
class="aeti-10">enabled_tunnel_types </span>which are not set in <span 
class="aeti-10">supported_tunnel_types</span>,
it SHOULD respond to the VIRTIO_NET_CTRL_HASH_TUNNEL_SET command
with VIRTIO_NET_ERR.
<!--l. 1156--><p class="noindent" >If the driver sets <span 
class="aeti-10">enabled_tunnel_types </span>to 0 through VIRTIO_NET_CTRL_HASH_TUNNEL_SET
or upon the device reset, the device MUST disable the inner header hash for all
encapsulation types.
<a 
 id="x1-301001r311"></a>
<!--l. 1159--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.4.4.5</span> <a 
 id="x1-3020005"></a>Driver Requirements: Inner Header Hash</h6>
The driver MUST have negotiated the VIRTIO_NET_F_HASH_TUNNEL feature
when issuing the VIRTIO_NET_CTRL_HASH_TUNNEL_SET command.
<!--l. 1163--><p class="noindent" >The driver MUST NOT set any bits in <span 
class="aeti-10">enabled_tunnel_types </span>which are not set in
<span 
class="aeti-10">supported_tunnel_types</span>.
                                                                  

                                                                  
<!--l. 1165--><p class="noindent" >The driver MUST ignore bits in <span 
class="aeti-10">supported_tunnel_types </span>which are not documented in
this specification.
<a 
 id="x1-302001r307"></a>
<!--l. 1167--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.4.5</span> <a 
 id="x1-3030005"></a>Hash reporting for incoming packets</h5>
If VIRTIO_NET_F_HASH_REPORT was negotiated and the device has calculated
the hash for the packet, the device fills <span 
class="aeti-10">hash_report </span>with the report type of calculated
hash and <span 
class="aeti-10">hash_value </span>with the value of calculated hash.
<!--l. 1174--><p class="noindent" >If VIRTIO_NET_F_HASH_REPORT was negotiated but due to any reason the hash was
not calculated, the device sets <span 
class="aeti-10">hash_report </span>to VIRTIO_NET_HASH_REPORT_NONE.
<!--l. 1177--><p class="noindent" >Possible values that the device can report in <span 
class="aeti-10">hash_report </span>are defined below. They
correspond to supported hash types defined in <a 
href="#x1-2930001">5.1.8.4.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets / Supported/enabled hash types --></a> as follows:
<!--l. 1182--><p class="noindent" >VIRTIO_NET_HASH_TYPE_XXX = 1 « (VIRTIO_NET_HASH_REPORT_XXX -
1)
<!--l. 1184-->
<pre class="lstlisting" id="listing-82"><span class="label"><a 
 id="x1-303001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_NONE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_IPv4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_TCPv4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_UDPv4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_IPv6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_TCPv6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_UDPv6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_IPv6_EX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_TCPv6_EX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-303010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_HASH_REPORT_UDPv6_EX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span></pre>
<a 
 id="x1-303011r299"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.8.5   </span> <a 
 id="x1-3040005"></a>Control Virtqueue</h5>
<!--l. 1199--><p class="noindent" >The driver uses the control virtqueue (if VIRTIO_NET_F_CTRL_VQ is negotiated)
to send commands to manipulate various features of the device which would not
easily map into the configuration space.
<!--l. 1204--><p class="noindent" >All commands are of the following form:
<!--l. 1206-->
<pre class="lstlisting" id="listing-83"><span class="label"><a 
 id="x1-304001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ctrl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">class</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ack</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ack</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-304011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_ERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<!--l. 1220--><p class="noindent" >The <span 
class="aeti-10">class</span>, <span 
class="aeti-10">command </span>and command-specific-data are set by the driver, and the device
sets the <span 
class="aeti-10">ack </span>byte and optionally <span 
class="aeti-10">command-specific-result</span>. There is little the driver can
do except issue a diagnostic if <span 
class="aeti-10">ack </span>is not VIRTIO_NET_OK.
<!--l. 1225--><p class="noindent" >The command VIRTIO_NET_CTRL_STATS_QUERY and VIRTIO_NET_CTRL_STATS_GET
contain <span 
class="aeti-10">command-specific-result</span>.
<a 
 id="x1-304012r313"></a>
<!--l. 1228--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.1</span> <a 
 id="x1-3050001"></a>Packet Receive Filtering</h5>
If the VIRTIO_NET_F_CTRL_RX and VIRTIO_NET_F_CTRL_RX_EXTRA features
are negotiated, the driver can send control commands for promiscuous mode,
multicast, unicast and broadcast receiving.
                                                                  

                                                                  
<span 
class="aeb10-">Note:</span> In general, these commands are best-effort: unwanted packets could still
      arrive.
<!--l. 1240-->
<pre class="lstlisting" id="listing-84"><span class="label"><a 
 id="x1-305001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_RX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-305002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_RX_PROMISC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-305003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_RX_ALLMULTI</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-305004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_RX_ALLUNI</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-305005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_RX_NOMULTI</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-305006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_RX_NOUNI</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-305007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_RX_NOBCAST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span></pre>
<a 
 id="x1-305008r312"></a>
<!--l. 1251--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.1.1</span> <a 
 id="x1-3060001"></a>Device Requirements: Packet Receive Filtering</h6>
If the VIRTIO_NET_F_CTRL_RX feature has been negotiated, the device MUST
support the following VIRTIO_NET_CTRL_RX class commands:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1257--><p class="noindent" >VIRTIO_NET_CTRL_RX_PROMISC turns promiscuous mode on and off.
    The command-specific-data is one byte containing 0 (off) or 1 (on). If
    promiscuous mode is on, the device SHOULD receive all incoming packets.
    This  SHOULD  take  effect  even  if  one  of  the  other  modes  set  by  a
    VIRTIO_NET_CTRL_RX class command is on.
    </li>
    <li class="itemize">
    <!--l. 1263--><p class="noindent" >VIRTIO_NET_CTRL_RX_ALLMULTI turns all-multicast receive on and
    off. The command-specific-data is one byte containing 0 (off) or 1 (on).
    When all-multicast receive is on the device SHOULD allow all incoming
    multicast packets.</li></ul>
<!--l. 1269--><p class="noindent" >If the VIRTIO_NET_F_CTRL_RX_EXTRA feature has been negotiated, the device
MUST support the following VIRTIO_NET_CTRL_RX class commands:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1273--><p class="noindent" >VIRTIO_NET_CTRL_RX_ALLUNI  turns  all-unicast  receive  on  and  off.
    The command-specific-data is one byte containing 0 (off) or 1 (on). When
    all-unicast receive is on the device SHOULD allow all incoming unicast
    packets.
    </li>
    <li class="itemize">
    <!--l. 1277--><p class="noindent" >VIRTIO_NET_CTRL_RX_NOMULTI  suppresses  multicast  receive.  The
    command-specific-data is one byte containing 0 (multicast receive allowed)
    or 1 (multicast receive suppressed). When multicast receive is suppressed,
    the  device  SHOULD  NOT  send  multicast  packets  to  the  driver.  This
    SHOULD take effect even if VIRTIO_NET_CTRL_RX_ALLMULTI is on.
                                                                  

                                                                  
    This filter SHOULD NOT apply to broadcast packets.
    </li>
    <li class="itemize">
    <!--l. 1284--><p class="noindent" >VIRTIO_NET_CTRL_RX_NOUNI    suppresses    unicast    receive.    The
    command-specific-data is one byte containing 0 (unicast receive allowed)
    or 1 (unicast receive suppressed). When unicast receive is suppressed, the
    device SHOULD NOT send unicast packets to the driver. This SHOULD
    take effect even if VIRTIO_NET_CTRL_RX_ALLUNI is on.
    </li>
    <li class="itemize">
    <!--l. 1290--><p class="noindent" >VIRTIO_NET_CTRL_RX_NOBCAST suppresses broadcast receive. The
    command-specific-data is one byte containing 0 (broadcast receive allowed)
    or 1 (broadcast receive suppressed). When broadcast receive is suppressed,
    the  device  SHOULD  NOT  send  broadcast  packets  to  the  driver.  This
    SHOULD take effect even if VIRTIO_NET_CTRL_RX_ALLMULTI is on.</li></ul>
<a 
 id="x1-306001r316"></a>
<!--l. 1298--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.1.2</span> <a 
 id="x1-3070002"></a>Driver Requirements: Packet Receive Filtering</h6>
If the VIRTIO_NET_F_CTRL_RX feature has not been negotiated, the driver
MUST NOT issue commands VIRTIO_NET_CTRL_RX_PROMISC or
VIRTIO_NET_CTRL_RX_ALLMULTI.
<!--l. 1304--><p class="noindent" >If the VIRTIO_NET_F_CTRL_RX_EXTRA feature has not been negotiated, the
driver MUST NOT issue commands VIRTIO_NET_CTRL_RX_ALLUNI,
VIRTIO_NET_CTRL_RX_NOMULTI, VIRTIO_NET_CTRL_RX_NOUNI or
VIRTIO_NET_CTRL_RX_NOBCAST.
<a 
 id="x1-307001r315"></a>
<!--l. 1311--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.2</span> <a 
 id="x1-3080002"></a>Setting MAC Address Filtering</h5>
If the VIRTIO_NET_F_CTRL_RX feature is negotiated, the driver can send control
commands for MAC address filtering.
<!--l. 1316-->
<pre class="lstlisting" id="listing-85"><span class="label"><a 
 id="x1-308001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ctrl_mac</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-308002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">entries</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-308003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">macs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">entries</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">][6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-308004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-308005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-308006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MAC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-308007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MAC_TABLE_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-308008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MAC_ADDR_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<!--l. 1327--><p class="noindent" >The device can filter incoming packets by any number of destination MAC
addresses<span class="footnote-mark"><a 
href="#fn12x5" id="fn12x5-bk"><sup class="textsuperscript">12</sup></a></span><a 
 id="x1-308009f12"></a>.
This table is set using the class VIRTIO_NET_CTRL_MAC and the command
VIRTIO_NET_CTRL_MAC_TABLE_SET. The command-specific-data is
two variable length tables of 6-byte MAC addresses (as described in struct
virtio_net_ctrl_mac). The first table contains unicast addresses, and the second
contains multicast addresses.
                                                                  

                                                                  
<!--l. 1337--><p class="noindent" >The VIRTIO_NET_CTRL_MAC_ADDR_SET command is used to set the default
MAC address which rx filtering accepts (and if VIRTIO_NET_F_MAC has been
negotiated, this will be reflected in <span 
class="aeti-10">mac </span>in config space).
<!--l. 1342--><p class="noindent" >The command-specific-data for VIRTIO_NET_CTRL_MAC_ADDR_SET is the 6-byte
MAC address.
<a 
 id="x1-308010r317"></a>
<!--l. 1345--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.2.1</span> <a 
 id="x1-3090001"></a>Device Requirements: Setting MAC Address Filtering</h6>
The device MUST have an empty MAC filtering table on reset.
<!--l. 1349--><p class="noindent" >The device MUST update the MAC filtering table before it consumes the
VIRTIO_NET_CTRL_MAC_TABLE_SET command.
<!--l. 1352--><p class="noindent" >The device MUST update <span 
class="aeti-10">mac </span>in config space before it consumes the
VIRTIO_NET_CTRL_MAC_ADDR_SET command, if VIRTIO_NET_F_MAC has
been negotiated.
<!--l. 1356--><p class="noindent" >The device SHOULD drop incoming packets which have a destination MAC which
matches neither the <span 
class="aeti-10">mac </span>(or that set with VIRTIO_NET_CTRL_MAC_ADDR_SET)
nor the MAC filtering table.
<a 
 id="x1-309001r319"></a>
<!--l. 1360--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.2.2</span> <a 
 id="x1-3100002"></a>Driver Requirements: Setting MAC Address Filtering</h6>
If VIRTIO_NET_F_CTRL_RX has not been negotiated, the driver MUST NOT issue
VIRTIO_NET_CTRL_MAC class commands.
<!--l. 1365--><p class="noindent" >If VIRTIO_NET_F_CTRL_RX has been negotiated, the driver SHOULD issue
VIRTIO_NET_CTRL_MAC_ADDR_SET to set the default mac if it is different from
<span 
class="aeti-10">mac</span>.
<!--l. 1369--><p class="noindent" >The driver MUST follow the VIRTIO_NET_CTRL_MAC_TABLE_SET command by
a le32 number, followed by that number of non-multicast MAC addresses, followed by
another le32 number, followed by that number of multicast addresses. Either number
MAY be 0.
<a 
 id="x1-310001r320"></a>
<!--l. 1374--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.2.3</span> <a 
 id="x1-3110003"></a>Legacy Interface: Setting MAC Address Filtering</h6>
When using the legacy interface, transitional devices and drivers MUST
format <span 
class="aeti-10">entries </span>in struct virtio_net_ctrl_mac according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<!--l. 1380--><p class="noindent" >Legacy drivers that didn’t negotiate VIRTIO_NET_F_CTRL_MAC_ADDR changed
<span 
class="aeti-10">mac </span>in config space when NIC is accepting incoming packets. These drivers
always wrote the mac value from first to last byte, therefore after detecting
such drivers, a transitional device MAY defer MAC update, or MAY defer
                                                                  

                                                                  
processing incoming packets until driver writes the last byte of <span 
class="aeti-10">mac </span>in the config
space.
<a 
 id="x1-311001r318"></a>
<!--l. 1388--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.3</span> <a 
 id="x1-3120003"></a>VLAN Filtering</h5>
If the driver negotiates the VIRTIO_NET_F_CTRL_VLAN feature, it can control a
VLAN filter table in the device. The VLAN filter table applies only to VLAN tagged
packets.
<!--l. 1394--><p class="noindent" >When VIRTIO_NET_F_CTRL_VLAN is negotiated, the device starts with an empty
VLAN filter table.
<span 
class="aeb10-">Note:</span> Similar to the MAC address based filtering, the VLAN filtering is also
      best-effort: unwanted packets could still arrive.
<!--l. 1402-->
<pre class="lstlisting" id="listing-86"><span class="label"><a 
 id="x1-312001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_VLAN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-312002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_VLAN_ADD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-312003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_VLAN_DEL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<!--l. 1408--><p class="noindent" >Both the VIRTIO_NET_CTRL_VLAN_ADD and VIRTIO_NET_CTRL_VLAN_DEL
command take a little-endian 16-bit VLAN id as the command-specific-data.
<!--l. 1411--><p class="noindent" >VIRTIO_NET_CTRL_VLAN_ADD command adds the specified VLAN to the VLAN
filter table.
<!--l. 1414--><p class="noindent" >VIRTIO_NET_CTRL_VLAN_DEL command removes the specified VLAN from the
VLAN filter table.
<a 
 id="x1-312004r321"></a>
<!--l. 1417--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.3.1</span> <a 
 id="x1-3130001"></a>Device Requirements: VLAN Filtering</h6>
When VIRTIO_NET_F_CTRL_VLAN is not negotiated, the device MUST accept all
VLAN tagged packets.
<!--l. 1422--><p class="noindent" >When VIRTIO_NET_F_CTRL_VLAN is negotiated, the device MUST accept all
VLAN tagged packets whose VLAN tag is present in the VLAN filter table and
SHOULD drop all VLAN tagged packets whose VLAN tag is absent in the VLAN
filter table.
<a 
 id="x1-313001r323"></a>
<!--l. 1427--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.3.2</span> <a 
 id="x1-3140002"></a>Legacy Interface: VLAN Filtering</h6>
When using the legacy interface, transitional devices and drivers MUST format the
VLAN id according to the native endian of the guest rather than (necessarily when
not using the legacy interface) little-endian.
<a 
 id="x1-314001r322"></a>
                                                                  

                                                                  
<!--l. 1433--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.4</span> <a 
 id="x1-3150004"></a>Gratuitous Packet Sending</h5>
If the driver negotiates the VIRTIO_NET_F_GUEST_ANNOUNCE (depends on
VIRTIO_NET_F_CTRL_VQ), the device can ask the driver to send gratuitous
packets; this is usually done after the guest has been physically migrated, and needs
to announce its presence on the new network links. (As hypervisor does not have the
knowledge of guest network configuration (eg. tagged vlan) it is simplest to prod the
guest in this way).
<!--l. 1443-->
<pre class="lstlisting" id="listing-87"><span class="label"><a 
 id="x1-315001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_ANNOUNCE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-315002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_ANNOUNCE_ACK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span></pre>
<!--l. 1448--><p class="noindent" >The driver checks VIRTIO_NET_S_ANNOUNCE bit in the device configuration
<span 
class="aeti-10">status </span>field when it notices the changes of device configuration. The command
VIRTIO_NET_CTRL_ANNOUNCE_ACK is used to indicate that driver has received
the notification and device clears the VIRTIO_NET_S_ANNOUNCE bit in
<span 
class="aeti-10">status</span>.
<!--l. 1454--><p class="noindent" >Processing this notification involves:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Sending the gratuitous packets (eg. ARP) or marking there are pending
    gratuitous packets to be sent and letting deferred routine to send them.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Sending   VIRTIO_NET_CTRL_ANNOUNCE_ACK   command   through
    control vq.</dd></dl>
<a 
 id="x1-315005r324"></a>
<!--l. 1465--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.4.1</span> <a 
 id="x1-3160001"></a>Driver Requirements: Gratuitous Packet Sending</h6>
If the driver negotiates VIRTIO_NET_F_GUEST_ANNOUNCE, it SHOULD notify
network peers of its new location after it sees the VIRTIO_NET_S_ANNOUNCE
bit in <span 
class="aeti-10">status</span>. The driver MUST send a command on the command
queue with class VIRTIO_NET_CTRL_ANNOUNCE and command
VIRTIO_NET_CTRL_ANNOUNCE_ACK.
<a 
 id="x1-316001r326"></a>
<!--l. 1472--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.4.2</span> <a 
 id="x1-3170002"></a>Device Requirements: Gratuitous Packet Sending</h6>
If VIRTIO_NET_F_GUEST_ANNOUNCE is negotiated, the device MUST
clear the VIRTIO_NET_S_ANNOUNCE bit in <span 
class="aeti-10">status </span>upon receipt of a
command buffer with class VIRTIO_NET_CTRL_ANNOUNCE and command
VIRTIO_NET_CTRL_ANNOUNCE_ACK before marking the buffer as used.
<a 
 id="x1-317001r325"></a>
                                                                  

                                                                  
<!--l. 1479--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.5</span> <a 
 id="x1-3180005"></a>Device operation in multiqueue mode</h5>
This specification defines the following modes that a device MAY implement for
operation with multiple transmit/receive virtqueues:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1483--><p class="noindent" >Automatic receive steering as defined in <a 
href="#x1-3190006">5.1.8.5.6<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Automatic receive steering in multiqueue mode --></a>. If a device supports this
    mode, it offers the VIRTIO_NET_F_MQ feature bit.
    </li>
    <li class="itemize">
    <!--l. 1485--><p class="noindent" >Receive-side scaling as defined in <a 
href="#x1-3270003">5.1.8.5.7.3<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS) / RSS processing --></a>. If a device supports this mode,
    it offers the VIRTIO_NET_F_RSS feature bit.</li></ul>
<!--l. 1489--><p class="noindent" >A device MAY support one of these features or both. The driver MAY negotiate any
set of these features that the device supports.
<!--l. 1491--><p class="noindent" >Multiqueue is disabled by default.
<!--l. 1493--><p class="noindent" >The driver enables multiqueue by sending a command using <span 
class="aeti-10">class</span>
VIRTIO_NET_CTRL_MQ. The <span 
class="aeti-10">command </span>selects the mode of multiqueue operation,
as follows: <!--l. 1494-->
<pre class="lstlisting" id="listing-88"><span class="label"><a 
 id="x1-318001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MQ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-318002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">automatic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">receive</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">steering</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-318003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MQ_RSS_CONFIG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configurable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">receive</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">steering</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-318004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MQ_HASH_CONFIG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">configurable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">calculation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span></pre>
<!--l. 1501--><p class="noindent" >If more than one multiqueue mode is negotiated, the resulting device configuration is
defined by the last command sent by the driver.
<a 
 id="x1-318005r328"></a>
<!--l. 1503--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.6</span> <a 
 id="x1-3190006"></a>Automatic receive steering in multiqueue mode</h5>
If the driver negotiates the VIRTIO_NET_F_MQ feature bit (depends on
VIRTIO_NET_F_CTRL_VQ), it MAY transmit outgoing packets on one of
the multiple transmitq1…transmitqN and ask the device to queue incoming
packets into one of the multiple receiveq1…receiveqN depending on the packet
flow.
<!--l. 1510--><p class="noindent" >The driver enables multiqueue by sending the VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET
command, specifying the number of the transmit and receive queues to be used up to
<span 
class="aeti-10">max_virtqueue_pairs</span>; subsequently, transmitq1…transmitqn and receiveq1…receiveqn
where n=<span 
class="aeti-10">virtqueue_pairs </span>MAY be used. <!--l. 1516-->
<pre class="lstlisting" id="listing-89"><span class="label"><a 
 id="x1-319001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ctrl_mq_pairs_set</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-319002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtqueue_pairs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-319003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-319004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MQ_VQ_PAIRS_MIN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-319005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_MQ_VQ_PAIRS_MAX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x8000</span></span></pre>
<!--l. 1525--><p class="noindent" >When multiqueue is enabled by VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET
command, the device MUST use automatic receive steering based on packet flow.
Programming of the receive steering classificator is implicit. After the driver
                                                                  

                                                                  
transmitted a packet of a flow on transmitqX, the device SHOULD cause incoming
packets for that flow to be steered to receiveqX. For uni-directional protocols, or
where no packets have been transmitted yet, the device MAY steer a packet to a
random queue out of the specified receiveq1…receiveqn.
<!--l. 1533--><p class="noindent" >Multiqueue is disabled by VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET with
<span 
class="aeti-10">virtqueue_pairs </span>to 1 (this is the default) and waiting for the device to use the
command buffer.
<a 
 id="x1-319008r327"></a>
<!--l. 1536--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.6.1</span> <a 
 id="x1-3200001"></a>Driver Requirements: Automatic receive steering in multiqueue
mode</h6>
The driver MUST configure the virtqueues before enabling them with the
VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET command.
<!--l. 1541--><p class="noindent" >The driver MUST NOT request a <span 
class="aeti-10">virtqueue_pairs </span>of 0 or greater than
<span 
class="aeti-10">max_virtqueue_pairs </span>in the device configuration space.
<!--l. 1544--><p class="noindent" >The driver MUST queue packets only on any transmitq1 before the
VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET command.
<!--l. 1547--><p class="noindent" >The driver MUST NOT queue packets on transmit queues greater than
<span 
class="aeti-10">virtqueue_pairs </span>once it has placed the VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET
command in the available ring.
<a 
 id="x1-320001r330"></a>
<!--l. 1550--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.6.2</span> <a 
 id="x1-3210002"></a>Device Requirements: Automatic receive steering in multiqueue
mode</h6>
After initialization of reset, the device MUST queue packets only on receiveq1.
<!--l. 1554--><p class="noindent" >The device MUST NOT queue packets on receive queues greater than <span 
class="aeti-10">virtqueue_pairs</span>
once it has placed the VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET command in a
used buffer.
<!--l. 1558--><p class="noindent" >If the destination receive queue is being reset (See <a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>), the device SHOULD
re-select another random queue. If all receive queues are being reset, the device
MUST drop the packet.
<a 
 id="x1-321001r331"></a>
<!--l. 1562--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.6.3</span> <a 
 id="x1-3220003"></a>Legacy Interface: Automatic receive steering in multiqueue mode</h6>
When using the legacy interface, transitional devices and drivers MUST format
<span 
class="aeti-10">virtqueue_pairs </span>according to the native endian of the guest rather than (necessarily
when not using the legacy interface) little-endian.
<a 
 id="x1-322001r332"></a>
<!--l. 1568--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.6.4</span> <a 
 id="x1-3230004"></a>Hash calculation</h6>
If VIRTIO_NET_F_HASH_REPORT was negotiated and the device uses automatic
                                                                  

                                                                  
receive steering, the device MUST support a command to configure hash calculation
parameters.
<!--l. 1572--><p class="noindent" >The driver provides parameters for hash calculation as follows:
<!--l. 1574--><p class="noindent" ><span 
class="aeti-10">class </span>VIRTIO_NET_CTRL_MQ, <span 
class="aeti-10">command </span>VIRTIO_NET_CTRL_MQ_HASH_CONFIG.
<!--l. 1576--><p class="noindent" >The <span 
class="aeti-10">command-specific-data </span>has following format: <!--l. 1577-->
<pre class="lstlisting" id="listing-90"><span class="label"><a 
 id="x1-323001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_hash_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-323002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_types</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-323003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-323004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_key_length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-323005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_key_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_key_length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-323006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1585--><p class="noindent" >Field <span 
class="aeti-10">hash_types </span>contains a bitmask of allowed hash types as defined in
<a 
href="#x1-2930001">5.1.8.4.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets / Supported/enabled hash types --></a>. Initially the device has all hash types disabled and reports only
VIRTIO_NET_HASH_REPORT_NONE.
<!--l. 1590--><p class="noindent" >Field <span 
class="aeti-10">reserved </span>MUST contain zeroes. It is defined to make the structure to match the
layout of virtio_net_rss_config structure, defined in <a 
href="#x1-3240007">5.1.8.5.7<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS) --></a>.
<!--l. 1593--><p class="noindent" >Fields <span 
class="aeti-10">hash_key_length </span>and <span 
class="aeti-10">hash_key_data </span>define the key to be used in hash
calculation.
<a 
 id="x1-323007r329"></a>
<!--l. 1595--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.7</span> <a 
 id="x1-3240007"></a>Receive-side scaling (RSS)</h5>
A device offers the feature VIRTIO_NET_F_RSS if it supports RSS receive steering
with Toeplitz hash calculation and configurable parameters.
<!--l. 1598--><p class="noindent" >A driver queries RSS capabilities of the device by reading device configuration as
defined in <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>
<a 
 id="x1-324001r333"></a>
<!--l. 1600--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.7.1</span> <a 
 id="x1-3250001"></a>Setting RSS parameters</h6>
Driver sends a VIRTIO_NET_CTRL_MQ_RSS_CONFIG command using the
following format for <span 
class="aeti-10">command-specific-data</span>: <!--l. 1603-->
<pre class="lstlisting" id="listing-91"><span class="label"><a 
 id="x1-325001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss_rq_id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index_1_16</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtqueue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Set</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zero</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_rss_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_types</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indirection_table_mask</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss_rq_id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unclassified_queue</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss_rq_id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indirection_table</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indirection_table_length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_tx_vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_key_length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_key_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_key_length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-325014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1619--><p class="noindent" >Field <span 
class="aeti-10">hash_types </span>contains a bitmask of allowed hash types as defined in <a 
href="#x1-2930001">5.1.8.4.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets / Supported/enabled hash types --></a>.
<!--l. 1623--><p class="noindent" >Field <span 
class="aeti-10">indirection_table_mask </span>is a mask to be applied to the calculated hash to
produce an index in the <span 
class="aeti-10">indirection_table </span>array. Number of entries in <span 
class="aeti-10">indirection_table</span>
is (<span 
class="aeti-10">indirection_table_mask </span>+ 1).
<!--l. 1628--><p class="noindent" ><span 
class="aeti-10">rss_rq_id </span>is a receive virtqueue id. <span 
class="aeti-10">vq_index_1_16 </span>consists of bits 1 to 16 of a
virtqueue index. For example, a <span 
class="aeti-10">vq_index_1_16 </span>value of 3 corresponds to virtqueue
index 6, which maps to receiveq4.
<!--l. 1633--><p class="noindent" >Field <span 
class="aeti-10">unclassified_queue </span>specifies the receive virtqueue id in which to place
unclassified packets.
                                                                  

                                                                  
<!--l. 1636--><p class="noindent" >Field <span 
class="aeti-10">indirection_table </span>is an array of receive virtqueues ids.
<!--l. 1638--><p class="noindent" >A driver sets <span 
class="aeti-10">max_tx_vq </span>to inform a device how many transmit virtqueues it may use
(transmitq1…transmitq <span 
class="aeti-10">max_tx_vq</span>).
<!--l. 1640--><p class="noindent" >Fields <span 
class="aeti-10">hash_key_length </span>and <span 
class="aeti-10">hash_key_data </span>define the key to be used in hash
calculation.
<a 
 id="x1-325015r335"></a>
<!--l. 1642--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.7.2</span> <a 
 id="x1-3260002"></a>Driver Requirements: Setting RSS parameters</h6>
A driver MUST NOT send the VIRTIO_NET_CTRL_MQ_RSS_CONFIG command if
the feature VIRTIO_NET_F_RSS has not been negotiated.
<!--l. 1646--><p class="noindent" >A driver MUST fill the <span 
class="aeti-10">indirection_table </span>array only with enabled receive virtqueues
ids.
<!--l. 1649--><p class="noindent" >The number of entries in <span 
class="aeti-10">indirection_table </span>(<span 
class="aeti-10">indirection_table_mask </span>+ 1) MUST be a
power of two.
<!--l. 1651--><p class="noindent" >A driver MUST use <span 
class="aeti-10">indirection_table_mask </span>values that are less than
<span 
class="aeti-10">rss_max_indirection_table_length </span>reported by a device.
<!--l. 1653--><p class="noindent" >A driver MUST NOT set any VIRTIO_NET_HASH_TYPE_ flags that are not
supported by a device.
<a 
 id="x1-326001r336"></a>
<!--l. 1655--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.7.3</span> <a 
 id="x1-3270003"></a>Device Requirements: RSS processing</h6>
The device MUST determine the destination queue for a network packet as
follows:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1658--><p class="noindent" >Calculate the hash of the packet as defined in <a 
href="#x1-2920003">5.1.8.4.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Hash calculation for incoming packets --></a>.
    </li>
    <li class="itemize">
    <!--l. 1659--><p class="noindent" >If  the  device  did  not  calculate  the  hash  for  the  specific  packet,  the
    device directs the packet to the receiveq specified by <span 
class="aeti-10">unclassified_queue </span>of
    virtio_net_rss_config structure.
    </li>
    <li class="itemize">
    <!--l. 1660--><p class="noindent" >Apply <span 
class="aeti-10">indirection_table_mask </span>to the calculated hash and use the result as
    the index in the indirection table to get the destination receive virtqueue
    id.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 1663--><p class="noindent" >If the destination receive queue is being reset (See <a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>), the device MUST
    drop the packet.</li></ul>
<a 
 id="x1-327001r334"></a>
<!--l. 1666--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.8</span> <a 
 id="x1-3280008"></a>RSS Context</h5>
An RSS context consists of configurable parameters specified by <a 
href="#x1-3240007">5.1.8.5.7<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS) --></a>.
<!--l. 1671--><p class="noindent" >The RSS configuration supported by VIRTIO_NET_F_RSS is considered the default
RSS configuration.
<!--l. 1673--><p class="noindent" >The device offers the feature VIRTIO_NET_F_RSS_CONTEXT if it supports one or
multiple RSS contexts (excluding the default RSS configuration) and configurable
parameters.
<a 
 id="x1-328001r337"></a>
<!--l. 1676--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.8.1</span> <a 
 id="x1-3290001"></a>Querying RSS Context Capability</h6>
<!--l. 1678-->
<pre class="lstlisting" id="listing-92"><span class="label"><a 
 id="x1-329001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTNET_RSS_CTX_CTRL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTNET_RSS_CTX_CTRL_CAP_GET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTNET_RSS_CTX_CTRL_ADD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTNET_RSS_CTX_CTRL_MOD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTNET_RSS_CTX_CTRL_DEL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtnet_rss_ctx_cap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_rss_contexts</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-329009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
Field <span 
class="aeti-10">max_rss_contexts </span>specifies the maximum number of RSS contexts <a 
href="#x1-3280008">5.1.8.5.8<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / RSS Context --></a>
supported by the device.
<!--l. 1693--><p class="noindent" >The driver queries the RSS context capability of the device by sending the command
VIRTNET_RSS_CTX_CTRL_CAP_GET with the structure virtnet_rss_ctx_cap.
<!--l. 1696--><p class="noindent" >For the command VIRTNET_RSS_CTX_CTRL_CAP_GET, the structure
virtnet_rss_ctx_cap is write-only for the device.
<a 
 id="x1-329010r339"></a>
<!--l. 1698--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.8.2</span> <a 
 id="x1-3300002"></a>Setting RSS Context Parameters</h6>
<!--l. 1700-->
<pre class="lstlisting" id="listing-93"><span class="label"><a 
 id="x1-330001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtnet_rss_ctx_add_modify</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss_ctx_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_rss_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtnet_rss_ctx_del</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rss_ctx_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-330009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
RSS context parameters:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1714--><p class="noindent" ><span 
class="aeti-10">rss_ctx_id</span>: ID of the specific RSS context.
    </li>
    <li class="itemize">
    <!--l. 1715--><p class="noindent" ><span 
class="aeti-10">rss</span>:  RSS  context  parameters  of  the  specific  RSS  context  whose  id  is
    <span 
class="aeti-10">rss_ctx_id</span>.</li></ul>
                                                                  

                                                                  
<!--l. 1718--><p class="noindent" ><span 
class="aeti-10">reserved </span>is reserved and it is ignored by the device.
<!--l. 1720--><p class="noindent" >If the feature VIRTIO_NET_F_RSS_CONTEXT has been negotiated, the driver can
send the following VIRTNET_RSS_CTX_CTRL class commands:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">VIRTNET_RSS_CTX_CTRL_ADD:                     use                     the
    structure virtnet_rss_ctx_add_modify to add an RSS context configured as
    <span 
class="aeti-10">rss </span>and id as <span 
class="aeti-10">rss_ctx_id </span>for the device.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">VIRTNET_RSS_CTX_CTRL_MOD:                     use                     the
    structure virtnet_rss_ctx_add_modify to configure parameters of the RSS
    context whose id is <span 
class="aeti-10">rss_ctx_id </span>as <span 
class="aeti-10">rss </span>for the device.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">VIRTNET_RSS_CTX_CTRL_DEL: use the structure virtnet_rss_ctx_del to
    delete the RSS context whose id is <span 
class="aeti-10">rss_ctx_id </span>for the device.</dd></dl>
<!--l. 1731--><p class="noindent" >For commands VIRTNET_RSS_CTX_CTRL_ADD and VIRTNET_RSS_CTX_CTRL_MOD,
the structure virtnet_rss_ctx_add_modify is read-only for the device. For the
command VIRTNET_RSS_CTX_CTRL_DEL, the structure virtnet_rss_ctx_del is
read-only for the device.
<a 
 id="x1-330013r340"></a>
<!--l. 1734--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.8.3</span> <a 
 id="x1-3310003"></a>Device Requirements: RSS Context</h6>
The device MUST set <span 
class="aeti-10">max_rss_contexts </span>to at least 1 if it offers
VIRTIO_NET_F_RSS_CONTEXT.
<!--l. 1738--><p class="noindent" >Upon reset, the device MUST clear all previously configured RSS contexts.
<a 
 id="x1-331001r341"></a>
<!--l. 1740--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.8.4</span> <a 
 id="x1-3320004"></a>Driver Requirements: RSS Context</h6>
The driver MUST have negotiated the VIRTIO_NET_F_RSS_CONTEXT feature
when issuing the VIRTNET_RSS_CTX_CTRL class commands.
<!--l. 1744--><p class="noindent" >The driver MUST set <span 
class="aeti-10">rss_ctx_id </span>to between 1 and <span 
class="aeti-10">max_rss_contexts </span>inclusive.
<!--l. 1746--><p class="noindent" >The driver MUST NOT send the command VIRTIO_NET_CTRL_MQ_VQ_PAIRS_SET
when the device has successfully configured at least one RSS context.
<a 
 id="x1-332001r338"></a>
<!--l. 1748--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.9</span> <a 
 id="x1-3330009"></a>Offloads State Configuration</h5>
If the VIRTIO_NET_F_CTRL_GUEST_OFFLOADS feature is negotiated, the driver
can send control commands for dynamic offloads state configuration.
<a 
 id="x1-333001r342"></a>
                                                                  

                                                                  
<!--l. 1753--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.9.1</span> <a 
 id="x1-3340001"></a>Setting Offloads State</h6>
To configure the offloads, the following layout structure and definitions are
used:
<!--l. 1758-->
<pre class="lstlisting" id="listing-94"><span class="label"><a 
 id="x1-334001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offloads</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_GUEST_CSUM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_GUEST_TSO4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_GUEST_TSO6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_GUEST_ECN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_GUEST_UFO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">10</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_GUEST_USO4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">54</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_F_GUEST_USO6</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">55</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_GUEST_OFFLOADS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-334012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_GUEST_OFFLOADS_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span></pre>
<!--l. 1773--><p class="noindent" >The class VIRTIO_NET_CTRL_GUEST_OFFLOADS has one command:
VIRTIO_NET_CTRL_GUEST_OFFLOADS_SET applies the new offloads
configuration.
<!--l. 1776--><p class="noindent" >le64 value passed as command data is a bitmask, bits set define offloads to be
enabled, bits cleared - offloads to be disabled.
<!--l. 1779--><p class="noindent" >There is a corresponding device feature for each offload. Upon feature negotiation
corresponding offload gets enabled to preserve backward compatibility.
<a 
 id="x1-334013r344"></a>
<!--l. 1783--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.9.2</span> <a 
 id="x1-3350002"></a>Driver Requirements: Setting Offloads State</h6>
A driver MUST NOT enable an offload for which the appropriate feature has not
been negotiated.
<a 
 id="x1-335001r345"></a>
<!--l. 1788--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.9.3</span> <a 
 id="x1-3360003"></a>Legacy Interface: Setting Offloads State</h6>
When using the legacy interface, transitional devices and drivers MUST format
<span 
class="aeti-10">offloads </span>according to the native endian of the guest rather than (necessarily when not
using the legacy interface) little-endian.
<a 
 id="x1-336001r343"></a>
<!--l. 1795--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.10</span> <a 
 id="x1-33700010"></a>Notifications Coalescing</h5>
If the VIRTIO_NET_F_NOTF_COAL feature is negotiated, the driver
can send commands VIRTIO_NET_CTRL_NOTF_COAL_TX_SET and
VIRTIO_NET_CTRL_NOTF_COAL_RX_SET for notification coalescing.
<!--l. 1801--><p class="noindent" >If the VIRTIO_NET_F_VQ_NOTF_COAL feature is negotiated, the driver
can send commands VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET and
VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET for virtqueue notification
coalescing.
<!--l. 1805-->
<pre class="lstlisting" id="listing-95"><span class="label"><a 
 id="x1-337001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ctrl_coal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_packets</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_usecs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ctrl_coal_vq</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ctrl_coal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">coal</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_NOTF_COAL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_NOTF_COAL_TX_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_NOTF_COAL_RX_SET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-337016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
<!--l. 1824--><p class="noindent" >Coalescing parameters:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1826--><p class="noindent" ><span 
class="aeti-10">vq_index</span>: The virtqueue index of an enabled transmit or receive virtqueue.
    </li>
    <li class="itemize">
    <!--l. 1827--><p class="noindent" ><span 
class="aeti-10">max_usecs  </span>for  RX:  Maximum  number  of  microseconds  to  delay  a  RX
    notification.
    </li>
    <li class="itemize">
    <!--l. 1828--><p class="noindent" ><span 
class="aeti-10">max_usecs  </span>for  TX:  Maximum  number  of  microseconds  to  delay  a  TX
    notification.
    </li>
    <li class="itemize">
    <!--l. 1829--><p class="noindent" ><span 
class="aeti-10">max_packets </span>for RX: Maximum number of packets to receive before a RX
    notification.
    </li>
    <li class="itemize">
    <!--l. 1830--><p class="noindent" ><span 
class="aeti-10">max_packets </span>for TX: Maximum number of packets to send before a TX
    notification.</li></ul>
<!--l. 1833--><p class="noindent" ><span 
class="aeti-10">reserved </span>is reserved and it is ignored by the device.
<!--l. 1835--><p class="noindent" >Read/Write attributes for coalescing parameters:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1837--><p class="noindent" >For    commands    VIRTIO_NET_CTRL_NOTF_COAL_TX_SET    and
    VIRTIO_NET_CTRL_NOTF_COAL_RX_SET,          the          structure
    virtio_net_ctrl_coal is write-only for the driver.
    </li>
    <li class="itemize">
    <!--l. 1838--><p class="noindent" >For   the   command   VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET,   the
    structure virtio_net_ctrl_coal_vq is write-only for the driver.
    </li>
    <li class="itemize">
    <!--l. 1839--><p class="noindent" >For the command VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET, <span 
class="aeti-10">vq_index</span>
    and   <span 
class="aeti-10">reserved   </span>are   write-only   for   the   driver,   and   the   structure
    virtio_net_ctrl_coal is read-only for the driver.</li></ul>
<!--l. 1843--><p class="noindent" >The class VIRTIO_NET_CTRL_NOTF_COAL has the following commands:
                                                                  

                                                                  
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">VIRTIO_NET_CTRL_NOTF_COAL_TX_SET:     use     the     structure
    virtio_net_ctrl_coal to set the <span 
class="aeti-10">max_usecs </span>and <span 
class="aeti-10">max_packets </span>parameters for
    all transmit virtqueues.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">VIRTIO_NET_CTRL_NOTF_COAL_RX_SET:     use     the     structure
    virtio_net_ctrl_coal to set the <span 
class="aeti-10">max_usecs </span>and <span 
class="aeti-10">max_packets </span>parameters for
    all receive virtqueues.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET:     use     the     structure
    virtio_net_ctrl_coal_vq to set the <span 
class="aeti-10">max_usecs </span>and <span 
class="aeti-10">max_packets </span>parameters
    for an enabled transmit/receive virtqueue whose index is <span 
class="aeti-10">vq_index</span>.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET:     use     the     structure
    virtio_net_ctrl_coal_vq to get the <span 
class="aeti-10">max_usecs </span>and <span 
class="aeti-10">max_packets </span>parameters
    for an enabled transmit/receive virtqueue whose index is <span 
class="aeti-10">vq_index</span>.</dd></dl>
<!--l. 1853--><p class="noindent" >The device may generate notifications more or less frequently than specified by set
commands of the VIRTIO_NET_CTRL_NOTF_COAL class.
<!--l. 1855--><p class="noindent" >If coalescing parameters are being set, the device applies the last coalescing
parameters set for a virtqueue, regardless of the command used to set the
parameters. Use the following command sequence with two pairs of virtqueues as an
example: Each of the following commands sets <span 
class="aeti-10">max_usecs </span>and <span 
class="aeti-10">max_packets</span>
parameters for virtqueues.
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1860--><p class="noindent" >Command1: VIRTIO_NET_CTRL_NOTF_COAL_RX_SET sets coalescing
    parameters for virtqueues having index 0 and index 2. Virtqueues having
    index 1 and index 3 retain their previous parameters.
    </li>
    <li class="itemize">
    <!--l. 1861--><p class="noindent" >Command2: VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET with <span 
class="aeti-10">vq_index</span>
    = 0 sets coalescing parameters for virtqueue having index 0. Virtqueue
    having index 2 retains the parameters from command1.
    </li>
    <li class="itemize">
    <!--l. 1862--><p class="noindent" >Command3: VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET with <span 
class="aeti-10">vq_index</span>
    = 0, the device responds with coalescing parameters of vq_index 0 set by
    command2.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 1863--><p class="noindent" >Command4: VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET with <span 
class="aeti-10">vq_index</span>
    = 1 sets coalescing parameters for virtqueue having index 1. Virtqueue
    having index 3 retains its previous parameters.
    </li>
    <li class="itemize">
    <!--l. 1864--><p class="noindent" >Command5: VIRTIO_NET_CTRL_NOTF_COAL_TX_SET sets coalescing
    parameters for virtqueues having index 1 and index 3, and overrides the
    parameters set by command4.
    </li>
    <li class="itemize">
    <!--l. 1865--><p class="noindent" >Command6: VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET with <span 
class="aeti-10">vq_index</span>
    = 1, the device responds with coalescing parameters of index 1 set by
    command5.</li></ul>
<a 
 id="x1-337021r346"></a>
<!--l. 1868--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.10.1</span> <a 
 id="x1-3380001"></a>Operation</h6>
The device sends a used buffer notification once the notification conditions are met
and if the notifications are not suppressed as explained in <a 
href="#x1-510007">2.7.7<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Used Buffer Notification Suppression --></a>.
<!--l. 1872--><p class="noindent" >When the device has non-zero <span 
class="aeti-10">max_usecs </span>and non-zero <span 
class="aeti-10">max_packets</span>, it starts
counting microseconds and packets upon receiving/sending a packet. The device
counts packets and microseconds for each receive virtqueue and transmit virtqueue
separately. In this case, the notification conditions are met when <span 
class="aeti-10">max_usecs</span>
microseconds elapse, or upon sending/receiving <span 
class="aeti-10">max_packets </span>packets, whichever
happens first. Afterwards, the device waits for the next packet and starts counting
packets and microseconds again.
<!--l. 1877--><p class="noindent" >When the device has <span 
class="aeti-10">max_usecs </span>= 0 or <span 
class="aeti-10">max_packets </span>= 0, the notification conditions
are met after every packet received/sent.
<a 
 id="x1-338001r348"></a>
<!--l. 1879--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.10.2</span> <a 
 id="x1-3390002"></a>RX Example</h6>
If, for example:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1883--><p class="noindent" ><span 
class="aeti-10">max_usecs </span>= 10.
    </li>
    <li class="itemize">
    <!--l. 1884--><p class="noindent" ><span 
class="aeti-10">max_packets </span>= 15.</li></ul>
<!--l. 1886--><p class="noindent" >then each receive virtqueue of a device will operate as follows:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1888--><p class="noindent" >The  device  will  count  packets  received  on  each  virtqueue  until  it
    accumulates 15, or until 10 microseconds elapsed since the first one was
    received.
    </li>
    <li class="itemize">
    <!--l. 1889--><p class="noindent" >If the notifications are not suppressed by the driver, the device will send an
    used buffer notification, otherwise, the device will not send an used buffer
    notification as long as the notifications are suppressed.</li></ul>
<a 
 id="x1-339001r349"></a>
<!--l. 1892--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.10.3</span> <a 
 id="x1-3400003"></a>TX Example</h6>
If, for example:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1896--><p class="noindent" ><span 
class="aeti-10">max_usecs </span>= 10.
    </li>
    <li class="itemize">
    <!--l. 1897--><p class="noindent" ><span 
class="aeti-10">max_packets </span>= 15.</li></ul>
<!--l. 1899--><p class="noindent" >then each transmit virtqueue of a device will operate as follows:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1901--><p class="noindent" >The device will count packets sent on each virtqueue until it accumulates
    15, or until 10 microseconds elapsed since the first one was sent.
    </li>
    <li class="itemize">
    <!--l. 1902--><p class="noindent" >If the notifications are not suppressed by the driver, the device will send an
    used buffer notification, otherwise, the device will not send an used buffer
    notification as long as the notifications are suppressed.</li></ul>
<a 
 id="x1-340001r350"></a>
<!--l. 1905--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.10.4</span> <a 
 id="x1-3410004"></a>Notifications When Coalescing Parameters Change</h6>
When the coalescing parameters of a device change, the device needs to check if the
new notification conditions are met and send a used buffer notification if
so.
<!--l. 1909--><p class="noindent" >For example, <span 
class="aeti-10">max_packets </span>= 15 for a device with a single transmit virtqueue: if the device
sends 10 packets and afterwards receives a VIRTIO_NET_CTRL_NOTF_COAL_TX_SET
                                                                  

                                                                  
command with <span 
class="aeti-10">max_packets </span>= 8, then the notification condition is immediately
considered to be met; the device needs to immediately send a used buffer notification,
if the notifications are not suppressed by the driver.
<a 
 id="x1-341001r351"></a>
<!--l. 1913--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.10.5</span> <a 
 id="x1-3420005"></a>Driver Requirements: Notifications Coalescing</h6>
The driver MUST set <span 
class="aeti-10">vq_index </span>to the virtqueue index of an enabled transmit or
receive virtqueue.
<!--l. 1917--><p class="noindent" >The driver MUST have negotiated the VIRTIO_NET_F_NOTF_COAL feature
when issuing commands VIRTIO_NET_CTRL_NOTF_COAL_TX_SET and
VIRTIO_NET_CTRL_NOTF_COAL_RX_SET.
<!--l. 1919--><p class="noindent" >The driver MUST have negotiated the VIRTIO_NET_F_VQ_NOTF_COAL feature
when issuing commands VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET and
VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET.
<!--l. 1921--><p class="noindent" >The driver MUST ignore the values of coalescing parameters received from the
VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET command if the device responds with
VIRTIO_NET_ERR.
<a 
 id="x1-342001r352"></a>
<!--l. 1923--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.10.6</span> <a 
 id="x1-3430006"></a>Device Requirements: Notifications Coalescing</h6>
The device MUST ignore <span 
class="aeti-10">reserved</span>.
<!--l. 1927--><p class="noindent" >The device SHOULD respond to VIRTIO_NET_CTRL_NOTF_COAL_TX_SET and
VIRTIO_NET_CTRL_NOTF_COAL_RX_SET commands with VIRTIO_NET_ERR if
it was not able to change the parameters.
<!--l. 1929--><p class="noindent" >The device MUST respond to the VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET
command with VIRTIO_NET_ERR if it was not able to change the parameters.
<!--l. 1931--><p class="noindent" >The device MUST respond to VIRTIO_NET_CTRL_NOTF_COAL_VQ_SET and
VIRTIO_NET_CTRL_NOTF_COAL_VQ_GET commands with VIRTIO_NET_ERR
if the designated virtqueue is not an enabled transmit or receive virtqueue.
<!--l. 1934--><p class="noindent" >Upon disabling and re-enabling a transmit virtqueue, the device MUST set
the coalescing parameters of the virtqueue to those configured through the
VIRTIO_NET_CTRL_NOTF_COAL_TX_SET command, or, if the driver did not set
any TX coalescing parameters, to 0.
<!--l. 1937--><p class="noindent" >Upon disabling and re-enabling a receive virtqueue, the device MUST set
the coalescing parameters of the virtqueue to those configured through the
VIRTIO_NET_CTRL_NOTF_COAL_RX_SET command, or, if the driver did not set
any RX coalescing parameters, to 0.
<!--l. 1940--><p class="noindent" >The behavior of the device in response to set commands of the
VIRTIO_NET_CTRL_NOTF_COAL class is best-effort: the device MAY generate
notifications more or less frequently than specified.
                                                                  

                                                                  
<!--l. 1943--><p class="noindent" >A device SHOULD NOT send used buffer notifications to the driver if the
notifications are suppressed, even if the notification conditions are met.
<!--l. 1945--><p class="noindent" >Upon reset, a device MUST initialize all coalescing parameters to 0.
<a 
 id="x1-343001r347"></a>
<!--l. 1947--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.5.11</span> <a 
 id="x1-34400011"></a>Device Statistics</h5>
If the VIRTIO_NET_F_DEVICE_STATS feature is negotiated, the driver can obtain
device statistics from the device by using the following command.
<!--l. 1952--><p class="noindent" >Different types of virtqueues have different statistics. The statistics of the receiveq
are different from those of the transmitq.
<!--l. 1955--><p class="noindent" >The statistics of a certain type of virtqueue are also divided into multiple types
because different types require different features. This enables the expansion of new
statistics.
<!--l. 1959--><p class="noindent" >In one command, the driver can obtain the statistics of one or multiple virtqueues.
Additionally, the driver can obtain multiple type statistics of each virtqueue.
<a 
 id="x1-344001r353"></a>
<!--l. 1962--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.1</span> <a 
 id="x1-3450001"></a>Query Statistic Capabilities</h6>
<!--l. 1964-->
<pre class="lstlisting" id="listing-96"><span class="label"><a 
 id="x1-345001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_STATS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_STATS_QUERY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_CTRL_STATS_GET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_capabilities</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_CVQ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_RX_BASIC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_RX_CSUM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_RX_GSO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_RX_SPEED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_TX_BASIC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_TX_CSUM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">17)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_TX_GSO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">18)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_TX_SPEED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">19)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported_stats_types</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[1];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-345020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
To obtain device statistic capability, use the VIRTIO_NET_CTRL_STATS_QUERY
command. When the command completes successfully, <span 
class="aeti-10">command-specific-result </span>is in
the format of <span 
class="aeti-10">struct virtio_net_stats_capabilities</span>.
<a 
 id="x1-345021r355"></a>
<!--l. 1991--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.2</span> <a 
 id="x1-3460002"></a>Get Statistics</h6>
<!--l. 1993-->
<pre class="lstlisting" id="listing-97"><span class="label"><a 
 id="x1-346001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ctrl_queue_stats</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types_bitmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[1];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">stats</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_CVQ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_RX_BASIC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_RX_CSUM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_RX_GSO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_RX_SPEED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_TX_BASIC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_TX_CSUM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">17</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346019r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_TX_GSO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">18</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_STATS_TYPE_REPLY_TX_SPEED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">19</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved1</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-346026r26"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
To obtain device statistics, use the VIRTIO_NET_CTRL_STATS_GET command with
the <span 
class="aeti-10">command-specific-data </span>which is in the format of <span 
class="aeti-10">struct virtio_net_ctrl_queue_stats</span>.
When the command completes successfully, <span 
class="aeti-10">command-specific-result </span>contains multiple
statistic results, each statistic result has the <span 
class="aeti-10">struct virtio_net_stats_reply_hdr </span>as the
header.
<!--l. 2029--><p class="noindent" >The fields of the <span 
class="aeti-10">struct virtio_net_ctrl_queue_stats</span>:
    <dl class="description"><dt class="description">
    <!--l. 2031--><p class="noindent" >
<span 
class="aeb10-">vq_index</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 2031--><p class="noindent" >The index of the virtqueue to obtain the statistics.
    </dd><dt class="description">
    <!--l. 2034--><p class="noindent" >
<span 
class="aeb10-">types_bitmap</span> </dt><dd 
class="description">
    <!--l. 2034--><p class="noindent" >This is a bitmask of the types of statistics to be obtained. Therefore, a
    <span 
class="aeti-10">stats </span>inside <span 
class="aeti-10">struct virtio_net_ctrl_queue_stats </span>may indicate multiple statistic
    replies for the virtqueue.</dd></dl>
<!--l. 2040--><p class="noindent" >The fields of the <span 
class="aeti-10">struct virtio_net_stats_reply_hdr</span>:
    <dl class="description"><dt class="description">
    <!--l. 2042--><p class="noindent" >
<span 
class="aeb10-">type</span> </dt><dd 
class="description">
    <!--l. 2042--><p class="noindent" >The type of the reply statistic.
    </dd><dt class="description">
    <!--l. 2045--><p class="noindent" >
<span 
class="aeb10-">vq_index</span> </dt><dd 
class="description">
    <!--l. 2045--><p class="noindent" >The virtqueue index of the reply statistic.
    </dd><dt class="description">
    <!--l. 2048--><p class="noindent" >
<span 
class="aeb10-">size</span> </dt><dd 
class="description">
    <!--l. 2048--><p class="noindent" >The  number  of  bytes  for  the  statistics  entry  including  size  of  <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_net_stats_reply_hdr</span>.
    </dd></dl>
<a 
 id="x1-346027r356"></a>
<!--l. 2053--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.3</span> <a 
 id="x1-3470003"></a>Controlq Statistics</h6>
The structure corresponding to the controlq statistics is <span 
class="aeti-10">struct virtio_net_stats_cvq</span>.
The corresponding type is VIRTIO_NET_STATS_TYPE_CVQ. This is for the
controlq.
<!--l. 2059-->
<pre class="lstlisting" id="listing-98"><span class="label"><a 
 id="x1-347001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_cvq</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-347002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-347003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-347004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command_num</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-347005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ok_num</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-347006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 2069--><p class="noindent" >
<span 
class="aeb10-">command_num</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 2069--><p class="noindent" >The number of commands received by the device including the current
    command.
    </dd><dt class="description">
    <!--l. 2072--><p class="noindent" >
<span 
class="aeb10-">ok_num</span> </dt><dd 
class="description">
    <!--l. 2072--><p class="noindent" >The number of commands completed successfully by the device including
    the current command.</dd></dl>
<a 
 id="x1-347007r357"></a>
<!--l. 2077--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.4</span> <a 
 id="x1-3480004"></a>Receiveq Basic Statistics</h6>
The structure corresponding to the receiveq basic statistics is <span 
class="aeti-10">struct virtio_net_stats_rx_basic</span>.
The corresponding type is VIRTIO_NET_STATS_TYPE_RX_BASIC. This is for the
receiveq.
<!--l. 2083--><p class="noindent" >Receiveq basic statistics do not require any feature. As long as the device
supports VIRTIO_NET_F_DEVICE_STATS, the following are the receiveq basic
statistics.
<!--l. 2086-->
<pre class="lstlisting" id="listing-99"><span class="label"><a 
 id="x1-348001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_rx_basic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_notifications</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_packets</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_interrupts</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_drops</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_drop_overruns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-348013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2102--><p class="noindent" >The packets described below were all presented on the specified virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2104--><p class="noindent" >
<span 
class="aeb10-">rx_notifications</span> </dt><dd 
class="description">
    <!--l. 2104--><p class="noindent" >The number of driver notifications received by the device for this receiveq.
    </dd><dt class="description">
    <!--l. 2108--><p class="noindent" >
<span 
class="aeb10-">rx_packets</span> </dt><dd 
class="description">
    <!--l. 2108--><p class="noindent" >This is the number of packets passed to the driver by the device.
    </dd><dt class="description">
    <!--l. 2111--><p class="noindent" >
<span 
class="aeb10-">rx_bytes</span> </dt><dd 
class="description">
    <!--l. 2111--><p class="noindent" >This is the bytes of packets passed to the driver by the device.
    </dd><dt class="description">
    <!--l. 2114--><p class="noindent" >
<span 
class="aeb10-">rx_interrupts</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 2114--><p class="noindent" >The number of interrupts generated by the device for this receiveq.
    </dd><dt class="description">
    <!--l. 2117--><p class="noindent" >
<span 
class="aeb10-">rx_drops</span> </dt><dd 
class="description">
    <!--l. 2117--><p class="noindent" >This is the number of packets dropped by the device. The count includes
    all types of packets dropped by the device.
    </dd><dt class="description">
    <!--l. 2121--><p class="noindent" >
<span 
class="aeb10-">rx_drop_overruns</span> </dt><dd 
class="description">
    <!--l. 2121--><p class="noindent" >This  is  the  number  of  packets  dropped  by  the  device  when  no  more
    descriptors were available.
    </dd></dl>
<a 
 id="x1-348014r358"></a>
<!--l. 2127--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.5</span> <a 
 id="x1-3490005"></a>Transmitq Basic Statistics</h6>
The structure corresponding to the transmitq basic statistics is <span 
class="aeti-10">struct virtio_net_stats_tx_basic</span>.
The corresponding type is VIRTIO_NET_STATS_TYPE_TX_BASIC. This is for the
transmitq.
<!--l. 2133--><p class="noindent" >Transmitq basic statistics do not require any feature. As long as the device supports
VIRTIO_NET_F_DEVICE_STATS, the following are the transmitq basic
statistics.
<!--l. 2136-->
<pre class="lstlisting" id="listing-100"><span class="label"><a 
 id="x1-349001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_tx_basic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_notifications</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_packets</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_interrupts</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_drops</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_drop_malformed</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-349013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2152--><p class="noindent" >The packets described below are all for a specific virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2154--><p class="noindent" >
<span 
class="aeb10-">tx_notifications</span> </dt><dd 
class="description">
    <!--l. 2154--><p class="noindent" >The number of driver notifications received by the device for this transmitq.
    </dd><dt class="description">
    <!--l. 2158--><p class="noindent" >
<span 
class="aeb10-">tx_packets</span> </dt><dd 
class="description">
    <!--l. 2158--><p class="noindent" >This is the number of packets sent by the device (not the packets got from
    the driver).
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 2162--><p class="noindent" >
<span 
class="aeb10-">tx_bytes</span> </dt><dd 
class="description">
    <!--l. 2162--><p class="noindent" >This is the number of bytes sent by the device for all the sent packets (not
    the bytes sent got from the driver).
    </dd><dt class="description">
    <!--l. 2166--><p class="noindent" >
<span 
class="aeb10-">tx_interrupts</span> </dt><dd 
class="description">
    <!--l. 2166--><p class="noindent" >The number of interrupts generated by the device for this transmitq.
    </dd><dt class="description">
    <!--l. 2169--><p class="noindent" >
<span 
class="aeb10-">tx_drops</span> </dt><dd 
class="description">
    <!--l. 2169--><p class="noindent" >The number of packets dropped by the device. The count includes all types
    of packets dropped by the device.
    </dd><dt class="description">
    <!--l. 2173--><p class="noindent" >
<span 
class="aeb10-">tx_drop_malformed</span> </dt><dd 
class="description">
    <!--l. 2173--><p class="noindent" >The number of packets dropped by the device, when the descriptors are
    malformed. For example, the buffer is too short.</dd></dl>
<a 
 id="x1-349014r359"></a>
<!--l. 2178--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.6</span> <a 
 id="x1-3500006"></a>Receiveq CSUM Statistics</h6>
The structure corresponding to the receiveq checksum statistics is <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_net_stats_rx_csum</span>. The corresponding type is VIRTIO_NET_STATS_TYPE_RX_CSUM.
This is for the receiveq.
<!--l. 2184--><p class="noindent" >Only after the VIRTIO_NET_F_GUEST_CSUM is negotiated, the receiveq checksum
statistics can be obtained.
<!--l. 2187-->
<pre class="lstlisting" id="listing-101"><span class="label"><a 
 id="x1-350001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_rx_csum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-350002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-350003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-350004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_csum_valid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-350005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_needs_csum</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-350006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_csum_none</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-350007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_csum_bad</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-350008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2198--><p class="noindent" >The packets described below were all presented on the specified virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2200--><p class="noindent" >
<span 
class="aeb10-">rx_csum_valid</span> </dt><dd 
class="description">
    <!--l. 2200--><p class="noindent" >The number of packets with VIRTIO_NET_HDR_F_DATA_VALID.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 2203--><p class="noindent" >
<span 
class="aeb10-">rx_needs_csum</span> </dt><dd 
class="description">
    <!--l. 2203--><p class="noindent" >The number of packets with VIRTIO_NET_HDR_F_NEEDS_CSUM.
    </dd><dt class="description">
    <!--l. 2206--><p class="noindent" >
<span 
class="aeb10-">rx_csum_none</span> </dt><dd 
class="description">
    <!--l. 2206--><p class="noindent" >The number of packets without hardware checksum. The packet here refers
    to the non-TCP/UDP packet that the device cannot recognize.
    </dd><dt class="description">
    <!--l. 2210--><p class="noindent" >
<span 
class="aeb10-">rx_csum_bad</span> </dt><dd 
class="description">
    <!--l. 2210--><p class="noindent" >The number of packets with checksum mismatch.
    </dd></dl>
<a 
 id="x1-350009r360"></a>
<!--l. 2215--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.7</span> <a 
 id="x1-3510007"></a>Transmitq CSUM Statistics</h6>
The structure corresponding to the transmitq checksum statistics is <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_net_stats_tx_csum</span>. The corresponding type is VIRTIO_NET_STATS_TYPE_TX_CSUM.
This is for the transmitq.
<!--l. 2221--><p class="noindent" >Only after the VIRTIO_NET_F_CSUM is negotiated, the transmitq checksum
statistics can be obtained.
<!--l. 2224--><p class="noindent" >The following are the transmitq checksum statistics:
<!--l. 2226-->
<pre class="lstlisting" id="listing-102"><span class="label"><a 
 id="x1-351001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_tx_csum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-351002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-351003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-351004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_csum_none</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-351005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_needs_csum</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-351006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2235--><p class="noindent" >The packets described below are all for a specific virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2237--><p class="noindent" >
<span 
class="aeb10-">tx_csum_none</span> </dt><dd 
class="description">
    <!--l. 2237--><p class="noindent" >The number of packets which do not require hardware checksum.
    </dd><dt class="description">
    <!--l. 2240--><p class="noindent" >
<span 
class="aeb10-">tx_needs_csum</span> </dt><dd 
class="description">
    <!--l. 2240--><p class="noindent" >The number of packets which require checksum calculation by the device.
                                                                  

                                                                  
    </dd></dl>
<a 
 id="x1-351007r361"></a>
<!--l. 2245--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.8</span> <a 
 id="x1-3520008"></a>Receiveq GSO Statistics</h6>
The structure corresponding to the receivq GSO statistics is <span 
class="aeti-10">struct virtio_net_stats_rx_gso</span>.
The corresponding type is VIRTIO_NET_STATS_TYPE_RX_GSO. This is for the
receiveq.
<!--l. 2251--><p class="noindent" >If one or more of the VIRTIO_NET_F_GUEST_TSO4, VIRTIO_NET_F_GUEST_TSO6
have been negotiated, the receiveq GSO statistics can be obtained.
<!--l. 2254--><p class="noindent" >GSO packets refer to packets passed by the device to the driver where <span 
class="aeti-10">gso_type </span>is not
VIRTIO_NET_HDR_GSO_NONE.
<!--l. 2257-->
<pre class="lstlisting" id="listing-103"><span class="label"><a 
 id="x1-352001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_rx_gso</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-352002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-352003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-352004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_gso_packets</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-352005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_gso_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-352006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_gso_packets_coalesced</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-352007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_gso_bytes_coalesced</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-352008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2268--><p class="noindent" >The packets described below were all presented on the specified virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2270--><p class="noindent" >
<span 
class="aeb10-">rx_gso_packets</span> </dt><dd 
class="description">
    <!--l. 2270--><p class="noindent" >The number of the GSO packets received by the device.
    </dd><dt class="description">
    <!--l. 2273--><p class="noindent" >
<span 
class="aeb10-">rx_gso_bytes</span> </dt><dd 
class="description">
    <!--l. 2273--><p class="noindent" >The bytes of the GSO packets received by the device. This includes the
    header size of the GSO packet.
    </dd><dt class="description">
    <!--l. 2277--><p class="noindent" >
<span 
class="aeb10-">rx_gso_packets_coalesced</span> </dt><dd 
class="description">
    <!--l. 2277--><p class="noindent" >The number of the GSO packets coalesced by the device.
    </dd><dt class="description">
    <!--l. 2280--><p class="noindent" >
<span 
class="aeb10-">rx_gso_bytes_coalesced</span> </dt><dd 
class="description">
    <!--l. 2280--><p class="noindent" >The bytes of the GSO packets coalesced by the device. This includes the
    header size of the GSO packet.</dd></dl>
<a 
 id="x1-352009r362"></a>
                                                                  

                                                                  
<!--l. 2285--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.9</span> <a 
 id="x1-3530009"></a>Transmitq GSO Statistics</h6>
The structure corresponding to the transmitq GSO statistics is <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_net_stats_tx_gso</span>. The corresponding type is VIRTIO_NET_STATS_TYPE_TX_GSO.
This is for the transmitq.
<!--l. 2291--><p class="noindent" >If one or more of the VIRTIO_NET_F_HOST_TSO4, VIRTIO_NET_F_HOST_TSO6,
VIRTIO_NET_F_HOST_USO options have been negotiated, the transmitq GSO
statistics can be obtained.
<!--l. 2295--><p class="noindent" >GSO packets refer to packets passed by the driver to the device where <span 
class="aeti-10">gso_type </span>is not
VIRTIO_NET_HDR_GSO_NONE. See more <a 
href="#x1-2820002">5.1.8.2<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Packet Transmission --></a>.
<!--l. 2300-->
<pre class="lstlisting" id="listing-104"><span class="label"><a 
 id="x1-353001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_tx_gso</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_gso_packets</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_gso_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_gso_segments</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_gso_segments_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_gso_packets_noseg</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_gso_bytes_noseg</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-353010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2313--><p class="noindent" >The packets described below are all for a specific virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2315--><p class="noindent" >
<span 
class="aeb10-">tx_gso_packets</span> </dt><dd 
class="description">
    <!--l. 2315--><p class="noindent" >The number of the GSO packets sent by the device.
    </dd><dt class="description">
    <!--l. 2318--><p class="noindent" >
<span 
class="aeb10-">tx_gso_bytes</span> </dt><dd 
class="description">
    <!--l. 2318--><p class="noindent" >The bytes of the GSO packets sent by the device.
    </dd><dt class="description">
    <!--l. 2321--><p class="noindent" >
<span 
class="aeb10-">tx_gso_segments</span> </dt><dd 
class="description">
    <!--l. 2321--><p class="noindent" >The number of segments prepared from GSO packets.
    </dd><dt class="description">
    <!--l. 2324--><p class="noindent" >
<span 
class="aeb10-">tx_gso_segments_bytes</span> </dt><dd 
class="description">
    <!--l. 2324--><p class="noindent" >The bytes of segments prepared from GSO packets.
    </dd><dt class="description">
    <!--l. 2327--><p class="noindent" >
<span 
class="aeb10-">tx_gso_packets_noseg</span> </dt><dd 
class="description">
    <!--l. 2327--><p class="noindent" >The number of the GSO packets without segmentation.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 2330--><p class="noindent" >
<span 
class="aeb10-">tx_gso_bytes_noseg</span> </dt><dd 
class="description">
    <!--l. 2330--><p class="noindent" >The bytes of the GSO packets without segmentation.
    </dd></dl>
<a 
 id="x1-353011r363"></a>
<!--l. 2335--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.10</span> <a 
 id="x1-35400010"></a>Receiveq Speed Statistics</h6>
The structure corresponding to the receiveq speed statistics is <span 
class="aeti-10">struct virtio_net_stats_rx_speed</span>.
The corresponding type is VIRTIO_NET_STATS_TYPE_RX_SPEED. This is for the
receiveq.
<!--l. 2341--><p class="noindent" >The device has the allowance for the speed. If VIRTIO_NET_F_SPEED_DUPLEX
has been negotiated, the driver can get this by <span 
class="aeti-10">speed</span>. When the received packets
bitrate exceeds the <span 
class="aeti-10">speed</span>, some packets may be dropped by the device.
<!--l. 2346-->
<pre class="lstlisting" id="listing-105"><span class="label"><a 
 id="x1-354001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_rx_speed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-354002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-354003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-354004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_packets_allowance_exceeded</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-354005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_bytes_allowance_exceeded</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-354006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2355--><p class="noindent" >The packets described below were all presented on the specified virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2357--><p class="noindent" >
<span 
class="aeb10-">rx_packets_allowance_exceeded</span> </dt><dd 
class="description">
    <!--l. 2357--><p class="noindent" >The number of the packets dropped by the device due to the received
    packets bitrate exceeding the <span 
class="aeti-10">speed</span>.
    </dd><dt class="description">
    <!--l. 2361--><p class="noindent" >
<span 
class="aeb10-">rx_bytes_allowance_exceeded</span> </dt><dd 
class="description">
    <!--l. 2361--><p class="noindent" >The bytes of the packets dropped by the device due to the received packets
    bitrate exceeding the <span 
class="aeti-10">speed</span>.
    </dd></dl>
<a 
 id="x1-354007r364"></a>
<!--l. 2367--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.11</span> <a 
 id="x1-35500011"></a>Transmitq Speed Statistics</h6>
The structure corresponding to the transmitq speed statistics is <span 
class="aeti-10">struct virtio_net_stats_tx_speed</span>.
The corresponding type is VIRTIO_NET_STATS_TYPE_TX_SPEED. This is for the
transmitq.
                                                                  

                                                                  
<!--l. 2373--><p class="noindent" >The device has the allowance for the speed. If VIRTIO_NET_F_SPEED_DUPLEX
has been negotiated, the driver can get this by <span 
class="aeti-10">speed</span>. When the transmit packets
bitrate exceeds the <span 
class="aeti-10">speed</span>, some packets may be dropped by the device.
<!--l. 2378-->
<pre class="lstlisting" id="listing-106"><span class="label"><a 
 id="x1-355001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_tx_speed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-355002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_stats_reply_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-355003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-355004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_packets_allowance_exceeded</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-355005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_bytes_allowance_exceeded</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-355006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2387--><p class="noindent" >The packets described below were all presented on the specified virtqueue.
    <dl class="description"><dt class="description">
    <!--l. 2389--><p class="noindent" >
<span 
class="aeb10-">tx_packets_allowance_exceeded</span> </dt><dd 
class="description">
    <!--l. 2389--><p class="noindent" >The number of the packets dropped by the device due to the transmit
    packets bitrate exceeding the <span 
class="aeti-10">speed</span>.
    </dd><dt class="description">
    <!--l. 2393--><p class="noindent" >
<span 
class="aeb10-">tx_bytes_allowance_exceeded</span> </dt><dd 
class="description">
    <!--l. 2393--><p class="noindent" >The bytes of the packets dropped by the device due to the transmit packets
    bitrate exceeding the <span 
class="aeti-10">speed</span>.
    </dd></dl>
<a 
 id="x1-355007r365"></a>
<!--l. 2399--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.12</span> <a 
 id="x1-35600012"></a>Device Requirements: Device Statistics</h6>
When the VIRTIO_NET_F_DEVICE_STATS feature is negotiated, the device MUST
reply to the command VIRTIO_NET_CTRL_STATS_QUERY with the <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_net_stats_capabilities</span>. <span 
class="aeti-10">supported_stats_types </span>includes all the statistic types
supported by the device.
<!--l. 2406--><p class="noindent" >If <span 
class="aeti-10">struct virtio_net_ctrl_queue_stats </span>is incorrect (such as the following), the device
MUST set <span 
class="aeti-10">ack </span>to VIRTIO_NET_ERR. Even if there is only one error, the device
MUST fail the entire command.
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2410--><p class="noindent" ><span 
class="aeti-10">vq_index </span>exceeds the queue range.
    </li>
    <li class="itemize">
    <!--l. 2411--><p class="noindent" ><span 
class="aeti-10">types_bitmap </span>contains unknown types.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 2412--><p class="noindent" >One or more of the bits present in <span 
class="aeti-10">types_bitmap </span>is not valid for the specified
    virtqueue.
    </li>
    <li class="itemize">
    <!--l. 2414--><p class="noindent" >The feature corresponding to the specified <span 
class="aeti-10">types_bitmap </span>was not negotiated.</li></ul>
<!--l. 2418--><p class="noindent" >The device MUST set the actual size of the bytes occupied by the reply to the <span 
class="aeti-10">size </span>of
the <span 
class="aeti-10">hdr</span>. And the device MUST set the <span 
class="aeti-10">type </span>and the <span 
class="aeti-10">vq_index </span>of the statistic
header.
<!--l. 2422--><p class="noindent" >The <span 
class="aeti-10">command-specific-result </span>buffer allocated by the driver may be smaller or bigger
than all the statistics specified by <span 
class="aeti-10">struct virtio_net_ctrl_queue_stats</span>. The device
MUST fill up only upto the valid bytes.
<!--l. 2427--><p class="noindent" >The statistics counter replied by the device MUST wrap around to zero by the device
on the overflow.
<a 
 id="x1-356001r366"></a>
<!--l. 2430--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.5.11.13</span> <a 
 id="x1-35700013"></a>Driver Requirements: Device Statistics</h6>
The types contained in the <span 
class="aeti-10">types_bitmap </span>MUST be queried from the device via
command VIRTIO_NET_CTRL_STATS_QUERY.
<!--l. 2435--><p class="noindent" ><span 
class="aeti-10">types_bitmap </span>in <span 
class="aeti-10">struct virtio_net_ctrl_queue_stats </span>MUST be valid to the vq specified
by <span 
class="aeti-10">vq_index</span>.
<!--l. 2438--><p class="noindent" >The <span 
class="aeti-10">command-specific-result </span>buffer allocated by the driver MUST have enough capacity
to store all the statistics reply headers defined in <span 
class="aeti-10">struct virtio_net_ctrl_queue_stats</span>. If
the <span 
class="aeti-10">command-specific-result </span>buffer is fully utilized by the device but some replies are
missed, it is possible that some statistics may exceed the capacity of the driver’s
records. In such cases, the driver should allocate additional space for the
<span 
class="aeti-10">command-specific-result </span>buffer.
<a 
 id="x1-357001r314"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.8.6   </span> <a 
 id="x1-3580006"></a>Flow filter</h5>
<!--l. 2448--><p class="noindent" >A network device can support one or more flow filter rules. Each flow filter rule is
applied by matching a packet and then taking an action, such as directing the packet
to a specific receiveq or dropping the packet. An example of a match is matching on
specific source and destination IP addresses.
<!--l. 2453--><p class="noindent" >A flow filter rule is a device resource object that consists of a key, a processing
priority, and an action to either direct a packet to a receive queue or drop the
packet.
<!--l. 2457--><p class="noindent" >Each rule uses a classifier. The key is matched against the packet using a classifier,
defining which fields in the packet are matched. A classifier resource object consists of
one or more field selectors, each with a type that specifies the header fields to be
matched against, and a mask. The mask can match whole fields or parts of a field
in a header. Each rule resource object depends on the classifier resource
                                                                  

                                                                  
object.
<!--l. 2464--><p class="noindent" >When a packet is received, relevant fields are extracted (in the same way) from both
the packet and the key according to the classifier. The resulting field contents are
then compared - if they are identical the rule action is taken, if they are not, the rule
is ignored.
<!--l. 2469--><p class="noindent" >Multiple flow filter rules are part of a group. The rule resource object depends on the
group. Each rule within a group has a rule priority, and each group also has a group
priority. For a packet, a group with the highest priority is selected first. Within a
group, rules are applied from highest to lowest priority, until one of the
rules matches the packet and an action is taken. If all the rules within a
group are ignored, the group with the next highest priority is selected, and so
on.
<!--l. 2477--><p class="noindent" >The device and the driver indicates flow filter resource limits using the capability
<a 
href="#x1-3610001">5.1.8.6.2.1<!--tex4ht:ref: par:Device Types / Network Device / Device Operation / Flow filter / Device and driver capabilities / VIRTIO-NET-FF-RESOURCE-CAP --></a> specifying the limits on the number of flow filter rule, group and classifier
resource objects. The capability <a 
href="#x1-3620002">5.1.8.6.2.2<!--tex4ht:ref: par:Device Types / Network Device / Device Operation / Flow filter / Device and driver capabilities / VIRTIO-NET-FF-SELECTOR-CAP --></a> specifies which selectors the device
supports. The driver indicates the selectors it is using by setting the flow filter
selector capability, prior to adding any resource objects.
<!--l. 2483--><p class="noindent" >The capability <a 
href="#x1-3630003">5.1.8.6.2.3<!--tex4ht:ref: par:Device Types / Network Device / Device Operation / Flow filter / Device and driver capabilities / VIRTIO-NET-FF-ACTION-CAP --></a> specifies which actions the device supports.
<!--l. 2485--><p class="noindent" >The driver controls the flow filter rule, classifier and group resource objects using
administration commands described in <a 
href="#x1-1220003">2.12.1.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device resource objects --></a>.
<a 
 id="x1-358001r354"></a>
<!--l. 2489--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.6.1</span> <a 
 id="x1-3590001"></a>Packet processing order</h5>
Note that flow filter rules are applied after MAC/VLAN filtering. Flow filter rules
take precedence over steering: if a flow filter rule results in an action, the steering
configuration does not apply. The steering configuration only applies to packets for
which no flow filter rule action was performed. For example, incoming packets can be
processed in the following order:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2498--><p class="noindent" >apply steering configuration received using control virtqueue commands
    VIRTIO_NET_CTRL_RX,           VIRTIO_NET_CTRL_MAC           and
    VIRTIO_NET_CTRL_VLAN.
    </li>
    <li class="itemize">
    <!--l. 2500--><p class="noindent" >apply flow filter rules if any.
    </li>
    <li class="itemize">
    <!--l. 2501--><p class="noindent" >if  no  filter  rule  applied,  apply  steering  configuration  received  using
    command VIRTIO_NET_CTRL_MQ_RSS_CONFIG or as per automatic
                                                                  

                                                                  
    receive steering.</li></ul>
<!--l. 2505--><p class="noindent" >Some incoming packet processing examples:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2507--><p class="noindent" >If the packet is dropped by the flow filter rule, RSS steering is ignored for
    the packet.
    </li>
    <li class="itemize">
    <!--l. 2509--><p class="noindent" >If the packet is directed to a specific receiveq using flow filter rule, the RSS
    steering is ignored for the packet.
    </li>
    <li class="itemize">
    <!--l. 2511--><p class="noindent" >If a packet is dropped due to the VIRTIO_NET_CTRL_MAC configuration,
    both flow filter rules and the RSS steering are ignored for the packet.
    </li>
    <li class="itemize">
    <!--l. 2513--><p class="noindent" >If a packet does not match any flow filter rules, the RSS steering is used
    to select the receiveq for the packet (if enabled).
    </li>
    <li class="itemize">
    <!--l. 2515--><p class="noindent" >If there are two flow filter groups configured as group_A and group_B with
    respective group priorities as 4, and 5; flow filter rules of group_B are
    applied first having highest group priority, if there is a match, the flow
    filter rules of group_A are ignored; if there is no match for the flow filter
    rules in group_B, the flow filter rules of next level group_A are applied.</li></ul>
<a 
 id="x1-359001r369"></a>
<!--l. 2522--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.6.2</span> <a 
 id="x1-3600002"></a>Device and driver capabilities</h5>
<a 
 id="x1-360001r367"></a>
<!--l. 2525--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.6.2.1</span> <a 
 id="x1-3610001"></a>VIRTIO_NET_FF_RESOURCE_CAP</h6>
The capability VIRTIO_NET_FF_RESOURCE_CAP indicates the flow filter resource
limits. <span 
class="aeti-10">cap_specific_data </span>is in the format <span 
class="aeti-10">struct virtio_net_ff_cap_data</span>.
<!--l. 2532-->
<pre class="lstlisting" id="listing-107"><span class="label"><a 
 id="x1-361001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ff_cap_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-361002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">groups_limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-361003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">selectors_limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-361004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rules_limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-361005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rules_per_group_limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-361006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">last_rule_priority</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-361007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">selectors_per_classifier_limit</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-361008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2543--><p class="noindent" ><span 
class="aeti-10">groups_limit</span>, and <span 
class="aeti-10">selectors_limit </span>represent the maximum number of flow filter groups
and selectors, respectively, that the driver can create. <span 
class="aeti-10">rules_limit </span>is the maximum
                                                                  

                                                                  
number of flow fiilter rules that the driver can create across all the groups.
<span 
class="aeti-10">rules_per_group_limit </span>is the maximum number of flow filter rules that the driver can
create for each flow filter group.
<!--l. 2550--><p class="noindent" ><span 
class="aeti-10">last_rule_priority </span>is the highest priority that can be assigned to a flow filter
rule.
<!--l. 2553--><p class="noindent" ><span 
class="aeti-10">selectors_per_classifier_limit </span>is the maximum number of selectors that a classifier can
have.
<a 
 id="x1-361009r371"></a>
<!--l. 2556--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.6.2.2</span> <a 
 id="x1-3620002"></a>VIRTIO_NET_FF_SELECTOR_CAP</h6>
The capability VIRTIO_NET_FF_SELECTOR_CAP lists the supported selectors and
the supported packet header fields for each selector. <span 
class="aeti-10">cap_specific_data </span>is in the format
<span 
class="aeti-10">struct virtio_net_ff_cap_mask_data</span>.
<!--l. 2563-->
<pre class="lstlisting" id="listing-108"><span class="label"><a 
 id="x1-362001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ff_selector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[2];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved1</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mask</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ff_cap_mask_data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ff_selector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">selectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-362016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_NET_FF_MASK_F_PARTIAL_MASK</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span></pre>
<!--l. 2582--><p class="noindent" ><span 
class="aeti-10">count </span>indicates number of valid entries in the <span 
class="aeti-10">selectors </span>array. <span 
class="aeti-10">selectors[] </span>is an array of
supported selectors. Within each array entry: <span 
class="aeti-10">type </span>specifies the type of the packet
header, as defined in table <a 
href="#x1-3620172">5.2<!--tex4ht:ref: table:Device Types / Network Device / Device Operation / Flow filter / Device and driver capabilities / VIRTIO-NET-FF-SELECTOR-CAP / flow filter selector types --></a>. <span 
class="aeti-10">mask </span>specifies which fields of the packet header can be
matched in a flow filter rule.
<!--l. 2588--><p class="noindent" >Each <span 
class="aeti-10">type </span>is also listed in table <a 
href="#x1-3620172">5.2<!--tex4ht:ref: table:Device Types / Network Device / Device Operation / Flow filter / Device and driver capabilities / VIRTIO-NET-FF-SELECTOR-CAP / flow filter selector types --></a>. <span 
class="aeti-10">mask </span>is a byte array in network byte order. For
example, when <span 
class="aeti-10">type </span>is VIRTIO_NET_FF_MASK_TYPE_IPV6, the <span 
class="aeti-10">mask </span>is in the
format <a 
href="#x1-3037x36">IPv6 Header Format</a>.
<!--l. 2593--><p class="noindent" >If partial masking is not set, then all bits in each field have to be either all 0s to
ignore this field or all 1s to match on this field. If partial masking is set, then any
combination of bits can bit set to match on these bits. For example, when a selector
<span 
class="aeti-10">type </span>is VIRTIO_NET_FF_MASK_TYPE_ETH, if <span 
class="aeti-10">mask[0-12] </span>are zero and
<span 
class="aeti-10">mask[13-14] </span>are 0xff (all 1s), it indicates that matching is only supported for
<span 
class="aeti-10">EtherType </span>of <span 
class="aeti-10">Ethernet MAC frame</span>, matching is not supported for <span 
class="aeti-10">Destination</span>
<span 
class="aeti-10">Address </span>and <span 
class="aeti-10">Source Address</span>.
<!--l. 2602--><p class="noindent" >The entries in the array <span 
class="aeti-10">selectors </span>are ordered by <span 
class="aeti-10">type</span>, with each <span 
class="aeti-10">type </span>value only
appearing once.
<!--l. 2605--><p class="noindent" ><span 
class="aeti-10">length </span>is the length of a dynamic array <span 
class="aeti-10">mask </span>in bytes. <span 
class="aeti-10">reserved </span>and <span 
class="aeti-10">reserved1 </span>are
reserved and set to zero.
<div class="table">
                                                                  

                                                                  
<!--l. 2608--><p class="noindent" ><a 
 id="x1-3620172"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Table 5.2: </span><span  
class="content">Flow filter selector types</span></div><!--tex4ht:label?: x1-3620172 -->
<!--l. 2629--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Type          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved                   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0x1 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >VIRTIO_NET_FF_MASK_TYPE_ETH</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >14 bytes
 of frame header starting from
 destination address described
 in <a 
href="#x1-3009x8">IEEE 802.3-2022</a>          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x2            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_NET_FF_MASK_TYPE_IPV4</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >20 bytes  of  <a 
href="#x1-3036x35">IPv4:  Internet
 Header Format</a>             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x3            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_NET_FF_MASK_TYPE_IPV6</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >40 bytes   of   <a 
href="#x1-3037x36">IPv6   Header
 Format</a>                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x4            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_NET_FF_MASK_TYPE_TCP</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >20 bytes   of   <a 
href="#x1-3040x39">TCP   Header
 Format</a>                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x5            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_NET_FF_MASK_TYPE_UDP</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >8 bytes   of   UDP   header
 described in <a 
href="#x1-3038x37">UDP</a>           </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x6 - 0xFF  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >                           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved for future          </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-9"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td></tr></table>
                                                                  

                                                                  
</div><hr class="endfloat" />
</div>
<!--l. 2632--><p class="noindent" >When VIRTIO_NET_FF_MASK_F_PARTIAL_MASK (bit 0) is set, it indicates that
partial masking is supported for all the fields of the selector identified by
<span 
class="aeti-10">type</span>.
<!--l. 2635--><p class="noindent" >For the selector <span 
class="aeti-10">type </span>VIRTIO_NET_FF_MASK_TYPE_IPV4, if a partial mask
is unsupported, then matching on an individual bit of <span 
class="aeti-10">Flags </span>in the <span 
class="aeti-10">IPv4:</span>
<span 
class="aeti-10">Internet Header Format </span>is unsupported. <span 
class="aeti-10">Flags </span>has to match as a whole if it is
supported.
<!--l. 2640--><p class="noindent" >For the selector <span 
class="aeti-10">type </span>VIRTIO_NET_FF_MASK_TYPE_IPV4, <span 
class="aeti-10">mask </span>includes fields up
to the <span 
class="aeti-10">Destination Address</span>; that is, <span 
class="aeti-10">Options </span>and <span 
class="aeti-10">Padding </span>are excluded.
<!--l. 2644--><p class="noindent" >For the selector <span 
class="aeti-10">type </span>VIRTIO_NET_FF_MASK_TYPE_IPV6, the <span 
class="aeti-10">Next Header </span>field of
the <span 
class="aeti-10">mask </span>corresponds to the <span 
class="aeti-10">Next Header </span>in the packet when <span 
class="aeti-10">IPv6 Extension</span>
<span 
class="aeti-10">Headers </span>are not present. When the packet includes one or more <span 
class="aeti-10">IPv6 Extension</span>
<span 
class="aeti-10">Headers</span>, the <span 
class="aeti-10">Next Header </span>field of the <span 
class="aeti-10">mask </span>corresponds to the <span 
class="aeti-10">Next Header </span>of the
last <span 
class="aeti-10">IPv6 Extension Header </span>in the packet.
<!--l. 2651--><p class="noindent" >For the selector <span 
class="aeti-10">type </span>VIRTIO_NET_FF_MASK_TYPE_TCP, <span 
class="aeti-10">Control bits </span>are treated
as individual fields for matching; that is, matching individual <span 
class="aeti-10">Control bits </span>does not
depend on the partial mask support.
<a 
 id="x1-362018r372"></a>
<!--l. 2655--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.6.2.3</span> <a 
 id="x1-3630003"></a>VIRTIO_NET_FF_ACTION_CAP</h6>
The capability VIRTIO_NET_FF_ACTION_CAP lists the supported actions in a
rule. <span 
class="aeti-10">cap_specific_data </span>is in the format <span 
class="aeti-10">struct virtio_net_ff_cap_actions</span>.
<!--l. 2661-->
<pre class="lstlisting" id="listing-109"><span class="label"><a 
 id="x1-363001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ff_actions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-363002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-363003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-363004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actions</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-363005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2669--><p class="noindent" ><span 
class="aeti-10">actions </span>is an array listing all possible actions. The entries in the array are ordered
from the smallest to the largest, with each supported value appearing exactly once.
Each entry can have the following values:
<div class="table">
                                                                  

                                                                  
<!--l. 2674--><p class="noindent" ><a 
 id="x1-3630063"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
 <div class="caption" 
><span class="id">Table 5.3: </span><span  
class="content">Flow filter rule actions</span></div><!--tex4ht:label?: x1-3630063 -->
<!--l. 2689--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Action        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Name                     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Description                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x0            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > -                         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > reserved                   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0x1 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >VIRTIO_NET_FF_ACTION_DROP</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Matching
 packet will be dropped by the
 device                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x2            </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > VIRTIO_NET_FF_ACTION_DIRECT_RX_VQ</td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Matching packet    will    be
 directed to a receive queue    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x3 - 0xFF  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >                           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved for future          </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td></tr></table>
                                                                  

                                                                  
</div><hr class="endfloat" />
</div>
<a 
 id="x1-363007r370"></a>
<!--l. 2692--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.6.3</span> <a 
 id="x1-3640003"></a>Resource objects</h5>
<a 
 id="x1-364001r374"></a>
<!--l. 2695--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.6.3.1</span> <a 
 id="x1-3650001"></a>VIRTIO_NET_RESOURCE_OBJ_FF_GROUP</h6>
A flow filter group contains between 0 and <span 
class="aeti-10">rules_limit </span>rules, as specified by the
capability VIRTIO_NET_FF_RESOURCE_CAP. For the flow filter group object both
<span 
class="aeti-10">resource_obj_specific_data </span>and <span 
class="aeti-10">resource_obj_specific_result </span>are in the format <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_net_resource_obj_ff_group</span>.
<!--l. 2703-->
<pre class="lstlisting" id="listing-110"><span class="label"><a 
 id="x1-365001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_resource_obj_ff_group</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-365002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">group_priority</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-365003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2709--><p class="noindent" ><span 
class="aeti-10">group_priority </span>specifies the priority for the group. Each group has a distinct priority.
For each incoming packet, the device tries to apply rules from groups from higher
<span 
class="aeti-10">group_priority </span>value to lower, until either a rule matches the packet or all groups
have been tried.
<a 
 id="x1-365004r377"></a>
<!--l. 2714--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.6.3.2</span> <a 
 id="x1-3660002"></a>VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER</h6>
A classifier is used to match a flow filter key against a packet. The classifier
defines the desired packet fields to match, and is represented by the
VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER device resource object.
<!--l. 2720--><p class="noindent" >For the flow filter classifier object both <span 
class="aeti-10">resource_obj_specific_data </span>and
<span 
class="aeti-10">resource_obj_specific_result </span>are in the format <span 
class="aeti-10">struct virtio_net_resource_obj_ff_classifier</span>.
<!--l. 2724-->
<pre class="lstlisting" id="listing-111"><span class="label"><a 
 id="x1-366001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_resource_obj_ff_classifier</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-366002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-366003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-366004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_ff_selector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">selectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-366005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2732--><p class="noindent" >A classifier is an array of <span 
class="aeti-10">selectors</span>. The number of selectors in the array is indicated
by <span 
class="aeti-10">count</span>. The selector has a type that specifies the header fields to be matched
against, and a mask. See <a 
href="#x1-3620002">5.1.8.6.2.2<!--tex4ht:ref: lst:Device Types / Network Device / Device Operation / Flow filter / Device and driver capabilities / VIRTIO-NET-FF-SELECTOR-CAP / virtio-net-ff-selector --></a> for details about selectors.
<!--l. 2738--><p class="noindent" >The first selector is always VIRTIO_NET_FF_MASK_TYPE_ETH. When there are
multiple selectors, a second selector can be either VIRTIO_NET_FF_MASK_TYPE_IPV4
or VIRTIO_NET_FF_MASK_TYPE_IPV6. If the third selector exists, the
third selector can be either VIRTIO_NET_FF_MASK_TYPE_UDP or
VIRTIO_NET_FF_MASK_TYPE_TCP. For example, to match a Ethernet IPv6 UDP
packet, <span 
class="aeti-10">selectors[0].type </span>is set to VIRTIO_NET_FF_MASK_TYPE_ETH,
                                                                  

                                                                  
<span 
class="aeti-10">selectors[1].type </span>is set to VIRTIO_NET_FF_MASK_TYPE_IPV6 and <span 
class="aeti-10">selectors[2].type</span>
is set to VIRTIO_NET_FF_MASK_TYPE_UDP; accordingly, <span 
class="aeti-10">selectors[0].mask[0-13]</span>
is for Ethernet header fields, <span 
class="aeti-10">selectors[1].mask[0-39] </span>is set for IPV6 header and
<span 
class="aeti-10">selectors[2].mask[0-7] </span>is set for UDP header.
<!--l. 2749--><p class="noindent" >When there are multiple selectors, the type of the (N+1)<sup class="textsuperscript"><span 
class="aer-9">th</span></sup> selector affects the mask
of the (N)<sup class="textsuperscript"><span 
class="aer-9">th</span></sup> selector. If <span 
class="aeti-10">count </span>is 2 or more, all the mask bits within <span 
class="aeti-10">selectors[0]</span>
corresponding to <span 
class="aeti-10">EtherType </span>of an Ethernet header are set.
<!--l. 2754--><p class="noindent" >If <span 
class="aeti-10">count </span>is more than 2:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2756--><p class="noindent" >if <span 
class="aeti-10">selector[1].type </span>is, VIRTIO_NET_FF_MASK_TYPE_IPV4, then, all the
    mask bits within <span 
class="aeti-10">selector[1] </span>for <span 
class="aeti-10">Protocol </span>is set.
    </li>
    <li class="itemize">
    <!--l. 2758--><p class="noindent" >if <span 
class="aeti-10">selector[1].type </span>is, VIRTIO_NET_FF_MASK_TYPE_IPV6, then, all the
    mask bits within <span 
class="aeti-10">selector[1] </span>for <span 
class="aeti-10">Next Header </span>is set.</li></ul>
<!--l. 2762--><p class="noindent" >If for a given packet header field, a subset of bits of a field is to be matched, and if
the partial mask is supported, the flow filter mask object can specify a mask which
has fewer bits set than the packet header field size. For example, a partial mask for
the Ethernet header source mac address can be of 1-bit for multicast detection
instead of 48-bits.
<a 
 id="x1-366006r378"></a>
<!--l. 2768--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.1.8.6.3.3</span> <a 
 id="x1-3670003"></a>VIRTIO_NET_RESOURCE_OBJ_FF_RULE</h6>
Each flow filter rule resource object comprises a key, a priority, and an action. For the
flow filter rule object, <span 
class="aeti-10">resource_obj_specific_data </span>and <span 
class="aeti-10">resource_obj_specific_result </span>are in
the format <span 
class="aeti-10">struct virtio_net_resource_obj_ff_rule</span>.
<!--l. 2776-->
<pre class="lstlisting" id="listing-112"><span class="label"><a 
 id="x1-367001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_net_resource_obj_ff_rule</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">group_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">classifier_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rule_priority</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">action</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved1</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[2];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">keys</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[][];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-367011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 2790--><p class="noindent" ><span 
class="aeti-10">group_id </span>is the resource object ID of the flow filter group to which this rule belongs.
<span 
class="aeti-10">classifier_id </span>is the resource object ID of the classifier used to match a packet against
the <span 
class="aeti-10">key</span>.
<!--l. 2794--><p class="noindent" ><span 
class="aeti-10">rule_priority </span>denotes the priority of the rule within the group specified by the
<span 
class="aeti-10">group_id</span>. Rules within the group are applied from the highest to the lowest priority
until a rule matches the packet and an action is taken. Rules with the same priority
can be applied in any order.
<!--l. 2800--><p class="noindent" ><span 
class="aeti-10">reserved </span>and <span 
class="aeti-10">reserved1 </span>are reserved and set to 0.
                                                                  

                                                                  
<!--l. 2802--><p class="noindent" ><span 
class="aeti-10">keys[][] </span>is an array of keys to match against packets, using the classifier specified by
<span 
class="aeti-10">classifier_id</span>. Each entry (key) comprises a byte array, and they are located one
immediately after another. The size (number of entries) of the array is exactly the
same as that of <span 
class="aeti-10">selectors </span>in the classifier, or in other words, <span 
class="aeti-10">count </span>in the
classifier.
<!--l. 2809--><p class="noindent" ><span 
class="aeti-10">key_length </span>specifies the total length of <span 
class="aeti-10">keys </span>in bytes. In other words, it equals the
sum total of <span 
class="aeti-10">length </span>of all selectors in <span 
class="aeti-10">selectors </span>in the classifier specified by
<span 
class="aeti-10">classifier_id</span>.
<!--l. 2814--><p class="noindent" >For example, if a classifier object’s <span 
class="aeti-10">selectors[0].type </span>is VIRTIO_NET_FF_MASK_TYPE_ETH
and <span 
class="aeti-10">selectors[1].type </span>is VIRTIO_NET_FF_MASK_TYPE_IPV6, then selectors[0].length
is 14 and selectors[1].length is 40. Accordingly, the <span 
class="aeti-10">key_length </span>is set to 54. This
setting indicates that the <span 
class="aeti-10">key </span>array’s length is 54 bytes comprising a first byte array
of 14 bytes for the Ethernet MAC header in bytes 0-13, immediately followed by 40
bytes for the IPv6 header in bytes 14-53.
<!--l. 2824--><p class="noindent" >When there are multiple selectors in the classifier object, the key bytes for (N)<sup class="textsuperscript"><span 
class="aer-9">th</span></sup>
selector are set so that (N+1)<sup class="textsuperscript"><span 
class="aer-9">th</span></sup> selector can be matched.
<!--l. 2828--><p class="noindent" >If <span 
class="aeti-10">count </span>is 2 or more, key bytes of <span 
class="aeti-10">EtherType </span>are set according to <a 
href="#x1-3010x9">IEEE 802 Ethertypes</a>
for VIRTIO_NET_FF_MASK_TYPE_IPV4 or VIRTIO_NET_FF_MASK_TYPE_IPV6
respectively.
<!--l. 2832--><p class="noindent" >If <span 
class="aeti-10">count </span>is more than 2, when <span 
class="aeti-10">selector[1].type </span>is VIRTIO_NET_FF_MASK_TYPE_IPV4
or VIRTIO_NET_FF_MASK_TYPE_IPV6, key bytes of <span 
class="aeti-10">Protocol </span>or <span 
class="aeti-10">Next</span>
<span 
class="aeti-10">Header </span>is set as per <span 
class="aeti-10">Protocol Numbers </span>defined <a 
href="#x1-3011x10">IANA Protocol Numbers</a>
respectively.
<!--l. 2838--><p class="noindent" ><span 
class="aeti-10">action </span>is the action to take when a packet matches the <span 
class="aeti-10">key </span>using the <span 
class="aeti-10">classifier_id</span>.
Supported actions are described in <a 
href="#x1-3630063">5.3<!--tex4ht:ref: table:Device Types / Network Device / Device Operation / Flow filter / Device and driver capabilities / VIRTIO-NET-FF-ACTION-CAP / flow filter rule actions --></a>.
<!--l. 2842--><p class="noindent" ><span 
class="aeti-10">vq_index </span>specifies a receive virtqueue. When the <span 
class="aeti-10">action </span>is set to
VIRTIO_NET_FF_ACTION_DIRECT_RX_VQ, and the packet matches the <span 
class="aeti-10">key</span>, the
matching packet is directed to this virtqueue.
<!--l. 2846--><p class="noindent" >Note that at most one action is ever taken for a given packet. If a rule is applied and
an action is taken, the action of other rules is not taken.
<a 
 id="x1-367012r376"></a>
<!--l. 2849--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.6.4</span> <a 
 id="x1-3680004"></a>Device Requirements: Flow filter</h5>
When the device supports flow filter operations,
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2853--><p class="noindent" >the      device      MUST      set      VIRTIO_NET_FF_RESOURCE_CAP,
    VIRTIO_NET_FF_SELECTOR_CAP
    and VIRTIO_NET_FF_ACTION_CAP capability in the <span 
class="aeti-10">supported_caps </span>in
    the command VIRTIO_ADMIN_CMD_CAP_SUPPORT_QUERY.
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 2856--><p class="noindent" >the     device     MUST     support     the     administration     commands
    VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE,
    VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY,
    VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY,
    VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY  for  the  resource
    types                            VIRTIO_NET_RESOURCE_OBJ_FF_GROUP,
    VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER                        and
    VIRTIO_NET_RESOURCE_OBJ_FF_RULE.</li></ul>
<!--l. 2864--><p class="noindent" >When any of the VIRTIO_NET_FF_RESOURCE_CAP, VIRTIO_NET_FF_SELECTOR_CAP,
or VIRTIO_NET_FF_ACTION_CAP capability is disabled, the device
SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_Q_INVALID_OPCODE
for the commands VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE,
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_MODIFY,
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_QUERY, and
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY. These commands
apply to the resource <span 
class="aeti-10">type </span>of VIRTIO_NET_RESOURCE_OBJ_FF_GROUP,
VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER, and
VIRTIO_NET_RESOURCE_OBJ_FF_RULE.
<!--l. 2873--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_EINVAL for the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE when the resource
<span 
class="aeti-10">type </span>is VIRTIO_NET_RESOURCE_OBJ_FF_GROUP, if a flow filter group already
exists with the supplied <span 
class="aeti-10">group_priority</span>.
<!--l. 2878--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_ENOSPC for the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE when the resource
<span 
class="aeti-10">type </span>is VIRTIO_NET_RESOURCE_OBJ_FF_GROUP, if the number of flow filter
group objects in the device exceeds the lower of the configured driver capabilities
<span 
class="aeti-10">groups_limit </span>and <span 
class="aeti-10">rules_per_group_limit</span>.
<!--l. 2884--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_ENOSPC for the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE when the resource
<span 
class="aeti-10">type </span>is VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER, if the number of flow
filter selector objects in the device exceeds the configured driver capability
<span 
class="aeti-10">selectors_limit</span>.
<!--l. 2890--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_EBUSY for the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY for a flow filter
group when the flow filter group has one or more flow filter rules depending on
it.
<!--l. 2894--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_ADMIN_STATUS_EBUSY for the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY for a flow filter
classifier when the flow filter classifier has one or more flow filter rules depending on
it.
                                                                  

                                                                  
<!--l. 2898--><p class="noindent" >The device SHOULD fail the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE
for the flow filter rule resource object if,
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2901--><p class="noindent" ><span 
class="aeti-10">vq_index    </span>is    not    a    valid    receive    virtqueue    index    for    the
    VIRTIO_NET_FF_ACTION_DIRECT_RX_VQ action,
    </li>
    <li class="itemize">
    <!--l. 2903--><p class="noindent" ><span 
class="aeti-10">priority </span>is greater than or equal to <span 
class="aeti-10">last_rule_priority</span>,
    </li>
    <li class="itemize">
    <!--l. 2905--><p class="noindent" ><span 
class="aeti-10">id  </span>is  greater  than  or  equal  to  <span 
class="aeti-10">rules_limit  </span>or  greater  than  or  equal  to
    <span 
class="aeti-10">rules_per_group_limit</span>, whichever is lower,
    </li>
    <li class="itemize">
    <!--l. 2907--><p class="noindent" >the length of <span 
class="aeti-10">keys </span>and the length of all the mask bytes of <span 
class="aeti-10">selectors[].mask</span>
    as referred by <span 
class="aeti-10">classifier_id </span>differs,
    </li>
    <li class="itemize">
    <!--l. 2909--><p class="noindent" >the    supplied    <span 
class="aeti-10">action    </span>is    not    supported    in    the    capability
    VIRTIO_NET_FF_ACTION_CAP.</li></ul>
<!--l. 2912--><p class="noindent" >When the flow filter directs a packet to the virtqueue identified by <span 
class="aeti-10">vq_index </span>and if the
receive virtqueue is reset, the device MUST drop such packets.
<!--l. 2916--><p class="noindent" >Upon applying a flow filter rule to a packet, the device MUST STOP any further
application of rules and cease applying any other steering configurations.
<!--l. 2919--><p class="noindent" >For multiple flow filter groups, the device MUST apply the rules from the group with
the highest priority. If any rule from this group is applied, the device MUST
ignore the remaining groups. If none of the rules from the highest priority
group match, the device MUST apply the rules from the group with the
next highest priority, until either a rule matches or all groups have been
attempted.
<!--l. 2926--><p class="noindent" >The device MUST apply the rules within the group from the highest to the lowest
priority until a rule matches the packet, and the device MUST take the action.
If an action is taken, the device MUST not take any other action for this
packet.
<!--l. 2931--><p class="noindent" >The device MAY apply the rules with the same <span 
class="aeti-10">rule_priority </span>in any order within the
group.
<!--l. 2934--><p class="noindent" >The device MUST process incoming packets in the following order:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2936--><p class="noindent" >apply   the   steering   configuration   received   using   control   virtqueue
    commands  VIRTIO_NET_CTRL_RX,  VIRTIO_NET_CTRL_MAC,  and
    VIRTIO_NET_CTRL_VLAN.
    </li>
    <li class="itemize">
    <!--l. 2939--><p class="noindent" >apply flow filter rules if any.
    </li>
    <li class="itemize">
    <!--l. 2940--><p class="noindent" >if no filter rule is applied, apply the steering configuration received using
    the  command  VIRTIO_NET_CTRL_MQ_RSS_CONFIG  or  according  to
    automatic receive steering.</li></ul>
<!--l. 2945--><p class="noindent" >When processing an incoming packet, if the packet is dropped at any stage, the
device MUST skip further processing.
<!--l. 2948--><p class="noindent" >When the device drops the packet due to the configuration done using the control
virtqueue commands VIRTIO_NET_CTRL_RX or VIRTIO_NET_CTRL_MAC or
VIRTIO_NET_CTRL_VLAN, the device MUST skip flow filter rules for this
packet.
<!--l. 2952--><p class="noindent" >When the device performs flow filter match operations and if the operation result did
not have any match in all the groups, the receive packet processing continues to next
level, i.e. to apply configuration done using VIRTIO_NET_CTRL_MQ_RSS_CONFIG
command.
<!--l. 2957--><p class="noindent" >The device MUST support the creation of flow filter classifier objects using the
command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE with <span 
class="aeti-10">flags </span>set to
VIRTIO_NET_FF_MASK_F_PARTIAL_MASK; this support is required even if all
the bits of the masks are set for a field in <span 
class="aeti-10">selectors</span>, provided that partial masking is
supported for the selectors.
<a 
 id="x1-368001r380"></a>
<!--l. 2964--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.1.8.6.5</span> <a 
 id="x1-3690005"></a>Driver Requirements: Flow filter</h5>
The driver MUST enable VIRTIO_NET_FF_RESOURCE_CAP,
VIRTIO_NET_FF_SELECTOR_CAP, and VIRTIO_NET_FF_ACTION_CAP
capabilities to use flow filter.
<!--l. 2969--><p class="noindent" >The driver SHOULD NOT remove a flow filter group using the command
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY when one or more flow filter
rules depend on that group. The driver SHOULD only destroy the group after all the
associated rules have been destroyed.
<!--l. 2974--><p class="noindent" >The driver SHOULD NOT remove a flow filter classifier using the command
VIRTIO_ADMIN_CMD_RESOURCE_OBJ_DESTROY when one or more flow filter
                                                                  

                                                                  
rules depend on the classifier. The driver SHOULD only destroy the classifier after all
the associated rules have been destroyed.
<!--l. 2979--><p class="noindent" >The driver SHOULD NOT add multiple flow filter rules with the same <span 
class="aeti-10">rule_priority</span>
within a flow filter group, as these rules MAY match the same packet. The driver
SHOULD assign different <span 
class="aeti-10">rule_priority </span>values to different flow filter rules if multiple
rules may match a single packet.
<!--l. 2985--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE, when
creating a resource of <span 
class="aeti-10">type </span>VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER, the
driver MUST set:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2988--><p class="noindent" ><span 
class="aeti-10">selectors[0].type </span>to VIRTIO_NET_FF_MASK_TYPE_ETH.
    </li>
    <li class="itemize">
    <!--l. 2989--><p class="noindent" ><span 
class="aeti-10">selectors[1].type      </span>to      VIRTIO_NET_FF_MASK_TYPE_IPV4      or
    VIRTIO_NET_FF_MASK_TYPE_IPV6 when <span 
class="aeti-10">count </span>is more than 1,
    </li>
    <li class="itemize">
    <!--l. 2991--><p class="noindent" ><span 
class="aeti-10">selectors[2].type           </span>VIRTIO_NET_FF_MASK_TYPE_UDP           or
    VIRTIO_NET_FF_MASK_TYPE_TCP when <span 
class="aeti-10">count </span>is more than 2.</li></ul>
<!--l. 2995--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE, when
creating a resource of <span 
class="aeti-10">type </span>VIRTIO_NET_RESOURCE_OBJ_FF_CLASSIFIER, the
driver MUST set:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 2998--><p class="noindent" ><span 
class="aeti-10">selectors[0].mask </span>bytes to all 1s for the <span 
class="aeti-10">EtherType </span>when <span 
class="aeti-10">count </span>is 2 or more.
    </li>
    <li class="itemize">
    <!--l. 3000--><p class="noindent" ><span 
class="aeti-10">selectors[1].mask     </span>bytes     to     all     1s     for     <span 
class="aeti-10">Protocol     </span>or     <span 
class="aeti-10">Next</span>
    <span 
class="aeti-10">Header </span>when <span 
class="aeti-10">selector[1].type </span>is VIRTIO_NET_FF_MASK_TYPE_IPV4 or
    VIRTIO_NET_FF_MASK_TYPE_IPV6, and when <span 
class="aeti-10">count </span>is more than 2.</li></ul>
<!--l. 3005--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE, the resource
<span 
class="aeti-10">type </span>VIRTIO_NET_RESOURCE_OBJ_FF_RULE, if the corresponding classifier object’s
<span 
class="aeti-10">count </span>is 2 or more, the driver MUST SET the <span 
class="aeti-10">keys </span>bytes of <span 
class="aeti-10">EtherType </span>in accordance
with <a 
href="#x1-3010x9">IEEE 802 Ethertypes</a> for either VIRTIO_NET_FF_MASK_TYPE_IPV4 or
VIRTIO_NET_FF_MASK_TYPE_IPV6.
<!--l. 3012--><p class="noindent" >For the command VIRTIO_ADMIN_CMD_RESOURCE_OBJ_CREATE, when creating
a resource of <span 
class="aeti-10">type </span>VIRTIO_NET_RESOURCE_OBJ_FF_RULE, if the corresponding
                                                                  

                                                                  
classifier object’s <span 
class="aeti-10">count </span>is more than 2, and the <span 
class="aeti-10">selector[1].type </span>is either
VIRTIO_NET_FF_MASK_TYPE_IPV4 or VIRTIO_NET_FF_MASK_TYPE_IPV6,
the driver MUST set the <span 
class="aeti-10">keys </span>bytes for the <span 
class="aeti-10">Protocol </span>or <span 
class="aeti-10">Next Header </span>according to
<a 
href="#x1-3011x10">IANA Protocol Numbers</a> respectively.
<!--l. 3019--><p class="noindent" >The driver SHOULD set all the bits for a field in the mask of a selector in both the capability
and the classifier object, unless the VIRTIO_NET_FF_MASK_F_PARTIAL_MASK is
enabled.
<a 
 id="x1-369001r368"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.1.8.7   </span> <a 
 id="x1-3700007"></a>Legacy Interface: Framing Requirements</h5>
<!--l. 3026--><p class="noindent" >When using legacy interfaces, transitional drivers which have not negotiated
VIRTIO_F_ANY_LAYOUT MUST use a single descriptor for the <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_net_hdr </span>on both transmit and receive, with the network data in the following
descriptors.
<!--l. 3031--><p class="noindent" >Additionally, when using the control virtqueue (see <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>) , transitional drivers
which have not negotiated VIRTIO_F_ANY_LAYOUT MUST:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 3036--><p class="noindent" >for all commands, use a single 2-byte descriptor including the first two
    fields: <span 
class="aeti-10">class </span>and <span 
class="aeti-10">command</span>
    </li>
    <li class="itemize">
    <!--l. 3038--><p class="noindent" >for all commands except VIRTIO_NET_CTRL_MAC_TABLE_SET use a
    single descriptor including command-specific-data with no padding.
    </li>
    <li class="itemize">
    <!--l. 3041--><p class="noindent" >for  the  VIRTIO_NET_CTRL_MAC_TABLE_SET  command  use  exactly
    two descriptors including command-specific-data with no padding: the first
    of these descriptors MUST include the virtio_net_ctrl_mac table structure
    for the unicast addresses with no padding, the second of these descriptors
    MUST include the virtio_net_ctrl_mac table structure for the multicast
    addresses with no padding.
    </li>
    <li class="itemize">
    <!--l. 3048--><p class="noindent" >for all commands, use a single 1-byte descriptor for the <span 
class="aeti-10">ack </span>field</li></ul>
<!--l. 3052--><p class="noindent" >See <a 
href="#x1-390004">2.7.4<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Message Framing --></a>.
<a 
 id="x1-370001r277"></a>
<h3 class="sectionHead"><span class="titlemark">5.2   </span> <a 
 id="x1-3710002"></a>Block Device</h3>
<!--l. 3--><p class="noindent" >The virtio block device is a simple virtual block device (ie. disk). Read and write
                                                                  

                                                                  
requests (and other exotic requests) are placed in one of its queues, and serviced
(probably out of order) by the device except where noted.
<a 
 id="x1-371001r290"></a>
<h4 class="subsectionHead"><span class="titlemark">5.2.1   </span> <a 
 id="x1-3720001"></a>Device ID</h4>
<!--l. 9--><p class="noindent" >2
<a 
 id="x1-372001r384"></a>
<h4 class="subsectionHead"><span class="titlemark">5.2.2   </span> <a 
 id="x1-3730002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 13--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 13--><p class="noindent" >requestq1
    </dd><dt class="description">
    <!--l. 14--><p class="noindent" >
<span 
class="aeb10-">…</span> </dt><dd 
class="description">
    <!--l. 14--><p class="noindent" >
    </dd><dt class="description">
    <!--l. 15--><p class="noindent" >
<span 
class="aeb10-">N-1</span> </dt><dd 
class="description">
    <!--l. 15--><p class="noindent" >requestqN</dd></dl>
<!--l. 18--><p class="noindent" >N=1 if VIRTIO_BLK_F_MQ is not negotiated, otherwise N is set by <span 
class="aeti-10">num_queues</span>.
<a 
 id="x1-373001r385"></a>
<h4 class="subsectionHead"><span class="titlemark">5.2.3   </span> <a 
 id="x1-3740003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 24--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_SIZE_MAX (1)</span> </dt><dd 
class="description">
    <!--l. 24--><p class="noindent" >Maximum size of any single segment is in <span 
class="aeti-10">size_max</span>.
    </dd><dt class="description">
    <!--l. 27--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_SEG_MAX (2)</span> </dt><dd 
class="description">
    <!--l. 27--><p class="noindent" >Maximum number of segments in a request is in <span 
class="aeti-10">seg_max</span>.
    </dd><dt class="description">
    <!--l. 30--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_GEOMETRY (4)</span> </dt><dd 
class="description">
    <!--l. 30--><p class="noindent" >Disk-style geometry specified in <span 
class="aeti-10">geometry</span>.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 33--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_RO (5)</span> </dt><dd 
class="description">
    <!--l. 33--><p class="noindent" >Device is read-only.
    </dd><dt class="description">
    <!--l. 35--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_BLK_SIZE (6)</span> </dt><dd 
class="description">
    <!--l. 35--><p class="noindent" >Block size of disk is in <span 
class="aeti-10">blk_size</span>.
    </dd><dt class="description">
    <!--l. 37--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_FLUSH (9)</span> </dt><dd 
class="description">
    <!--l. 37--><p class="noindent" >Cache flush command support.
    </dd><dt class="description">
    <!--l. 39--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_TOPOLOGY (10)</span> </dt><dd 
class="description">
    <!--l. 39--><p class="noindent" >Device exports information on optimal I/O alignment.
    </dd><dt class="description">
    <!--l. 42--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_CONFIG_WCE (11)</span> </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >Device can toggle its cache between writeback and writethrough modes.
    </dd><dt class="description">
    <!--l. 45--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_MQ (12)</span> </dt><dd 
class="description">
    <!--l. 45--><p class="noindent" >Device supports multiqueue.
    </dd><dt class="description">
    <!--l. 47--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_DISCARD (13)</span> </dt><dd 
class="description">
    <!--l. 47--><p class="noindent" >Device  can  support  discard  command,  maximum  discard  sectors  size
    in   <span 
class="aeti-10">max_discard_sectors   </span>and   maximum   discard   segment   number   in
    <span 
class="aeti-10">max_discard_seg</span>.
    </dd><dt class="description">
    <!--l. 51--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_WRITE_ZEROES (14)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 51--><p class="noindent" >Device can support write zeroes command, maximum write zeroes sectors
    size  in  <span 
class="aeti-10">max_write_zeroes_sectors  </span>and  maximum  write  zeroes  segment
    number in <span 
class="aeti-10">max_write_zeroes_seg</span>.
    </dd><dt class="description">
    <!--l. 55--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_LIFETIME (15)</span> </dt><dd 
class="description">
    <!--l. 55--><p class="noindent" >Device supports providing storage lifetime information.
    </dd><dt class="description">
    <!--l. 58--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_SECURE_ERASE (16)</span> </dt><dd 
class="description">
    <!--l. 58--><p class="noindent" >Device  supports  secure  erase  command,  maximum  erase  sectors  count
    in  <span 
class="aeti-10">max_secure_erase_sectors  </span>and  maximum  erase  segment  number  in
    <span 
class="aeti-10">max_secure_erase_seg</span>.
    </dd><dt class="description">
    <!--l. 62--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_ZONED(17)</span> </dt><dd 
class="description">
    <!--l. 62--><p class="noindent" >Device is a Zoned Block Device, that is, a device that follows the zoned
    storage device behavior that is also supported by industry standards such
    as the T10 Zoned Block Command standard (ZBC r05) or the NVMe(TM)
    NVM Express Zoned Namespace Command Set Specification 1.1b (ZNS).
    For brevity, these standard documents are referred as "ZBD standards"
    from this point on in the text.
    </dd></dl>
<a 
 id="x1-374001r382"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.3.1   </span> <a 
 id="x1-3750001"></a>Legacy Interface: Feature bits</h5>
    <dl class="description"><dt class="description">
    <!--l. 74--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_BARRIER (0)</span> </dt><dd 
class="description">
    <!--l. 74--><p class="noindent" >Device supports request barriers.
    </dd><dt class="description">
    <!--l. 76--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BLK_F_SCSI (7)</span> </dt><dd 
class="description">
    <!--l. 76--><p class="noindent" >Device supports scsi packet commands.</dd></dl>
<span 
class="aeb10-">Note:</span> In   the   legacy   interface,   VIRTIO_BLK_F_FLUSH   was   also   called
      VIRTIO_BLK_F_WCE.
                                                                  

                                                                  
<a 
 id="x1-375001r386"></a>
<h4 class="subsectionHead"><span class="titlemark">5.2.4   </span> <a 
 id="x1-3760004"></a>Device configuration layout</h4>
<!--l. 86--><p class="noindent" >The block device has the following device configuration layout.
<!--l. 88-->
<pre class="lstlisting" id="listing-113"><span class="label"><a 
 id="x1-376001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capacity</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size_max</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">seg_max</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_geometry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cylinders</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">heads</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">geometry</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blk_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_topology</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">logical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">per</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">physical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">log2</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">physical_block_exp</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">first</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aligned</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">logical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">alignment_offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">suggested</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">minimum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">I</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">O</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blocks</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">min_io_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">optimal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">suggested</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">maximum</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">I</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">O</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blocks</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opt_io_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">topology</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writeback</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unused0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_queues</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_discard_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_discard_seg</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">discard_sector_alignment</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_write_zeroes_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_write_zeroes_seg</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write_zeroes_may_unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unused1</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_secure_erase_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_secure_erase_seg</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">secure_erase_sector_alignment</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_zoned_characteristics</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zone_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_open_zones</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_active_zones</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_append_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write_granularity</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">model</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unused2</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376042r42"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zoned</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376043r43"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 134--><p class="noindent" >The <span 
class="aeti-10">capacity </span>of the device (expressed in 512-byte sectors) is always present.
The availability of the others all depend on various feature bits as indicated
above.
<!--l. 138--><p class="noindent" >The field <span 
class="aeti-10">num_queues </span>only exists if VIRTIO_BLK_F_MQ is set. This field specifies
the number of queues.
<!--l. 141--><p class="noindent" >The parameters in the configuration space of the device <span 
class="aeti-10">max_discard_sectors</span>
<span 
class="aeti-10">discard_sector_alignment </span>are expressed in 512-byte units if the VIRTIO_BLK_F_DISCARD
feature bit is negotiated. The <span 
class="aeti-10">max_write_zeroes_sectors </span>is expressed in 512-byte units if
the VIRTIO_BLK_F_WRITE_ZEROES feature bit is negotiated. The parameters in the
configuration space of the device <span 
class="aeti-10">max_secure_erase_sectors secure_erase_sector_alignment</span>
are expressed in 512-byte units if the VIRTIO_BLK_F_SECURE_ERASE feature bit
is negotiated.
<!--l. 149--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature is negotiated, then in <span 
class="aeti-10">virtio_blk_zoned_characteristics</span>,
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 152--><p class="noindent" ><span 
class="aeti-10">zone_sectors </span>value is expressed in 512-byte sectors.
    </li>
    <li class="itemize">
    <!--l. 153--><p class="noindent" ><span 
class="aeti-10">max_append_sectors </span>value is expressed in 512-byte sectors.
    </li>
    <li class="itemize">
    <!--l. 154--><p class="noindent" ><span 
class="aeti-10">write_granularity </span>value is expressed in bytes.</li></ul>
<!--l. 157--><p class="noindent" >The <span 
class="aeti-10">model </span>field in <span 
class="aeti-10">zoned </span>may have the following values:
<!--l. 159-->
<pre class="lstlisting" id="listing-114"><span class="label"><a 
 id="x1-376044r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_Z_NONE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376045r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_Z_HM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-376046r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_Z_HA</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<!--l. 165--><p class="noindent" >Depending on their design, zoned block devices may follow several possible models of
operation. The three models that are standardized for ZBDs are drive-managed,
host-managed and host-aware.
                                                                  

                                                                  
<!--l. 169--><p class="noindent" >While being zoned internally, drive-managed ZBDs behave exactly like regular,
non-zoned block devices. For the purposes of virtio standardization, drive-managed
ZBDs can always be treated as non-zoned devices. These devices have the
VIRTIO_BLK_Z_NONE model value set in the <span 
class="aeti-10">model </span>field in <span 
class="aeti-10">zoned</span>.
<!--l. 175--><p class="noindent" >Devices that offer the VIRTIO_BLK_F_ZONED feature while reporting the
VIRTIO_BLK_Z_NONE zoned model are drive-managed zoned block devices. In this
case, the driver treats the device as a regular non-zoned block device.
<!--l. 179--><p class="noindent" >Host-managed zoned block devices have their LBA range divided into Sequential
Write Required (SWR) zones that require some additional handling by the host for
correct operation. All write requests to SWR zones are required be sequential and
zones containing some written data need to be reset before that data can be
rewritten. Host-managed devices support a set of ZBD-specific I/O requests that can
be used by the host to manage device zones. Host-managed devices report
VIRTIO_BLK_Z_HM in the <span 
class="aeti-10">model </span>field in <span 
class="aeti-10">zoned</span>.
<!--l. 187--><p class="noindent" >Host-aware zoned block devices have their LBA range divided to Sequential Write
Preferred (SWP) zones that support random write access, similar to regular
non-zoned devices. However, the device I/O performance might not be optimal if
SWP zones are used in a random I/O pattern. SWP zones also support the same set
of ZBD-specific I/O requests as host-managed devices that allow host-aware devices
to be managed by any host that supports zoned block devices to achieve its optimum
performance. Host-aware devices report VIRTIO_BLK_Z_HA in the <span 
class="aeti-10">model </span>field in
<span 
class="aeti-10">zoned</span>.
<!--l. 196--><p class="noindent" >Both SWR zones and SWP zones are sometimes referred as sequential zones.
<!--l. 198--><p class="noindent" >During device operation, sequential zones can be in one of the following states:
empty, implicitly-open, explicitly-open, closed and full. The state machine
that governs the transitions between these states is described later in this
document.
<!--l. 202--><p class="noindent" >SWR and SWP zones consume volatile device resources while being in certain states
and the device may set limits on the number of zones that can be in these states
simultaneously.
<!--l. 206--><p class="noindent" >Zoned block devices use two internal counters to account for the device resources in
use, the number of currently open zones and the number of currently active
zones.
<!--l. 210--><p class="noindent" >Any zone state transition from a state that doesn’t consume a zone resource to a
state that consumes the same resource increments the internal device counter for that
resource. Any zone transition out of a state that consumes a zone resource to a state
that doesn’t consume the same resource decrements the counter. Any request that
causes the device to exceed the reported zone resource limits is terminated by the
device with a "zone resources exceeded" error as defined for specific commands
later.
<a 
 id="x1-376047r387"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.2.4.1   </span> <a 
 id="x1-3770001"></a>Legacy Interface: Device configuration layout</h5>
<!--l. 219--><p class="noindent" >When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_blk_config according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<a 
 id="x1-377001r388"></a>
<h4 class="subsectionHead"><span class="titlemark">5.2.5   </span> <a 
 id="x1-3780005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The device size can be read from <span 
class="aeti-10">capacity</span>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BLK_F_BLK_SIZE feature is negotiated, <span 
class="aeti-10">blk_size </span>can be
    read to determine the optimal sector size for the driver to use. This does
    not affect the units used in the protocol (always 512 bytes), but awareness
    of the correct value can affect performance.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BLK_F_RO feature is set by the device, any write requests
    will fail.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BLK_F_TOPOLOGY feature is negotiated, the fields in the
    <span 
class="aeti-10">topology </span>struct can be read to determine the physical block size and optimal
    I/O lengths for the driver to use. This also does not affect the units in the
    protocol, only performance.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">If  the  VIRTIO_BLK_F_CONFIG_WCE  feature  is  negotiated,  the  cache
    mode can be read or set through the <span 
class="aeti-10">writeback </span>field. 0 corresponds to a
    writethrough cache, 1 to a writeback cache<span class="footnote-mark"><a 
href="#fn13x5" id="fn13x5-bk"><sup class="textsuperscript">13</sup></a></span><a 
 id="x1-378006f13"></a>.
    The cache mode after reset can be either writeback or writethrough. The
    actual mode can be determined by reading <span 
class="aeti-10">writeback </span>after feature negotiation.
    </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">If                                                                                           the
    VIRTIO_BLK_F_DISCARD feature is negotiated, <span 
class="aeti-10">max_discard_sectors </span>and
    <span 
class="aeti-10">max_discard_seg </span>can be read to determine the maximum discard sectors
    and maximum number of discard segments for the block driver to use.
    <span 
class="aeti-10">discard_sector_alignment </span>can be used by OS when splitting a request based
    on alignment.
    </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">If        the        VIRTIO_BLK_F_WRITE_ZEROES        feature        is
    negotiated, <span 
class="aeti-10">max_write_zeroes_sectors </span>and <span 
class="aeti-10">max_write_zeroes_seg </span>can be read
    to determine the maximum write zeroes sectors and maximum number of
    write zeroes segments for the block driver to use.
                                                                  

                                                                  
    </dd><dt class="enumerate-enumitem">
  8. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BLK_F_MQ feature is negotiated, <span 
class="aeti-10">num_queues </span>field can be
    read to determine the number of queues.
    </dd><dt class="enumerate-enumitem">
  9. </dt><dd 
class="enumerate-enumitem">If                      the                      VIRTIO_BLK_F_SECURE_ERASE
    feature is negotiated, <span 
class="aeti-10">max_secure_erase_sectors </span>and <span 
class="aeti-10">max_secure_erase_seg</span>
    can  be  read  to  determine  the  maximum  secure  erase  sectors  and
    maximum number of secure erase segments for the block driver to use.
    <span 
class="aeti-10">secure_erase_sector_alignment </span>can be used by OS when splitting a request
    based on alignment.
    </dd><dt class="enumerate-enumitem">
 10. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BLK_F_ZONED feature is negotiated, the fields in <span 
class="aeti-10">zoned</span>
    can be read by the driver to determine the zone characteristics of the device.
    All <span 
class="aeti-10">zoned </span>fields are read-only.
    </dd></dl>
<a 
 id="x1-378012r389"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.5.1   </span> <a 
 id="x1-3790001"></a>Driver Requirements: Device Initialization</h5>
<!--l. 285--><p class="noindent" >Drivers SHOULD NOT negotiate VIRTIO_BLK_F_FLUSH if they are incapable of
sending VIRTIO_BLK_T_FLUSH commands.
<!--l. 288--><p class="noindent" >If neither VIRTIO_BLK_F_CONFIG_WCE nor VIRTIO_BLK_F_FLUSH are
negotiated, the driver MAY deduce the presence of a writethrough cache. If
VIRTIO_BLK_F_CONFIG_WCE was not negotiated but VIRTIO_BLK_F_FLUSH
was, the driver SHOULD assume presence of a writeback cache.
<!--l. 293--><p class="noindent" >The driver MUST NOT read <span 
class="aeti-10">writeback </span>before setting the FEATURES_OK <span 
class="aeti-10">device</span>
<span 
class="aeti-10">status </span>bit.
<!--l. 296--><p class="noindent" >Drivers MUST NOT negotiate the VIRTIO_BLK_F_ZONED feature if they are
incapable of supporting devices with the VIRTIO_BLK_Z_HM, VIRTIO_BLK_Z_HA
or VIRTIO_BLK_Z_NONE zoned model.
<!--l. 300--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature is offered by the device with the
VIRTIO_BLK_Z_HM zone model, then the VIRTIO_BLK_F_DISCARD feature
MUST NOT be offered by the driver.
<!--l. 304--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature and VIRTIO_BLK_F_DISCARD feature are
both offered by the device with the VIRTIO_BLK_Z_HA or VIRTIO_BLK_Z_NONE
zone model, then the driver MAY negotiate these two bits independently.
<!--l. 308--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature is negotiated, then
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 310--><p class="noindent" >if  the  driver  that  can  not  support  host-managed  zoned  devices  reads
    VIRTIO_BLK_Z_HM from the <span 
class="aeti-10">model </span>field of <span 
class="aeti-10">zoned</span>, the driver MUST NOT
                                                                  

                                                                  
    set FEATURES_OK flag and instead set the FAILED bit.
    </li>
    <li class="itemize">
    <!--l. 314--><p class="noindent" >if the driver that can not support zoned devices reads VIRTIO_BLK_Z_HA
    from the <span 
class="aeti-10">model  </span>field of <span 
class="aeti-10">zoned</span>, the driver MAY handle the device as a
    non-zoned device. In this case, the driver SHOULD ignore all other fields
    in <span 
class="aeti-10">zoned</span>.</li></ul>
<a 
 id="x1-379001r391"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.5.2   </span> <a 
 id="x1-3800002"></a>Device Requirements: Device Initialization</h5>
<!--l. 322--><p class="noindent" >Devices SHOULD always offer VIRTIO_BLK_F_FLUSH, and MUST offer it if they
offer VIRTIO_BLK_F_CONFIG_WCE.
<!--l. 325--><p class="noindent" >If VIRTIO_BLK_F_CONFIG_WCE is negotiated but VIRTIO_BLK_F_FLUSH is not,
the device MUST initialize <span 
class="aeti-10">writeback </span>to 0.
<!--l. 328--><p class="noindent" >The device MUST initialize padding bytes <span 
class="aeti-10">unused0 </span>and <span 
class="aeti-10">unused1 </span>to 0.
<!--l. 331--><p class="noindent" >If the device that is being initialized is a not a zoned device, the device SHOULD
NOT offer the VIRTIO_BLK_F_ZONED feature.
<!--l. 334--><p class="noindent" >The VIRTIO_BLK_F_ZONED feature cannot be properly negotiated without
FEATURES_OK bit. Legacy devices MUST NOT offer VIRTIO_BLK_F_ZONED
feature bit.
<!--l. 337--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature is not accepted by the driver,
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 339--><p class="noindent" >the device with the VIRTIO_BLK_Z_HA or VIRTIO_BLK_Z_NONE zone
    model SHOULD proceed with the initialization while setting all zoned
    characteristics fields to zero.
    </li>
    <li class="itemize">
    <!--l. 343--><p class="noindent" >the device with the VIRTIO_BLK_Z_HM zone model MUST fail to set the
    FEATURES_OK device status bit when the driver writes the Device Status
    field.</li></ul>
<!--l. 348--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature is negotiated, then the <span 
class="aeti-10">model </span>field in <span 
class="aeti-10">zoned</span>
struct in the configuration space MUST be set by the device
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 351--><p class="noindent" >to the value of VIRTIO_BLK_Z_NONE if it operates as a drive-managed
    zoned block device or a non-zoned block device.
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 354--><p class="noindent" >to the value of VIRTIO_BLK_Z_HM if it operates as a host-managed zoned
    block device.
    </li>
    <li class="itemize">
    <!--l. 357--><p class="noindent" >to the value of VIRTIO_BLK_Z_HA if it operates as a host-aware zoned
    block device.</li></ul>
<!--l. 361--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature is negotiated and the device <span 
class="aeti-10">model </span>field in
<span 
class="aeti-10">zoned </span>struct is VIRTIO_BLK_Z_HM or VIRTIO_BLK_Z_HA,
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 365--><p class="noindent" >the <span 
class="aeti-10">zone_sectors </span>field of <span 
class="aeti-10">zoned </span>MUST be set by the device to the size of a single
    zone on the device. All zones of the device have the same size indicated by
    <span 
class="aeti-10">zone_sectors </span>except for the last zone that MAY be smaller than all other
    zones. The driver can calculate the number of zones on the device as
    <!--l. 370-->
    <pre class="lstlisting" id="listing-115"><span class="label"><a 
 id="x1-380001r1"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nr_zones</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capacity</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zone_sectors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zone_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
    
    <!--l. 373--><p class="noindent" >and the size of the last zone as <!--l. 374-->
    <pre class="lstlisting" id="listing-116"><span class="label"><a 
 id="x1-380002r1"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zs_last</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capacity</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nr_zones</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zone_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
    
    </li>
    <li class="itemize">
    <!--l. 378--><p class="noindent" >The <span 
class="aeti-10">max_open_zones </span>field of the <span 
class="aeti-10">zoned </span>structure MUST be set by the device to
    the maximum number of zones that can be open on the device (zones in the
    implicit open or explicit open state). A value of zero indicates that the device
    does not have any limit on the number of open zones.
    </li>
    <li class="itemize">
    <!--l. 384--><p class="noindent" >The <span 
class="aeti-10">max_active_zones </span>field of the <span 
class="aeti-10">zoned </span>structure MUST be set by the device to
    the maximum number zones that can be active on the device (zones
    in the implicit open, explicit open or closed state). A value of zero
    indicates that the device does not have any limit on the number of active
    zones.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 390--><p class="noindent" >the <span 
class="aeti-10">max_append_sectors </span>field of <span 
class="aeti-10">zoned </span>MUST be set by the device to the
    maximum data size of a VIRTIO_BLK_T_ZONE_APPEND request that can be
    successfully issued to the device. The value of this field MUST NOT exceed the
    <span 
class="aeti-10">seg_max </span>* <span 
class="aeti-10">size_max </span>value. A device MAY set the <span 
class="aeti-10">max_append_sectors </span>to zero if
    it doesn’t support VIRTIO_BLK_T_ZONE_APPEND requests.
    </li>
    <li class="itemize">
    <!--l. 397--><p class="noindent" >the <span 
class="aeti-10">write_granularity </span>field of <span 
class="aeti-10">zoned </span>MUST be set by the device to the
    offset and size alignment constraint for VIRTIO_BLK_T_OUT and
    VIRTIO_BLK_T_ZONE_APPEND requests issued to a sequential zone of the
    device.
    </li>
    <li class="itemize">
    <!--l. 402--><p class="noindent" >the device MUST initialize padding bytes <span 
class="aeti-10">unused2 </span>to 0.</li></ul>
<a 
 id="x1-380003r392"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.5.3   </span> <a 
 id="x1-3810003"></a>Legacy Interface: Device Initialization</h5>
<!--l. 407--><p class="noindent" >Because legacy devices do not have FEATURES_OK, transitional devices
MUST implement slightly different behavior around feature negotiation
when used through the legacy interface. In particular, when using the legacy
interface:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 413--><p class="noindent" >the driver MAY read or write <span 
class="aeti-10">writeback  </span>before setting the DRIVER or
    DRIVER_OK <span 
class="aeti-10">device status </span>bit
    </li>
    <li class="itemize">
    <!--l. 416--><p class="noindent" >the device MUST NOT modify the cache mode (and <span 
class="aeti-10">writeback</span>) as a result
    of a driver setting a status bit, unless the DRIVER_OK bit is being set and
    the driver has not set the VIRTIO_BLK_F_CONFIG_WCE driver feature
    bit.
    </li>
    <li class="itemize">
    <!--l. 421--><p class="noindent" >the device MUST NOT modify the cache mode (and <span 
class="aeti-10">writeback</span>) as a result
    of a driver modifying the driver feature bits, for example if the driver sets
    the VIRTIO_BLK_F_CONFIG_WCE driver feature bit but does not set
    the VIRTIO_BLK_F_FLUSH bit.</li></ul>
<a 
 id="x1-381001r390"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">5.2.6   </span> <a 
 id="x1-3820006"></a>Device Operation</h4>
<!--l. 430--><p class="noindent" >The driver enqueues requests to the virtqueues, and they are used by the device (not
necessarily in order). Each request except VIRTIO_BLK_T_ZONE_APPEND is of
form:
<!--l. 434-->
<pre class="lstlisting" id="listing-117"><span class="label"><a 
 id="x1-382001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 444--><p class="noindent" >The type of the request is either a read (VIRTIO_BLK_T_IN), a write
(VIRTIO_BLK_T_OUT), a discard (VIRTIO_BLK_T_DISCARD), a write zeroes
(VIRTIO_BLK_T_WRITE_ZEROES), a flush (VIRTIO_BLK_T_FLUSH), a
get device ID string command (VIRTIO_BLK_T_GET_ID), a secure erase
(VIRTIO_BLK_T_SECURE_ERASE), or a get device lifetime command
(VIRTIO_BLK_T_GET_LIFETIME).
<!--l. 451-->
<pre class="lstlisting" id="listing-118"><span class="label"><a 
 id="x1-382008r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_IN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382009r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_OUT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382010r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_FLUSH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382011r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_GET_ID</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382012r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_GET_LIFETIME</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">10</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382013r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_DISCARD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">11</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382014r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_WRITE_ZEROES</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">13</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382015r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_SECURE_ERASE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">14</span></span></pre>
<!--l. 462--><p class="noindent" >The <span 
class="aeti-10">sector </span>number indicates the offset (multiplied by 512) where the read or write is
to occur. This field is unused and set to 0 for commands other than read, write and
some zone operations.
<!--l. 466--><p class="noindent" >VIRTIO_BLK_T_IN requests populate <span 
class="aeti-10">data </span>with the contents of sectors read
from the block device (in multiples of 512 bytes). VIRTIO_BLK_T_OUT
requests write the contents of <span 
class="aeti-10">data </span>to the block device (in multiples of 512
bytes).
<!--l. 471--><p class="noindent" >The <span 
class="aeti-10">data </span>used for discard, secure erase or write zeroes commands consists of one
or more segments. The maximum number of segments is <span 
class="aeti-10">max_discard_seg</span>
for discard commands, <span 
class="aeti-10">max_secure_erase_seg </span>for secure erase commands
and <span 
class="aeti-10">max_write_zeroes_seg </span>for write zeroes commands. Each segment is of
form:
<!--l. 478-->
<pre class="lstlisting" id="listing-119"><span class="label"><a 
 id="x1-382016r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_discard_write_zeroes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382017r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382018r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382019r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382020r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:1;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382021r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:31;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382022r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382023r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 489--><p class="noindent" ><span 
class="aeti-10">sector </span>indicates the starting offset (in 512-byte units) of the segment, while
<span 
class="aeti-10">num_sectors </span>indicates the number of sectors in each discarded range. <span 
class="aeti-10">unmap </span>is only
used in write zeroes commands and allows the device to discard the specified range,
provided that following reads return zeroes.
<!--l. 495--><p class="noindent" >VIRTIO_BLK_T_GET_ID requests fetch the device ID string from the device into
<span 
class="aeti-10">data</span>. The device ID string is a NUL-padded ASCII string up to 20 bytes long. If the
string is 20 bytes long then there is no NUL terminator.
                                                                  

                                                                  
<!--l. 499--><p class="noindent" >The <span 
class="aeti-10">data </span>used for VIRTIO_BLK_T_GET_LIFETIME requests is populated by the
device, and is of the form
<!--l. 502-->
<pre class="lstlisting" id="listing-120"><span class="label"><a 
 id="x1-382024r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_lifetime</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382025r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pre_eol_info</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382026r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device_lifetime_est_typ_a</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382027r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device_lifetime_est_typ_b</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382028r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 510--><p class="noindent" >The <span 
class="aeti-10">pre_eol_info </span>specifies the percentage of reserved blocks that are consumed and
will have one of these values:
<!--l. 513-->
<pre class="lstlisting" id="listing-121"><span class="label"><a 
 id="x1-382029r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">not</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">available</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382030r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_PRE_EOL_INFO_UNDEFINED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382031r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">80%</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">consumed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382032r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_PRE_EOL_INFO_NORMAL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382033r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">80%</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">consumed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382034r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_PRE_EOL_INFO_WARNING</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382035r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">90%</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blocks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">consumed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382036r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_PRE_EOL_INFO_URGENT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382037r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">All</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">others</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span></pre>
<!--l. 525--><p class="noindent" >The <span 
class="aeti-10">device_lifetime_est_typ_a </span>refers to wear of SLC cells and is provided in increments
of 10used, and so on, thru to 11 meaning estimated lifetime exceeded. All values
above 11 are reserved.
<!--l. 530--><p class="noindent" >The <span 
class="aeti-10">device_lifetime_est_typ_b </span>refers to wear of MLC cells and is provided with the
same semantics as <span 
class="aeti-10">device_lifetime_est_typ_a</span>.
<!--l. 533--><p class="noindent" >The final <span 
class="aeti-10">status </span>byte is written by the device: either VIRTIO_BLK_S_OK for success,
VIRTIO_BLK_S_IOERR for device or driver error or VIRTIO_BLK_S_UNSUPP for a
request unsupported by device:
<!--l. 537-->
<pre class="lstlisting" id="listing-122"><span class="label"><a 
 id="x1-382038r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_S_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382039r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_S_IOERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382040r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_S_UNSUPP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<!--l. 543--><p class="noindent" >The status of individual segments is indeterminate when a discard or write zero
command produces VIRTIO_BLK_S_IOERR. A segment may have completed
successfully, failed, or not been processed by the device.
<!--l. 547--><p class="noindent" >The following requirements only apply if the VIRTIO_BLK_F_ZONED feature is
negotiated.
<!--l. 550--><p class="noindent" >In addition to the request types defined for non-zoned devices, the type of the request
can be a zone report (VIRTIO_BLK_T_ZONE_REPORT), an explicit zone open
(VIRTIO_BLK_T_ZONE_OPEN), a zone close (VIRTIO_BLK_T_ZONE_CLOSE),
a zone finish (VIRTIO_BLK_T_ZONE_FINISH), a zone_append
(VIRTIO_BLK_T_ZONE_APPEND), a zone reset (VIRTIO_BLK_T_ZONE_RESET)
or a zone reset all (VIRTIO_BLK_T_ZONE_RESET_ALL).
<!--l. 557-->
<pre class="lstlisting" id="listing-123"><span class="label"><a 
 id="x1-382041r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_ZONE_APPEND</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382042r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_ZONE_REPORT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382043r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_ZONE_OPEN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">18</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382044r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_ZONE_CLOSE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">20</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382045r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_ZONE_FINISH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">22</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382046r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_ZONE_RESET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382047r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_ZONE_RESET_ALL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">26</span></span></pre>
<!--l. 567--><p class="noindent" >Requests of type VIRTIO_BLK_T_OUT, VIRTIO_BLK_T_ZONE_OPEN,
VIRTIO_BLK_T_ZONE_CLOSE, VIRTIO_BLK_T_ZONE_FINISH,
                                                                  

                                                                  
VIRTIO_BLK_T_ZONE_APPEND, VIRTIO_BLK_T_ZONE_RESET or
VIRTIO_BLK_T_ZONE_RESET_ALL may be completed by the device with
VIRTIO_BLK_S_OK, VIRTIO_BLK_S_IOERR or VIRTIO_BLK_S_UNSUPP
<span 
class="aeti-10">status</span>, or, additionally, with VIRTIO_BLK_S_ZONE_INVALID_CMD,
VIRTIO_BLK_S_ZONE_UNALIGNED_WP, VIRTIO_BLK_S_ZONE_OPEN_RESOURCE
or VIRTIO_BLK_S_ZONE_ACTIVE_RESOURCE ZBD-specific status codes.
<!--l. 575--><p class="noindent" >Besides the request status, VIRTIO_BLK_T_ZONE_APPEND requests return the
starting sector of the appended data back to the driver. For this reason, the
VIRTIO_BLK_T_ZONE_APPEND request has the layout that is extended to have
the <span 
class="aeti-10">append_sector </span>field to carry this value:
<!--l. 580-->
<pre class="lstlisting" id="listing-124"><span class="label"><a 
 id="x1-382048r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_req_za</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382049r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382050r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382051r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382052r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382053r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">append_sector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382054r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382055r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 591-->
<pre class="lstlisting" id="listing-125"><span class="label"><a 
 id="x1-382056r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_S_ZONE_INVALID_CMD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382057r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_S_ZONE_UNALIGNED_WP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382058r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_S_ZONE_OPEN_RESOURCE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382059r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_S_ZONE_ACTIVE_RESOURCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span></pre>
<!--l. 598--><p class="noindent" >Requests of the type VIRTIO_BLK_T_ZONE_REPORT are reads and requests of the
type VIRTIO_BLK_T_ZONE_APPEND are writes. VIRTIO_BLK_T_ZONE_OPEN,
VIRTIO_BLK_T_ZONE_CLOSE, VIRTIO_BLK_T_ZONE_FINISH,
VIRTIO_BLK_T_ZONE_RESET and VIRTIO_BLK_T_ZONE_RESET_ALL are
non-data requests.
<!--l. 603--><p class="noindent" >Zone sector address is a 64-bit address of the first 512-byte sector of the
zone.
<!--l. 606--><p class="noindent" >VIRTIO_BLK_T_ZONE_OPEN, VIRTIO_BLK_T_ZONE_CLOSE,
VIRTIO_BLK_T_ZONE_FINISH and VIRTIO_BLK_T_ZONE_RESET requests make
the zone operation to act on a particular zone specified by the zone sector address in
the <span 
class="aeti-10">sector </span>of the request.
<!--l. 610--><p class="noindent" >VIRTIO_BLK_T_ZONE_RESET_ALL request acts upon all applicable zones of the
device. The <span 
class="aeti-10">sector </span>value is not used for this request.
<!--l. 613--><p class="noindent" >In ZBD standards, the VIRTIO_BLK_T_ZONE_REPORT request belongs to "Zone
Management Receive" command category and VIRTIO_BLK_T_ZONE_OPEN,
VIRTIO_BLK_T_ZONE_CLOSE, VIRTIO_BLK_T_ZONE_FINISH and
VIRTIO_BLK_T_ZONE_RESET/VIRTIO_BLK_T_ZONE_RESET_ALL requests are
categorized as "Zone Management Send" commands. VIRTIO_BLK_T_ZONE_APPEND
is categorized separately from zone management commands and is the only request
that uses the <span 
class="aeti-10">append_secctor </span>field <span 
class="aeti-10">virtio_blk_req_za </span>to return to the driver the sector
at which the data has been appended to the zone.
<!--l. 622--><p class="noindent" >VIRTIO_BLK_T_ZONE_REPORT is a read request that returns the information
about the current state of zones on the device starting from the zone containing the
<span 
class="aeti-10">sector </span>of the request. The report consists of a header followed by zero or more zone
                                                                  

                                                                  
descriptors.
<!--l. 627--><p class="noindent" >A zone report reply has the following structure:
<!--l. 629-->
<pre class="lstlisting" id="listing-126"><span class="label"><a 
 id="x1-382060r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_zone_report</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382061r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nr_zones</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382062r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[56];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382063r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_zone_descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">zones</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382064r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 637--><p class="noindent" >The device sets the <span 
class="aeti-10">nr_zones </span>field in the report header to the number of fully
transferred zone descriptors in the data buffer.
<!--l. 640--><p class="noindent" >A zone descriptor has the following structure:
<!--l. 642-->
<pre class="lstlisting" id="listing-127"><span class="label"><a 
 id="x1-382065r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_blk_zone_descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382066r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">z_cap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382067r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">z_start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382068r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">z_wp</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382069r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">z_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382070r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">z_state</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382071r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[38];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382072r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 653--><p class="noindent" >The zone descriptor field <span 
class="aeti-10">z_type virtio_blk_zone_descriptor </span>indicates the type of the
zone.
<!--l. 656--><p class="noindent" >The following zone types are available:
<!--l. 658-->
<pre class="lstlisting" id="listing-128"><span class="label"><a 
 id="x1-382073r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZT_CONV</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382074r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZT_SWR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382075r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZT_SWP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
<!--l. 664--><p class="noindent" >Read and write operations into zones with the VIRTIO_BLK_ZT_CONV
(Conventional) type have the same behavior as read and write operations on a
regular block device. Any block in a conventional zone can be read or written at any
time and in any order.
<!--l. 669--><p class="noindent" >Zones with VIRTIO_BLK_ZT_SWR can be read randomly, but must be written
sequentially at a certain point in the zone called the Write Pointer (WP).
With every write, the Write Pointer is incremented by the number of sectors
written.
<!--l. 673--><p class="noindent" >Zones with VIRTIO_BLK_ZT_SWP can be read randomly and should be written
sequentially, similarly to SWR zones. However, SWP zones can accept random write
operations, that is, VIRTIO_BLK_T_OUT requests with a start sector different from
the zone write pointer position.
<!--l. 678--><p class="noindent" >The field <span 
class="aeti-10">z_state </span>of <span 
class="aeti-10">virtio_blk_zone_descriptor </span>indicates the state of the device
zone.
<!--l. 681--><p class="noindent" >The following zone states are available:
<!--l. 683-->
<pre class="lstlisting" id="listing-129"><span class="label"><a 
 id="x1-382076r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_NOT_WP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382077r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_EMPTY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382078r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_IOPEN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382079r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_EOPEN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382080r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_CLOSED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382081r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_RDONLY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">13</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382082r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_FULL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">14</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-382083r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_ZS_OFFLINE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">15</span></span></pre>
                                                                  

                                                                  
<!--l. 694--><p class="noindent" >Zones of the type VIRTIO_BLK_ZT_CONV are always reported by the device to be
in the VIRTIO_BLK_ZS_NOT_WP state. Zones of the types VIRTIO_BLK_ZT_SWR
and VIRTIO_BLK_ZT_SWP can not transition to the VIRTIO_BLK_ZS_NOT_WP
state.
<!--l. 698--><p class="noindent" >Zones in VIRTIO_BLK_ZS_EMPTY (Empty), VIRTIO_BLK_ZS_IOPEN (Implicitly
Open), VIRTIO_BLK_ZS_EOPEN (Explicitly Open) and VIRTIO_BLK_ZS_CLOSED
(Closed) state are writable, but zones in VIRTIO_BLK_ZS_RDONLY (Read-Only),
VIRTIO_BLK_ZS_FULL (Full) and VIRTIO_BLK_ZS_OFFLINE (Offline) state are
not. The write pointer value (<span 
class="aeti-10">z_wp</span>) is not valid for Read-Only, Full and Offline
zones.
<!--l. 704--><p class="noindent" >The zone descriptor field <span 
class="aeti-10">z_cap </span>contains the maximum number of 512-byte
sectors that are available to be written with user data when the zone is in
the Empty state. This value shall be less than or equal to the <span 
class="aeti-10">zone_sectors</span>
value in <span 
class="aeti-10">virtio_blk_zoned_characteristics </span>structure in the device configuration
space.
<!--l. 710--><p class="noindent" >The zone descriptor field <span 
class="aeti-10">z_start </span>contains the zone sector address.
<!--l. 712--><p class="noindent" >The zone descriptor field <span 
class="aeti-10">z_wp </span>contains the sector address where the next write
operation for this zone should be issued. This value is undefined for conventional
zones and for zones in VIRTIO_BLK_ZS_RDONLY, VIRTIO_BLK_ZS_FULL and
VIRTIO_BLK_ZS_OFFLINE state.
<!--l. 717--><p class="noindent" >Depending on their state, zones consume resources as follows:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 719--><p class="noindent" >a zone in VIRTIO_BLK_ZS_IOPEN and VIRTIO_BLK_ZS_EOPEN state
    consumes one open zone resource and, additionally,
    </li>
    <li class="itemize">
    <!--l. 722--><p class="noindent" >a  zone  in  VIRTIO_BLK_ZS_IOPEN,  VIRTIO_BLK_ZS_EOPEN  and
    VIRTIO_BLK_ZS_CLOSED state consumes one active resource.</li></ul>
<!--l. 726--><p class="noindent" >Attempts for zone transitions that violate zone resource limits must fail with
VIRTIO_BLK_S_ZONE_OPEN_RESOURCE or VIRTIO_BLK_S_ZONE_ACTIVE_RESOURCE
<span 
class="aeti-10">status</span>.
<!--l. 730--><p class="noindent" >Zones in the VIRTIO_BLK_ZS_EMPTY (Empty) state have the write pointer value
equal to the sector address of the zone. In this state, the entire capacity
of the zone is available for writing. A zone can transition from this state
to
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 734--><p class="noindent" >VIRTIO_BLK_ZS_IOPEN   when   a   successful   VIRTIO_BLK_T_OUT
                                                                  

                                                                  
    request or VIRTIO_BLK_T_ZONE_APPEND with a non-zero data size is
    received for the zone.
    </li>
    <li class="itemize">
    <!--l. 737--><p class="noindent" >VIRTIO_BLK_ZS_EOPEN              when              a              successful
    VIRTIO_BLK_T_ZONE_OPEN request is received for the zone</li></ul>
<!--l. 741--><p class="noindent" >When a VIRTIO_BLK_T_ZONE_RESET request is issued to an Empty zone, the request
is completed successfully and the zone stays in the VIRTIO_BLK_ZS_EMPTY
state.
<!--l. 744--><p class="noindent" >Zones in the VIRTIO_BLK_ZS_IOPEN (Implicitly Open) state transition from this
state to
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 747--><p class="noindent" >VIRTIO_BLK_ZS_EMPTY             when             a             successful
    VIRTIO_BLK_T_ZONE_RESET request is received for the zone,
    </li>
    <li class="itemize">
    <!--l. 750--><p class="noindent" >VIRTIO_BLK_ZS_EMPTY             when             a             successful
    VIRTIO_BLK_T_ZONE_RESET_ALL request is received by the device,
    </li>
    <li class="itemize">
    <!--l. 753--><p class="noindent" >VIRTIO_BLK_ZS_EOPEN              when              a              successful
    VIRTIO_BLK_T_ZONE_OPEN request is received for the zone,
    </li>
    <li class="itemize">
    <!--l. 756--><p class="noindent" >VIRTIO_BLK_ZS_CLOSED             when             a             successful
    VIRTIO_BLK_T_ZONE_CLOSE request is received for the zone,
    </li>
    <li class="itemize">
    <!--l. 759--><p class="noindent" >VIRTIO_BLK_ZS_CLOSED implicitly by the device when another zone is
    entering the VIRTIO_BLK_ZS_IOPEN or VIRTIO_BLK_ZS_EOPEN state
    and the number of currently open zones is at <span 
class="aeti-10">max_open_zones </span>limit,
    </li>
    <li class="itemize">
    <!--l. 763--><p class="noindent" >VIRTIO_BLK_ZS_FULL
    when a successful VIRTIO_BLK_T_ZONE_FINISH request is received for
    the zone.
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 766--><p class="noindent" >VIRTIO_BLK_ZS_FULL  when  a  successful  VIRTIO_BLK_T_OUT  or
    VIRTIO_BLK_T_ZONE_APPEND request that causes the zone to reach
    its writable capacity is received for the zone.</li></ul>
<!--l. 771--><p class="noindent" >Zones in the VIRTIO_BLK_ZS_EOPEN (Explicitly Open) state transition from this
state to
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 774--><p class="noindent" >VIRTIO_BLK_ZS_EMPTY             when             a             successful
    VIRTIO_BLK_T_ZONE_RESET request is received for the zone,
    </li>
    <li class="itemize">
    <!--l. 777--><p class="noindent" >VIRTIO_BLK_ZS_EMPTY             when             a             successful
    VIRTIO_BLK_T_ZONE_RESET_ALL request is received by the device,
    </li>
    <li class="itemize">
    <!--l. 780--><p class="noindent" >VIRTIO_BLK_ZS_EMPTY
    when a successful VIRTIO_BLK_T_ZONE_CLOSE request is received for
    the zone and the write pointer of the zone has the value equal to the start
    sector of the zone,
    </li>
    <li class="itemize">
    <!--l. 784--><p class="noindent" >VIRTIO_BLK_ZS_CLOSED
    when a successful VIRTIO_BLK_T_ZONE_CLOSE request is received for
    the zone and the zone write pointer is larger then the start sector of the
    zone,
    </li>
    <li class="itemize">
    <!--l. 788--><p class="noindent" >VIRTIO_BLK_ZS_FULL
    when a successful VIRTIO_BLK_T_ZONE_FINISH request is received for
    the zone,
    </li>
    <li class="itemize">
    <!--l. 791--><p class="noindent" >VIRTIO_BLK_ZS_FULL  when  a  successful  VIRTIO_BLK_T_OUT  or
    VIRTIO_BLK_T_ZONE_APPEND request that causes the zone to reach
    its writable capacity is received for the zone.</li></ul>
                                                                  

                                                                  
<!--l. 796--><p class="noindent" >When a VIRTIO_BLK_T_ZONE_EOPEN request is issued to an Explicitly
Open zone, the request is completed successfully and the zone stays in the
VIRTIO_BLK_ZS_EOPEN state.
<!--l. 800--><p class="noindent" >Zones in the VIRTIO_BLK_ZS_CLOSED (Closed) state transition from this state
to
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 803--><p class="noindent" >VIRTIO_BLK_ZS_EMPTY             when             a             successful
    VIRTIO_BLK_T_ZONE_RESET request is received for the zone,
    </li>
    <li class="itemize">
    <!--l. 806--><p class="noindent" >VIRTIO_BLK_ZS_EMPTY             when             a             successful
    VIRTIO_BLK_T_ZONE_RESET_ALL request is received by the device,
    </li>
    <li class="itemize">
    <!--l. 809--><p class="noindent" >VIRTIO_BLK_ZS_IOPEN   when   a   successful   VIRTIO_BLK_T_OUT
    request or VIRTIO_BLK_T_ZONE_APPEND with a non-zero data size is
    received for the zone.
    </li>
    <li class="itemize">
    <!--l. 812--><p class="noindent" >VIRTIO_BLK_ZS_EOPEN              when              a              successful
    VIRTIO_BLK_T_ZONE_OPEN request is received for the zone,</li></ul>
<!--l. 816--><p class="noindent" >When a VIRTIO_BLK_T_ZONE_CLOSE request is issued to a Closed zone, the request
is completed successfully and the zone stays in the VIRTIO_BLK_ZS_CLOSED
state.
<!--l. 819--><p class="noindent" >Zones in the VIRTIO_BLK_ZS_FULL (Full) state transition from this state to
VIRTIO_BLK_ZS_EMPTY when a successful VIRTIO_BLK_T_ZONE_RESET
request is received for the zone or a successful VIRTIO_BLK_T_ZONE_RESET_ALL
request is received by the device.
<!--l. 824--><p class="noindent" >When a VIRTIO_BLK_T_ZONE_FINISH request is issued to a Full zone, the request
is completed successfully and the zone stays in the VIRTIO_BLK_ZS_FULL
state.
<!--l. 827--><p class="noindent" >The device may automatically transition zones to VIRTIO_BLK_ZS_RDONLY
(Read-Only) or VIRTIO_BLK_ZS_OFFLINE (Offline) state from any other state.
The device may also automatically transition zones in the Read-Only state to the
Offline state. Zones in the Offline state may not transition to any other state. Such
automatic transitions usually indicate hardware failures. The previously written data
may only be read from zones in the Read-Only state. Zones in the Offline state can
not be read or written.
                                                                  

                                                                  
<!--l. 835--><p class="noindent" >VIRTIO_BLK_S_ZONE_UNALIGNED_WP is set by the device when the request
received from the driver attempts to perform a write to an SWR zone and at least
one of the following conditions is met:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 840--><p class="noindent" >the starting sector of the request is not equal to the current value of the
    zone write pointer.
    </li>
    <li class="itemize">
    <!--l. 843--><p class="noindent" >the ending sector of the request data multiplied by 512 is not a multiple of
    the value reported by the device in the field <span 
class="aeti-10">write_granularity </span>in the device
    configuration space.</li></ul>
<!--l. 848--><p class="noindent" >VIRTIO_BLK_S_ZONE_OPEN_RESOURCE is set by the device when a zone
operation or write request received from the driver can not be handled without
exceeding the <span 
class="aeti-10">max_open_zones </span>limit value reported by the device in the configuration
space.
<!--l. 853--><p class="noindent" >VIRTIO_BLK_S_ZONE_ACTIVE_RESOURCE is set by the device when a zone
operation or write request received from the driver can not be handled without
exceeding the <span 
class="aeti-10">max_active_zones </span>limit value reported by the device in the
configuration space.
<!--l. 858--><p class="noindent" >A zone transition request that leads to both the <span 
class="aeti-10">max_open_zones </span>and the
<span 
class="aeti-10">max_active_zones </span>limits to be exceeded is terminated by the device with
VIRTIO_BLK_S_ZONE_ACTIVE_RESOURCE <span 
class="aeti-10">status </span>value.
<!--l. 862--><p class="noindent" >The device reports all other error conditions related to zoned block model operation
by setting the VIRTIO_BLK_S_ZONE_INVALID_CMD value in <span 
class="aeti-10">status </span>of
<span 
class="aeti-10">virtio_blk_req </span>structure.
<a 
 id="x1-382084r393"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.6.1   </span> <a 
 id="x1-3830001"></a>Driver Requirements: Device Operation</h5>
<!--l. 868--><p class="noindent" >The driver SHOULD check if the content of the <span 
class="aeti-10">capacity </span>field has changed upon
receiving a configuration change notification.
<!--l. 871--><p class="noindent" >A driver MUST NOT submit a request which would cause a read or write beyond
<span 
class="aeti-10">capacity</span>.
<!--l. 874--><p class="noindent" >A driver SHOULD accept the VIRTIO_BLK_F_RO feature if offered.
<!--l. 876--><p class="noindent" >A driver MUST set <span 
class="aeti-10">sector </span>to 0 for a VIRTIO_BLK_T_FLUSH request. A driver
SHOULD NOT include any data in a VIRTIO_BLK_T_FLUSH request.
<!--l. 879--><p class="noindent" >The length of <span 
class="aeti-10">data </span>MUST be a multiple of 512 bytes for VIRTIO_BLK_T_IN and
VIRTIO_BLK_T_OUT requests.
                                                                  

                                                                  
<!--l. 882--><p class="noindent" >The length of <span 
class="aeti-10">data </span>MUST be a multiple of the size of struct virtio_blk_discard_write_zeroes
for VIRTIO_BLK_T_DISCARD, VIRTIO_BLK_T_SECURE_ERASE and
VIRTIO_BLK_T_WRITE_ZEROES requests.
<!--l. 886--><p class="noindent" >The length of <span 
class="aeti-10">data </span>MUST be 20 bytes for VIRTIO_BLK_T_GET_ID requests.
<!--l. 888--><p class="noindent" >VIRTIO_BLK_T_DISCARD requests MUST NOT contain more than <span 
class="aeti-10">max_discard_seg</span>
struct virtio_blk_discard_write_zeroes segments in <span 
class="aeti-10">data</span>.
<!--l. 892--><p class="noindent" >VIRTIO_BLK_T_SECURE_ERASE requests MUST NOT contain more than
<span 
class="aeti-10">max_secure_erase_seg </span>struct virtio_blk_discard_write_zeroes segments in <span 
class="aeti-10">data</span>.
<!--l. 896--><p class="noindent" >VIRTIO_BLK_T_WRITE_ZEROES requests MUST NOT contain more than
<span 
class="aeti-10">max_write_zeroes_seg </span>struct virtio_blk_discard_write_zeroes segments in <span 
class="aeti-10">data</span>.
<!--l. 900--><p class="noindent" >If the VIRTIO_BLK_F_CONFIG_WCE feature is negotiated, the driver MAY switch
to writethrough or writeback mode by writing respectively 0 and 1 to the
<span 
class="aeti-10">writeback </span>field. After writing a 0 to <span 
class="aeti-10">writeback</span>, the driver MUST NOT assume
that any volatile writes have been committed to persistent device backend
storage.
<!--l. 906--><p class="noindent" >The <span 
class="aeti-10">unmap </span>bit MUST be zero for discard commands. The driver MUST NOT
assume anything about the data returned by read requests after a range of sectors
has been discarded.
<!--l. 910--><p class="noindent" >A driver MUST NOT assume that individual segments in a multi-segment
VIRTIO_BLK_T_DISCARD or VIRTIO_BLK_T_WRITE_ZEROES request
completed successfully, failed, or were processed by the device at all if the request
failed with VIRTIO_BLK_S_IOERR.
<!--l. 915--><p class="noindent" >The following requirements only apply if the VIRTIO_BLK_F_ZONED feature is
negotiated.
<!--l. 918--><p class="noindent" >A zone sector address provided by the driver MUST be a multiple of 512
bytes.
<!--l. 920--><p class="noindent" >When forming a VIRTIO_BLK_T_ZONE_REPORT request, the driver MUST set a
sector within the sector range of the starting zone to report to <span 
class="aeti-10">sector </span>field. It MAY
be a sector that is different from the zone sector address.
<!--l. 924--><p class="noindent" >In VIRTIO_BLK_T_ZONE_OPEN, VIRTIO_BLK_T_ZONE_CLOSE,
VIRTIO_BLK_T_ZONE_FINISH and VIRTIO_BLK_T_ZONE_RESET requests,
the driver MUST set <span 
class="aeti-10">sector </span>field to point at the first sector in the target
zone.
<!--l. 928--><p class="noindent" >In VIRTIO_BLK_T_ZONE_RESET_ALL request, the driver MUST set the field
<span 
class="aeti-10">sector </span>to zero value.
<!--l. 931--><p class="noindent" >The <span 
class="aeti-10">sector </span>field of the VIRTIO_BLK_T_ZONE_APPEND request MUST specify the
zone sector address of the zone to which data is to be appended at the position of the
write pointer. The size of the data that is appended MUST be a multiple of
<span 
class="aeti-10">write_granularity </span>bytes and MUST NOT exceed the <span 
class="aeti-10">max_append_sectors </span>value
                                                                  

                                                                  
provided by the device in <span 
class="aeti-10">virtio_blk_zoned_characteristics </span>configuration space
structure.
<!--l. 938--><p class="noindent" >Upon a successful completion of a VIRTIO_BLK_T_ZONE_APPEND request, the
driver MAY read the starting sector location of the written data from the request
field <span 
class="aeti-10">append_sector</span>.
<!--l. 942--><p class="noindent" >All VIRTIO_BLK_T_OUT requests issued by the driver to sequential zones and
VIRTIO_BLK_T_ZONE_APPEND requests MUST have:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">the data size that is a multiple of the number of bytes reported by the
    device in the field <span 
class="aeti-10">write_granularity </span>in the <span 
class="aeti-10">virtio_blk_zoned_characteristics</span>
    configuration space structure.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">the  value  of  the  field  <span 
class="aeti-10">sector  </span>that  is  a  multiple  of  the  number  of
    bytes  reported  by  the  device  in  the  field  <span 
class="aeti-10">write_granularity  </span>in  the
    <span 
class="aeti-10">virtio_blk_zoned_characteristics </span>configuration space structure.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">the data size that will not exceed the writable zone capacity when its value
    is added to the current value of the write pointer of the zone.
    </dd></dl>
<a 
 id="x1-383004r395"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.6.2   </span> <a 
 id="x1-3840002"></a>Device Requirements: Device Operation</h5>
<!--l. 961--><p class="noindent" >The device MAY change the content of the <span 
class="aeti-10">capacity </span>field during operation of the
device. When this happens, the device SHOULD trigger a configuration change
notification.
<!--l. 965--><p class="noindent" >A device MUST set the <span 
class="aeti-10">status </span>byte to VIRTIO_BLK_S_IOERR for a write request
if the VIRTIO_BLK_F_RO feature if offered, and MUST NOT write any
data.
<!--l. 969--><p class="noindent" >The device MUST set the <span 
class="aeti-10">status </span>byte to VIRTIO_BLK_S_UNSUPP for discard,
secure erase and write zeroes commands if any unknown flag is set. Furthermore, the
device MUST set the <span 
class="aeti-10">status </span>byte to VIRTIO_BLK_S_UNSUPP for discard commands
if the <span 
class="aeti-10">unmap </span>flag is set.
<!--l. 974--><p class="noindent" >For discard commands, the device MAY deallocate the specified range of sectors in
the device backend storage.
<!--l. 977--><p class="noindent" >For write zeroes commands, if the <span 
class="aeti-10">unmap </span>is set, the device MAY deallocate the
specified range of sectors in the device backend storage, as if the discard command
had been sent. After a write zeroes command is completed, reads of the specified
ranges of sectors MUST return zeroes. This is true independent of whether <span 
class="aeti-10">unmap</span>
was set or clear.
<!--l. 983--><p class="noindent" >The device SHOULD clear the <span 
class="aeti-10">write_zeroes_may_unmap </span>field of the virtio
                                                                  

                                                                  
configuration space if and only if a write zeroes request cannot result in deallocating
one or more sectors. The device MAY change the content of the field during
operation of the device; when this happens, the device SHOULD trigger a
configuration change notification.
<!--l. 989--><p class="noindent" >A write is considered volatile when it is submitted; the contents of sectors covered by
a volatile write are undefined in persistent device backend storage until the write
becomes stable. A write becomes stable once it is completed and one or more of the
following conditions is true:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-3840011"></a>  neither  VIRTIO_BLK_F_CONFIG_WCE  nor  VIRTIO_BLK_F_FLUSH
    feature were negotiated, but VIRTIO_BLK_F_FLUSH was offered by the
    device;
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-3840022"></a>  the  VIRTIO_BLK_F_CONFIG_WCE  feature  was  negotiated  and  the
    <span 
class="aeti-10">writeback  </span>field  in  configuration  space  was  0  <span 
class="aeb10-">all  the  time  between  the</span>
    <span 
class="aeb10-">submission of the write and its completion</span>;
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem"><a 
 id="x1-3840033"></a> a VIRTIO_BLK_T_FLUSH request is sent <span 
class="aeb10-">after the write is completed</span>
    and is completed itself.</dd></dl>
<!--l. 1007--><p class="noindent" >If the device is backed by persistent storage, the device MUST ensure that stable
writes are committed to it, before reporting completion of the write (cases <a 
href="#x1-3840011">1<!--tex4ht:ref: item:flush1 --></a>
and <a 
href="#x1-3840022">2<!--tex4ht:ref: item:flush2 --></a>) or the flush (case <a 
href="#x1-3840033">3<!--tex4ht:ref: item:flush3 --></a>). Failure to do so can cause data loss in case of a
crash.
<!--l. 1013--><p class="noindent" >If the driver changes <span 
class="aeti-10">writeback </span>between the submission of the write and its
completion, the write could be either volatile or stable when its completion is
reported; in other words, the exact behavior is undefined.
<!--l. 1023--><p class="noindent" >If VIRTIO_BLK_F_FLUSH was not offered by the
device<span class="footnote-mark"><a 
href="#fn14x5" id="fn14x5-bk"><sup class="textsuperscript">14</sup></a></span><a 
 id="x1-384004f14"></a>,
the device MAY also commit writes to persistent device backend storage before
reporting their completion. Unlike case <a 
href="#x1-3840011">1<!--tex4ht:ref: item:flush1 --></a>, however, this is not an absolute
requirement of the specification.
<span 
class="aeb10-">Note:</span> An implementation that does not offer VIRTIO_BLK_F_FLUSH and does
      not commit completed writes will not be resilient to data loss in case of
      crashes. Not offering VIRTIO_BLK_F_FLUSH is an absolute requirement
      for implementations that do not wish to be safe against such data losses.
<!--l. 1038--><p class="noindent" >If the device is backed by storage providing lifetime metrics (such as eMMC or UFS
persistent storage), the device SHOULD offer the VIRTIO_BLK_F_LIFETIME flag.
The flag MUST NOT be offered if the device is backed by storage for which the
lifetime metrics described in this document cannot be obtained or for which such
metrics have no useful meaning. If the metrics are offered, the device MUST NOT
                                                                  

                                                                  
send any reserved values, as defined in this specification.
<span 
class="aeb10-">Note:</span> The   device   lifetime   metrics   <span 
class="aeti-10">pre_eol_info</span>,   <span 
class="aeti-10">device_lifetime_est_a   </span>and
      <span 
class="aeti-10">device_lifetime_est_b </span>are discussed in the JESD84-B50 specification.
      <!--l. 1049--><p class="noindent" >The   complete   JESD84-B50   is   available   at   the   JEDEC   website
      (https://www.jedec.org)  pursuant  to  JEDEC’s  licensing  terms  and
      conditions.   This   information   is   provided   to   simplfy   passthrough
      implementations from eMMC devices.
<!--l. 1054--><p class="noindent" >If the VIRTIO_BLK_F_ZONED feature is not negotiated, the device MUST
reject VIRTIO_BLK_T_ZONE_REPORT, VIRTIO_BLK_T_ZONE_OPEN,
VIRTIO_BLK_T_ZONE_CLOSE, VIRTIO_BLK_T_ZONE_FINISH,
VIRTIO_BLK_T_ZONE_APPEND, VIRTIO_BLK_T_ZONE_RESET and
VIRTIO_BLK_T_ZONE_RESET_ALL requests with VIRTIO_BLK_S_UNSUPP
status.
<!--l. 1059--><p class="noindent" >The following device requirements only apply if the VIRTIO_BLK_F_ZONED feature
is negotiated.
<!--l. 1062--><p class="noindent" >If a request of type VIRTIO_BLK_T_ZONE_OPEN, VIRTIO_BLK_T_ZONE_CLOSE,
VIRTIO_BLK_T_ZONE_FINISH or VIRTIO_BLK_T_ZONE_RESET is issued for a
Conventional zone (type VIRTIO_BLK_ZT_CONV), the device MUST complete the
request with VIRTIO_BLK_S_ZONE_INVALID_CMD <span 
class="aeti-10">status</span>.
<!--l. 1067--><p class="noindent" >If the zone specified by the VIRTIO_BLK_T_ZONE_APPEND request is not a SWR zone,
then the request SHALL be completed with VIRTIO_BLK_S_ZONE_INVALID_CMD
<span 
class="aeti-10">status</span>.
<!--l. 1071--><p class="noindent" >The device handles a VIRTIO_BLK_T_ZONE_OPEN request by attempting to
change the state of the zone with the <span 
class="aeti-10">sector </span>address to VIRTIO_BLK_ZS_EOPEN. If
the transition to this state can not be performed, the request MUST be completed
with VIRTIO_BLK_S_ZONE_INVALID_CMD <span 
class="aeti-10">status</span>. If, while processing this request,
the available zone resources are insufficient, then the zone state does not change and
the request MUST be completed with VIRTIO_BLK_S_ZONE_OPEN_RESOURCE
or VIRTIO_BLK_S_ZONE_ACTIVE_RESOURCE value in the field <span 
class="aeti-10">status</span>.
<!--l. 1080--><p class="noindent" >The device handles a VIRTIO_BLK_T_ZONE_CLOSE request by attempting to
change the state of the zone with the <span 
class="aeti-10">sector </span>address to VIRTIO_BLK_ZS_CLOSED.
If the transition to this state can not be performed, the request MUST be
completed with VIRTIO_BLK_S_ZONE_INVALID_CMD value in the field
<span 
class="aeti-10">status</span>.
<!--l. 1085--><p class="noindent" >The device handles a VIRTIO_BLK_T_ZONE_FINISH request by attempting to
change the state of the zone with the <span 
class="aeti-10">sector </span>address to VIRTIO_BLK_ZS_FULL. If
the transition to this state can not be performed, the zone state does not change and
the request MUST be completed with VIRTIO_BLK_S_ZONE_INVALID_CMD value
in the field <span 
class="aeti-10">status</span>.
<!--l. 1091--><p class="noindent" >The device handles a VIRTIO_BLK_T_ZONE_RESET request by attempting to change
                                                                  

                                                                  
the state of the zone with the <span 
class="aeti-10">sector </span>address to VIRTIO_BLK_ZS_EMPTY state. If
the transition to this state can not be performed, the zone state does not change and
the request MUST be completed with VIRTIO_BLK_S_ZONE_INVALID_CMD value
in the field <span 
class="aeti-10">status</span>.
<!--l. 1097--><p class="noindent" >The device handles a VIRTIO_BLK_T_ZONE_RESET_ALL request by
transitioning all sequential device zones in VIRTIO_BLK_ZS_IOPEN,
VIRTIO_BLK_ZS_EOPEN, VIRTIO_BLK_ZS_CLOSED and VIRTIO_BLK_ZS_FULL
state to VIRTIO_BLK_ZS_EMPTY state.
<!--l. 1101--><p class="noindent" >Upon receiving a VIRTIO_BLK_T_ZONE_APPEND request or a VIRTIO_BLK_T_OUT
request issued to a SWR zone in VIRTIO_BLK_ZS_EMPTY or VIRTIO_BLK_ZS_CLOSED
state, the device attempts to perform the transition of the zone to
VIRTIO_BLK_ZS_IOPEN state before writing data. This transition may fail due to
insufficient open and/or active zone resources available on the device. In this case,
the request MUST be completed with VIRTIO_BLK_S_ZONE_OPEN_RESOURCE
or VIRTIO_BLK_S_ZONE_ACTIVE_RESOURCE value in the <span 
class="aeti-10">status</span>.
<!--l. 1109--><p class="noindent" >If the <span 
class="aeti-10">sector </span>field in the VIRTIO_BLK_T_ZONE_APPEND request does not specify
the lowest sector for a zone, then the request SHALL be completed with
VIRTIO_BLK_S_ZONE_INVALID_CMD value in <span 
class="aeti-10">status</span>.
<!--l. 1113--><p class="noindent" >A VIRTIO_BLK_T_ZONE_APPEND request or a VIRTIO_BLK_T_OUT request
that has the data range that exceeds the remaining writable capacity for the zone,
then the request SHALL be completed with VIRTIO_BLK_S_ZONE_INVALID_CMD
value in <span 
class="aeti-10">status</span>.
<!--l. 1118--><p class="noindent" >If a request of the type VIRTIO_BLK_T_ZONE_APPEND is completed with
VIRTIO_BLK_S_OK status, the field <span 
class="aeti-10">append_sector </span>in <span 
class="aeti-10">virtio_blk_req_za </span>MUST
be set by the device to contain the first sector of the data written to the
zone.
<!--l. 1123--><p class="noindent" >If a request of the type VIRTIO_BLK_T_ZONE_APPEND is completed with a status
other than VIRTIO_BLK_S_OK, the value of <span 
class="aeti-10">append_sector </span>field in <span 
class="aeti-10">virtio_blk_req_za</span>
is undefined.
<!--l. 1127--><p class="noindent" >A VIRTIO_BLK_T_ZONE_APPEND request that has the data size that exceeds
<span 
class="aeti-10">max_append_sectors </span>configuration space value, then,
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1130--><p class="noindent" >if <span 
class="aeti-10">max_append_sectors </span>configuration space value is reported as zero by the
    device, the request SHALL be completed with VIRTIO_BLK_S_UNSUPP
    <span 
class="aeti-10">status</span>.
    </li>
    <li class="itemize">
    <!--l. 1134--><p class="noindent" >if   <span 
class="aeti-10">max_append_sectors   </span>configuration   space   value   is   reported   as   a
    non-zero  value  by  the  device,  the  request  SHALL  be  completed  with
                                                                  

                                                                  
    VIRTIO_BLK_S_ZONE_INVALID_CMD <span 
class="aeti-10">status</span>.</li></ul>
<!--l. 1139--><p class="noindent" >If a VIRTIO_BLK_T_ZONE_APPEND request, a VIRTIO_BLK_T_IN request or a
VIRTIO_BLK_T_OUT request issued to a SWR zone has the range that has
sectors in more than one zone, then the request SHALL be completed with
VIRTIO_BLK_S_ZONE_INVALID_CMD value in the field <span 
class="aeti-10">status</span>.
<!--l. 1144--><p class="noindent" >A VIRTIO_BLK_T_OUT request that has the <span 
class="aeti-10">sector </span>value that is not aligned with
the write pointer for the zone, then the request SHALL be completed with
VIRTIO_BLK_S_ZONE_UNALIGNED_WP value in the field <span 
class="aeti-10">status</span>.
<!--l. 1148--><p class="noindent" >In order to avoid resource-related errors while opening zones implicitly, the device
MAY automatically transition zones in VIRTIO_BLK_ZS_IOPEN state to
VIRTIO_BLK_ZS_CLOSED state.
<!--l. 1152--><p class="noindent" >All VIRTIO_BLK_T_OUT requests or VIRTIO_BLK_T_ZONE_APPEND requests
issued to a zone in the VIRTIO_BLK_ZS_RDONLY state SHALL be completed with
VIRTIO_BLK_S_ZONE_INVALID_CMD <span 
class="aeti-10">status</span>.
<!--l. 1156--><p class="noindent" >All requests issued to a zone in the VIRTIO_BLK_ZS_OFFLINE state SHALL be
completed with VIRTIO_BLK_S_ZONE_INVALID_CMD value in the field
<span 
class="aeti-10">status</span>.
<!--l. 1159--><p class="noindent" >The device MUST consider the sectors that are read between the write pointer
position of a zone and the end of the last sector of the zone as unwritten data. The
sectors between the write pointer position and the end of the last sector within the
zone capacity during VIRTIO_BLK_T_ZONE_FINISH request processing are also
considered unwritten data.
<!--l. 1165--><p class="noindent" >When unwritten data is present in the sector range of a read request, the device
MUST process this data in one of the following ways -
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Fill   the   unwritten   data   with   a   device-specific   byte   pattern.   The
    configuration, control and reporting of this byte pattern is beyond the scope
    of this standard. This is the preferred approach.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Fail the request. Depending on the driver implementation, this may prevent
    the device from becoming operational.</dd></dl>
<!--l. 1177--><p class="noindent" >If both the VIRTIO_BLK_F_ZONED and VIRTIO_BLK_F_SECURE_ERASE
features are negotiated, then
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">the field <span 
class="aeti-10">secure_erase_sector_alignment  </span>in the configuration space of the
    device MUST be a multiple of <span 
class="aeti-10">zone_sectors </span>value reported in the device
    configuration space.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">the data size in VIRTIO_BLK_T_SECURE_ERASE requests MUST be a
    multiple of <span 
class="aeti-10">zone_sectors </span>value in the device configuration space.</dd></dl>
                                                                  

                                                                  
<!--l. 1189--><p class="noindent" >The device MUST handle a VIRTIO_BLK_T_SECURE_ERASE request in the same
way it handles VIRTIO_BLK_T_ZONE_RESET request for the zone range specified
in the VIRTIO_BLK_T_SECURE_ERASE request.
<a 
 id="x1-384009r396"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.6.3   </span> <a 
 id="x1-3850003"></a>Legacy Interface: Device Operation</h5>
<!--l. 1194--><p class="noindent" >When using the legacy interface, transitional devices and drivers MUST format the
fields in struct virtio_blk_req according to the native endian of the guest rather than
(necessarily when not using the legacy interface) little-endian.
<!--l. 1199--><p class="noindent" >When using the legacy interface, transitional drivers SHOULD ignore the used length
values.
<span 
class="aeb10-">Note:</span> Historically, some devices put the total descriptor length, or the total
      length of device-writable buffers there, even when only the status byte
      was actually written.
<!--l. 1207--><p class="noindent" >The <span 
class="aeti-10">reserved </span>field was previously called <span 
class="aeti-10">ioprio</span>. <span 
class="aeti-10">ioprio </span>is a hint about the relative
priorities of requests to the device: higher numbers indicate more important
requests.
<!--l. 1211-->
<pre class="lstlisting" id="listing-130"><span class="label"><a 
 id="x1-385001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_FLUSH_OUT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span></pre>
<!--l. 1215--><p class="noindent" >The command VIRTIO_BLK_T_FLUSH_OUT was a synonym for
VIRTIO_BLK_T_FLUSH; a driver MUST treat it as a VIRTIO_BLK_T_FLUSH
command.
<!--l. 1218-->
<pre class="lstlisting" id="listing-131"><span class="label"><a 
 id="x1-385002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_BARRIER</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x80000000</span></span></pre>
<!--l. 1222--><p class="noindent" >If the device has VIRTIO_BLK_F_BARRIER feature the high bit
(VIRTIO_BLK_T_BARRIER) indicates that this request acts as a barrier and that
all preceding requests SHOULD be complete before this one, and all following
requests SHOULD NOT be started until this is complete.
<span 
class="aeb10-">Note:</span> A  barrier  does  not  flush  caches  in  the  underlying  backend  device  in
      host,  and  thus  does  not  serve  as  data  consistency  guarantee.  Only  a
      VIRTIO_BLK_T_FLUSH request does that.
<!--l. 1234--><p class="noindent" >Some older legacy devices did not commit completed writes to persistent device
backend storage when VIRTIO_BLK_F_FLUSH was offered but not negotiated.
In order to work around this, the driver MAY set the <span 
class="aeti-10">writeback </span>to 0 (if
available) or it MAY send an explicit flush request after every completed
write.
                                                                  

                                                                  
<!--l. 1240--><p class="noindent" >If the device has VIRTIO_BLK_F_SCSI feature, it can also support scsi packet
command requests, each of these requests is of form:
<!--l. 1243-->
<pre class="lstlisting" id="listing-132"><span class="label"><a 
 id="x1-385003r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">All</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">guest</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">native</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">endian</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385004r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_pc_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385005r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385006r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ioprio</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385007r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sector</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385008r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cmd</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385009r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[][512];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385010r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SCSI_SENSE_BUFFERSIZE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">96</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385011r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sense</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SCSI_SENSE_BUFFERSIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385012r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">errors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385013r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385014r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sense_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385015r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">residual</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385016r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385017r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1261--><p class="noindent" >A request type can also be a scsi packet command (VIRTIO_BLK_T_SCSI_CMD or
VIRTIO_BLK_T_SCSI_CMD_OUT). The two types are equivalent, the device does
not distinguish between them:
<!--l. 1265-->
<pre class="lstlisting" id="listing-133"><span class="label"><a 
 id="x1-385018r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_SCSI_CMD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-385019r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BLK_T_SCSI_CMD_OUT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
<!--l. 1270--><p class="noindent" >The <span 
class="aeti-10">cmd </span>field is only present for scsi packet command requests, and indicates the
command to perform. This field MUST reside in a single, separate device-readable
buffer; command length can be derived from the length of this buffer.
<!--l. 1275--><p class="noindent" >Note that these first three (four for scsi packet commands) fields are always
device-readable: <span 
class="aeti-10">data </span>is either device-readable or device-writable, depending on the
request. The size of the read or write can be derived from the total size of the request
buffers.
<!--l. 1280--><p class="noindent" ><span 
class="aeti-10">sense </span>is only present for scsi packet command requests, and indicates the buffer for
scsi sense data.
<!--l. 1283--><p class="noindent" ><span 
class="aeti-10">data_len </span>is only present for scsi packet command requests, this field is deprecated,
and SHOULD be ignored by the driver. Historically, devices copied data length
there.
<!--l. 1287--><p class="noindent" ><span 
class="aeti-10">sense_len </span>is only present for scsi packet command requests and indicates the number
of bytes actually written to the <span 
class="aeti-10">sense </span>buffer.
<!--l. 1291--><p class="noindent" ><span 
class="aeti-10">residual </span>field is only present for scsi packet command requests and indicates the
residual size, calculated as data length - number of bytes actually transferred.
<a 
 id="x1-385020r397"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.2.6.4   </span> <a 
 id="x1-3860004"></a>Legacy Interface: Framing Requirements</h5>
<!--l. 1297--><p class="noindent" >When using legacy interfaces, transitional drivers which have not negotiated
VIRTIO_F_ANY_LAYOUT:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1301--><p class="noindent" >MUST use a single 8-byte descriptor containing <span 
class="aeti-10">type</span>, <span 
class="aeti-10">reserved </span>and <span 
class="aeti-10">sector</span>,
    followed by descriptors for <span 
class="aeti-10">data</span>, then finally a separate 1-byte descriptor
    for <span 
class="aeti-10">status</span>.
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 1306--><p class="noindent" >For SCSI commands there are additional constraints. <span 
class="aeti-10">sense </span>MUST reside
    in  a  single  separate  device-writable  descriptor  of  size  96  bytes,  and
    <span 
class="aeti-10">errors</span>, <span 
class="aeti-10">data_len</span>, <span 
class="aeti-10">sense_len  </span>and <span 
class="aeti-10">residual  </span>MUST reside a single separate
    device-writable descriptor.</li></ul>
<!--l. 1314--><p class="noindent" >See <a 
href="#x1-390004">2.7.4<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Message Framing --></a>.
<a 
 id="x1-386001r383"></a>
<h3 class="sectionHead"><span class="titlemark">5.3   </span> <a 
 id="x1-3870003"></a>Console Device</h3>
<!--l. 3--><p class="noindent" >The virtio console device is a simple device for data input and output. A
device MAY have one or more ports. Each port has a pair of input and
output virtqueues. Moreover, a device has a pair of control IO virtqueues. The
control virtqueues are used to communicate information between the device
and the driver about ports being opened and closed on either side of the
connection, indication from the device about whether a particular port is a console
port, adding new ports, port hot-plug/unplug, etc., and indication from
the driver about whether a port or a device was successfully added, port
open/close, etc. For data IO, one or more empty buffers are placed in the receive
queue for incoming data and outgoing characters are placed in the transmit
queue.
<a 
 id="x1-387001r394"></a>
<h4 class="subsectionHead"><span class="titlemark">5.3.1   </span> <a 
 id="x1-3880001"></a>Device ID</h4>
<!--l. 18--><p class="noindent" >3
<a 
 id="x1-388001r400"></a>
<h4 class="subsectionHead"><span class="titlemark">5.3.2   </span> <a 
 id="x1-3890002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 23--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 23--><p class="noindent" >receiveq(port0)
    </dd><dt class="description">
    <!--l. 24--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 24--><p class="noindent" >transmitq(port0)
    </dd><dt class="description">
    <!--l. 25--><p class="noindent" >
<span 
class="aeb10-">2</span> </dt><dd 
class="description">
    <!--l. 25--><p class="noindent" >control receiveq
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 26--><p class="noindent" >
<span 
class="aeb10-">3</span> </dt><dd 
class="description">
    <!--l. 26--><p class="noindent" >control transmitq
    </dd><dt class="description">
    <!--l. 27--><p class="noindent" >
<span 
class="aeb10-">4</span> </dt><dd 
class="description">
    <!--l. 27--><p class="noindent" >receiveq(port1)
    </dd><dt class="description">
    <!--l. 28--><p class="noindent" >
<span 
class="aeb10-">5</span> </dt><dd 
class="description">
    <!--l. 28--><p class="noindent" >transmitq(port1)
    </dd><dt class="description">
    <!--l. 29--><p class="noindent" >
<span 
class="aeb10-">…</span> </dt><dd 
class="description">
    <!--l. 29--><p class="noindent" ></dd></dl>
<!--l. 32--><p class="noindent" >The port 0 receive and transmit queues always exist: other queues only exist if
VIRTIO_CONSOLE_F_MULTIPORT is set.
<a 
 id="x1-389001r401"></a>
<h4 class="subsectionHead"><span class="titlemark">5.3.3   </span> <a 
 id="x1-3900003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 38--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_F_SIZE (0)</span> </dt><dd 
class="description">
    <!--l. 38--><p class="noindent" >Configuration <span 
class="aeti-10">cols </span>and <span 
class="aeti-10">rows </span>are valid.
    </dd><dt class="description">
    <!--l. 41--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_F_MULTIPORT (1)</span> </dt><dd 
class="description">
    <!--l. 41--><p class="noindent" >Device has support for multiple ports; <span 
class="aeti-10">max_nr_ports </span>is valid and control
    virtqueues will be used.
    </dd><dt class="description">
    <!--l. 44--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_F_EMERG_WRITE (2)</span> </dt><dd 
class="description">
    <!--l. 44--><p class="noindent" >Device has support for emergency write. Configuration field emerg_wr is
    valid.</dd></dl>
                                                                  

                                                                  
<a 
 id="x1-390001r402"></a>
<h4 class="subsectionHead"><span class="titlemark">5.3.4   </span> <a 
 id="x1-3910004"></a>Device configuration layout</h4>
<!--l. 50--><p class="noindent" >The size of the console is supplied in the configuration space if
the VIRTIO_CONSOLE_F_SIZE feature is set. Furthermore, if the
VIRTIO_CONSOLE_F_MULTIPORT feature is set, the maximum number of ports
supported by the device can be fetched.
<!--l. 56--><p class="noindent" >If VIRTIO_CONSOLE_F_EMERG_WRITE is set then the driver can use emergency
write to output a single character without initializing virtio queues, or even
acknowledging the feature.
<!--l. 60-->
<pre class="lstlisting" id="listing-134"><span class="label"><a 
 id="x1-391001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_console_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-391002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cols</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-391003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rows</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-391004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_nr_ports</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-391005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">emerg_wr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-391006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-391007r398"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.3.4.1   </span> <a 
 id="x1-3920001"></a>Legacy Interface: Device configuration layout</h5>
<!--l. 70--><p class="noindent" >When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_console_config according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<a 
 id="x1-392001r403"></a>
<h4 class="subsectionHead"><span class="titlemark">5.3.5   </span> <a 
 id="x1-3930005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">If         the         VIRTIO_CONSOLE_F_EMERG_WRITE         feature
    is offered, <span 
class="aeti-10">emerg_wr </span>field of the configuration can be written at any time.
    Thus it works for very early boot debugging output as well as catastophic
    OS failures (eg. virtio ring corruption).
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_CONSOLE_F_SIZE feature is negotiated, the driver can
    read the console dimensions from <span 
class="aeti-10">cols </span>and <span 
class="aeti-10">rows</span>.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If  the  VIRTIO_CONSOLE_F_MULTIPORT  feature  is  negotiated,  the
    driver can spawn multiple ports, not all of which are necessarily attached to
    a console. Some could be generic ports. In this case, the control virtqueues
    are enabled and according to <span 
class="aeti-10">max_nr_ports</span>, the appropriate number of
    virtqueues are created. A control message indicating the driver is ready
    is  sent  to  the  device.  The  device  can  then  send  control  messages  for
    adding new ports to the device. After creating and initializing each port, a
    VIRTIO_CONSOLE_PORT_READY control message is sent to the device
    for  that  port  so  the  device  can  let  the  driver  know  of  any  additional
    configuration options set for that port.
                                                                  

                                                                  
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">The receiveq for each port is populated with one or more receive buffers.</dd></dl>
<a 
 id="x1-393005r404"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.3.5.1   </span> <a 
 id="x1-3940001"></a>Device Requirements: Device Initialization</h5>
<!--l. 105--><p class="noindent" >The device MUST allow a write to <span 
class="aeti-10">emerg_wr</span>, even on an unconfigured device.
<!--l. 108--><p class="noindent" >The device SHOULD transmit the lower byte written to <span 
class="aeti-10">emerg_wr </span>to an appropriate
log or output method.
<a 
 id="x1-394001r405"></a>
<h4 class="subsectionHead"><span class="titlemark">5.3.6   </span> <a 
 id="x1-3950006"></a>Device Operation</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">For output, a buffer containing the characters is placed in the port’s transmitq<span class="footnote-mark"><a 
href="#fn15x5" id="fn15x5-bk"><sup class="textsuperscript">15</sup></a></span><a 
 id="x1-395002f15"></a>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">When  a  buffer  is  used  in  the  receiveq  (signalled  by  a  used  buffer
    notification), the contents is the input to the port associated with the
    virtqueue for which the notification was received.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If  the  driver  negotiated  the  VIRTIO_CONSOLE_F_SIZE  feature,  a
    configuration change notification indicates that the updated size can be
    read from the configuration fields. This size applies to port 0 only.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">If the driver negotiated the VIRTIO_CONSOLE_F_MULTIPORT feature,
    active      ports      are      announced      by      the      device      using
    the VIRTIO_CONSOLE_PORT_ADD control message. The same message
    is used for port hot-plug as well.</dd></dl>
<a 
 id="x1-395006r406"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.3.6.1   </span> <a 
 id="x1-3960001"></a>Driver Requirements: Device Operation</h5>
<!--l. 140--><p class="noindent" >The driver MUST NOT put a device-readable buffer in a receiveq. The driver MUST
NOT put a device-writable buffer in a transmitq.
<a 
 id="x1-396001r408"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.3.6.2   </span> <a 
 id="x1-3970002"></a>Multiport Device Operation</h5>
<!--l. 145--><p class="noindent" >If the driver negotiated the VIRTIO_CONSOLE_F_MULTIPORT, the two control
queues are used to manipulate the different console ports: the control receiveq for
messages from the device to the driver, and the control sendq for driver-to-device
messages. The layout of the control messages is:
<!--l. 151-->
<pre class="lstlisting" id="listing-135"><span class="label"><a 
 id="x1-397001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_console_control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-397002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Port</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">number</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-397003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">kind</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-397004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Extra</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">information</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-397005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 159--><p class="noindent" >The values for <span 
class="aeti-10">event </span>are:
                                                                  

                                                                  
    <dl class="description"><dt class="description">
    <!--l. 161--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_DEVICE_READY (0)</span> </dt><dd 
class="description">
    <!--l. 161--><p class="noindent" >Sent by the driver at initialization to indicate that it is ready to receive
    control messages. A value of 1 indicates success, and 0 indicates failure.
    The port number <span 
class="aeti-10">id </span>is unused.
    </dd><dt class="description">
    <!--l. 164--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_DEVICE_ADD (1)</span> </dt><dd 
class="description">
    <!--l. 164--><p class="noindent" >Sent by the device, to create a new port. <span 
class="aeti-10">value </span>is unused.
    </dd><dt class="description">
    <!--l. 166--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_DEVICE_REMOVE (2)</span> </dt><dd 
class="description">
    <!--l. 166--><p class="noindent" >Sent by the device, to remove an existing port. <span 
class="aeti-10">value </span>is unused.
    </dd><dt class="description">
    <!--l. 168--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_PORT_READY (3)</span> </dt><dd 
class="description">
    <!--l. 168--><p class="noindent" >Sent                         by                         the                         driver
    in response to the device’s VIRTIO_CONSOLE_PORT_ADD message, to
    indicate that the port is ready to be used. A <span 
class="aeti-10">value </span>of 1 indicates success,
    and 0 indicates failure.
    </dd><dt class="description">
    <!--l. 172--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_CONSOLE_PORT (4)</span> </dt><dd 
class="description">
    <!--l. 172--><p class="noindent" >Sent by the device to nominate a port as a console port. There MAY be
    more than one console port.
    </dd><dt class="description">
    <!--l. 174--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_RESIZE (5)</span> </dt><dd 
class="description">
    <!--l. 174--><p class="noindent" >Sent by the device to indicate a console size change. <span 
class="aeti-10">value </span>is unused. The buffer
    is followed by the number of columns and rows: <!--l. 176-->
    <pre class="lstlisting" id="listing-136"><span class="label"><a 
 id="x1-397006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_console_resize</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-397007r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cols</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-397008r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rows</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-397009r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    </dd><dt class="description">
    <!--l. 182--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_PORT_OPEN (6)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 182--><p class="noindent" >This message is sent by both the device and the driver. <span 
class="aeti-10">value </span>indicates the state:
    0 (port closed) or 1 (port open). This allows for ports to be used directly by
    guest and host processes to communicate in an application-defined
    manner.
    </dd><dt class="description">
    <!--l. 187--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CONSOLE_PORT_NAME (7)</span> </dt><dd 
class="description">
    <!--l. 187--><p class="noindent" >Sent by the device to give a tag to the port. This control command is
    immediately followed by the UTF-8 name of the port for identification within
    the guest (without a NUL terminator).</dd></dl>
<a 
 id="x1-397010r381"></a>
<!--l. 193--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.3.6.2.1</span> <a 
 id="x1-3980001"></a>Device Requirements: Multiport Device Operation</h5>
The device MUST NOT specify a port which exists in a VIRTIO_CONSOLE_DEVICE_ADD
message, nor a port which is equal or greater than <span 
class="aeti-10">max_nr_ports</span>.
<!--l. 199--><p class="noindent" >The device MUST NOT specify a port in VIRTIO_CONSOLE_DEVICE_REMOVE
which has not been created with a previous VIRTIO_CONSOLE_DEVICE_ADD.
<a 
 id="x1-398001r410"></a>
<!--l. 202--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.3.6.2.2</span> <a 
 id="x1-3990002"></a>Driver Requirements: Multiport Device Operation</h5>
The driver MUST send a VIRTIO_CONSOLE_DEVICE_READY message if
VIRTIO_CONSOLE_F_MULTIPORT is negotiated.
<!--l. 207--><p class="noindent" >Upon receipt of a VIRTIO_CONSOLE_CONSOLE_PORT message, the driver
SHOULD treat the port in a manner suitable for text console access and MUST
respond with a VIRTIO_CONSOLE_PORT_OPEN message, which MUST have <span 
class="aeti-10">value</span>
set to 1.
<a 
 id="x1-399001r409"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.3.6.3   </span> <a 
 id="x1-4000003"></a>Legacy Interface: Device Operation</h5>
<!--l. 213--><p class="noindent" >When using the legacy interface, transitional devices and drivers MUST format
the fields in struct virtio_console_control according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<!--l. 218--><p class="noindent" >When using the legacy interface, the driver SHOULD ignore the used length values
for the transmit queues and the control transmitq.
<span 
class="aeb10-">Note:</span> Historically,  some  devices  put  the  total  descriptor  length  there,  even
      though no data was actually written.
<a 
 id="x1-400001r412"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.3.6.4   </span> <a 
 id="x1-4010004"></a>Legacy Interface: Framing Requirements</h5>
<!--l. 229--><p class="noindent" >When using legacy interfaces, transitional drivers which have not negotiated
VIRTIO_F_ANY_LAYOUT MUST use only a single descriptor for all buffers in the
control receiveq and control transmitq.
<a 
 id="x1-401001r399"></a>
<h3 class="sectionHead"><span class="titlemark">5.4   </span> <a 
 id="x1-4020004"></a>Entropy Device</h3>
<!--l. 3--><p class="noindent" >The virtio entropy device supplies high-quality randomness for guest use.
<a 
 id="x1-402001r407"></a>
<h4 class="subsectionHead"><span class="titlemark">5.4.1   </span> <a 
 id="x1-4030001"></a>Device ID</h4>
<!--l. 7--><p class="noindent" >4
<a 
 id="x1-403001r415"></a>
<h4 class="subsectionHead"><span class="titlemark">5.4.2   </span> <a 
 id="x1-4040002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 11--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 11--><p class="noindent" >requestq</dd></dl>
<a 
 id="x1-404001r416"></a>
<h4 class="subsectionHead"><span class="titlemark">5.4.3   </span> <a 
 id="x1-4050003"></a>Feature bits</h4>
<!--l. 15--><p class="noindent" >None currently defined
<a 
 id="x1-405001r417"></a>
<h4 class="subsectionHead"><span class="titlemark">5.4.4   </span> <a 
 id="x1-4060004"></a>Device configuration layout</h4>
<!--l. 18--><p class="noindent" >None currently defined.
<a 
 id="x1-406001r418"></a>
<h4 class="subsectionHead"><span class="titlemark">5.4.5   </span> <a 
 id="x1-4070005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The virtqueue is initialized</dd></dl>
<a 
 id="x1-407002r419"></a>
<h4 class="subsectionHead"><span class="titlemark">5.4.6   </span> <a 
 id="x1-4080006"></a>Device Operation</h4>
<!--l. 28--><p class="noindent" >When the driver requires random bytes, it places the descriptor of one or more
buffers in the queue. It will be completely filled by random data by the
device.
<a 
 id="x1-408001r413"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.4.6.1   </span> <a 
 id="x1-4090001"></a>Driver Requirements: Device Operation</h5>
<!--l. 34--><p class="noindent" >The driver MUST NOT place device-readable buffers into the queue.
<!--l. 36--><p class="noindent" >The driver MUST examine the length written by the device to determine how many
                                                                  

                                                                  
random bytes were received.
<a 
 id="x1-409001r421"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.4.6.2   </span> <a 
 id="x1-4100002"></a>Device Requirements: Device Operation</h5>
<!--l. 41--><p class="noindent" >The device MUST place one or more random bytes into the buffer, but it MAY use
less than the entire buffer length.
<a 
 id="x1-410001r414"></a>
<h3 class="sectionHead"><span class="titlemark">5.5   </span> <a 
 id="x1-4110005"></a>Traditional Memory Balloon Device</h3>
<!--l. 3--><p class="noindent" >This is the traditional balloon device. The device number 13 is reserved for a new
memory balloon interface, with different semantics, which is expected in a future
version of the standard.
<!--l. 7--><p class="noindent" >The traditional virtio memory balloon device is a primitive device for managing guest
memory: the device asks for a certain amount of memory, and the driver supplies it
(or withdraws it, if the device has more than it asks for). This allows the guest to
adapt to changes in allowance of underlying physical memory. If the feature is
negotiated, the device can also be used to communicate guest memory statistics to
the host.
<a 
 id="x1-411001r420"></a>
<h4 class="subsectionHead"><span class="titlemark">5.5.1   </span> <a 
 id="x1-4120001"></a>Device ID</h4>
<!--l. 16--><p class="noindent" >5
<a 
 id="x1-412001r424"></a>
<h4 class="subsectionHead"><span class="titlemark">5.5.2   </span> <a 
 id="x1-4130002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 20--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 20--><p class="noindent" >inflateq
    </dd><dt class="description">
    <!--l. 21--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 21--><p class="noindent" >deflateq
    </dd><dt class="description">
    <!--l. 22--><p class="noindent" >
<span 
class="aeb10-">2</span> </dt><dd 
class="description">
    <!--l. 22--><p class="noindent" >statsq
    </dd><dt class="description">
    <!--l. 23--><p class="noindent" >
<span 
class="aeb10-">3</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 23--><p class="noindent" >free_page_vq
    </dd><dt class="description">
    <!--l. 24--><p class="noindent" >
<span 
class="aeb10-">4</span> </dt><dd 
class="description">
    <!--l. 24--><p class="noindent" >reporting_vq</dd></dl>
<!--l. 27--><p class="noindent" >statsq only exists if VIRTIO_BALLOON_F_STATS_VQ is set.
<!--l. 29--><p class="noindent" >free_page_vq only exists if VIRTIO_BALLOON_F_FREE_PAGE_HINT is
set.
<!--l. 31--><p class="noindent" >reporting_vq only exists if VIRTIO_BALLOON_F_PAGE_REPORTING is
set.
<a 
 id="x1-413001r425"></a>
<h4 class="subsectionHead"><span class="titlemark">5.5.3   </span> <a 
 id="x1-4140003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 35--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_F_MUST_TELL_HOST (0)</span> </dt><dd 
class="description">
    <!--l. 35--><p class="noindent" >Host has to be told before pages from the balloon are used.
    </dd><dt class="description">
    <!--l. 38--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_F_STATS_VQ (1)</span> </dt><dd 
class="description">
    <!--l. 38--><p class="noindent" >A virtqueue for reporting guest memory statistics is present.
    </dd><dt class="description">
    <!--l. 40--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_F_DEFLATE_ON_OOM (2)</span>  </dt><dd 
class="description">
    <!--l. 40--><p class="noindent" >Deflate balloon on guest out of memory condition.
    </dd><dt class="description">
    <!--l. 42--><p class="noindent" >
 <span 
class="aeb10-">VIRTIO_BALLOON_F_FREE_PAGE_HINT(3)</span>  </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >The device has support for free page hinting. A virtqueue for providing
    hints as to what memory is currently free is present. Configuration field
    <span 
class="aeti-10">free_page_hint_cmd_id </span>is valid.
    </dd><dt class="description">
    <!--l. 46--><p class="noindent" >
 <span 
class="aeb10-">VIRTIO_BALLOON_F_PAGE_POISON(4)</span>  </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 46--><p class="noindent" >A hint to the device, that the driver will immediately write <span 
class="aeti-10">poison_val </span>to
    pages after deflating them. Configuration field <span 
class="aeti-10">poison_val </span>is valid.
    </dd><dt class="description">
    <!--l. 49--><p class="noindent" >
 <span 
class="aeb10-">VIRTIO_BALLOON_F_PAGE_REPORTING(5)</span>  </dt><dd 
class="description">
    <!--l. 49--><p class="noindent" >The device has support for free page reporting. A virtqueue for reporting
    free guest memory is present.
    </dd></dl>
<a 
 id="x1-414001r422"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.3.1   </span> <a 
 id="x1-4150001"></a>Driver Requirements: Feature bits</h5>
<!--l. 55--><p class="noindent" >The driver SHOULD accept the VIRTIO_BALLOON_F_MUST_TELL_HOST feature
if offered by the device.
<!--l. 58--><p class="noindent" >The driver SHOULD clear the VIRTIO_BALLOON_F_PAGE_POISON flag if it will
not immediately write <span 
class="aeti-10">poison_val </span>to deflated pages (e.g., to initialize them, or fill
them with a poison value).
<!--l. 62--><p class="noindent" >If the driver is expecting the pages to retain some initialized value, it MUST NOT
accept VIRTIO_BALLOON_F_PAGE_REPORTING unless it also negotiates
VIRTIO_BALLOON_F_PAGE_POISON.
<a 
 id="x1-415001r427"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.3.2   </span> <a 
 id="x1-4160002"></a>Device Requirements: Feature bits</h5>
<!--l. 67--><p class="noindent" >If the device offers the VIRTIO_BALLOON_F_MUST_TELL_HOST feature bit, and
if the driver did not accept this feature bit, the device MAY signal failure
by failing to set FEATURES_OK <span 
class="aeti-10">device status </span>bit when the driver writes
it.
<a 
 id="x1-416001r379"></a>
<!--l. 71--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.5.3.2.0.1</span> <a 
 id="x1-4170001"></a>Legacy Interface: Feature bits</h6>
As the legacy interface does not have a way to gracefully report feature negotiation
failure, when using the legacy interface, transitional devices MUST support
guests which do not negotiate VIRTIO_BALLOON_F_MUST_TELL_HOST
feature, and SHOULD allow guest to use memory before notifying host if
VIRTIO_BALLOON_F_MUST_TELL_HOST is not negotiated.
<a 
 id="x1-417001r426"></a>
<h4 class="subsectionHead"><span class="titlemark">5.5.4   </span> <a 
 id="x1-4180004"></a>Device configuration layout</h4>
<!--l. 82--><p class="noindent" ><span 
class="aeti-10">num_pages </span>and <span 
class="aeti-10">actual </span>are always available.
<!--l. 84--><p class="noindent" ><span 
class="aeti-10">free_page_hint_cmd_id </span>is available if VIRTIO_BALLOON_F_FREE_PAGE_HINT has
been negotiated. The field is read-only by the driver. <span 
class="aeti-10">poison_val </span>is available if
VIRTIO_BALLOON_F_PAGE_POISON has been negotiated.
                                                                  

                                                                  
<!--l. 90-->
<pre class="lstlisting" id="listing-137"><span class="label"><a 
 id="x1-418001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_balloon_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-418002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_pages</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-418003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actual</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-418004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">free_page_hint_cmd_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-418005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">poison_val</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-418006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-418007r429"></a>
<!--l. 99--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.5.4.0.0.1</span> <a 
 id="x1-4190001"></a>Legacy Interface: Device configuration layout</h6>
When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_balloon_config according to the little-endian
format.
<span 
class="aeb10-">Note:</span> This is unlike the usual convention that legacy device fields are guest
      endian.
<a 
 id="x1-419001r430"></a>
<h4 class="subsectionHead"><span class="titlemark">5.5.5   </span> <a 
 id="x1-4200005"></a>Device Initialization</h4>
<!--l. 110--><p class="noindent" >The device initialization process is outlined below:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The inflate and deflate virtqueues are identified.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BALLOON_F_STATS_VQ feature bit is negotiated:
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
    (a) </dt><dd 
class="enumerate-enumitem">Identify the stats virtqueue.
        </dd><dt class="enumerate-enumitem">
    (b) </dt><dd 
class="enumerate-enumitem">Add one empty buffer to the stats virtqueue.</dd></dl>
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BALLOON_F_FREE_PAGE_HINT feature bit is negotiated,
    identify the free_page_vq.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BALLOON_F_PAGE_POISON feature bit is negotiated, update
    the <span 
class="aeti-10">poison_val </span>configuration field.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BALLOON_F_PAGE_REPORTING feature bit is negotiated,
    identify the reporting_vq.
    </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">DRIVER_OK is set: device operation begins.
    </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BALLOON_F_STATS_VQ feature bit is negotiated, then notify
    the device about the stats virtqueue buffer.
                                                                  

                                                                  
    </dd><dt class="enumerate-enumitem">
  8. </dt><dd 
class="enumerate-enumitem">If the VIRTIO_BALLOON_F_PAGE_REPORTING feature bit is negotiated,
    then begin reporting free pages to the device.</dd></dl>
<a 
 id="x1-420011r432"></a>
<h4 class="subsectionHead"><span class="titlemark">5.5.6   </span> <a 
 id="x1-4210006"></a>Device Operation</h4>
<!--l. 138--><p class="noindent" >The device is driven either by the receipt of a configuration change notification, or by
changing guest memory needs, such as performing memory compaction or responding
to out of memory conditions.
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem"><span 
class="aeti-10">num_pages </span>configuration field is examined. If this is greater than the <span 
class="aeti-10">actual</span>
    number of pages, the balloon wants more memory from the guest. If it is
    less than <span 
class="aeti-10">actual</span>, the balloon doesn’t need it all.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">To supply memory to the balloon (aka. inflate):
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
    (a) </dt><dd 
class="enumerate-enumitem">The driver constructs an array of addresses of unused memory pages.
        These addresses are divided by 4096<span class="footnote-mark"><a 
href="#fn16x5" id="fn16x5-bk"><sup class="textsuperscript">16</sup></a></span><a 
 id="x1-421004f16"></a>
        and the descriptor describing the resulting 32-bit array is added to the
        inflateq.</dd></dl>
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">To remove memory from the balloon (aka. deflate):
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
    (a) </dt><dd 
class="enumerate-enumitem">The driver constructs an array of addresses of memory pages it has
        previously given to the balloon, as described above. This descriptor is
        added to the deflateq.
        </dd><dt class="enumerate-enumitem">
    (b) </dt><dd 
class="enumerate-enumitem">If    the    VIRTIO_BALLOON_F_MUST_TELL_HOST    feature    is
        negotiated, the guest informs the device of pages before it uses them.
        </dd><dt class="enumerate-enumitem">
    (c) </dt><dd 
class="enumerate-enumitem">Otherwise, the guest is allowed to re-use pages previously given to the
        balloon before the device has acknowledged their withdrawal<span class="footnote-mark"><a 
href="#fn17x5" id="fn17x5-bk"><sup class="textsuperscript">17</sup></a></span><a 
 id="x1-421009f17"></a>.</dd></dl>
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">In either case, the device acknowledges inflate and deflate requests by using the
    descriptor.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">Once the device has acknowledged the inflation or deflation, the driver updates
    <span 
class="aeti-10">actual </span>to reflect the new number of pages in the balloon.</dd></dl>
<a 
 id="x1-421012r428"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.5.6.1   </span> <a 
 id="x1-4220001"></a>Driver Requirements: Device Operation</h5>
<!--l. 179--><p class="noindent" >The driver SHOULD supply pages to the balloon when <span 
class="aeti-10">num_pages </span>is greater than the
actual number of pages in the balloon.
<!--l. 182--><p class="noindent" >The driver MAY use pages from the balloon when <span 
class="aeti-10">num_pages </span>is less than the actual
number of pages in the balloon.
<!--l. 185--><p class="noindent" >The driver MAY supply pages to the balloon when <span 
class="aeti-10">num_pages </span>is greater than or
equal to the actual number of pages in the balloon.
<!--l. 188--><p class="noindent" >If VIRTIO_BALLOON_F_DEFLATE_ON_OOM has not been negotiated, the driver
MUST NOT use pages from the balloon when <span 
class="aeti-10">num_pages </span>is less than or equal to the
actual number of pages in the balloon.
<!--l. 193--><p class="noindent" >If VIRTIO_BALLOON_F_DEFLATE_ON_OOM has been negotiated, the
driver MAY use pages from the balloon when <span 
class="aeti-10">num_pages </span>is less than or
equal to the actual number of pages in the balloon if this is required for
system stability (e.g. if memory is required by applications running within the
guest).
<!--l. 200--><p class="noindent" >The driver MUST use the deflateq to inform the device of pages that it wants to use
from the balloon.
<!--l. 203--><p class="noindent" >If the VIRTIO_BALLOON_F_MUST_TELL_HOST feature is negotiated, the driver
MUST NOT use pages from the balloon until the device has acknowledged the deflate
request.
<!--l. 207--><p class="noindent" >Otherwise, if the VIRTIO_BALLOON_F_MUST_TELL_HOST feature is not
negotiated, the driver MAY begin to re-use pages previously given to the balloon
before the device has acknowledged the deflate request.
<!--l. 212--><p class="noindent" >In any case, the driver MUST NOT use pages from the balloon after adding the
pages to the balloon, but before the device has acknowledged the inflate
request.
<!--l. 216--><p class="noindent" >The driver MUST NOT request deflation of pages in the balloon before the device
has acknowledged the inflate request.
<!--l. 220--><p class="noindent" >The driver MUST update <span 
class="aeti-10">actual </span>after changing the number of pages in the
balloon.
<!--l. 223--><p class="noindent" >The driver MAY update <span 
class="aeti-10">actual </span>once after multiple inflate and deflate operations.
<a 
 id="x1-422001r434"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.6.2   </span> <a 
 id="x1-4230002"></a>Device Requirements: Device Operation</h5>
<!--l. 228--><p class="noindent" >The device MAY modify the contents of a page in the balloon after detecting its
physical number in an inflate request and before acknowledging the inflate request by
using the inflateq descriptor.
<!--l. 233--><p class="noindent" >If the VIRTIO_BALLOON_F_MUST_TELL_HOST feature is negotiated, the device
MAY modify the contents of a page in the balloon after detecting its physical number
                                                                  

                                                                  
in an inflate request and before detecting its physical number in a deflate request and
acknowledging the deflate request.
<a 
 id="x1-423001r411"></a>
<!--l. 239--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.2.1</span> <a 
 id="x1-4240001"></a>Legacy Interface: Device Operation</h5>
When using the legacy interface, the driver SHOULD ignore the used length
values.
<span 
class="aeb10-">Note:</span> Historically,  some  devices  put  the  total  descriptor  length  there,  even
      though no data was actually written.
<!--l. 248--><p class="noindent" >When using the legacy interface, the driver MUST write out all 4 bytes each time it
updates the <span 
class="aeti-10">actual </span>value in the configuration space, using a single atomic
operation.
<!--l. 252--><p class="noindent" >When using the legacy interface, the device SHOULD NOT use the <span 
class="aeti-10">actual </span>value
written by the driver in the configuration space, until the last, most-significant byte
of the value has been written.
<span 
class="aeb10-">Note:</span> Historically, devices used the <span 
class="aeti-10">actual </span>value, even though when using Virtio
      Over PCI Bus the device-specific configuration space was not guaranteed
      to be atomic. Using intermediate values during update by driver is best
      avoided, except for debugging.
      <!--l. 263--><p class="noindent" >Historically, drivers using Virtio Over PCI Bus wrote the <span 
class="aeti-10">actual </span>value
      by using multiple single-byte writes in order, from the least-significant to
      the most-significant value.
<a 
 id="x1-424001r435"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.6.3   </span> <a 
 id="x1-4250003"></a>Memory Statistics</h5>
<!--l. 269--><p class="noindent" >The stats virtqueue is atypical because communication is driven by the device (not
the driver). The channel becomes active at driver initialization time when the driver
adds an empty buffer and notifies the device. A request for memory statistics
proceeds as follows:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The device uses the buffer and sends a used buffer notification.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">The driver pops the used buffer and discards it.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">The driver collects memory statistics and writes them into a new buffer.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">The driver adds the buffer to the virtqueue and notifies the device.
    </dd><dt class="enumerate-enumitem">
                                                                  

                                                                  
  5. </dt><dd 
class="enumerate-enumitem">The device pops the buffer (retaining it to initiate a subsequent request)
    and consumes the statistics.</dd></dl>
<!--l. 290--><p class="noindent" >Within the buffer, statistics are an array of 10-byte entries. Each statistic consists of
a 16 bit tag and a 64 bit value. All statistics are optional and the driver chooses
which ones to supply. To guarantee backwards compatibility, devices omit
unsupported statistics.
<!--l. 296-->
<pre class="lstlisting" id="listing-138"><span class="label"><a 
 id="x1-425006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_balloon_stat</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425007r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_SWAP_IN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425008r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_SWAP_OUT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425009r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_MAJFLT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425010r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_MINFLT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425011r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_MEMFREE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425012r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_MEMTOT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425013r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_AVAIL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425014r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_CACHES</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425015r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_HTLB_PGALLOC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425016r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_BALLOON_S_HTLB_PGFAIL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425017r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425018r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">val</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-425019r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">__attribute__</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">((</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">packed</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
<a 
 id="x1-425020r436"></a>
<!--l. 313--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.3.1</span> <a 
 id="x1-4260001"></a>Driver Requirements: Memory Statistics</h5>
Normative statements in this section apply if and only if the
VIRTIO_BALLOON_F_STATS_VQ feature has been negotiated.
<!--l. 317--><p class="noindent" >The driver MUST make at most one buffer available to the device in the statsq, at all
times.
<!--l. 320--><p class="noindent" >After initializing the device, the driver MUST make an output buffer available in the
statsq.
<!--l. 323--><p class="noindent" >Upon detecting that device has used a buffer in the statsq, the driver MUST make an
output buffer available in the statsq.
<!--l. 326--><p class="noindent" >Before making an output buffer available in the statsq, the driver MUST initialize
it, including one struct virtio_balloon_stat entry for each statistic that it
supports.
<!--l. 330--><p class="noindent" >Driver MUST use an output buffer size which is a multiple of 6 bytes for all buffers
submitted to the statsq.
<!--l. 333--><p class="noindent" >Driver MAY supply struct virtio_balloon_stat entries in the output buffer submitted
to the statsq in any order, without regard to <span 
class="aeti-10">tag </span>values.
<!--l. 337--><p class="noindent" >Driver MAY supply a subset of all statistics in the output buffer submitted to the
statsq.
<!--l. 340--><p class="noindent" >Driver MUST supply the same subset of statistics in all buffers submitted to the
statsq.
<a 
 id="x1-426001r438"></a>
<!--l. 343--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.3.2</span> <a 
 id="x1-4270002"></a>Device Requirements: Memory Statistics</h5>
Normative statements in this section apply if and only if the
VIRTIO_BALLOON_F_STATS_VQ feature has been negotiated.
<!--l. 347--><p class="noindent" >Within an output buffer submitted to the statsq, the device MUST ignore entries
with <span 
class="aeti-10">tag </span>values that it does not recognize.
                                                                  

                                                                  
<!--l. 350--><p class="noindent" >Within an output buffer submitted to the statsq, the device MUST accept struct
virtio_balloon_stat entries in any order without regard to <span 
class="aeti-10">tag </span>values.
<a 
 id="x1-427001r439"></a>
<!--l. 354--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.3.3</span> <a 
 id="x1-4280003"></a>Legacy Interface: Memory Statistics</h5>
When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_balloon_stat according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<!--l. 361--><p class="noindent" >When using the legacy interface, the device SHOULD ignore all values in the first
buffer in the statsq supplied by the driver after device initialization.
<span 
class="aeb10-">Note:</span> Historically, drivers supplied an uninitialized buffer in the first buffer.
<a 
 id="x1-428001r437"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.6.4   </span> <a 
 id="x1-4290004"></a>Memory Statistics Tags</h5>
    <dl class="description"><dt class="description">
    <!--l. 372--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_SWAP_IN (0)</span> </dt><dd 
class="description">
    <!--l. 372--><p class="noindent" >The amount of memory that has been swapped in (in bytes).
    </dd><dt class="description">
    <!--l. 375--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_SWAP_OUT (1)</span> </dt><dd 
class="description">
    <!--l. 375--><p class="noindent" >The amount of memory that has been swapped out to disk (in bytes).
    </dd><dt class="description">
    <!--l. 378--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_MAJFLT (2)</span> </dt><dd 
class="description">
    <!--l. 378--><p class="noindent" >The number of major page faults that have occurred.
    </dd><dt class="description">
    <!--l. 381--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_MINFLT (3)</span> </dt><dd 
class="description">
    <!--l. 381--><p class="noindent" >The number of minor page faults that have occurred.
    </dd><dt class="description">
    <!--l. 384--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_MEMFREE (4)</span> </dt><dd 
class="description">
    <!--l. 384--><p class="noindent" >The amount of memory not being used for any purpose (in bytes).
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 387--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_MEMTOT (5)</span> </dt><dd 
class="description">
    <!--l. 387--><p class="noindent" >The total amount of memory available (in bytes).
    </dd><dt class="description">
    <!--l. 390--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_AVAIL (6)</span> </dt><dd 
class="description">
    <!--l. 390--><p class="noindent" >An estimate of how much memory is available (in bytes) for starting new
    applications, without pushing the system to swap.
    </dd><dt class="description">
    <!--l. 393--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_CACHES (7)</span> </dt><dd 
class="description">
    <!--l. 393--><p class="noindent" >The amount of memory, in bytes, that can be quickly reclaimed without
    additional I/O. Typically these pages are used for caching files from disk.
    </dd><dt class="description">
    <!--l. 397--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_HTLB_PGALLOC (8)</span> </dt><dd 
class="description">
    <!--l. 397--><p class="noindent" >The number of successful hugetlb page allocations in the guest.
    </dd><dt class="description">
    <!--l. 400--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_S_HTLB_PGFAIL (9)</span> </dt><dd 
class="description">
    <!--l. 400--><p class="noindent" >The number of failed hugetlb page allocations in the guest.</dd></dl>
<a 
 id="x1-429001r441"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.6.5   </span> <a 
 id="x1-4300005"></a>Free Page Hinting</h5>
<!--l. 406--><p class="noindent" >Free page hinting is designed to be used during migration to determine what
pages within the guest are currently unused so that they can be skipped
over while migrating the guest. The device will indicate that it is ready to
start performing hinting by setting the <span 
class="aeti-10">free_page_hint_cmd_id </span>to one of the
non-reserved values that can be used as a command ID. The following values are
reserved:
    <dl class="description"><dt class="description">
    <!--l. 414--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_CMD_ID_STOP (0)</span> </dt><dd 
class="description">
    <!--l. 414--><p class="noindent" >Any command ID previously supplied by the device is invalid. The driver
    should stop hinting free pages until a new command ID is supplied, but
    should not release any hinted pages for use by the guest.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 419--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_BALLOON_CMD_ID_DONE (1)</span> </dt><dd 
class="description">
    <!--l. 419--><p class="noindent" >Any command ID previously supplied by the device is invalid. The driver
    should stop hinting free pages, and should release all hinted pages for use
    by the guest.</dd></dl>
<!--l. 424--><p class="noindent" >When a hint is provided by the driver it indicates that the data contained in the
given page is no longer needed and can be discarded. If the driver writes to the
page this overrides the hint and the data will be retained. The contents of
any stale pages that have not been written to since the page was hinted
may be lost, and if read the contents of such pages will be uninitialized
memory.
<!--l. 431--><p class="noindent" >A request for free page hinting proceeds as follows:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The  driver  examines  the  <span 
class="aeti-10">free_page_hint_cmd_id  </span>configuration  field.  If  it
    contains a non-reserved value then free page hinting will begin.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">To supply free page hints:
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
    (a) </dt><dd 
class="enumerate-enumitem">The  driver  constructs  an  output  buffer  containing  the  new  value
        from the <span 
class="aeti-10">free_page_hint_cmd_id </span>configuration field and adds it to the
        free_page_vq.
        </dd><dt class="enumerate-enumitem">
    (b) </dt><dd 
class="enumerate-enumitem">The driver maps a series of pages and adds them to the free_page_vq
        as individual scatter-gather input buffer entries.
        </dd><dt class="enumerate-enumitem">
    (c) </dt><dd 
class="enumerate-enumitem">When the driver is no longer able to fetch additional pages to add
        to the free_page_vq, it will construct an output buffer containing the
        command ID VIRTIO_BALLOON_CMD_ID_STOP.</dd></dl>
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">A round of hinting ends either when the driver is no longer able to
    supply more pages for hinting as described above, or when the device
    updates <span 
class="aeti-10">free_page_hint_cmd_id </span>configuration field to contain either
    VIRTIO_BALLOON_CMD_ID_STOP or VIRTIO_BALLOON_CMD_ID_DONE.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">The device may follow VIRTIO_BALLOON_CMD_ID_STOP with a new
    non-reserved value for the <span 
class="aeti-10">free_page_hint_cmd_id </span>configuration field in which
    case it will resume supplying free page hints.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">Otherwise, if the device provides VIRTIO_BALLOON_CMD_ID_DONE then
    hinting is complete and the driver may release all previously hinted pages for use
                                                                  

                                                                  
    by the guest.
    </dd></dl>
<a 
 id="x1-430009r440"></a>
<!--l. 465--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.5.1</span> <a 
 id="x1-4310001"></a>Driver Requirements: Free Page Hinting</h5>
Normative statements in this section apply if the VIRTIO_BALLOON_F_FREE_PAGE_HINT
feature has been negotiated.
<!--l. 470--><p class="noindent" >The driver MUST use an output buffer size of 4 bytes for all output buffers
submitted to the free_page_vq.
<!--l. 473--><p class="noindent" >The driver MUST start hinting by providing an output buffer containing the current
command ID for the given block of pages.
<!--l. 476--><p class="noindent" >The driver MUST NOT provide more than one output buffer containing the current
command ID.
<!--l. 479--><p class="noindent" >The driver SHOULD supply pages to the free_page_vq as input buffers when
<span 
class="aeti-10">free_page_hint_cmd_id </span>specifies a value of 2 or greater.
<!--l. 482--><p class="noindent" >The driver SHOULD stop supplying pages for hinting when <span 
class="aeti-10">free_page_hint_cmd_id </span>specifies
a value of VIRTIO_BALLOON_CMD_ID_STOP or VIRTIO_BALLOON_CMD_ID_DONE.
<!--l. 486--><p class="noindent" >If the driver is unable to supply pages, it MUST complete hinting by adding an
output buffer containing the command ID VIRTIO_BALLOON_CMD_ID_STOP.
<!--l. 489--><p class="noindent" >The driver MAY release hinted pages for use by the guest including when the device
has not yet used the descriptor containing the hinting request.
<!--l. 492--><p class="noindent" >The driver MUST treat the content of all hinted pages as uninitialized memory.
<!--l. 495--><p class="noindent" >The driver MUST initialize the contents of any previously hinted page released before
<span 
class="aeti-10">free_page_hint_cmd_id </span>specifies a value of VIRTIO_BALLOON_CMD_ID_DONE.
<!--l. 499--><p class="noindent" >The driver SHOULD release all previously hinted pages once <span 
class="aeti-10">free_page_hint_cmd_id</span>
specifies a value of VIRTIO_BALLOON_CMD_ID_DONE.
<a 
 id="x1-431001r443"></a>
<!--l. 503--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.5.2</span> <a 
 id="x1-4320002"></a>Device Requirements: Free Page Hinting</h5>
Normative statements in this section apply if the VIRTIO_BALLOON_F_FREE_PAGE_HINT
feature has been negotiated.
<!--l. 508--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">free_page_hint_cmd_id </span>to VIRTIO_BALLOON_CMD_ID_STOP
any time that it will not be able to make use of the hints provided by the
driver.
<!--l. 512--><p class="noindent" >The device MUST NOT reuse a command ID until it has received an output buffer
containing VIRTIO_BALLOON_CMD_ID_STOP from the driver.
<!--l. 515--><p class="noindent" >The device MUST ignore pages that are provided with a command ID that does not
match the current value in <span 
class="aeti-10">free_page_hint_cmd_id</span>.
                                                                  

                                                                  
<!--l. 518--><p class="noindent" >If the content of a previously hinted page has not been modified by the guest since
the device issued the <span 
class="aeti-10">free_page_hint_cmd_id </span>associated with the hint, the device MAY
modify the contents of the page.
<!--l. 522--><p class="noindent" >The device MUST NOT modify the content of a previously hinted page after
<span 
class="aeti-10">free_page_hint_cmd_id </span>is set to VIRTIO_BALLOON_CMD_ID_DONE.
<!--l. 525--><p class="noindent" >The device MUST report a value of VIRTIO_BALLOON_CMD_ID_DONE in
<span 
class="aeti-10">free_page_hint_cmd_id </span>when it no longer has need for the previously hinted
pages.
<a 
 id="x1-432001r444"></a>
<!--l. 529--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.5.3</span> <a 
 id="x1-4330003"></a>Legacy Interface: Free Page Hinting</h5>
When using the legacy interface, transitional devices and drivers MUST
format the command ID field in output buffers according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<a 
 id="x1-433001r442"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.6.6   </span> <a 
 id="x1-4340006"></a>Page Poison</h5>
<!--l. 538--><p class="noindent" >Page Poison provides a way to notify the host that the guest is initializing free pages
with <span 
class="aeti-10">poison_val</span>. When the feature is enabled, pages will be immediately written to by
the driver after deflating, and pages reported by free page reporting will retain the
value indicated by <span 
class="aeti-10">poison_val</span>.
<!--l. 543--><p class="noindent" >If the guest is not initializing freed pages, the driver should reject the
VIRTIO_BALLOON_F_PAGE_POISON feature.
<!--l. 546--><p class="noindent" >If VIRTIO_BALLOON_F_PAGE_POISON feature has been negotiated, the
driver will place the initialization value into the <span 
class="aeti-10">poison_val </span>configuration field
data.
<a 
 id="x1-434001r445"></a>
<!--l. 550--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.6.1</span> <a 
 id="x1-4350001"></a>Driver Requirements: Page Poison</h5>
Normative statements in this section apply if the VIRTIO_BALLOON_F_PAGE_POISON
feature has been negotiated.
<!--l. 555--><p class="noindent" >The driver MUST initialize the deflated pages with <span 
class="aeti-10">poison_val </span>when they are reused
by the driver.
<!--l. 558--><p class="noindent" >The driver MUST populate the <span 
class="aeti-10">poison_val </span>configuration data before setting the
DRIVER_OK bit.
<!--l. 561--><p class="noindent" >The driver MUST NOT modify <span 
class="aeti-10">poison_val </span>while the DRIVER_OK bit is
set.
<a 
 id="x1-435001r447"></a>
                                                                  

                                                                  
<!--l. 563--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.6.2</span> <a 
 id="x1-4360002"></a>Device Requirements: Page Poison</h5>
Normative statements in this section apply if the VIRTIO_BALLOON_F_PAGE_POISON
feature has been negotiated.
<!--l. 568--><p class="noindent" >The device MAY use the content of <span 
class="aeti-10">poison_val </span>as a hint to guest behavior.
<a 
 id="x1-436001r446"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.5.6.7   </span> <a 
 id="x1-4370007"></a>Free Page Reporting</h5>
<!--l. 573--><p class="noindent" >Free Page Reporting provides a mechanism similar to balloon inflation, however it
does not provide a deflation queue. Reported free pages can be reused by the driver
after the reporting request has been acknowledged without notifying the
device.
<!--l. 578--><p class="noindent" >The driver will begin reporting free pages. When exactly and which free pages are
reported is up to the driver.
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The driver determines it has enough pages available to begin reporting free
    pages.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">The driver gathers free pages into a scatter-gather list and adds them to
    the reporting_vq.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">The device acknowledges the reporting request by using the reporting_vq
    descriptor.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Once the device has acknowledged the report, the driver can reuse the
    reported free pages when needed (e.g., by putting them back to free page
    lists in the guest operating system).
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">The driver can then continue to gather and report free pages until it has
    determined it has reported a sufficient quantity of pages.
    </dd></dl>
<a 
 id="x1-437006r448"></a>
<!--l. 601--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.7.1</span> <a 
 id="x1-4380001"></a>Driver Requirements: Free Page Reporting</h5>
Normative statements in this section apply if the VIRTIO_BALLOON_F_PAGE_REPORTING
feature has been negotiated.
<!--l. 606--><p class="noindent" >If the VIRTIO_BALLOON_F_PAGE_POISON feature has not been negotiated, then
the driver MUST treat all reported pages as uninitialized memory.
<!--l. 609--><p class="noindent" >If the VIRTIO_BALLOON_F_PAGE_POISON feature has been negotiated,
the driver MUST initialize all free pages with <span 
class="aeti-10">poison_val </span>before reporting
                                                                  

                                                                  
them.
<!--l. 613--><p class="noindent" >The driver MUST NOT use the reported pages until the device has acknowledged the
reporting request.
<!--l. 616--><p class="noindent" >The driver MAY report free pages any time after DRIVER_OK is set.
<!--l. 618--><p class="noindent" >The driver SHOULD attempt to report large pages rather than smaller ones.
<!--l. 620--><p class="noindent" >The driver SHOULD avoid reading/writing reported pages if not strictly
necessary.
<a 
 id="x1-438001r450"></a>
<!--l. 623--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.5.6.7.2</span> <a 
 id="x1-4390002"></a>Device Requirements: Free Page Reporting</h5>
Normative statements in this section apply if the VIRTIO_BALLOON_F_PAGE_REPORTING
feature has been negotiated.
<!--l. 628--><p class="noindent" >If the VIRTIO_BALLOON_F_PAGE_POISON feature has not been negotiated, the
device MAY modify the contents of any page supplied in a report request before
acknowledging that request by using the reporting_vq descriptor.
<!--l. 632--><p class="noindent" >If the VIRTIO_BALLOON_F_PAGE_POISON feature has been negotiated, the
device MUST NOT modify the the content of a reported page to a value other than
<span 
class="aeti-10">poison_val</span>.
<a 
 id="x1-439001r423"></a>
<h3 class="sectionHead"><span class="titlemark">5.6   </span> <a 
 id="x1-4400006"></a>SCSI Host Device</h3>
<!--l. 3--><p class="noindent" >The virtio SCSI host device groups together one or more virtual logical units (such as
disks), and allows communicating to them using the SCSI protocol. An instance of
the device represents a SCSI host to which many targets and LUNs are
attached.
<!--l. 8--><p class="noindent" >The virtio SCSI device services two kinds of requests:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 10--><p class="noindent" >command requests for a logical unit;
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" >task management functions related to a logical unit, target or command.</li></ul>
<!--l. 16--><p class="noindent" >The device is also able to send out notifications about added and removed logical
units. Together, these capabilities provide a SCSI transport protocol that uses
virtqueues as the transfer medium. In the transport protocol, the virtio driver acts as
the initiator, while the virtio SCSI host provides one or more targets that receive and
process the requests.
<!--l. 23--><p class="noindent" >This section relies on definitions from <a 
href="#x1-3012x11">SAM</a>.
                                                                  

                                                                  
<a 
 id="x1-440001r433"></a>
<h4 class="subsectionHead"><span class="titlemark">5.6.1   </span> <a 
 id="x1-4410001"></a>Device ID</h4>
<!--l. 26--><p class="noindent" >8
<a 
 id="x1-441001r453"></a>
<h4 class="subsectionHead"><span class="titlemark">5.6.2   </span> <a 
 id="x1-4420002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 31--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 31--><p class="noindent" >controlq
    </dd><dt class="description">
    <!--l. 32--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 32--><p class="noindent" >eventq
    </dd><dt class="description">
    <!--l. 33--><p class="noindent" >
<span 
class="aeb10-">2</span><span 
class="aeb10-">…n</span> </dt><dd 
class="description">
    <!--l. 33--><p class="noindent" >request queues</dd></dl>
<a 
 id="x1-442001r454"></a>
<h4 class="subsectionHead"><span class="titlemark">5.6.3   </span> <a 
 id="x1-4430003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 39--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_F_INOUT (0)</span> </dt><dd 
class="description">
    <!--l. 39--><p class="noindent" >A single request can include both device-readable and device-writable data
    buffers.
    </dd><dt class="description">
    <!--l. 42--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_F_HOTPLUG (1)</span> </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >The host SHOULD enable reporting of hot-plug and hot-unplug events for
    LUNs and targets on the SCSI bus. The guest SHOULD handle hot-plug
    and hot-unplug events.
    </dd><dt class="description">
    <!--l. 46--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_F_CHANGE (2)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 46--><p class="noindent" >The    host    will    report    changes    to    LUN    parameters    via
    a VIRTIO_SCSI_T_PARAM_CHANGE event; the guest SHOULD handle
    them.
    </dd><dt class="description">
    <!--l. 50--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_F_T10_PI (3)</span> </dt><dd 
class="description">
    <!--l. 50--><p class="noindent" >The extended fields for T10 protection information (DIF/DIX) are included
    in the SCSI request header.</dd></dl>
<a 
 id="x1-443001r455"></a>
<h4 class="subsectionHead"><span class="titlemark">5.6.4   </span> <a 
 id="x1-4440004"></a>Device configuration layout</h4>
<!--l. 56--><p class="noindent" >All fields of this configuration are always available.
<!--l. 58-->
<pre class="lstlisting" id="listing-139"><span class="label"><a 
 id="x1-444001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_queues</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">seg_max</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_sectors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cmd_per_lun</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event_info_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sense_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cdb_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_channel</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_target</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_lun</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-444012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 74--><p class="noindent" >
<span 
class="aebxti-10">num_queues</span> </dt><dd 
class="description">
    <!--l. 74--><p class="noindent" >is the total number of request virtqueues exposed by the device. The driver
    MAY use only one request queue, or it can use more to achieve better
    performance.
    </dd><dt class="description">
    <!--l. 78--><p class="noindent" >
<span 
class="aebxti-10">seg_max</span> </dt><dd 
class="description">
    <!--l. 78--><p class="noindent" >is  the  maximum  number  of  segments  that  can  be  in  a  command.  A
    bidirectional command can include <span 
class="aeti-10">seg_max </span>input segments and <span 
class="aeti-10">seg_max</span>
    output segments.
    </dd><dt class="description">
    <!--l. 82--><p class="noindent" >
<span 
class="aebxti-10">max_sectors</span> </dt><dd 
class="description">
    <!--l. 82--><p class="noindent" >is a hint to the driver about the maximum transfer size to use.
    </dd><dt class="description">
    <!--l. 85--><p class="noindent" >
<span 
class="aebxti-10">cmd_per_lun</span> </dt><dd 
class="description">
    <!--l. 85--><p class="noindent" >tells the driver the maximum number of linked commands it can send to
    one LUN.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 88--><p class="noindent" >
<span 
class="aebxti-10">event_info_size</span> </dt><dd 
class="description">
    <!--l. 88--><p class="noindent" >is the maximum size that the device will fill for buffers that the driver
    places in the eventq. It is written by the device depending on the set of
    negotiated features.
    </dd><dt class="description">
    <!--l. 93--><p class="noindent" >
<span 
class="aebxti-10">sense_size</span> </dt><dd 
class="description">
    <!--l. 93--><p class="noindent" >is the maximum size of the sense data that the device will write. The default
    value is written by the device and MUST be 96, but the driver can modify
    it. It is restored to the default when the device is reset.
    </dd><dt class="description">
    <!--l. 98--><p class="noindent" >
<span 
class="aebxti-10">cdb_size</span> </dt><dd 
class="description">
    <!--l. 98--><p class="noindent" >is the maximum size of the CDB that the driver will write. The default
    value is written by the device and MUST be 32, but the driver can likewise
    modify it. It is restored to the default when the device is reset.
    </dd><dt class="description">
    <!--l. 103--><p class="noindent" >
<span 
class="aebxti-10">max_channel</span><span 
class="aeb10-">, </span><span 
class="aebxti-10">max_target </span><span 
class="aeb10-">and </span><span 
class="aebxti-10">max_lun</span> </dt><dd 
class="description">
    <!--l. 103--><p class="noindent" >can be used by the driver as hints to constrain scanning the logical units
    on the host to channel/target/logical unit numbers that are less than or
    equal to the value of the fields. <span 
class="aeti-10">max_channel </span>SHOULD be zero. <span 
class="aeti-10">max_target</span>
    SHOULD be less than or equal to 255. <span 
class="aeti-10">max_lun </span>SHOULD be less than or
    equal to 16383.</dd></dl>
<a 
 id="x1-444013r449"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.6.4.1   </span> <a 
 id="x1-4450001"></a>Driver Requirements: Device configuration layout</h5>
<!--l. 113--><p class="noindent" >The driver MUST NOT write to device configuration fields other than <span 
class="aeti-10">sense_size </span>and
<span 
class="aeti-10">cdb_size</span>.
<!--l. 116--><p class="noindent" >The driver MUST NOT send more than <span 
class="aeti-10">cmd_per_lun </span>linked commands to one LUN,
and MUST NOT send more than the virtqueue size number of linked commands to
one LUN.
<a 
 id="x1-445001r457"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.6.4.2   </span> <a 
 id="x1-4460002"></a>Device Requirements: Device configuration layout</h5>
<!--l. 122--><p class="noindent" >On reset, the device MUST set <span 
class="aeti-10">sense_size </span>to 96 and <span 
class="aeti-10">cdb_size </span>to 32.
<a 
 id="x1-446001r458"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.6.4.3   </span> <a 
 id="x1-4470003"></a>Legacy Interface: Device configuration layout</h5>
<!--l. 126--><p class="noindent" >When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_scsi_config according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<a 
 id="x1-447001r456"></a>
<h4 class="subsectionHead"><span class="titlemark">5.6.5   </span> <a 
 id="x1-4480005"></a>Device Requirements: Device Initialization</h4>
<!--l. 133--><p class="noindent" >On initialization the driver SHOULD first discover the device’s virtqueues.
<!--l. 136--><p class="noindent" >If the driver uses the eventq, the driver SHOULD place at least one buffer in the
eventq.
<!--l. 139--><p class="noindent" >The  driver  MAY  immediately  issue
requests<span class="footnote-mark"><a 
href="#fn18x5" id="fn18x5-bk"><sup class="textsuperscript">18</sup></a></span><a 
 id="x1-448001f18"></a> or task
management functions<span class="footnote-mark"><a 
href="#fn19x5" id="fn19x5-bk"><sup class="textsuperscript">19</sup></a></span><a 
 id="x1-448002f19"></a>.
<a 
 id="x1-448003r460"></a>
<h4 class="subsectionHead"><span class="titlemark">5.6.6   </span> <a 
 id="x1-4490006"></a>Device Operation</h4>
<!--l. 145--><p class="noindent" >Device operation consists of operating request queues, the control queue and the
event queue.
<a 
 id="x1-449001r451"></a>
<!--l. 148--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.0.1</span> <a 
 id="x1-4500001"></a>Legacy Interface: Device Operation</h5>
When using the legacy interface, the driver SHOULD ignore the used length
values.
<span 
class="aeb10-">Note:</span> Historically, devices put the total descriptor length, or the total length
      of device-writable buffers there, even when only part of the buffers were
      actually written.
<a 
 id="x1-450001r459"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.6.6.1   </span> <a 
 id="x1-4510001"></a>Device Operation: Request Queues</h5>
<!--l. 161--><p class="noindent" >The driver enqueues requests to an arbitrary request queue, and they are used by the
device on that same queue. It is the responsibility of the driver to ensure strict
request ordering for commands placed on different queues, because they will be
consumed with no order constraints.
<!--l. 167--><p class="noindent" >Requests have the following format:
<!--l. 169-->
<pre class="lstlisting" id="listing-140"><span class="label"><a 
 id="x1-451001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_req_cmd</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">lun</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[8];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">task_attr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">prio</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">crn</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cdb</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cdb_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">three</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">present</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_F_T10_PI</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pi_bytesout</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pi_bytesin</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pi_out</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pi_bytesout</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dataout</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sense_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">residual</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status_qualifier</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sense</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sense_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">present</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_F_T10_PI</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">negotiated</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pi_in</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pi_bytesin</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">datain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451027r27"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451030r30"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451031r31"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451032r32"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_OVERRUN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451033r33"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_ABORTED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451034r34"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_BAD_TARGET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451035r35"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_RESET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451036r36"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_BUSY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451037r37"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_TRANSPORT_FAILURE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451038r38"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_TARGET_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451039r39"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_NEXUS_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451040r40"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451042r42"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">task_attr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451043r43"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_SIMPLE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451044r44"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_ORDERED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451045r45"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_HEAD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-451046r46"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_ACA</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
<!--l. 218--><p class="noindent" ><span 
class="aeti-10">lun </span>addresses the REPORT LUNS well-known logical unit, or a target and
logical unit in the virtio-scsi device’s SCSI domain. When used to address the
                                                                  

                                                                  
REPORT LUNS logical unit, <span 
class="aeti-10">lun </span>is 0xC1, 0x01 and six zero bytes. The
virtio-scsi device SHOULD implement the REPORT LUNS well-known logical
unit.
<!--l. 224--><p class="noindent" >When used to address a target and logical unit, the only supported format for <span 
class="aeti-10">lun </span>is:
first byte set to 1, second byte set to target, third and fourth byte representing a
single level LUN structure, followed by four zero bytes. With this representation, a
virtio-scsi device can serve up to 256 targets and 16384 LUNs per target. The device
MAY also support having a well-known logical units in the third and fourth
byte.
<!--l. 231--><p class="noindent" ><span 
class="aeti-10">id </span>is the command identifier (“tag”).
<!--l. 233--><p class="noindent" ><span 
class="aeti-10">task_attr </span>defines the task attribute as in the table above, but all task attributes MAY
be mapped to SIMPLE by the device. Some commands are defined by SCSI
standards as "implicit head of queue"; for such commands, all task attributes MAY
also be mapped to HEAD OF QUEUE. Drivers and applications SHOULD NOT
send a command with the ORDERED task attribute if the command has an implicit
HEAD OF QUEUE attribute, because whether the ORDERED task attribute is
honored is vendor-specific.
<!--l. 241--><p class="noindent" ><span 
class="aeti-10">crn </span>may also be provided by clients, but is generally expected to be 0. The maximum
CRN value defined by the protocol is 255, since CRN is stored in an 8-bit
integer.
<!--l. 245--><p class="noindent" >The CDB is included in <span 
class="aeti-10">cdb </span>and its size, <span 
class="aeti-10">cdb_size</span>, is taken from the configuration
space.
<!--l. 248--><p class="noindent" >All of these fields are defined in <a 
href="#x1-3012x11">SAM</a> and are always device-readable.
<!--l. 251--><p class="noindent" ><span 
class="aeti-10">pi_bytesout </span>determines the size of the <span 
class="aeti-10">pi_out </span>field in bytes. If it is nonzero, the
<span 
class="aeti-10">pi_out </span>field contains outgoing protection information for write operations.
<span 
class="aeti-10">pi_bytesin </span>determines the size of the <span 
class="aeti-10">pi_in </span>field in the device-writable section, in
bytes. All three fields are only present if VIRTIO_SCSI_F_T10_PI has been
negotiated.
<!--l. 257--><p class="noindent" >The remainder of the device-readable part is the data output buffer, <span 
class="aeti-10">dataout</span>.
<!--l. 260--><p class="noindent" ><span 
class="aeti-10">sense </span>and subsequent fields are always device-writable. <span 
class="aeti-10">sense_len </span>indicates the
number of bytes actually written to the sense buffer.
<!--l. 264--><p class="noindent" ><span 
class="aeti-10">residual </span>indicates the residual size, calculated as “data_length - number_of_transferred_bytes”,
for read or write operations. For bidirectional commands, the number_of_transferred_bytes
includes both read and written bytes. A <span 
class="aeti-10">residual </span>that is less than the size of <span 
class="aeti-10">datain</span>
means that <span 
class="aeti-10">dataout </span>was processed entirely. A <span 
class="aeti-10">residual </span>that exceeds the size of <span 
class="aeti-10">datain</span>
means that <span 
class="aeti-10">dataout </span>was processed partially and <span 
class="aeti-10">datain </span>was not processed at
all.
<!--l. 274--><p class="noindent" >If the <span 
class="aeti-10">pi_bytesin </span>is nonzero, the <span 
class="aeti-10">pi_in </span>field contains incoming protection information
for read operations. <span 
class="aeti-10">pi_in </span>is only present if VIRTIO_SCSI_F_T10_PI has been
negotiated<span class="footnote-mark"><a 
href="#fn20x5" id="fn20x5-bk"><sup class="textsuperscript">20</sup></a></span><a 
 id="x1-451047f20"></a>.
                                                                  

                                                                  
<!--l. 282--><p class="noindent" >The remainder of the device-writable part is the data input buffer, <span 
class="aeti-10">datain</span>.
<a 
 id="x1-451048r462"></a>
<!--l. 286--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.1.1</span> <a 
 id="x1-4520001"></a>Device Requirements: Device Operation: Request Queues</h5>
The device MUST write the <span 
class="aeti-10">status </span>byte as the status code as defined in
<a 
href="#x1-3012x11">SAM</a>.
<!--l. 291--><p class="noindent" >The device MUST write the <span 
class="aeti-10">response </span>byte as one of the following:
    <dl class="description"><dt class="description">
    <!--l. 295--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_OK</span> </dt><dd 
class="description">
    <!--l. 295--><p class="noindent" >when the request was completed and the <span 
class="aeti-10">status </span>byte is filled with a SCSI
    status code (not necessarily “GOOD”).
    </dd><dt class="description">
    <!--l. 299--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_OVERRUN</span> </dt><dd 
class="description">
    <!--l. 299--><p class="noindent" >if the content of the CDB (such as the allocation length, parameter length
    or transfer size) requires more data than is available in the datain and
    dataout buffers.
    </dd><dt class="description">
    <!--l. 303--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_ABORTED</span> </dt><dd 
class="description">
    <!--l. 303--><p class="noindent" >if the request was cancelled due to an ABORT TASK or ABORT TASK
    SET task management function.
    </dd><dt class="description">
    <!--l. 306--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_BAD_TARGET</span> </dt><dd 
class="description">
    <!--l. 306--><p class="noindent" >if the request was never processed because the target indicated by <span 
class="aeti-10">lun </span>does
    not exist.
    </dd><dt class="description">
    <!--l. 309--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_RESET</span> </dt><dd 
class="description">
    <!--l. 309--><p class="noindent" >if the request was cancelled due to a bus or device reset (including a task
    management function).
    </dd><dt class="description">
    <!--l. 312--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_TRANSPORT_FAILURE</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 312--><p class="noindent" >if the request failed due to a problem in the connection between the host
    and the target (severed link).
    </dd><dt class="description">
    <!--l. 316--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_TARGET_FAILURE</span> </dt><dd 
class="description">
    <!--l. 316--><p class="noindent" >if the target is suffering a failure and to tell the driver not to retry on other
    paths.
    </dd><dt class="description">
    <!--l. 319--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_NEXUS_FAILURE</span> </dt><dd 
class="description">
    <!--l. 319--><p class="noindent" >if the nexus is suffering a failure but retrying on other paths might yield a
    different result.
    </dd><dt class="description">
    <!--l. 322--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_BUSY</span> </dt><dd 
class="description">
    <!--l. 322--><p class="noindent" >if the request failed but retrying on the same path is likely to work.
    </dd><dt class="description">
    <!--l. 325--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCSI_S_FAILURE</span> </dt><dd 
class="description">
    <!--l. 325--><p class="noindent" >for  other  host  or  driver  error.  In  particular,  if  neither  <span 
class="aeti-10">dataout  </span>nor
    <span 
class="aeti-10">datain </span>is empty, and the VIRTIO_SCSI_F_INOUT feature has not been
    negotiated, the request will be immediately returned with a response equal
    to VIRTIO_SCSI_S_FAILURE.</dd></dl>
<!--l. 332--><p class="noindent" >All commands must be completed before the virtio-scsi device is reset or unplugged.
The device MAY choose to abort them, or if it does not do so MUST pick the
VIRTIO_SCSI_S_FAILURE response.
<a 
 id="x1-452001r464"></a>
<!--l. 336--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.1.2</span> <a 
 id="x1-4530002"></a>Driver Requirements: Device Operation: Request Queues</h5>
<span 
class="aeti-10">task_attr</span>, <span 
class="aeti-10">prio </span>and <span 
class="aeti-10">crn </span>SHOULD be zero.
<!--l. 340--><p class="noindent" >Upon receiving a VIRTIO_SCSI_S_TARGET_FAILURE response, the driver
SHOULD NOT retry the request on other paths.
<a 
 id="x1-453001r465"></a>
<!--l. 343--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.1.3</span> <a 
 id="x1-4540003"></a>Legacy Interface: Device Operation: Request Queues</h5>
When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_scsi_req_cmd according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
                                                                  

                                                                  
little-endian.
<a 
 id="x1-454001r463"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.6.6.2   </span> <a 
 id="x1-4550002"></a>Device Operation: controlq</h5>
<!--l. 351--><p class="noindent" >The controlq is used for other SCSI transport operations. Requests have the following
format:
<!--l. 356-->
<pre class="lstlisting" id="listing-141"><span class="label"><a 
 id="x1-455001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_ctrl</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455003r3"></a></span><span 
class="pcrr8t-x-x-80">…</span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">valid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">all</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">commands</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_BAD_TARGET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_BUSY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_TRANSPORT_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_TARGET_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_NEXUS_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_INCORRECT_LUN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">12</span></span></pre>
<!--l. 375--><p class="noindent" >The <span 
class="aeti-10">type </span>identifies the remaining fields.
<!--l. 377--><p class="noindent" >The following commands are defined:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 380--><p class="noindent" >Task management function. <!--l. 381-->
    <pre class="lstlisting" id="listing-142"><span class="label"><a 
 id="x1-455016r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455017r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455018r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_ABORT_TASK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455019r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_ABORT_TASK_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455020r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_CLEAR_ACA</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455021r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_CLEAR_TASK_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455022r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_I_T_NEXUS_RESET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455023r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_LOGICAL_UNIT_RESET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455024r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_QUERY_TASK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455025r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TMF_QUERY_TASK_SET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455026r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455027r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_ctrl_tmf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455028r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455029r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455030r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">subtype</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455031r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">lun</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[8];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455032r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455033r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455034r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455035r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455036r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455037r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">command</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455038r23"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_FUNCTION_COMPLETE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455039r24"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_FUNCTION_SUCCEEDED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">10</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455040r25"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_S_FUNCTION_REJECTED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">11</span></span></pre>
    
    <!--l. 409--><p class="noindent" >The <span 
class="aeti-10">type </span>is VIRTIO_SCSI_T_TMF; <span 
class="aeti-10">subtype </span>defines which task management
    function. All fields except <span 
class="aeti-10">response </span>are filled by the driver.
    <!--l. 413--><p class="noindent" >Other fields which are irrelevant for the requested TMF are ignored but they are
    still present. <span 
class="aeti-10">lun </span>is in the same format specified for request queues; the single
    level LUN is ignored when the task management function addresses a whole I_T
    nexus. When relevant, the value of <span 
class="aeti-10">id </span>is matched against the id values passed on
    the requestq.
    <!--l. 420--><p class="noindent" >The outcome of the task management function is written by the device in
    <span 
class="aeti-10">response</span>. The command-specific response values map 1-to-1 with those defined
    in <a 
href="#x1-3012x11">SAM</a>.
    <!--l. 424--><p class="noindent" >Task management function can affect the response value for commands that are
    in the request queue and have not been completed yet. For example,
    the device MUST complete all active commands on a logical unit or
    target (possibly with a VIRTIO_SCSI_S_RESET response code) upon
    receiving a "logical unit reset" or "I_T nexus reset" TMF. Similarly,
    the device MUST complete the selected commands (possibly with a
    VIRTIO_SCSI_S_ABORTED response code) upon receiving an "abort task" or
    "abort task set" TMF. Such effects MUST take place before the TMF itself is
    successfully completed, and the device MUST use memory barriers
    appropriately in order to ensure that the driver sees these writes in the correct
    order.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 436--><p class="noindent" >Asynchronous notification query. <!--l. 437-->
    <pre class="lstlisting" id="listing-143"><span class="label"><a 
 id="x1-455041r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_AN_QUERY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455042r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455043r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_ctrl_an</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455044r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455045r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455046r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">lun</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[8];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455047r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event_requested</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455048r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455049r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event_actual</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455050r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455051r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455052r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455053r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_ASYNC_OPERATIONAL_CHANGE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455054r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_ASYNC_POWER_MGMT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455055r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_ASYNC_EXTERNAL_REQUEST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455056r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_ASYNC_MEDIA_CHANGE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455057r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_ASYNC_MULTI_HOST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455058r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_ASYNC_DEVICE_BUSY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">64</span></span></pre>
    
    <!--l. 458--><p class="noindent" >By sending this command, the driver asks the device which events the given
    LUN can report, as described in paragraphs 6.6 and A.6 of <a 
href="#x1-3013x12">SCSI MMC</a>. The
    driver writes the events it is interested in into <span 
class="aeti-10">event_requested</span>; the device
    responds by writing the events that it supports into <span 
class="aeti-10">event_actual</span>.
    <!--l. 465--><p class="noindent" >The <span 
class="aeti-10">type </span>is VIRTIO_SCSI_T_AN_QUERY. <span 
class="aeti-10">lun </span>and <span 
class="aeti-10">event_requested </span>are
    written by the driver. <span 
class="aeti-10">event_actual </span>and <span 
class="aeti-10">response </span>fields are written by the
    device.
    <!--l. 469--><p class="noindent" >No command-specific values are defined for the <span 
class="aeti-10">response </span>byte.
    </li>
    <li class="itemize">
    <!--l. 471--><p class="noindent" >Asynchronous notification subscription. <!--l. 472-->
    <pre class="lstlisting" id="listing-144"><span class="label"><a 
 id="x1-455059r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_AN_SUBSCRIBE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455060r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455061r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_ctrl_an</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455062r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455063r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455064r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">lun</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[8];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455065r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event_requested</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455066r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455067r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event_actual</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455068r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">response</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-455069r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 486--><p class="noindent" >By sending this command, the driver asks the specified LUN to report events for
    its physical interface, again as described in <a 
href="#x1-3013x12">SCSI MMC</a>. The driver writes the
    events it is interested in into <span 
class="aeti-10">event_requested</span>; the device responds by writing the
    events that it supports into <span 
class="aeti-10">event_actual</span>.
    <!--l. 492--><p class="noindent" >Event types are the same as for the asynchronous notification query
    message.
    <!--l. 495--><p class="noindent" >The <span 
class="aeti-10">type </span>is VIRTIO_SCSI_T_AN_SUBSCRIBE. <span 
class="aeti-10">lun </span>and <span 
class="aeti-10">event_requested </span>are
    written by the driver. <span 
class="aeti-10">event_actual </span>and <span 
class="aeti-10">response </span>are written by the
    device.
    <!--l. 499--><p class="noindent" >No command-specific values are defined for the response byte.</li></ul>
<a 
 id="x1-455070r466"></a>
<!--l. 502--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.2.1</span> <a 
 id="x1-4560001"></a>Legacy Interface: Device Operation: controlq</h5>
When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_scsi_ctrl, struct virtio_scsi_ctrl_tmf, struct
virtio_scsi_ctrl_an and struct virtio_scsi_ctrl_an according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<a 
 id="x1-456001r467"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.6.6.3   </span> <a 
 id="x1-4570003"></a>Device Operation: eventq</h5>
<!--l. 514--><p class="noindent" >The eventq is populated by the driver for the device to report information on
logical units that are attached to it. In general, the device will not queue
                                                                  

                                                                  
events to cope with an empty eventq, and will end up dropping events if it
finds no buffer ready. However, when reporting events for many LUNs (e.g.
when a whole target disappears), the device can throttle events to avoid
dropping them. For this reason, placing 10-15 buffers on the event queue is
sufficient.
<!--l. 523--><p class="noindent" >Buffers returned by the device on the eventq will be referred to as “events” in the rest
of this section. Events have the following format:
<!--l. 527-->
<pre class="lstlisting" id="listing-145"><span class="label"><a 
 id="x1-457001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_EVENTS_MISSED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x80000000</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scsi_event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">lun</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[8];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reason</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 538--><p class="noindent" >The devices sets bit 31 in <span 
class="aeti-10">event </span>to report lost events due to missing buffers.
<!--l. 541--><p class="noindent" >The meaning of <span 
class="aeti-10">reason </span>depends on the contents of <span 
class="aeti-10">event</span>. The following events are
defined:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 545--><p class="noindent" >No event. <!--l. 546-->
    <pre class="lstlisting" id="listing-146"><span class="label"><a 
 id="x1-457009r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_NO_EVENT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span></pre>
    
    <!--l. 550--><p class="noindent" >This event is fired in the following cases:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 553--><p class="noindent" >When the device detects in the eventq a buffer that is shorter than
        what is indicated in the configuration field, it MAY use it immediately
        and put this dummy value in <span 
class="aeti-10">event</span>. A well-written driver will never
        observe this situation.
        </li>
        <li class="itemize">
        <!--l. 559--><p class="noindent" >When events are dropped, the device MAY signal this event as soon
        as the drivers makes a buffer available, in order to request action from
        the driver. In this case, of course, this event will be reported with the
        VIRTIO_SCSI_T_EVENTS_MISSED flag.</li></ul>
    </li>
    <li class="itemize">
    <!--l. 566--><p class="noindent" >Transport reset <!--l. 567-->
    <pre class="lstlisting" id="listing-147"><span class="label"><a 
 id="x1-457010r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_TRANSPORT_RESET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457011r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457012r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_RESET_HARD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457013r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_RESET_RESCAN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-457014r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_EVT_RESET_REMOVED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
    
                                                                  

                                                                  
    <!--l. 575--><p class="noindent" >By sending this event, the device signals that a logical unit on a target
    has been reset, including the case of a new device appearing or
    disappearing on the bus. The device fills in all fields. <span 
class="aeti-10">event </span>is set to
    VIRTIO_SCSI_T_TRANSPORT_RESET. <span 
class="aeti-10">lun </span>addresses a logical unit in the
    SCSI host.
    <!--l. 582--><p class="noindent" >The <span 
class="aeti-10">reason </span>value is one of the three #define values appearing above:
        <dl class="description"><dt class="description">
        <!--l. 586--><p class="noindent" >
    <span 
class="aeb10-">VIRTIO_SCSI_EVT_RESET_REMOVED</span> </dt><dd 
class="description">
        <!--l. 586--><p class="noindent" >(“LUN/target removed”) is used if the target or logical unit is no longer
        able to receive commands.
        </dd><dt class="description">
        <!--l. 590--><p class="noindent" >
    <span 
class="aeb10-">VIRTIO_SCSI_EVT_RESET_HARD</span> </dt><dd 
class="description">
        <!--l. 590--><p class="noindent" >(“LUN hard reset”) is used if the logical unit has been reset, but is still
        present.
        </dd><dt class="description">
        <!--l. 593--><p class="noindent" >
    <span 
class="aeb10-">VIRTIO_SCSI_EVT_RESET_RESCAN</span> </dt><dd 
class="description">
        <!--l. 593--><p class="noindent" >(“rescan  LUN/target”)  is  used  if  a  target  or  logical  unit  has  just
        appeared on the device.</dd></dl>
    <!--l. 597--><p class="noindent" >The “removed” and “rescan” events can happen when VIRTIO_SCSI_F_HOTPLUG
    feature was negotiated; when sent for LUN 0, they MAY apply to the entire
    target so the driver can ask the initiator to rescan the target to detect
    this.
    <!--l. 602--><p class="noindent" >Events will also be reported via sense codes (this obviously does not apply to
    newly appeared buses or targets, since the application has never discovered
    them):
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 607--><p class="noindent" >“LUN/target removed” maps to sense key ILLEGAL REQUEST, asc
        0x25, ascq 0x00 (LOGICAL UNIT NOT SUPPORTED)
        </li>
        <li class="itemize">
        <!--l. 610--><p class="noindent" >“LUN hard reset” maps to sense key UNIT ATTENTION, asc 0x29
        (POWER ON, RESET OR BUS DEVICE RESET OCCURRED)
                                                                  

                                                                  
        </li>
        <li class="itemize">
        <!--l. 613--><p class="noindent" >“rescan LUN/target” maps to sense key UNIT ATTENTION, asc 0x3f,
        ascq 0x0e (REPORTED LUNS DATA HAS CHANGED)</li></ul>
    <!--l. 617--><p class="noindent" >The preferred way to detect transport reset is always to use events, because
    sense codes are only seen by the driver when it sends a SCSI command to
    the logical unit or target. However, in case events are dropped, the
    initiator will still be able to synchronize with the actual state of the
    controller if the driver asks the initiator to rescan of the SCSI bus. During
    the rescan, the initiator will be able to observe the above sense codes,
    and it will process them as if it the driver had received the equivalent
    event.
    </li>
    <li class="itemize">
    <!--l. 627--><p class="noindent" >Asynchronous notification <!--l. 628-->
    <pre class="lstlisting" id="listing-148"><span class="label"><a 
 id="x1-457015r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_ASYNC_NOTIFY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
    
    <!--l. 632--><p class="noindent" >By sending this event, the device signals that an asynchronous event was fired
    from a physical interface.
    <!--l. 635--><p class="noindent" >All fields are written by the device. <span 
class="aeti-10">event </span>is set to VIRTIO_SCSI_T_ASYNC_NOTIFY.
    <span 
class="aeti-10">lun </span>addresses a logical unit in the SCSI host. <span 
class="aeti-10">reason </span>is a subset of the events
    that the driver has subscribed to via the “Asynchronous notification
    subscription” command.
    </li>
    <li class="itemize">
    <!--l. 641--><p class="noindent" >LUN parameter change <!--l. 642-->
    <pre class="lstlisting" id="listing-149"><span class="label"><a 
 id="x1-457016r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SCSI_T_PARAM_CHANGE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
    
    <!--l. 646--><p class="noindent" >By sending this event, the device signals a change in the configuration
    parameters of a logical unit, for example the capacity or cache mode. <span 
class="aeti-10">event </span>is
    set to VIRTIO_SCSI_T_PARAM_CHANGE. <span 
class="aeti-10">lun </span>addresses a logical unit in the
    SCSI host.
    <!--l. 651--><p class="noindent" >The same event SHOULD also be reported as a unit attention condition. <span 
class="aeti-10">reason</span>
    contains the additional sense code and additional sense code qualifier,
    respectively in bits 0…7 and 8…15.
    <span 
class="aeb10-">Note:</span> For example, a change in capacity will be reported as asc 0x2a, ascq
          0x09 (CAPACITY DATA HAS CHANGED).
                                                                  

                                                                  
    <!--l. 659--><p class="noindent" >For MMC devices (inquiry type 5) there would be some overlap between this
    event and the asynchronous notification event, so for simplicity the host never
    reports this event for MMC devices.</li></ul>
<a 
 id="x1-457017r468"></a>
<!--l. 664--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.3.1</span> <a 
 id="x1-4580001"></a>Driver Requirements: Device Operation: eventq</h5>
The driver SHOULD keep the eventq populated with buffers. These buffers MUST be
device-writable, and SHOULD be at least <span 
class="aeti-10">event_info_size </span>bytes long, and MUST be
at least the size of struct virtio_scsi_event.
<!--l. 671--><p class="noindent" >If <span 
class="aeti-10">event </span>has bit 31 set, the driver SHOULD poll the logical units for unit attention
conditions, and/or do whatever form of bus scan is appropriate for the guest
operating system and SHOULD poll for asynchronous events manually using SCSI
commands.
<!--l. 676--><p class="noindent" >When receiving a VIRTIO_SCSI_T_TRANSPORT_RESET message with <span 
class="aeti-10">reason </span>set to
VIRTIO_SCSI_EVT_RESET_REMOVED or VIRTIO_SCSI_EVT_RESET_RESCAN
for LUN 0, the driver SHOULD ask the initiator to rescan the target, in order to
detect the case when an entire target has appeared or disappeared.
<a 
 id="x1-458001r470"></a>
<!--l. 682--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.3.2</span> <a 
 id="x1-4590002"></a>Device Requirements: Device Operation: eventq</h5>
The device MUST set bit 31 in <span 
class="aeti-10">event </span>if events were lost due to missing
buffers, and it MAY use a VIRTIO_SCSI_T_NO_EVENT event to report
this.
<!--l. 688--><p class="noindent" >The device MUST NOT send VIRTIO_SCSI_T_TRANSPORT_RESET
messages with <span 
class="aeti-10">reason </span>set to VIRTIO_SCSI_EVT_RESET_REMOVED or
VIRTIO_SCSI_EVT_RESET_RESCAN unless VIRTIO_SCSI_F_HOTPLUG was
negotiated.
<!--l. 692--><p class="noindent" >The device MUST NOT report VIRTIO_SCSI_T_PARAM_CHANGE for MMC
devices.
<a 
 id="x1-459001r471"></a>
<!--l. 694--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.6.6.3.3</span> <a 
 id="x1-4600003"></a>Legacy Interface: Device Operation: eventq</h5>
When using the legacy interface, transitional devices and drivers MUST
format the fields in struct virtio_scsi_event according to the native endian
of the guest rather than (necessarily when not using the legacy interface)
little-endian.
<a 
 id="x1-460001r469"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.6.6.4   </span> <a 
 id="x1-4610004"></a>Legacy Interface: Framing Requirements</h5>
<!--l. 703--><p class="noindent" >When using legacy interfaces, transitional drivers which have not negotiated
VIRTIO_F_ANY_LAYOUT MUST use a single descriptor for the <span 
class="aeti-10">lun</span>, <span 
class="aeti-10">id</span>, <span 
class="aeti-10">task_attr</span>,
<span 
class="aeti-10">prio</span>, <span 
class="aeti-10">crn </span>and <span 
class="aeti-10">cdb </span>fields, and MUST only use a single descriptor for the <span 
class="aeti-10">sense_len</span>,
                                                                  

                                                                  
<span 
class="aeti-10">residual</span>, <span 
class="aeti-10">status_qualifier</span>, <span 
class="aeti-10">status</span>, <span 
class="aeti-10">response </span>and <span 
class="aeti-10">sense </span>fields.
<a 
 id="x1-461001r452"></a>
<h3 class="sectionHead"><span class="titlemark">5.7   </span> <a 
 id="x1-4620007"></a>GPU Device</h3>
<!--l. 3--><p class="noindent" >virtio-gpu is a virtio based graphics adapter. It can operate in 2D mode and in 3D
mode. 3D mode will offload rendering ops to the host gpu and therefore requires a
gpu with 3D support on the host machine.
<!--l. 8--><p class="noindent" >In 2D mode the virtio-gpu device provides support for ARGB Hardware cursors and
multiple scanouts (aka heads).
<a 
 id="x1-462001r461"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.1   </span> <a 
 id="x1-4630001"></a>Device ID</h4>
<!--l. 13--><p class="noindent" >16
<a 
 id="x1-463001r475"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.2   </span> <a 
 id="x1-4640002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 18--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 18--><p class="noindent" >controlq - queue for sending control commands
    </dd><dt class="description">
    <!--l. 19--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 19--><p class="noindent" >cursorq - queue for sending cursor updates</dd></dl>
<!--l. 22--><p class="noindent" >Both queues have the same format. Each request and each response have a fixed
header, followed by command specific data fields. The separate cursor queue is the
"fast track" for cursor commands (VIRTIO_GPU_CMD_UPDATE_CURSOR and
VIRTIO_GPU_CMD_MOVE_CURSOR), so they go through without being delayed
by time-consuming commands in the control queue.
<a 
 id="x1-464001r476"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.3   </span> <a 
 id="x1-4650003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 32--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_F_VIRGL (0)</span> </dt><dd 
class="description">
    <!--l. 32--><p class="noindent" >virgl 3D mode is supported.
    </dd><dt class="description">
    <!--l. 33--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_F_EDID (1)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 33--><p class="noindent" >EDID is supported.
    </dd><dt class="description">
    <!--l. 34--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_F_RESOURCE_UUID (2)</span> </dt><dd 
class="description">
    <!--l. 34--><p class="noindent" >assigning resources UUIDs for export to other virtio devices is supported.
    </dd><dt class="description">
    <!--l. 36--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_F_RESOURCE_BLOB (3)</span> </dt><dd 
class="description">
    <!--l. 36--><p class="noindent" >creating and using size-based blob resources is supported.
    </dd><dt class="description">
    <!--l. 38--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_F_CONTEXT_INIT (4)</span> </dt><dd 
class="description">
    <!--l. 38--><p class="noindent" >multiple context types and synchronization timelines supported. Requires
    VIRTIO_GPU_F_VIRGL.</dd></dl>
<a 
 id="x1-465001r477"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.4   </span> <a 
 id="x1-4660004"></a>Device configuration layout</h4>
<!--l. 44--><p class="noindent" >GPU device configuration uses the following layout structure and definitions:
<!--l. 47-->
<pre class="lstlisting" id="listing-150"><span class="label"><a 
 id="x1-466001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_EVENT_DISPLAY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-466002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-466003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-466004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">events_read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-466005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">events_clear</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-466006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_scanouts</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-466007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_capsets</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-466008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-466009r473"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.4.1   </span> <a 
 id="x1-4670001"></a>Device configuration fields</h5>
    <dl class="description"><dt class="description">
    <!--l. 61--><p class="noindent" >
<span 
class="aebxti-10">events_read</span> </dt><dd 
class="description">
    <!--l. 61--><p class="noindent" >signals pending events to the driver. The driver MUST NOT write to this
    field.
    </dd><dt class="description">
    <!--l. 63--><p class="noindent" >
<span 
class="aebxti-10">events_clear</span> </dt><dd 
class="description">
    <!--l. 63--><p class="noindent" >clears pending events in the device. Writing a ’1’ into a bit will clear the
    corresponding bit in <span 
class="aeti-10">events_read</span>, mimicking write-to-clear behavior.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 66--><p class="noindent" >
<span 
class="aebxti-10">num_scanouts</span> </dt><dd 
class="description">
    <!--l. 66--><p class="noindent" >specifies  the  maximum  number  of  scanouts  supported  by  the  device.
    Minimum value is 1, maximum value is 16.
    </dd><dt class="description">
    <!--l. 68--><p class="noindent" >
<span 
class="aebxti-10">num_capsets</span> </dt><dd 
class="description">
    <!--l. 68--><p class="noindent" >specifies the maximum number of capability sets supported by the device.
    The minimum value is zero.</dd></dl>
<a 
 id="x1-467001r479"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.4.2   </span> <a 
 id="x1-4680002"></a>Events</h5>
    <dl class="description"><dt class="description">
    <!--l. 75--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_EVENT_DISPLAY</span> </dt><dd 
class="description">
    <!--l. 75--><p class="noindent" >Display                  configuration                  has                  changed.
    The driver SHOULD use the VIRTIO_GPU_CMD_GET_DISPLAY_INFO
    command to fetch the information from the device. In case EDID support is
    negotiated (VIRTIO_GPU_F_EDID feature flag) the device SHOULD also
    fetch the updated EDID blobs using the VIRTIO_GPU_CMD_GET_EDID
    command.</dd></dl>
<a 
 id="x1-468001r478"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.5   </span> <a 
 id="x1-4690005"></a>Device Requirements: Device Initialization</h4>
<!--l. 85--><p class="noindent" >The driver SHOULD query the display information from the device using
the VIRTIO_GPU_CMD_GET_DISPLAY_INFO command and use that
information for the initial scanout setup. In case EDID support is negotiated
(VIRTIO_GPU_F_EDID feature flag) the device SHOULD also fetch the EDID
information using the VIRTIO_GPU_CMD_GET_EDID command. If no information
is available or all displays are disabled the driver MAY choose to use a fallback, such
as 1024x768 at display 0.
<!--l. 93--><p class="noindent" >The driver SHOULD query all shared memory regions supported by the device. If the
device supports shared memory, the <span 
class="aeti-10">shmid </span>of a region MUST (see <a 
href="#x1-10200010">2.10<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Shared Memory Regions --></a> <a 
href="#x1-10200010">Shared
Memory Regions<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Shared Memory Regions --></a>) be one of the following:
<!--l. 99-->
<pre class="lstlisting" id="listing-151"><span class="label"><a 
 id="x1-469001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_shm_id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-469002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_SHM_ID_UNDEFINED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-469003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_SHM_ID_HOST_VISIBLE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-469004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 106--><p class="noindent" >The shared memory region with VIRTIO_GPU_SHM_ID_HOST_VISIBLE
is referred as the "host visible memory region". The device MUST
support the VIRTIO_GPU_CMD_RESOURCE_MAP_BLOB and
                                                                  

                                                                  
VIRTIO_GPU_CMD_RESOURCE_UNMAP_BLOB if the host visible memory region
is available.
<a 
 id="x1-469005r481"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.6   </span> <a 
 id="x1-4700006"></a>Device Operation</h4>
<!--l. 113--><p class="noindent" >The virtio-gpu is based around the concept of resources private to the host. The
guest must DMA transfer into these resources, unless shared memory regions are
supported. This is a design requirement in order to interface with future 3D
rendering. In the unaccelerated 2D mode there is no support for DMA transfers from
resources, just to them.
<!--l. 119--><p class="noindent" >Resources are initially simple 2D resources, consisting of a width, height and format
along with an identifier. The guest must then attach backing store to the
resources in order for DMA transfers to work. This is like a GART in a real
GPU.
<a 
 id="x1-470001r480"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.1   </span> <a 
 id="x1-4710001"></a>Device Operation: Create a framebuffer and configure scanout</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 127--><p class="noindent" >Create                a                host                resource                using
    VIRTIO_GPU_CMD_RESOURCE_CREATE_2D.
    </li>
    <li class="itemize">
    <!--l. 128--><p class="noindent" >Allocate a framebuffer from guest ram, and attach it as backing storage to
    the               resource               just               created,               using
    VIRTIO_GPU_CMD_RESOURCE_ATTACH_BACKING. Scatter lists are
    supported,  so  the  framebuffer  doesn’t  need  to  be  contignous  in  guest
    physical memory.
    </li>
    <li class="itemize">
    <!--l. 133--><p class="noindent" >Use  VIRTIO_GPU_CMD_SET_SCANOUT  to  link  the  framebuffer  to  a
    display scanout.</li></ul>
<a 
 id="x1-471001r483"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.2   </span> <a 
 id="x1-4720002"></a>Device Operation: Update a framebuffer and scanout</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 140--><p class="noindent" >Render to your framebuffer memory.
    </li>
    <li class="itemize">
    <!--l. 141--><p class="noindent" >Use VIRTIO_GPU_CMD_TRANSFER_TO_HOST_2D to update the host
    resource from guest memory.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 143--><p class="noindent" >Use  VIRTIO_GPU_CMD_RESOURCE_FLUSH  to  flush  the  updated
    resource to the display.</li></ul>
<a 
 id="x1-472001r484"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.3   </span> <a 
 id="x1-4730003"></a>Device Operation: Using pageflip</h5>
<!--l. 149--><p class="noindent" >It is possible to create multiple framebuffers, flip between them using
VIRTIO_GPU_CMD_SET_SCANOUT and VIRTIO_GPU_CMD_RESOURCE_FLUSH, and
update the invisible framebuffer using VIRTIO_GPU_CMD_TRANSFER_TO_HOST_2D.
<a 
 id="x1-473001r485"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.4   </span> <a 
 id="x1-4740004"></a>Device Operation: Multihead setup</h5>
<!--l. 156--><p class="noindent" >In case two or more displays are present there are different ways to configure
things:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 160--><p class="noindent" >Create a single framebuffer, link it to all displays (mirroring).
    </li>
    <li class="itemize">
    <!--l. 162--><p class="noindent" >Create an framebuffer for each display.
    </li>
    <li class="itemize">
    <!--l. 163--><p class="noindent" >Create  one  big  framebuffer,  configure  scanouts  to  display  a  different
    rectangle of that framebuffer each.</li></ul>
<a 
 id="x1-474001r486"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.5   </span> <a 
 id="x1-4750005"></a>Device Requirements: Device Operation: Command lifecycle and
fencing</h5>
<!--l. 169--><p class="noindent" >The device MAY process controlq commands asynchronously and return them to the
driver before the processing is complete. If the driver needs to know when the
processing is finished it can set the VIRTIO_GPU_FLAG_FENCE flag in the
request. The device MUST finish the processing before returning the command
then.
<!--l. 175--><p class="noindent" >Note: current qemu implementation does asyncrounous processing only in 3d mode,
when offloading the processing to the host gpu.
<a 
 id="x1-475001r487"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.6   </span> <a 
 id="x1-4760006"></a>Device Operation: Configure mouse cursor</h5>
<!--l. 180--><p class="noindent" >The mouse cursor image is a normal resource, except that it must be
64x64 in size. The driver MUST create and populate the resource
(using the usual VIRTIO_GPU_CMD_RESOURCE_CREATE_2D,
VIRTIO_GPU_CMD_RESOURCE_ATTACH_BACKING and
VIRTIO_GPU_CMD_TRANSFER_TO_HOST_2D controlq commands) and make
sure they are completed (using VIRTIO_GPU_FLAG_FENCE).
<!--l. 187--><p class="noindent" >Then VIRTIO_GPU_CMD_UPDATE_CURSOR can be sent to the cursorq to set the
                                                                  

                                                                  
pointer shape and position. To move the pointer without updating the shape use
VIRTIO_GPU_CMD_MOVE_CURSOR instead.
<a 
 id="x1-476001r488"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.7   </span> <a 
 id="x1-4770007"></a>Device Operation: Request header</h5>
<!--l. 193--><p class="noindent" >All requests and responses on the virtqueues have a fixed header using the following
layout structure and definitions:
<!--l. 196-->
<pre class="lstlisting" id="listing-152"><span class="label"><a 
 id="x1-477001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_type</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">commands</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_GET_DISPLAY_INFO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0100</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_CREATE_2D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_UNREF</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_SET_SCANOUT</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_FLUSH</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_TRANSFER_TO_HOST_2D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_ATTACH_BACKING</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_DETACH_BACKING</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_GET_CAPSET_INFO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_GET_CAPSET</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_GET_EDID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_ASSIGN_UUID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_CREATE_BLOB</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_SET_SCANOUT_BLOB</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">commands</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_CTX_CREATE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0200</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_CTX_DESTROY</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_CTX_ATTACH_RESOURCE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_CTX_DETACH_RESOURCE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_CREATE_3D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_TRANSFER_TO_HOST_3D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_TRANSFER_FROM_HOST_3D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_SUBMIT_3D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_MAP_BLOB</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_RESOURCE_UNMAP_BLOB</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cursor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">commands</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_UPDATE_CURSOR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0300</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CMD_MOVE_CURSOR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">success</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">responses</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_OK_NODATA</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1100</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_OK_DISPLAY_INFO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_OK_CAPSET_INFO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_OK_CAPSET</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_OK_EDID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_OK_RESOURCE_UUID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477042r42"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_OK_MAP_INFO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477043r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477044r44"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">error</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">responses</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477045r45"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_ERR_UNSPEC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1200</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477046r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_ERR_OUT_OF_MEMORY</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477047r47"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_ERR_INVALID_SCANOUT_ID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477048r48"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_ERR_INVALID_RESOURCE_ID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477049r49"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_ERR_INVALID_CONTEXT_ID</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477050r50"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_RESP_ERR_INVALID_PARAMETER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477051r51"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477052r52"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477053r53"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FLAG_FENCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477054r54"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FLAG_INFO_RING_IDX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477055r55"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477056r56"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477057r57"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477058r58"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477059r59"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fence_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477060r60"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ctx_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477061r61"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring_idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477062r62"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-477063r63"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 262--><p class="noindent" >The fixed header <span 
class="aeti-10">struct virtio_gpu_ctrl_hdr </span>in each request includes the following
fields:
    <dl class="description"><dt class="description">
    <!--l. 266--><p class="noindent" >
<span 
class="aebxti-10">type</span> </dt><dd 
class="description">
    <!--l. 266--><p class="noindent" >specifies the type of the driver request (VIRTIO_GPU_CMD_*) or device
    response (VIRTIO_GPU_RESP_*).
    </dd><dt class="description">
    <!--l. 268--><p class="noindent" >
<span 
class="aebxti-10">flags</span> </dt><dd 
class="description">
    <!--l. 268--><p class="noindent" >request / response flags.
    </dd><dt class="description">
    <!--l. 269--><p class="noindent" >
<span 
class="aebxti-10">fence_id</span> </dt><dd 
class="description">
    <!--l. 269--><p class="noindent" >If the driver sets the VIRTIO_GPU_FLAG_FENCE bit in the request <span 
class="aeti-10">flags </span>field
    the device MUST:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 272--><p class="noindent" >set VIRTIO_GPU_FLAG_FENCE bit in the response,
        </li>
        <li class="itemize">
        <!--l. 273--><p class="noindent" >copy the content of the <span 
class="aeti-10">fence_id </span>field from the request to the response,
        and
        </li>
        <li class="itemize">
        <!--l. 275--><p class="noindent" >send the response only after command processing is complete.</li></ul>
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 277--><p class="noindent" >
<span 
class="aebxti-10">ctx_id</span> </dt><dd 
class="description">
    <!--l. 277--><p class="noindent" >Rendering context (used in 3D mode only).
    </dd><dt class="description">
    <!--l. 278--><p class="noindent" >
<span 
class="aebxti-10">ring_idx</span> </dt><dd 
class="description">
    <!--l. 278--><p class="noindent" >If VIRTIO_GPU_F_CONTEXT_INIT is supported, then the driver MAY set
    VIRTIO_GPU_FLAG_INFO_RING_IDX bit in the request <span 
class="aeti-10">flags</span>. In that
    case:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 282--><p class="noindent" ><span 
class="aeti-10">ring_idx  </span>indicates  the  value  of  a  context-specific  ring  index.  The
        minimum value is 0 and maximum value is 63 (inclusive).
        </li>
        <li class="itemize">
        <!--l. 284--><p class="noindent" >If VIRTIO_GPU_FLAG_FENCE is set, <span 
class="aeti-10">fence_id  </span>acts as a sequence
        number on the synchronization timeline defined by <span 
class="aeti-10">ctx_idx  </span>and the
        ring index.
        </li>
        <li class="itemize">
        <!--l. 287--><p class="noindent" >If  VIRTIO_GPU_FLAG_FENCE  is  set  and  when  the  command
        associated with <span 
class="aeti-10">fence_id </span>is complete, the device MUST send a response
        for all outstanding commands with a sequence number less than or
        equal to <span 
class="aeti-10">fence_id </span>on the same synchronization timeline.</li></ul>
    </dd></dl>
<!--l. 294--><p class="noindent" >On success the device will return VIRTIO_GPU_RESP_OK_NODATA in
case there is no payload. Otherwise the <span 
class="aeti-10">type </span>field will indicate the kind of
payload.
<!--l. 298--><p class="noindent" >On error the device will return one of the VIRTIO_GPU_RESP_ERR_* error
codes.
<a 
 id="x1-477064r489"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.8   </span> <a 
 id="x1-4780008"></a>Device Operation: controlq</h5>
<!--l. 303--><p class="noindent" >For any coordinates given 0,0 is top left, larger x moves right, larger y moves
down.
    <dl class="description"><dt class="description">
    <!--l. 308--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_GET_DISPLAY_INFO</span> </dt><dd 
class="description">
    <!--l. 308--><p class="noindent" >Retrieve the current output configuration. No request data (just bare <span 
class="aeti-10">struct</span>
                                                                  

                                                                  
    <span 
class="aeti-10">virtio_gpu_ctrl_hdr</span>).                                                           Response
    type is VIRTIO_GPU_RESP_OK_DISPLAY_INFO, response data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_resp_display_info</span>.
    <!--l. 314-->
    <pre class="lstlisting" id="listing-153"><span class="label"><a 
 id="x1-478001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_MAX_SCANOUTS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_rect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">y</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">width</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">height</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resp_display_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_display_one</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_rect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pmodes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_MAX_SCANOUTS</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 334--><p class="noindent" >The response contains a list of per-scanout information. The info contains
    whether the scanout is enabled and what its preferred position and size
    is.
    <!--l. 338--><p class="noindent" >The size (fields <span 
class="aeti-10">width </span>and <span 
class="aeti-10">height</span>) is similar to the native panel resolution in
    EDID display information, except that in the virtual machine case the size can
    change when the host window representing the guest display is gets
    resized.
    <!--l. 343--><p class="noindent" >The position (fields <span 
class="aeti-10">x </span>and <span 
class="aeti-10">y</span>) describe how the displays are arranged (i.e. which
    is – for example – the left display).
    <!--l. 347--><p class="noindent" >The <span 
class="aeti-10">enabled </span>field is set when the user enabled the display. It is roughly the same
    as the connected state of a physical display connector.
    </dd><dt class="description">
    <!--l. 351--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_GET_EDID</span> </dt><dd 
class="description">
    <!--l. 351--><p class="noindent" >Retrieve the EDID data for a given scanout. Request data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_get_edid</span>). Response type is VIRTIO_GPU_RESP_OK_EDID, response
    data is <span 
class="aeti-10">struct virtio_gpu_resp_edid</span>. Support is optional and negotiated using the
    VIRTIO_GPU_F_EDID feature flag.
    <!--l. 357-->
    <pre class="lstlisting" id="listing-154"><span class="label"><a 
 id="x1-478018r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_get_edid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478019r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478020r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">scanout</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478021r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478022r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478023r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478024r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resp_edid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478025r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478026r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478027r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478028r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">edid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[1024];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478029r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 372--><p class="noindent" >The response contains the EDID display data blob (as specified by VESA) for
    the scanout.
    </dd><dt class="description">
    <!--l. 375--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_CREATE_2D</span> </dt><dd 
class="description">
    <!--l. 375--><p class="noindent" >Create a 2D resource on the host. Request data is <span 
class="aeti-10">struct virtio_gpu_resource_create_2d</span>.
    Response type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 379-->
    <pre class="lstlisting" id="listing-155"><span class="label"><a 
 id="x1-478030r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_formats</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478031r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_B8G8R8A8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478032r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_B8G8R8X8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478033r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_A8R8G8B8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478034r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_X8R8G8B8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478035r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478036r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_R8G8B8A8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">67,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478037r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_X8B8G8R8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">68,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478038r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478039r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_A8B8G8R8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">121,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478040r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_FORMAT_R8G8B8X8_UNORM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">134,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478041r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478042r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478043r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_create_2d</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478044r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478045r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478046r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">format</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478047r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">width</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478048r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">height</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478049r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
                                                                  

                                                                  
    <!--l. 402--><p class="noindent" >This creates a 2D resource on the host with the specified width, height and
    format. The resource ids are generated by the guest.
    </dd><dt class="description">
    <!--l. 405--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_UNREF</span> </dt><dd 
class="description">
    <!--l. 405--><p class="noindent" >Destroy a resource. Request data is <span 
class="aeti-10">struct virtio_gpu_resource_unref</span>. Response
    type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 409-->
    <pre class="lstlisting" id="listing-156"><span class="label"><a 
 id="x1-478050r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_unref</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478051r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478052r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478053r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478054r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 417--><p class="noindent" >This informs the host that a resource is no longer required by the guest.
    </dd><dt class="description">
    <!--l. 420--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_SET_SCANOUT</span> </dt><dd 
class="description">
    <!--l. 420--><p class="noindent" >Set the scanout parameters for a single output. Request data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_set_scanout</span>. Response type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 425-->
    <pre class="lstlisting" id="listing-157"><span class="label"><a 
 id="x1-478055r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_set_scanout</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478056r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478057r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_rect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478058r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">scanout_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478059r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478060r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 434--><p class="noindent" >This sets the scanout parameters for a single scanout. The resource_id is the
    resource to be scanned out from, along with a rectangle.
    <!--l. 437--><p class="noindent" >Scanout rectangles must be completely covered by the underlying resource.
    Overlapping (or identical) scanouts are allowed, typical use case is screen
    mirroring.
    <!--l. 441--><p class="noindent" >The driver can use resource_id = 0 to disable a scanout.
    </dd><dt class="description">
    <!--l. 443--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_FLUSH</span> </dt><dd 
class="description">
    <!--l. 443--><p class="noindent" >Flush a scanout resource Request data is <span 
class="aeti-10">struct virtio_gpu_resource_flush</span>.
    Response type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 447-->
    <pre class="lstlisting" id="listing-158"><span class="label"><a 
 id="x1-478061r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_flush</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478062r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478063r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_rect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478064r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478065r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478066r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 456--><p class="noindent" >This flushes a resource to screen. It takes a rectangle and a resource id, and
    flushes any scanouts the resource is being used on.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 459--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_TRANSFER_TO_HOST_2D</span> </dt><dd 
class="description">
    <!--l. 459--><p class="noindent" >Transfer from guest memory to host resource. Request data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_transfer_to_host_2d</span>. Response type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 464-->
    <pre class="lstlisting" id="listing-159"><span class="label"><a 
 id="x1-478067r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_transfer_to_host_2d</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478068r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478069r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_rect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478070r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478071r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478072r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478073r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 474--><p class="noindent" >This takes a resource id along with an destination offset into the resource, and a
    box to transfer to the host backing for the resource.
    </dd><dt class="description">
    <!--l. 477--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_ATTACH_BACKING</span> </dt><dd 
class="description">
    <!--l. 477--><p class="noindent" >Assign backing pages to a resource. Request data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_resource_attach_backing</span>, followed by <span 
class="aeti-10">struct virtio_gpu_mem_entry</span>
    entries. Response type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 483-->
    <pre class="lstlisting" id="listing-160"><span class="label"><a 
 id="x1-478074r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_attach_backing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478075r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478076r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478077r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nr_entries</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478078r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478079r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478080r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_mem_entry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478081r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478082r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478083r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478084r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 497--><p class="noindent" >This assign an array of guest pages as the backing store for a resource. These
    pages are then used for the transfer operations for that resource from that point
    on.
    </dd><dt class="description">
    <!--l. 501--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_DETACH_BACKING</span> </dt><dd 
class="description">
    <!--l. 501--><p class="noindent" >Detach backing pages from a resource. Request data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_resource_detach_backing</span>. Response type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 506-->
    <pre class="lstlisting" id="listing-161"><span class="label"><a 
 id="x1-478085r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_detach_backing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478086r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478087r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478088r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478089r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 514--><p class="noindent" >This detaches any backing pages from a resource, to be used in case of guest
    swapping or object destruction.
    </dd><dt class="description">
    <!--l. 517--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_GET_CAPSET_INFO</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 517--><p class="noindent" >Gets the information associated with a particular <span 
class="aeti-10">capset_index</span>, which
    MUST less than <span 
class="aeti-10">num_capsets </span>defined in the device configuration.
    Request data is <span 
class="aeti-10">struct virtio_gpu_get_capset_info</span>. Response type is
    VIRTIO_GPU_RESP_OK_CAPSET_INFO.
    <!--l. 523--><p class="noindent" >On success, <span 
class="aeti-10">struct virtio_gpu_resp_capset_info </span>contains the <span 
class="aeti-10">capset_id</span>,
    <span 
class="aeti-10">capset_max_version</span>, <span 
class="aeti-10">capset_max_size </span>associated with capset at the specified
    capset_idex. fieldcapset_id MUST be one of the following (see listing for
    values):
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 529--><p class="noindent" ><a 
href="https://gitlab.freedesktop.org/virgl/virglrenderer/-/blob/master/src/virgl_hw.h#L526" >VIRTIO_GPU_CAPSET_VIRGL</a> – the first edition of Virgl (Gallium
        OpenGL) protocol.
        </li>
        <li class="itemize">
        <!--l. 531--><p class="noindent" ><a 
href="https://gitlab.freedesktop.org/virgl/virglrenderer/-/blob/master/src/virgl_hw.h#L550" >VIRTIO_GPU_CAPSET_VIRGL2</a>  –  the  second  edition  of  Virgl
        (Gallium OpenGL) protocol after the capset fix.
        </li>
        <li class="itemize">
        <!--l. 533--><p class="noindent" ><a 
href="https://android.googlesource.com/device/generic/vulkan-cereal/+/refs/heads/master/protocols/" >VIRTIO_GPU_CAPSET_GFXSTREAM</a>    –    gfxtream’s    (mostly)
        autogenerated GLES and Vulkan streaming protocols.
        </li>
        <li class="itemize">
        <!--l. 535--><p class="noindent" ><a 
href="https://gitlab.freedesktop.org/olv/venus-protocol" >VIRTIO_GPU_CAPSET_VENUS</a>  –  Mesa’s  (mostly)  autogenerated
        Vulkan protocol.
        </li>
        <li class="itemize">
        <!--l. 537--><p class="noindent" ><a 
href="https://chromium.googlesource.com/chromiumos/platform/crosvm/+/refs/heads/main/rutabaga_gfx/src/cross_domain/cross_domain_protocol.rs" >VIRTIO_GPU_CAPSET_CROSS_DOMAIN</a>  –  protocol  for  display
        virtualization via Wayland proxying.</li></ul>
    <!--l. 541-->
    <pre class="lstlisting" id="listing-162"><span class="label"><a 
 id="x1-478090r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_get_capset_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478091r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478092r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capset_index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478093r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478094r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478095r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478096r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CAPSET_VIRGL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478097r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CAPSET_VIRGL2</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478098r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CAPSET_GFXSTREAM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478099r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CAPSET_VENUS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478100r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CAPSET_CROSS_DOMAIN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478101r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resp_capset_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478102r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478103r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capset_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478104r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capset_max_version</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478105r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capset_max_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478106r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478107r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    </dd><dt class="description">
    <!--l. 562--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_GET_CAPSET</span> </dt><dd 
class="description">
    <!--l. 562--><p class="noindent" >Gets the capset associated with a particular <span 
class="aeti-10">capset_id </span>and <span 
class="aeti-10">capset_version</span>.
    Request data is <span 
class="aeti-10">struct virtio_gpu_get_capset</span>. Response type is
    VIRTIO_GPU_RESP_OK_CAPSET.
    <!--l. 567-->
    <pre class="lstlisting" id="listing-163"><span class="label"><a 
 id="x1-478108r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_get_capset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478109r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478110r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capset_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478111r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capset_version</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478112r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478113r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478114r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resp_capset</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478115r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478116r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capset_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478117r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 580--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_ASSIGN_UUID</span> </dt><dd 
class="description">
    <!--l. 580--><p class="noindent" >Creates an exported object from a resource. Request data
    is <span 
class="aeti-10">struct virtio_gpu_resource_assign_uuid</span>. Response type is
    VIRTIO_GPU_RESP_OK_RESOURCE_UUID, response data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_resp_resource_uuid</span>. Support is optional and negotiated using the
    VIRTIO_GPU_F_RESOURCE_UUID feature flag.
    <!--l. 587-->
    <pre class="lstlisting" id="listing-164"><span class="label"><a 
 id="x1-478118r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_assign_uuid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478119r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478120r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478121r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478122r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478123r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478124r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resp_resource_uuid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478125r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478126r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uuid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[16];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478127r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 600--><p class="noindent" >The response contains a UUID which identifies the exported object created from
    the host private resource. Note that if the resource has an attached backing,
    modifications made to the host private resource through the exported object by
    other devices are not visible in the attached backing until they are transferred
    into the backing.
    </dd><dt class="description">
    <!--l. 606--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_CREATE_BLOB</span> </dt><dd 
class="description">
    <!--l. 606--><p class="noindent" >Creates a virtio-gpu blob resource. Request data is <span 
class="aeti-10">struct virtio_gpu_resource_create_blob</span>,
    followed by <span 
class="aeti-10">struct virtio_gpu_mem_entry </span>entries. Response type is
    VIRTIO_GPU_RESP_OK_NODATA. Support is optional and negotiated using
    the VIRTIO_GPU_F_RESOURCE_BLOB feature flag.
    <!--l. 613-->
    <pre class="lstlisting" id="listing-165"><span class="label"><a 
 id="x1-478128r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_BLOB_MEM_GUEST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0001</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478129r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_BLOB_MEM_HOST3D</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0002</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478130r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_BLOB_MEM_HOST3D_GUEST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0003</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478131r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478132r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_BLOB_FLAG_USE_MAPPABLE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0001</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478133r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_BLOB_FLAG_USE_SHAREABLE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0002</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478134r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_BLOB_FLAG_USE_CROSS_DEVICE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0004</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478135r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478136r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_create_blob</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478137r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478138r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478139r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blob_mem</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478140r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blob_flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478141r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nr_entries</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478142r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">blob_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478143r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478144r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 634--><p class="noindent" >A blob resource is a container for:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 637--><p class="noindent" >a guest memory allocation (referred to as a "guest-only blob resource").
        </li>
        <li class="itemize">
        <!--l. 639--><p class="noindent" >a host memory allocation (referred to as a "host-only blob resource").
        </li>
        <li class="itemize">
        <!--l. 641--><p class="noindent" >a guest memory and host memory allocation (referred to as a "default
        blob resource").</li></ul>
    <!--l. 645--><p class="noindent" >The memory properties of the blob resource MUST be described by <span 
class="aeti-10">blob_mem</span>,
    which MUST be non-zero.
                                                                  

                                                                  
    <!--l. 648--><p class="noindent" >For default and guest-only blob resources, <span 
class="aeti-10">nr_entries </span>guest memory entries
    may be assigned to the resource. For default blob resources (i.e, when
    <span 
class="aeti-10">blob_mem </span>is VIRTIO_GPU_BLOB_MEM_HOST3D_GUEST), these memory
    entries are used as a shadow buffer for the host memory. To facilitate
    drivers that support swap-in and swap-out, <span 
class="aeti-10">nr_entries </span>may be zero and
    VIRTIO_GPU_CMD_RESOURCE_ATTACH_BACKING may be subsequently
    used. VIRTIO_GPU_CMD_RESOURCE_DETACH_BACKING may be used to
    unassign memory entries.
    <!--l. 656--><p class="noindent" ><span 
class="aeti-10">blob_mem </span>can only be VIRTIO_GPU_BLOB_MEM_HOST3D and
    VIRTIO_GPU_BLOB_MEM_HOST3D_GUEST if VIRTIO_GPU_F_VIRGL is
    supported. VIRTIO_GPU_BLOB_MEM_GUEST is valid regardless whether
    VIRTIO_GPU_F_VIRGL is supported or not.
    <!--l. 661--><p class="noindent" >For VIRTIO_GPU_BLOB_MEM_HOST3D and VIRTIO_GPU_BLOB_MEM_HOST3D_GUEST,
    the virtio-gpu resource MUST be created from the rendering context
    local object identified by the <span 
class="aeti-10">blob_id</span>. The actual allocation is done via
    VIRTIO_GPU_CMD_SUBMIT_3D.
    <!--l. 666--><p class="noindent" >The driver MUST inform the device if the blob resource is used for memory
    access, sharing between driver instances and/or sharing with other devices. This
    is done via the <span 
class="aeti-10">blob_flags </span>field.
    <!--l. 670--><p class="noindent" >If VIRTIO_GPU_F_VIRGL is set, both VIRTIO_GPU_CMD_TRANSFER_TO_HOST_3D
    and VIRTIO_GPU_CMD_TRANSFER_FROM_HOST_3D may be used to
    update the resource. There is no restriction on the image/buffer view the driver
    has on the blob resource.
    </dd><dt class="description">
    <!--l. 675--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_SET_SCANOUT_BLOB</span> </dt><dd 
class="description">
    <!--l. 675--><p class="noindent" >sets scanout parameters for a blob resource. Request data is <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpu_set_scanout_blob</span>. Response type is VIRTIO_GPU_RESP_OK_NODATA.
    Support is optional and negotiated using the VIRTIO_GPU_F_RESOURCE_BLOB
    feature flag.
    <!--l. 681-->
    <pre class="lstlisting" id="listing-166"><span class="label"><a 
 id="x1-478147r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_set_scanout_blob</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478148r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478149r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_rect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478150r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">scanout_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478151r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478152r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">width</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478153r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">height</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478154r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">format</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478155r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478156r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">strides</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478157r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offsets</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-478158r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 696--><p class="noindent" >The rectangle <span 
class="aeti-10">r </span>represents the portion of the blob resource being displayed. The
    rest is the metadata associated with the blob resource. The format MUST be
    one of <span 
class="aeti-10">enum virtio_gpu_formats</span>. The format MAY be compressed with header
    and data planes.
    </dd></dl>
<a 
 id="x1-478159r490"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.9   </span> <a 
 id="x1-4790009"></a>Device Operation: controlq (3d)</h5>
<!--l. 705--><p class="noindent" >These commands are supported by the device if the VIRTIO_GPU_F_VIRGL feature
flag is set.
    <dl class="description"><dt class="description">
    <!--l. 710--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_CTX_CREATE</span> </dt><dd 
class="description">
    <!--l. 710--><p class="noindent" >creates               a               context               for               submitting
    an opaque command stream. Request data is <span 
class="aeti-10">struct virtio_gpu_ctx_create</span>.
    Response type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 714-->
    <pre class="lstlisting" id="listing-167"><span class="label"><a 
 id="x1-479001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_CONTEXT_INIT_CAPSET_ID_MASK</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x000000ff</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctx_create</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nlen</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">context_init</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">char</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">debug_name</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[64];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    <!--l. 724--><p class="noindent" >The implementation MUST create a context for the given <span 
class="aeti-10">ctx_id </span>in the <span 
class="aeti-10">hdr</span>. For
    debugging purposes, a <span 
class="aeti-10">debug_name </span>and it’s length <span 
class="aeti-10">nlen </span>is provided by the
    driver. If VIRTIO_GPU_F_CONTEXT_INIT is supported, then lower 8 bits of
    <span 
class="aeti-10">context_init </span>MAY contain the <span 
class="aeti-10">capset_id </span>associated with context. In that case,
    then the device MUST create a context that can handle the specified command
    stream.
    <!--l. 732--><p class="noindent" >If the lower 8-bits of the <span 
class="aeti-10">context_init </span>are zero, then the type of the context is
    determined by the device.
    </dd><dt class="description">
    <!--l. 735--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_CTX_DESTROY</span> </dt><dd 
class="description">
    <!--l. 735--><p class="noindent" >
    </dd><dt class="description">
    <!--l. 736--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_CTX_ATTACH_RESOURCE</span> </dt><dd 
class="description">
    <!--l. 736--><p class="noindent" >
    </dd><dt class="description">
    <!--l. 737--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_CTX_DETACH_RESOURCE</span> </dt><dd 
class="description">
    <!--l. 737--><p class="noindent" >Manage virtio-gpu 3d contexts.
    </dd><dt class="description">
    <!--l. 740--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_CREATE_3D</span> </dt><dd 
class="description">
    <!--l. 740--><p class="noindent" >Create virtio-gpu 3d resources.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 743--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_TRANSFER_TO_HOST_3D</span> </dt><dd 
class="description">
    <!--l. 743--><p class="noindent" >
    </dd><dt class="description">
    <!--l. 744--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_TRANSFER_FROM_HOST_3D</span> </dt><dd 
class="description">
    <!--l. 744--><p class="noindent" >Transfer data from and to virtio-gpu 3d resources.
    </dd><dt class="description">
    <!--l. 747--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_SUBMIT_3D</span> </dt><dd 
class="description">
    <!--l. 747--><p class="noindent" >Submit an opaque command stream. The type of the command stream is
    determined when creating a context.
    </dd><dt class="description">
    <!--l. 751--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_MAP_BLOB</span> </dt><dd 
class="description">
    <!--l. 751--><p class="noindent" >maps a host-only blob resource into an offset in the host visible memory
    region. Request data is <span 
class="aeti-10">struct virtio_gpu_resource_map_blob</span>. The driver
    MUST not map a blob resource that is already mapped. Response type is
    VIRTIO_GPU_RESP_OK_MAP_INFO. Support is optional and negotiated using
    the VIRTIO_GPU_F_RESOURCE_BLOB feature flag and checking for the
    presence of the host visible memory region.
    <!--l. 759-->
    <pre class="lstlisting" id="listing-168"><span class="label"><a 
 id="x1-479008r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_map_blob</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479009r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479010r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479011r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479012r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479013r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479014r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479015r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_MAP_CACHE_MASK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0f</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479016r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_MAP_CACHE_NONE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479017r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_MAP_CACHE_CACHED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x01</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479018r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_MAP_CACHE_UNCACHED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479019r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPU_MAP_CACHE_WC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479020r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resp_map_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479021r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479022r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map_info</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479023r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479024r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    </dd><dt class="description">
    <!--l. 779--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_RESOURCE_UNMAP_BLOB</span> </dt><dd 
class="description">
    <!--l. 779--><p class="noindent" >unmaps a host-only blob resource from the host visible memory region.
    Request data is <span 
class="aeti-10">struct virtio_gpu_resource_unmap_blob</span>. Response type is
    VIRTIO_GPU_RESP_OK_NODATA. Support is optional and negotiated using
    the VIRTIO_GPU_F_RESOURCE_BLOB feature flag and checking for the
    presence of the host visible memory region.
    <!--l. 786-->
    <pre class="lstlisting" id="listing-169"><span class="label"><a 
 id="x1-479025r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_resource_unmap_blob</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479026r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479027r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479028r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-479029r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
                                                                  

                                                                  
    </dd></dl>
<a 
 id="x1-479030r491"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.7.6.10   </span> <a 
 id="x1-48000010"></a>Device Operation: cursorq</h5>
<!--l. 798--><p class="noindent" >Both cursorq commands use the same command struct.
<!--l. 800-->
<pre class="lstlisting" id="listing-170"><span class="label"><a 
 id="x1-480001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_cursor_pos</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">scanout_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">y</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_update_cursor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_ctrl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpu_cursor_pos</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pos</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resource_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hot_x</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hot_y</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-480015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 820--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_UPDATE_CURSOR</span> </dt><dd 
class="description">
    <!--l. 820--><p class="noindent" >Update cursor. Request data is <span 
class="aeti-10">struct virtio_gpu_update_cursor</span>. Response
    type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 825--><p class="noindent" >Full cursor update. Cursor will be loaded from the specified <span 
class="aeti-10">resource_id</span>
    and will be moved to <span 
class="aeti-10">pos</span>. The driver must transfer the cursor into the
    resource beforehand (using control queue commands) and make sure the
    commands to fill the resource are actually processed (using fencing).
    </dd><dt class="description">
    <!--l. 831--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPU_CMD_MOVE_CURSOR</span> </dt><dd 
class="description">
    <!--l. 831--><p class="noindent" >Move cursor. Request data is <span 
class="aeti-10">struct virtio_gpu_update_cursor</span>. Response
    type is VIRTIO_GPU_RESP_OK_NODATA.
    <!--l. 836--><p class="noindent" >Move cursor to the place specified in <span 
class="aeti-10">pos</span>. The other fields are not used and
    will be ignored by the device.
    </dd></dl>
<a 
 id="x1-480016r482"></a>
<h4 class="subsectionHead"><span class="titlemark">5.7.7   </span> <a 
 id="x1-4810007"></a>VGA Compatibility</h4>
<!--l. 843--><p class="noindent" >Applies to Virtio Over PCI only. The GPU device can come with and without VGA
compatibility. The PCI class should be DISPLAY_VGA if VGA compatibility is
present and DISPLAY_OTHER otherwise.
<!--l. 847--><p class="noindent" >VGA compatibility: PCI region 0 has the linear framebuffer, standard vga registers
are present. Configuring a scanout (VIRTIO_GPU_CMD_SET_SCANOUT) switches
the device from vga compatibility mode into native virtio mode. A reset switches it
back into vga compatibility mode.
<!--l. 853--><p class="noindent" >Note: qemu implementation also provides bochs dispi interface io ports and mmio bar
at pci region 1 and is therefore fully compatible with the qemu stdvga (see
<a 
href="https://git.qemu-project.org/?p=qemu.git;a=blob;f=docs/specs/standard-vga.txt;hb=HEAD" >docs/specs/standard-vga.txt</a> in the qemu source tree).
                                                                  

                                                                  
<a 
 id="x1-481001r474"></a>
<h3 class="sectionHead"><span class="titlemark">5.8   </span> <a 
 id="x1-4820008"></a>Input Device</h3>
<!--l. 3--><p class="noindent" >The virtio input device can be used to create virtual human interface devices such as
keyboards, mice and tablets. An instance of the virtio device represents one such
input device. Device behavior mirrors that of the evdev layer in Linux, making
pass-through implementations on top of evdev easy.
<!--l. 9--><p class="noindent" >This specification defines how evdev events are transported over virtio and how
the set of supported events is discovered by a driver. It does not, however,
define the semantics of input events as this is dependent on the particular
evdev implementation. For the list of events used by Linux input devices, see
<a 
href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/input-event-codes.h" >include/uapi/linux/input-event-codes.h</a> in the Linux source tree.
<a 
 id="x1-482001r493"></a>
<h4 class="subsectionHead"><span class="titlemark">5.8.1   </span> <a 
 id="x1-4830001"></a>Device ID</h4>
<!--l. 19--><p class="noindent" >18
<a 
 id="x1-483001r495"></a>
<h4 class="subsectionHead"><span class="titlemark">5.8.2   </span> <a 
 id="x1-4840002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 24--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 24--><p class="noindent" >eventq
    </dd><dt class="description">
    <!--l. 25--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 25--><p class="noindent" >statusq</dd></dl>
<a 
 id="x1-484001r496"></a>
<h4 class="subsectionHead"><span class="titlemark">5.8.3   </span> <a 
 id="x1-4850003"></a>Feature bits</h4>
<!--l. 30--><p class="noindent" >None.
<a 
 id="x1-485001r497"></a>
<h4 class="subsectionHead"><span class="titlemark">5.8.4   </span> <a 
 id="x1-4860004"></a>Device configuration layout</h4>
<!--l. 34--><p class="noindent" >Device configuration holds all information the guest needs to handle the device, most
importantly the events which are supported.
<!--l. 37-->
<pre class="lstlisting" id="listing-171"><span class="label"><a 
 id="x1-486001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_input_config_select</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_INPUT_CFG_UNSET</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_INPUT_CFG_ID_NAME</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x01</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_INPUT_CFG_ID_SERIAL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_INPUT_CFG_ID_DEVIDS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_INPUT_CFG_PROP_BITS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x10</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_INPUT_CFG_EV_BITS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x11</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_INPUT_CFG_ABS_INFO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x12</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_input_absinfo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">min</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuzz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flat</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">res</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486019r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_input_devids</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bustype</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vendor</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">product</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">version</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486024r24"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486026r26"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_input_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">select</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">subsel</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[5];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">char</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">string</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[128];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bitmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[128];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_input_absinfo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">abs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_input_devids</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ids</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-486037r37"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 77--><p class="noindent" >To query a specific piece of information the driver sets <span 
class="aeti-10">select </span>and <span 
class="aeti-10">subsel </span>accordingly,
then checks <span 
class="aeti-10">size </span>to see how much information is available. <span 
class="aeti-10">size </span>can be zero if no
                                                                  

                                                                  
information is available. Strings do not include a NUL terminator. Related evdev
ioctl names are provided for reference.
    <dl class="description"><dt class="description">
    <!--l. 84--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_INPUT_CFG_ID_NAME</span> </dt><dd 
class="description">
    <!--l. 84--><p class="noindent" ><span 
class="aeti-10">subsel </span>is zero. Returns the name of the device, in <span 
class="aeti-10">u.string</span>.
    <!--l. 88--><p class="noindent" >Similar to EVIOCGNAME ioctl for Linux evdev devices.
    </dd><dt class="description">
    <!--l. 90--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_INPUT_CFG_ID_SERIAL</span> </dt><dd 
class="description">
    <!--l. 90--><p class="noindent" ><span 
class="aeti-10">subsel </span>is zero. Returns the serial number of the device, in <span 
class="aeti-10">u.string</span>.
    </dd><dt class="description">
    <!--l. 94--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_INPUT_CFG_ID_DEVIDS</span> </dt><dd 
class="description">
    <!--l. 94--><p class="noindent" ><span 
class="aeti-10">subsel </span>is zero. Returns ID information of the device, in <span 
class="aeti-10">u.ids</span>.
    <!--l. 98--><p class="noindent" >Similar to EVIOCGID ioctl for Linux evdev devices.
    </dd><dt class="description">
    <!--l. 100--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_INPUT_CFG_PROP_BITS</span> </dt><dd 
class="description">
    <!--l. 100--><p class="noindent" ><span 
class="aeti-10">subsel  </span>is  zero.  Returns  input  properties  of  the  device,  in  <span 
class="aeti-10">u.bitmap</span>.
    Individual bits in the bitmap correspond to INPUT_PROP_* constants
    used by the underlying evdev implementation.
    <!--l. 106--><p class="noindent" >Similar to EVIOCGPROP ioctl for Linux evdev devices.
    </dd><dt class="description">
    <!--l. 108--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_INPUT_CFG_EV_BITS</span> </dt><dd 
class="description">
    <!--l. 108--><p class="noindent" ><span 
class="aeti-10">subsel  </span>specifies the event type using EV_* constants in the underlying
    evdev implementation. If <span 
class="aeti-10">size </span>is non-zero the event type is supported and
    a bitmap of supported event codes is returned in <span 
class="aeti-10">u.bitmap</span>. Individual bits
    in the bitmap correspond to implementation-defined input event codes, for
    example keys or pointing device axes.
    <!--l. 117--><p class="noindent" >Similar to EVIOCGBIT ioctl for Linux evdev devices.
    </dd><dt class="description">
    <!--l. 119--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_INPUT_CFG_ABS_INFO</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 119--><p class="noindent" ><span 
class="aeti-10">subsel </span>specifies the absolute axis using ABS_* constants in the underlying
    evdev implementation. Information about the axis will be returned in <span 
class="aeti-10">u.abs</span>.
    <!--l. 124--><p class="noindent" >Similar to EVIOCGABS ioctl for Linux evdev devices.
    </dd></dl>
<a 
 id="x1-486038r498"></a>
<h4 class="subsectionHead"><span class="titlemark">5.8.5   </span> <a 
 id="x1-4870005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The device is queried for supported event types and codes.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">The eventq is populated with receive buffers.</dd></dl>
<a 
 id="x1-487003r492"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.8.5.1   </span> <a 
 id="x1-4880001"></a>Driver Requirements: Device Initialization</h5>
<!--l. 136--><p class="noindent" >A driver MUST set both <span 
class="aeti-10">select </span>and <span 
class="aeti-10">subsel </span>when querying device configuration, in any
order.
<!--l. 139--><p class="noindent" >A driver MUST NOT write to configuration fields other than <span 
class="aeti-10">select </span>and
<span 
class="aeti-10">subsel</span>.
<!--l. 142--><p class="noindent" >A driver SHOULD check the <span 
class="aeti-10">size </span>field before accessing the configuration
information.
<a 
 id="x1-488001r500"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.8.5.2   </span> <a 
 id="x1-4890002"></a>Device Requirements: Device Initialization</h5>
<!--l. 146--><p class="noindent" >A device MUST set the <span 
class="aeti-10">size </span>field to zero if it doesn’t support a given <span 
class="aeti-10">select </span>and
<span 
class="aeti-10">subsel </span>combination.
<a 
 id="x1-489001r499"></a>
<h4 class="subsectionHead"><span class="titlemark">5.8.6   </span> <a 
 id="x1-4900006"></a>Device Operation</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Input events such as press and release events for keys and buttons, and
    motion events for pointing devices are sent from the device to the driver
    using the eventq.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Status feedback such as keyboard LED updates are sent from the driver to
    the device using the statusq.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Both queues use the same virtio_input_event struct. <span 
class="aeti-10">type</span>, <span 
class="aeti-10">code </span>and <span 
class="aeti-10">value</span>
    are filled according to the Linux input layer (evdev) interface, except that
    the fields are in little endian byte order whereas the evdev ioctl interface
    uses native endian-ness.</dd></dl>
<!--l. 164-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-172"><span class="label"><a 
 id="x1-490004r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_input_event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-490005r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-490006r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">code</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-490007r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-490008r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-490009r501"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.8.6.1   </span> <a 
 id="x1-4910001"></a>Driver Requirements: Device Operation</h5>
<!--l. 174--><p class="noindent" >A driver SHOULD keep the eventq populated with buffers. These buffers MUST be
device-writable and MUST be at least the size of struct virtio_input_event.
<!--l. 178--><p class="noindent" >Buffers placed into the statusq by a driver MUST be at least the size of struct
virtio_input_event.
<!--l. 181--><p class="noindent" >A driver SHOULD ignore eventq input events it does not recognize. Note that evdev
devices generally maintain backward compatibility by sending redundant events and
relying on the consuming side using only the events it understands and ignoring the
rest.
<a 
 id="x1-491001r503"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.8.6.2   </span> <a 
 id="x1-4920002"></a>Device Requirements: Device Operation</h5>
<!--l. 188--><p class="noindent" >A device MAY drop input events if the eventq does not have enough available
buffers. It SHOULD NOT drop individual input events if they are part of a
sequence forming one input device update. For example, a pointing device
update typically consists of several input events, one for each axis, and a
terminating EV_SYN event. A device SHOULD either buffer or drop the entire
sequence.
<a 
 id="x1-492001r494"></a>
<h3 class="sectionHead"><span class="titlemark">5.9   </span> <a 
 id="x1-4930009"></a>Crypto Device</h3>
<!--l. 3--><p class="noindent" >The virtio crypto device is a virtual cryptography device as well as a virtual
cryptographic accelerator. The virtio crypto device provides the following crypto
services: CIPHER, MAC, HASH, AEAD and AKCIPHER. Virtio crypto devices have
a single control queue and at least one data queue. Crypto operation requests are
placed into a data queue, and serviced by the device. Some crypto operation requests
are only valid in the context of a session. The role of the control queue is facilitating
control operation requests. Sessions management is realized with control operation
requests.
<a 
 id="x1-493001r502"></a>
<h4 class="subsectionHead"><span class="titlemark">5.9.1   </span> <a 
 id="x1-4940001"></a>Device ID</h4>
<!--l. 15--><p class="noindent" >20
<a 
 id="x1-494001r506"></a>
<h4 class="subsectionHead"><span class="titlemark">5.9.2   </span> <a 
 id="x1-4950002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 20--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 20--><p class="noindent" >dataq1
    </dd><dt class="description">
    <!--l. 21--><p class="noindent" >
<span 
class="aeb10-">…</span> </dt><dd 
class="description">
    <!--l. 21--><p class="noindent" >
    </dd><dt class="description">
    <!--l. 22--><p class="noindent" >
<span 
class="aeb10-">N-1</span> </dt><dd 
class="description">
    <!--l. 22--><p class="noindent" >dataqN
    </dd><dt class="description">
    <!--l. 23--><p class="noindent" >
<span 
class="aeb10-">N</span> </dt><dd 
class="description">
    <!--l. 23--><p class="noindent" >controlq</dd></dl>
<!--l. 26--><p class="noindent" >N is set by <span 
class="aeti-10">max_dataqueues</span>.
<a 
 id="x1-495001r507"></a>
<h4 class="subsectionHead"><span class="titlemark">5.9.3   </span> <a 
 id="x1-4960003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 31--><p class="noindent" >
 </dt><dd 
class="description">
    <!--l. 31--><p class="noindent" >VIRTIO_CRYPTO_F_REVISION_1 (0) revision 1. Revision 1 has a specific
    request format and other enhancements (which result in some additional
    requirements).
    </dd><dt class="description">
    <!--l. 34--><p class="noindent" >
 </dt><dd 
class="description">
    <!--l. 34--><p class="noindent" >VIRTIO_CRYPTO_F_CIPHER_STATELESS_MODE  (1)  stateless  mode
    requests are supported by the CIPHER service.
    </dd><dt class="description">
    <!--l. 36--><p class="noindent" >
 </dt><dd 
class="description">
    <!--l. 36--><p class="noindent" >VIRTIO_CRYPTO_F_HASH_STATELESS_MODE   (2)   stateless   mode
    requests are supported by the HASH service.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 38--><p class="noindent" >
 </dt><dd 
class="description">
    <!--l. 38--><p class="noindent" >VIRTIO_CRYPTO_F_MAC_STATELESS_MODE   (3)   stateless   mode
    requests are supported by the MAC service.
    </dd><dt class="description">
    <!--l. 40--><p class="noindent" >
 </dt><dd 
class="description">
    <!--l. 40--><p class="noindent" >VIRTIO_CRYPTO_F_AEAD_STATELESS_MODE   (4)   stateless   mode
    requests are supported by the AEAD service.
    </dd><dt class="description">
    <!--l. 42--><p class="noindent" >
 </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >VIRTIO_CRYPTO_F_AKCIPHER_STATELESS_MODE    (5)    stateless
    mode requests are supported by the AKCIPHER service.</dd></dl>
<a 
 id="x1-496001r504"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.3.1   </span> <a 
 id="x1-4970001"></a>Feature bit requirements</h5>
<!--l. 49--><p class="noindent" >Some crypto feature bits require other crypto feature bits (see <a 
href="#x1-150001">2.2.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Feature Bits --></a>):
    <dl class="description"><dt class="description">
    <!--l. 53--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CRYPTO_F_CIPHER_STATELESS_MODE</span> </dt><dd 
class="description">
    <!--l. 53--><p class="noindent" >Requires VIRTIO_CRYPTO_F_REVISION_1.
    </dd><dt class="description">
    <!--l. 54--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CRYPTO_F_HASH_STATELESS_MODE</span> </dt><dd 
class="description">
    <!--l. 54--><p class="noindent" >Requires VIRTIO_CRYPTO_F_REVISION_1.
    </dd><dt class="description">
    <!--l. 55--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CRYPTO_F_MAC_STATELESS_MODE</span> </dt><dd 
class="description">
    <!--l. 55--><p class="noindent" >Requires VIRTIO_CRYPTO_F_REVISION_1.
    </dd><dt class="description">
    <!--l. 56--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CRYPTO_F_AEAD_STATELESS_MODE</span> </dt><dd 
class="description">
    <!--l. 56--><p class="noindent" >Requires VIRTIO_CRYPTO_F_REVISION_1.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 57--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CRYPTO_F_AKCIPHER_STATELESS_MODE</span> </dt><dd 
class="description">
    <!--l. 57--><p class="noindent" >Requires VIRTIO_CRYPTO_F_REVISION_1.</dd></dl>
<a 
 id="x1-497001r508"></a>
<h4 class="subsectionHead"><span class="titlemark">5.9.4   </span> <a 
 id="x1-4980004"></a>Supported crypto services</h4>
<!--l. 62--><p class="noindent" >The following crypto services are defined:
<!--l. 64-->
<pre class="lstlisting" id="listing-173"><span class="label"><a 
 id="x1-498001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CIPHER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Symmetric</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Cipher</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_CIPHER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">HASH</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_HASH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">MAC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Message</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Authentication</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Codes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_MAC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AEAD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Encryption</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Associated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AEAD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AKCIPHER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Asymmetric</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Cipher</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-498010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AKCIPHER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span></pre>
<!--l. 77--><p class="noindent" >The above constants designate bits used to indicate the which of crypto services are
offered by the device as described in, see <a 
href="#x1-5040005">5.9.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device configuration layout --></a>.
<a 
 id="x1-498011r509"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.4.1   </span> <a 
 id="x1-4990001"></a>CIPHER services</h5>
<!--l. 82--><p class="noindent" >The following CIPHER algorithms are defined:
<!--l. 84-->
<pre class="lstlisting" id="listing-174"><span class="label"><a 
 id="x1-499001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_NO_CIPHER</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_ARC4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_AES_ECB</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_AES_CBC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_AES_CTR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_DES_ECB</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_DES_CBC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_3DES_ECB</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_3DES_CBC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_3DES_CTR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_KASUMI_F8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">10</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_SNOW3G_UEA2</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">11</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_AES_F8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">12</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_AES_XTS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">13</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-499015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_ZUC_EEA3</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">14</span></span></pre>
<!--l. 102--><p class="noindent" >The above constants have two usages:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">As bit numbers, used to tell the driver which CIPHER algorithms are
    supported by the device, see <a 
href="#x1-5040005">5.9.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device configuration layout --></a>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">As  values,  used  to  designate  the  algorithm  in  (CIPHER  type)  crypto
    operation requests, see <a 
href="#x1-5120001">5.9.7.2.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation --></a>.</dd></dl>
<a 
 id="x1-499018r511"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.4.2   </span> <a 
 id="x1-5000002"></a>HASH services</h5>
<!--l. 112--><p class="noindent" >The following HASH algorithms are defined:
<!--l. 114-->
<pre class="lstlisting" id="listing-175"><span class="label"><a 
 id="x1-500001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_NO_HASH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_MD5</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA_224</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA_256</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA_384</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA_512</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA3_224</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA3_256</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA3_384</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA3_512</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">10</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA3_SHAKE128</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">11</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-500013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_SHA3_SHAKE256</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">12</span></span></pre>
<!--l. 130--><p class="noindent" >The above constants have two usages:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">As  bit  numbers,  used  to  tell  the  driver  which  HASH  algorithms  are
    supported by the device, see <a 
href="#x1-5040005">5.9.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device configuration layout --></a>.
                                                                  

                                                                  
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">As values, used to designate the algorithm in (HASH type) crypto operation
    requires, see <a 
href="#x1-5120001">5.9.7.2.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation --></a>.</dd></dl>
<a 
 id="x1-500016r512"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.4.3   </span> <a 
 id="x1-5010003"></a>MAC services</h5>
<!--l. 140--><p class="noindent" >The following MAC algorithms are defined:
<!--l. 142-->
<pre class="lstlisting" id="listing-176"><span class="label"><a 
 id="x1-501001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_NO_MAC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_HMAC_MD5</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_HMAC_SHA1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_HMAC_SHA_224</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_HMAC_SHA_256</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_HMAC_SHA_384</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_HMAC_SHA_512</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_CMAC_3DES</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">25</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_CMAC_AES</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">26</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_KASUMI_F9</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">27</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_SNOW3G_UIA2</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">28</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_GMAC_AES</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">41</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_GMAC_TWOFISH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">42</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_CBCMAC_AES</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">49</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_CBCMAC_KASUMI_F9</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">50</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_XCBC_AES</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">53</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-501017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_ZUC_EIA3</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">54</span></span></pre>
<!--l. 162--><p class="noindent" >The above constants have two usages:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">As  bit  numbers,  used  to  tell  the  driver  which  MAC  algorithms  are
    supported by the device, see <a 
href="#x1-5040005">5.9.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device configuration layout --></a>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">As values, used to designate the algorithm in (MAC type) crypto operation
    requests, see <a 
href="#x1-5120001">5.9.7.2.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation --></a>.</dd></dl>
<a 
 id="x1-501020r513"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.4.4   </span> <a 
 id="x1-5020004"></a>AEAD services</h5>
<!--l. 172--><p class="noindent" >The following AEAD algorithms are defined:
<!--l. 174-->
<pre class="lstlisting" id="listing-177"><span class="label"><a 
 id="x1-502001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_NO_AEAD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-502002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_GCM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-502003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_CCM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-502004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_CHACHA20_POLY1305</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
<!--l. 181--><p class="noindent" >The above constants have two usages:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">As  bit  numbers,  used  to  tell  the  driver  which  AEAD  algorithms  are
    supported by the device, see <a 
href="#x1-5040005">5.9.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device configuration layout --></a>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">As  values,  used  to  designate  the  algorithm  in  (DEAD  type)  crypto
    operation requests, see <a 
href="#x1-5120001">5.9.7.2.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation --></a>.</dd></dl>
<a 
 id="x1-502007r514"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.4.5   </span> <a 
 id="x1-5030005"></a>AKCIPHER services</h5>
<!--l. 191--><p class="noindent" >The following AKCIPHER algorithms are defined: <!--l. 192-->
<pre class="lstlisting" id="listing-178"><span class="label"><a 
 id="x1-503001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_NO_AKCIPHER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-503002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_RSA</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-503003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_ECDSA</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<!--l. 198--><p class="noindent" >The above constants have two usages:
                                                                  

                                                                  
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">As bit numbers, used to tell the driver which AKCIPHER algorithms are
    supported by the device, see <a 
href="#x1-5040005">5.9.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device configuration layout --></a>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">As values, used to designate the algorithm in asymmetric crypto operation
    requests, see <a 
href="#x1-5120001">5.9.7.2.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation --></a>.</dd></dl>
<a 
 id="x1-503006r510"></a>
<h4 class="subsectionHead"><span class="titlemark">5.9.5   </span> <a 
 id="x1-5040005"></a>Device configuration layout</h4>
<!--l. 209--><p class="noindent" >Crypto device configuration uses the following layout structure:
<!--l. 211-->
<pre class="lstlisting" id="listing-179"><span class="label"><a 
 id="x1-504001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_dataqueues</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">crypto_services</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Detailed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algorithms</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mask</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_algo_l</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_algo_h</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mac_algo_l</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mac_algo_h</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aead_algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Maximum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_cipher_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Maximum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">akcipher_algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Maximum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">each</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">crypto</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">request</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">content</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-504019r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 234--><p class="noindent" >
 </dt><dd 
class="description">
    <!--l. 234--><p class="noindent" >Currently, only one <span 
class="aeti-10">status </span>bit is defined: VIRTIO_CRYPTO_S_HW_READY set
    indicates that the device is ready to process requests, this bit is read-only for the
    driver <!--l. 237-->
    <pre class="lstlisting" id="listing-180"><span class="label"><a 
 id="x1-504020r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_S_HW_READY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span></pre>
    
    </dd><dt class="description">
    <!--l. 241--><p class="noindent" >
<span 
class="aebxti-10">max_dataqueues</span> </dt><dd 
class="description">
    <!--l. 241--><p class="noindent" >is the maximum number of data virtqueues that can be configured by the
    device. The driver MAY use only one data queue, or it can use more to achieve
    better performance.
    </dd><dt class="description">
    <!--l. 245--><p class="noindent" >
<span 
class="aebxti-10">crypto_services</span> </dt><dd 
class="description">
    <!--l. 245--><p class="noindent" >crypto service offered, see <a 
href="#x1-4980004">5.9.4<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services --></a>.
    </dd><dt class="description">
    <!--l. 247--><p class="noindent" >
<span 
class="aebxti-10">cipher_algo_l</span> </dt><dd 
class="description">
    <!--l. 247--><p class="noindent" >CIPHER algorithms bits 0-31, see <a 
href="#x1-4990001">5.9.4.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services / CIPHER services --></a>.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 249--><p class="noindent" >
<span 
class="aebxti-10">cipher_algo_h</span> </dt><dd 
class="description">
    <!--l. 249--><p class="noindent" >CIPHER algorithms bits 32-63, see <a 
href="#x1-4990001">5.9.4.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services / CIPHER services --></a>.
    </dd><dt class="description">
    <!--l. 251--><p class="noindent" >
<span 
class="aebxti-10">hash_algo</span> </dt><dd 
class="description">
    <!--l. 251--><p class="noindent" >HASH algorithms bits, see <a 
href="#x1-5000002">5.9.4.2<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services / HASH services --></a>.
    </dd><dt class="description">
    <!--l. 253--><p class="noindent" >
<span 
class="aebxti-10">mac_algo_l</span> </dt><dd 
class="description">
    <!--l. 253--><p class="noindent" >MAC algorithms bits 0-31, see <a 
href="#x1-5010003">5.9.4.3<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services / MAC services --></a>.
    </dd><dt class="description">
    <!--l. 255--><p class="noindent" >
<span 
class="aebxti-10">mac_algo_h</span> </dt><dd 
class="description">
    <!--l. 255--><p class="noindent" >MAC algorithms bits 32-63, see <a 
href="#x1-5010003">5.9.4.3<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services / MAC services --></a>.
    </dd><dt class="description">
    <!--l. 257--><p class="noindent" >
<span 
class="aebxti-10">aead_algo</span> </dt><dd 
class="description">
    <!--l. 257--><p class="noindent" >AEAD algorithms bits, see <a 
href="#x1-5020004">5.9.4.4<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services / AEAD services --></a>.
    </dd><dt class="description">
    <!--l. 259--><p class="noindent" >
<span 
class="aebxti-10">max_cipher_key_len</span> </dt><dd 
class="description">
    <!--l. 259--><p class="noindent" >is the maximum length of cipher key supported by the device.
    </dd><dt class="description">
    <!--l. 261--><p class="noindent" >
<span 
class="aebxti-10">max_auth_key_len</span> </dt><dd 
class="description">
    <!--l. 261--><p class="noindent" >is the maximum length of authenticated key supported by the device.
    </dd><dt class="description">
    <!--l. 263--><p class="noindent" >
<span 
class="aebxti-10">akcipher_algo</span> </dt><dd 
class="description">
    <!--l. 263--><p class="noindent" >AKCIPHER algorithms bit 0-31, see <a 
href="#x1-5030005">5.9.4.5<!--tex4ht:ref: sec: Device Types / Crypto Device / Supported crypto services / AKCIPHER services --></a>.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 265--><p class="noindent" >
<span 
class="aebxti-10">max_size</span> </dt><dd 
class="description">
    <!--l. 265--><p class="noindent" >is the maximum size of the variable-length parameters of data operation of each
    crypto request’s content supported by the device.</dd></dl>
<span 
class="aeb10-">Note:</span> Unless explicitly stated otherwise all lengths and sizes are in bytes.
<a 
 id="x1-504021r515"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.5.1   </span> <a 
 id="x1-5050001"></a>Device Requirements: Device configuration layout</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 276--><p class="noindent" >The device MUST set <span 
class="aeti-10">max_dataqueues </span>to between 1 and 65535 inclusive.
    </li>
    <li class="itemize">
    <!--l. 277--><p class="noindent" >The device MUST set the <span 
class="aeti-10">status </span>with valid flags, undefined flags MUST
    NOT be set.
    </li>
    <li class="itemize">
    <!--l. 278--><p class="noindent" >The  device  MUST  accept  and  handle  requests  after  <span 
class="aeti-10">status  </span>is  set  to
    VIRTIO_CRYPTO_S_HW_READY.
    </li>
    <li class="itemize">
    <!--l. 279--><p class="noindent" >The device MUST set <span 
class="aeti-10">crypto_services  </span>based on the crypto services the
    device offers.
    </li>
    <li class="itemize">
    <!--l. 280--><p class="noindent" >The device MUST set detailed algorithms masks for each service advertised
    by <span 
class="aeti-10">crypto_services</span>. The device MUST NOT set the not defined algorithms
    bits.
    </li>
    <li class="itemize">
    <!--l. 282--><p class="noindent" >The device MUST set <span 
class="aeti-10">max_size </span>to show the maximum size of crypto request
    the device supports.
    </li>
    <li class="itemize">
    <!--l. 283--><p class="noindent" >The device MUST set <span 
class="aeti-10">max_cipher_key_len </span>to show the maximum length of
    cipher key if the device supports CIPHER service.
    </li>
    <li class="itemize">
    <!--l. 285--><p class="noindent" >The device MUST set <span 
class="aeti-10">max_auth_key_len </span>to show the maximum length of
    authenticated key if the device supports MAC service.</li></ul>
<a 
 id="x1-505001r517"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.9.5.2   </span> <a 
 id="x1-5060002"></a>Driver Requirements: Device configuration layout</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 292--><p class="noindent" >The  driver  MUST  read  the  <span 
class="aeti-10">status  </span>from  the  bottom  bit  of  status  to
    check whether the VIRTIO_CRYPTO_S_HW_READY is set, and the driver
    MUST reread it after device reset.
    </li>
    <li class="itemize">
    <!--l. 294--><p class="noindent" >The  driver  MUST  NOT  transmit  any  requests  to  the  device  if  the
    VIRTIO_CRYPTO_S_HW_READY is not set.
    </li>
    <li class="itemize">
    <!--l. 295--><p class="noindent" >The driver MUST read <span 
class="aeti-10">max_dataqueues </span>field to discover the number of
    data queues the device supports.
    </li>
    <li class="itemize">
    <!--l. 296--><p class="noindent" >The driver MUST read <span 
class="aeti-10">crypto_services </span>field to discover which services the
    device is able to offer.
    </li>
    <li class="itemize">
    <!--l. 297--><p class="noindent" >The driver SHOULD ignore the not defined algorithms bits.
    </li>
    <li class="itemize">
    <!--l. 298--><p class="noindent" >The   driver   MUST   read   the   detailed   algorithms   fields   based   on
    <span 
class="aeti-10">crypto_services </span>field.
    </li>
    <li class="itemize">
    <!--l. 299--><p class="noindent" >The driver SHOULD read <span 
class="aeti-10">max_size </span>to discover the maximum size of the
    variable-length parameters of data operation of the crypto request’s content
    the device supports and MUST guarantee that the size of each crypto
    request’s content is within the <span 
class="aeti-10">max_size</span>, otherwise the request will fail and
    the driver MUST reset the device.
    </li>
    <li class="itemize">
    <!--l. 303--><p class="noindent" >The driver SHOULD read <span 
class="aeti-10">max_cipher_key_len </span>to discover the maximum
    length   of   cipher   key   the   device   supports   and   MUST   guarantee
    that  the  <span 
class="aeti-10">key_len  </span>(CIPHER  service  or  AEAD  service)  is  within  the
    <span 
class="aeti-10">max_cipher_key_len </span>of the device configuration, otherwise the request will
    fail.
    </li>
    <li class="itemize">
    <!--l. 306--><p class="noindent" >The  driver  SHOULD  read  <span 
class="aeti-10">max_auth_key_len  </span>to  discover  the  maximum
    length  of  authenticated  key  the  device  supports  and  MUST  guarantee
    that the <span 
class="aeti-10">auth_key_len </span>(MAC service) is within the <span 
class="aeti-10">max_auth_key_len </span>of the
    device configuration, otherwise the request will fail.</li></ul>
                                                                  

                                                                  
<a 
 id="x1-506001r516"></a>
<h4 class="subsectionHead"><span class="titlemark">5.9.6   </span> <a 
 id="x1-5070006"></a>Device Initialization</h4>
<a 
 id="x1-507001r518"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.6.1   </span> <a 
 id="x1-5080001"></a>Driver Requirements: Device Initialization</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 316--><p class="noindent" >The driver MUST configure and initialize all virtqueues.
    </li>
    <li class="itemize">
    <!--l. 317--><p class="noindent" >The  driver  MUST  read  the  supported  crypto  services  from  bits  of
    <span 
class="aeti-10">crypto_services</span>.
    </li>
    <li class="itemize">
    <!--l. 318--><p class="noindent" >The driver MUST read the supported algorithms based on <span 
class="aeti-10">crypto_services</span>
    field.</li></ul>
<a 
 id="x1-508001r519"></a>
<h4 class="subsectionHead"><span class="titlemark">5.9.7   </span> <a 
 id="x1-5090007"></a>Device Operation</h4>
<!--l. 323--><p class="noindent" >The operation of a virtio crypto device is driven by requests placed on the virtqueues.
Requests consist of a queue-type specific header (specifying among others the
operation) and an operation specific payload.
<!--l. 327--><p class="noindent" >If VIRTIO_CRYPTO_F_REVISION_1 is negotiated the device may support both
session mode (See <a 
href="#x1-5120001">5.9.7.2.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation --></a>) and stateless mode operation requests. In stateless mode
all operation parameters are supplied as a part of each request, while in session
mode, some or all operation parameters are managed within the session.
Stateless mode is guarded by feature bits 0-4 on a service level. If stateless
mode is negotiated for a service, the service accepts both session mode and
stateless requests; otherwise stateless mode requests are rejected (via operation
status).
<a 
 id="x1-509001r520"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.1   </span> <a 
 id="x1-5100001"></a>Operation Status</h5>
<!--l. 338--><p class="noindent" >The device MUST return a status code as part of the operation (both session
operation and service operation) result. The valid operation status as follows:
<!--l. 341-->
<pre class="lstlisting" id="listing-181"><span class="label"><a 
 id="x1-510001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_STATUS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OK</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_ERR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_BADMSG</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_NOTSUPP</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_INVSESS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_NOSPC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_KEY_REJECTED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAX</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-510010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 355--><p class="noindent" >VIRTIO_CRYPTO_OK: success.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 356--><p class="noindent" >VIRTIO_CRYPTO_BADMSG:  authentication  failed  (only  when  AEAD
    decryption).
    </li>
    <li class="itemize">
    <!--l. 357--><p class="noindent" >VIRTIO_CRYPTO_NOTSUPP: operation or algorithm is unsupported.
    </li>
    <li class="itemize">
    <!--l. 358--><p class="noindent" >VIRTIO_CRYPTO_INVSESS: invalid session ID when executing crypto
    operations.
    </li>
    <li class="itemize">
    <!--l. 359--><p class="noindent" >VIRTIO_CRYPTO_NOSPC:   no   free   session   ID   (only   when   the
    VIRTIO_CRYPTO_F_REVISION_1 feature bit is negotiated).
    </li>
    <li class="itemize">
    <!--l. 361--><p class="noindent" >VIRTIO_CRYPTO_KEY_REJECTED: signature verification failed (only
    when AKCIPHER verification).
    </li>
    <li class="itemize">
    <!--l. 362--><p class="noindent" >VIRTIO_CRYPTO_ERR: any failure not mentioned above occurs.</li></ul>
<a 
 id="x1-510011r522"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.2   </span> <a 
 id="x1-5110002"></a>Control Virtqueue</h5>
<!--l. 367--><p class="noindent" >The driver uses the control virtqueue to send control commands to the device, such
as session operations (See <a 
href="#x1-5120001">5.9.7.2.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation --></a>).
<!--l. 371--><p class="noindent" >The header for controlq is of the following form: <!--l. 372-->
<pre class="lstlisting" id="listing-182"><span class="label"><a 
 id="x1-511001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(((</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_ctrl_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_CREATE_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_CIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_DESTROY_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_CIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_CREATE_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_HASH</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_DESTROY_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_HASH</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_CREATE_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_MAC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_DESTROY_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_MAC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_CREATE_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AEAD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_DESTROY_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AEAD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_CREATE_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AKCIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x04</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511022r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_DESTROY_SESSION</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCDE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AKCIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x05</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">should</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algorithms</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flag</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511029r29"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 404--><p class="noindent" >The controlq request is composed of four parts: <!--l. 405-->
<pre class="lstlisting" id="listing-183"><span class="label"><a 
 id="x1-511030r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_op_ctrl_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511031r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511032r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511033r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_ctrl_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">header</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511034r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511035r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CTRLQ_OP_SPEC_HDR_LEGACY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">56</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511036r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fixed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511037r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_flf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flf_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511038r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511039r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">variable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511040r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_vlf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vlf_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511041r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511042r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511043r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511044r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">completion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511045r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_outcome</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">outcome_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-511046r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 425--><p class="noindent" ><span 
class="aeti-10">header </span>is a general header (see above).
<!--l. 427--><p class="noindent" ><span 
class="aeti-10">op_flf  </span>is the opcode (in <span 
class="aeti-10">header</span>) specific fixed-length parameters.
<!--l. 429--><p class="noindent" ><span 
class="aeti-10">flf_len </span>depends on the VIRTIO_CRYPTO_F_REVISION_1 feature bit (see
below).
<!--l. 431--><p class="noindent" ><span 
class="aeti-10">op_vlf  </span>is the opcode (in <span 
class="aeti-10">header</span>) specific variable-length parameters.
<!--l. 433--><p class="noindent" ><span 
class="aeti-10">vlf_len </span>is the size of the specific structure used.
<span 
class="aeb10-">Note:</span> The  <span 
class="aeti-10">vlf_len  </span>of  session-destroy  operation  and  the  hash-session-create
      operation is ZERO.
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 440--><p class="noindent" >If                 the                 opcode                 (in                 <span 
class="aeti-10">header</span>)
    is VIRTIO_CRYPTO_CIPHER_CREATE_SESSION then <span 
class="aeti-10">op_flf  </span>is struct
    virtio_crypto_sym_create_session_flf if VIRTIO_CRYPTO_F_REVISION_1
    is negotiated and struct virtio_crypto_sym_create_session_flf is padded to
    56     bytes     if     NOT     negotiated,     and     <span 
class="aeti-10">op_vlf     </span>is     struct
    virtio_crypto_sym_create_session_vlf.
    </li>
    <li class="itemize">
    <!--l. 445--><p class="noindent" >If                 the                 opcode                 (in                 <span 
class="aeti-10">header</span>)
    is  VIRTIO_CRYPTO_HASH_CREATE_SESSION  then  <span 
class="aeti-10">op_flf  </span>is  struct
    virtio_crypto_hash_create_session_flf if VIRTIO_CRYPTO_F_REVISION_1
    is negotiated and struct virtio_crypto_hash_create_session_flf is padded to
    56 bytes if NOT negotiated.
    </li>
    <li class="itemize">
    <!--l. 449--><p class="noindent" >If the opcode (in <span 
class="aeti-10">header</span>) is VIRTIO_CRYPTO_MAC_CREATE_SESSION
    then                         <span 
class="aeti-10">op_flf                        </span>is                         struct
    virtio_crypto_mac_create_session_flf if VIRTIO_CRYPTO_F_REVISION_1
    is negotiated and struct virtio_crypto_mac_create_session_flf is padded to
    56     bytes     if     NOT     negotiated,     and     <span 
class="aeti-10">op_vlf     </span>is     struct
    virtio_crypto_mac_create_session_vlf.
    </li>
    <li class="itemize">
    <!--l. 454--><p class="noindent" >If                 the                 opcode                 (in                 <span 
class="aeti-10">header</span>)
    is  VIRTIO_CRYPTO_AEAD_CREATE_SESSION  then  <span 
class="aeti-10">op_flf  </span>is  struct
    virtio_crypto_aead_create_session_flf if VIRTIO_CRYPTO_F_REVISION_1
    is negotiated and struct virtio_crypto_aead_create_session_flf is padded to
    56     bytes     if     NOT     negotiated,     and     <span 
class="aeti-10">op_vlf     </span>is     struct
    virtio_crypto_aead_create_session_vlf.
    </li>
    <li class="itemize">
    <!--l. 459--><p class="noindent" >If             the             opcode             (in             <span 
class="aeti-10">header</span>)             is
    VIRTIO_CRYPTO_AKCIPHER_CREATE_SESSION then <span 
class="aeti-10">op_flf </span>is struct
    virtio_crypto_akcipher_create_session_flf                                           if
    VIRTIO_CRYPTO_F_REVISION_1     is     negotiated     and     struct
    virtio_crypto_akcipher_create_session_flf  is  padded  to  56  bytes  if  NOT
    negotiated, and <span 
class="aeti-10">op_vlf  </span>is struct virtio_crypto_akcipher_create_session_vlf.
    </li>
    <li class="itemize">
    <!--l. 464--><p class="noindent" >If                                                                                           the
    opcode (in <span 
class="aeti-10">header</span>) is VIRTIO_CRYPTO_CIPHER_DESTROY_SESSION
    or              VIRTIO_CRYPTO_HASH_DESTROY_SESSION              or
    VIRTIO_CRYPTO_MAC_DESTROY_SESSION
    or VIRTIO_CRYPTO_AEAD_DESTROY_SESSION then <span 
class="aeti-10">op_flf  </span>is struct
                                                                  

                                                                  
    virtio_crypto_destroy_session_flf  if  VIRTIO_CRYPTO_F_REVISION_1  is
    negotiated and struct virtio_crypto_destroy_session_flf is padded to 56 bytes
    if NOT negotiated.</li></ul>
<!--l. 471--><p class="noindent" ><span 
class="aeti-10">op_outcome </span>stores the result of operation and must be struct virtio_crypto_destroy_session_input
for destroy session or struct virtio_crypto_create_session_input for create
session.
<!--l. 475--><p class="noindent" ><span 
class="aeti-10">outcome_len </span>is the size of the structure used.
<a 
 id="x1-511047r472"></a>
<!--l. 478--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.2.1</span> <a 
 id="x1-5120001"></a>Session operation</h5>
The session is a handle which describes the cryptographic parameters to be applied
to a number of buffers.
<!--l. 484--><p class="noindent" >The following structure stores the result of session creation set by the device:
<!--l. 486-->
<pre class="lstlisting" id="listing-184"><span class="label"><a 
 id="x1-512001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_create_session_input</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">session_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 494--><p class="noindent" >A request to destroy a session includes the following information:
<!--l. 496-->
<pre class="lstlisting" id="listing-185"><span class="label"><a 
 id="x1-512006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_destroy_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512007r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512008r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">session_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512009r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512010r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512011r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_destroy_session_input</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512012r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512013r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-512014r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-512015r431"></a>
<!--l. 509--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.1</span> <a 
 id="x1-5130001"></a>Session operation: HASH session</h6>
The fixed-length parameters of HASH session requests is as follows:
<!--l. 514-->
<pre class="lstlisting" id="listing-186"><span class="label"><a 
 id="x1-513001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_hash_create_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-513002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-513003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-513004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-513005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-513006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-513007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-513008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-513009r525"></a>
<!--l. 526--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.2</span> <a 
 id="x1-5140002"></a>Session operation: MAC session</h6>
The fixed-length and the variable-length parameters of MAC session requests are as
follows:
<!--l. 531-->
<pre class="lstlisting" id="listing-187"><span class="label"><a 
 id="x1-514001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_mac_create_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_mac_create_session_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-514018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
                                                                  

                                                                  
<!--l. 552--><p class="noindent" >The length of <span 
class="aeti-10">auth_key </span>is specified in <span 
class="aeti-10">auth_key_len </span>in the struct
virtio_crypto_mac_create_session_flf.
<a 
 id="x1-514019r526"></a>
<!--l. 556--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.3</span> <a 
 id="x1-5150003"></a>Session operation: Symmetric algorithms session</h6>
The request of symmetric session could be the CIPHER algorithms request or the
chain algorithms (chaining CIPHER and HASH/MAC) request.
<!--l. 562--><p class="noindent" >The fixed-length and the variable-length parameters of CIPHER session requests are
as follows:
<!--l. 564-->
<pre class="lstlisting" id="listing-188"><span class="label"><a 
 id="x1-515001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_cipher_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OP_ENCRYPT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OP_DECRYPT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">encryption</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">decryption</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_cipher_session_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 587--><p class="noindent" >The length of <span 
class="aeti-10">cipher_key </span>is specified in <span 
class="aeti-10">key_len </span>in the struct virtio_crypto_cipher_session_flf.
<!--l. 590--><p class="noindent" >The fixed-length and the variable-length parameters of Chain session requests are as
follows:
<!--l. 592-->
<pre class="lstlisting" id="listing-189"><span class="label"><a 
 id="x1-515021r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_alg_chain_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515022r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515023r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515024r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_ALG_CHAIN_ORDER_HASH_THEN_CIPHER</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515025r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_ALG_CHAIN_ORDER_CIPHER_THEN_HASH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515026r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">alg_chain_order</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515027r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Plain</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515028r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_HASH_MODE_PLAIN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515029r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mac</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515030r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_HASH_MODE_AUTH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515031r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Nested</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515032r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_HASH_MODE_NESTED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515033r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515034r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_cipher_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515035r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515036r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_ALG_CHAIN_SESS_OP_SPEC_HDR_SIZE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515037r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fixed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515038r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo_flf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_ALG_CHAIN_SESS_OP_SPEC_HDR_SIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515039r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515040r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AAD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515041r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515042r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515043r23"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515044r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515045r25"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_alg_chain_session_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515046r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515047r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515048r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515049r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515050r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515051r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515052r32"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 627--><p class="noindent" ><span 
class="aeti-10">hash_mode </span>decides the type used by <span 
class="aeti-10">algo_flf</span>.
<!--l. 629--><p class="noindent" ><span 
class="aeti-10">algo_flf  </span>is fixed to 16 bytes and MUST contains or be one of the following
types:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 632--><p class="noindent" >struct virtio_crypto_hash_create_session_flf
    </li>
    <li class="itemize">
    <!--l. 633--><p class="noindent" >struct virtio_crypto_mac_create_session_flf</li></ul>
<!--l. 635--><p class="noindent" >The data of unused part (if has) in <span 
class="aeti-10">algo_flf  </span>will be ignored.
<!--l. 637--><p class="noindent" >The length of <span 
class="aeti-10">cipher_key </span>is specified in <span 
class="aeti-10">key_len </span>in <span 
class="aeti-10">cipher_hdr</span>.
<!--l. 639--><p class="noindent" >The length of <span 
class="aeti-10">auth_key </span>is specified in <span 
class="aeti-10">auth_key_len </span>in struct virtio_crypto_mac_create_session_flf.
<!--l. 642--><p class="noindent" >The fixed-length parameters of Symmetric session requests are as follows:
<!--l. 644-->
<pre class="lstlisting" id="listing-190"><span class="label"><a 
 id="x1-515053r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_sym_create_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515054r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515055r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515056r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_SESS_OP_SPEC_HDR_SIZE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">48</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515057r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fixed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515058r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_flf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_SESS_OP_SPEC_HDR_SIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515059r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515060r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">No</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">operation</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515061r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_OP_NONE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515062r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">operation</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515063r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_OP_CIPHER</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515064r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Chain</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">any</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">any</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mac</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">operation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">order</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515065r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">depends</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">alg_chain_order</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">param</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515066r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_OP_ALGORITHM_CHAINING</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515067r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515068r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515069r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 664--><p class="noindent" ><span 
class="aeti-10">op_flf  </span>is fixed to 48 bytes, MUST contains or be one of the following types:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 667--><p class="noindent" >struct virtio_crypto_cipher_session_flf
    </li>
    <li class="itemize">
    <!--l. 668--><p class="noindent" >struct virtio_crypto_alg_chain_session_flf</li></ul>
<!--l. 670--><p class="noindent" >The data of unused part (if has) in <span 
class="aeti-10">op_flf  </span>will be ignored.
<!--l. 672--><p class="noindent" ><span 
class="aeti-10">op_type </span>decides the type used by <span 
class="aeti-10">op_flf</span>.
<!--l. 674--><p class="noindent" >The variable-length parameters of Symmetric session requests are as follows:
<!--l. 676-->
<pre class="lstlisting" id="listing-191"><span class="label"><a 
 id="x1-515070r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_sym_create_session_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515071r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515072r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">variable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515073r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_vlf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vlf_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-515074r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 684--><p class="noindent" ><span 
class="aeti-10">op_vlf  </span>MUST contains or be one of the following types:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 686--><p class="noindent" >struct virtio_crypto_cipher_session_vlf
    </li>
    <li class="itemize">
    <!--l. 687--><p class="noindent" >struct virtio_crypto_alg_chain_session_vlf</li></ul>
<!--l. 690--><p class="noindent" ><span 
class="aeti-10">op_type </span>in struct virtio_crypto_sym_create_session_flf decides the type used by
<span 
class="aeti-10">op_vlf</span>.
<!--l. 693--><p class="noindent" ><span 
class="aeti-10">vlf_len </span>is the size of the specific structure used.
<a 
 id="x1-515075r527"></a>
<!--l. 696--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.4</span> <a 
 id="x1-5160004"></a>Session operation: AEAD session</h6>
The fixed-length and the variable-length parameters of AEAD session requests are as
follows:
<!--l. 701-->
<pre class="lstlisting" id="listing-192"><span class="label"><a 
 id="x1-516001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_aead_create_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Authentication</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AAD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">encryption</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">decryption</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OP_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_aead_create_session_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-516020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 724--><p class="noindent" >The length of <span 
class="aeti-10">key </span>is specified in <span 
class="aeti-10">key_len </span>in struct virtio_crypto_aead_create_session_flf.
<a 
 id="x1-516021r528"></a>
<!--l. 727--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.5</span> <a 
 id="x1-5170005"></a>Session operation: AKCIPHER session</h6>
Due to the complexity of asymmetric key algorithms, different algorithms require
different parameters. The following data structures are used as supplementary
parameters to describe the asymmetric algorithm sessions.
                                                                  

                                                                  
<!--l. 734--><p class="noindent" >For the RSA algorithm, the extra parameters are as follows: <!--l. 735-->
<pre class="lstlisting" id="listing-193"><span class="label"><a 
 id="x1-517001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_rsa_session_para</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_RAW_PADDING</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_PKCS1_PADDING</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding_algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_NO_HASH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_MD2</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_MD3</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_MD4</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_MD5</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_SHA1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_SHA256</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_SHA384</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_SHA512</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_RSA_SHA224</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 755--><p class="noindent" ><span 
class="aeti-10">padding_algo </span>specifies the padding method used by RSA sessions.
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 757--><p class="noindent" >If VIRTIO_CRYPTO_RSA_RAW_PADDING is specified, 1) <span 
class="aeti-10">hash_algo </span>is
    ignored, 2) ciphertext and plaintext MUST be padded with leading zeros, 3)
    and RSA sessions with VIRTIO_CRYPTO_RSA_RAW_PADDING MUST
    not be used for verification and signing operations.
    </li>
    <li class="itemize">
    <!--l. 761--><p class="noindent" >If                                    VIRTIO_CRYPTO_RSA_PKCS1_PADDING
    is specified, EMSA-PKCS1-v1_5 padding method is used (see <a 
href="#x1-3020x19">PKCS#1</a>),
    <span 
class="aeti-10">hash_algo </span>specifies how the digest of the data passed to RSA sessions is
    calculated when verifying and signing. It only affects the padding algorithm
    and is ignored during encryption and decryption.</li></ul>
<!--l. 767--><p class="noindent" >The ECC algorithms such as the ECDSA algorithm, cannot use custom
curves, only the following known curves can be used (see <a 
href="#x1-3021x20">NIST-recommended
curves</a>).
<!--l. 770-->
<pre class="lstlisting" id="listing-194"><span class="label"><a 
 id="x1-517018r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CURVE_UNKNOWN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517019r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CURVE_NIST_P192</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517020r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CURVE_NIST_P224</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517021r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CURVE_NIST_P256</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517022r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CURVE_NIST_P384</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517023r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CURVE_NIST_P521</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span></pre>
<!--l. 779--><p class="noindent" >For the ECDSA algorithm, the extra parameters are as follows: <!--l. 780-->
<pre class="lstlisting" id="listing-195"><span class="label"><a 
 id="x1-517024r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_ecdsa_session_para</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517025r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CURVE_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517026r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">curve_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517027r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 787--><p class="noindent" >The fixed-length and the variable-length parameters of AKCIPHER session requests
are as follows: <!--l. 788-->
<pre class="lstlisting" id="listing-196"><span class="label"><a 
 id="x1-517028r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_akcipher_create_session_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517029r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517030r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517031r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517032r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517033r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_KEY_TYPE_PUBLIC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517034r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_KEY_TYPE_PRIVATE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517035r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517036r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517037r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517038r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517039r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_SESS_ALGO_SPEC_HDR_SIZE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">44</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517040r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo_flf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_SESS_ALGO_SPEC_HDR_SIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517041r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517042r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517043r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_akcipher_create_session_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517044r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517045r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517046r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 810--><p class="noindent" ><span 
class="aeti-10">algo </span>decides the type used by <span 
class="aeti-10">algo_flf</span>. <span 
class="aeti-10">algo_flf  </span>is fixed to 44 bytes and MUST
contains of be one the following structures:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 814--><p class="noindent" >struct virtio_crypto_rsa_session_para
    </li>
    <li class="itemize">
    <!--l. 815--><p class="noindent" >struct virtio_crypto_ecdsa_session_para</li></ul>
                                                                  

                                                                  
<!--l. 818--><p class="noindent" >The length of <span 
class="aeti-10">key </span>is specified in <span 
class="aeti-10">key_len </span>in the struct virtio_crypto_akcipher_create_session_flf.
<!--l. 821--><p class="noindent" >For the RSA algorithm, the key needs to be encoded according to <a 
href="#x1-3020x19">PKCS#1</a>. The
private key is described with the RSAPrivateKey structure, and the public key is
described with the RSAPublicKey structure. These ASN.1 structures are encoded in
DER encoding rules (see <a 
href="#x1-3023x22">rfc6025</a>).
<!--l. 827-->
<pre class="lstlisting" id="listing-197"><span class="label"><a 
 id="x1-517047r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RSAPrivateKey</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">::=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SEQUENCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517048r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">version</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517049r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">modulus</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517050r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">publicExponent</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517051r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">privateExponent</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517052r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">prime1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517053r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">prime2</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517054r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">exponent1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517055r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">exponent1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517056r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">coefficient</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517057r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">otherPrimeInfos</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OtherPrimeInfos</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OPTIONAL</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517058r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517059r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517060r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OtherPrimeInfos</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">::=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SEQUENCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1...</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">MAX</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OtherPrimeInfo</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517061r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517062r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OtherPrimeINfo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">::=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SEQUENCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517063r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">prime</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517064r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">exponent</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517065r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">coefficient</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517066r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517067r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517068r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RSAPublicKey</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">::=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SEQUENCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517069r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">modulus</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517070r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">publicExponent</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517071r25"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<!--l. 855--><p class="noindent" >For the ECDSA algorithm, the private key is encoded according to <a 
href="#x1-3022x21">RFC5915</a>, the
private key of the ECDSA algorithm is described by the ASN.1 structure
ECPrivateKey and encoded with DER encoding rules (see <a 
href="#x1-3023x22">rfc6025</a>).
<!--l. 860-->
<pre class="lstlisting" id="listing-198"><span class="label"><a 
 id="x1-517072r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ECPrivateKey</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">::=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SEQUNCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517073r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">version</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517074r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">privateKey</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OCTET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">STRING</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517075r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parameters</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[0]</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ECParameters</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{{</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">NamedCurve</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OPTIONAL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517076r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">publicKey</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[1]</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BIT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">STRING</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OPTIONAL</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-517077r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<!--l. 869--><p class="noindent" >The public key of the ECDSA algorithm is encoded according to <a 
href="#x1-3025x24">SEC1</a>, and the
public key of ECDSA is described by the ASN.1 structure ECPoint. When initializing
a session with ECDSA public key, the ECPoint is DER encoded and the <span 
class="aeti-10">key </span>only
contains the value part of ECPoint, that is, the header part of the OCTET STRING
will be omitted (see <a 
href="#x1-3023x22">rfc6025</a>).
<!--l. 875-->
<pre class="lstlisting" id="listing-199"><span class="label"><a 
 id="x1-517078r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ECPoint</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">::=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OCTET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">STRING</span></span></pre>
<!--l. 879--><p class="noindent" >The length of <span 
class="aeti-10">key </span>is specified in <span 
class="aeti-10">key_len </span>in struct virtio_crypto_akcipher_create_session_flf.
<a 
 id="x1-517079r529"></a>
<!--l. 883--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.6</span> <a 
 id="x1-5180006"></a>Driver Requirements: Session operation: create session</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 886--><p class="noindent" >The driver MUST set the <span 
class="aeti-10">opcode </span>field based on service type: CIPHER,
    HASH, MAC, AEAD or AKCIPHER.
    </li>
    <li class="itemize">
    <!--l. 887--><p class="noindent" >The  driver  MUST  set  the  control  general  header,  the  opcode  specific
    header,  the  opcode  specific  extra  parameters  and  the  opcode  specific
    outcome buffer in turn. See <a 
href="#x1-5110002">5.9.7.2<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue --></a>.
    </li>
    <li class="itemize">
    <!--l. 890--><p class="noindent" >The driver MUST set the <span 
class="aeti-10">reversed </span>field to zero.</li></ul>
<a 
 id="x1-518001r530"></a>
                                                                  

                                                                  
<!--l. 894--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.7</span> <a 
 id="x1-5190007"></a>Device Requirements: Session operation: create session</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 897--><p class="noindent" >The  device  MUST  use  the  corresponding  opcode  specific  structure
    according to the <span 
class="aeti-10">opcode </span>in the control general header.
    </li>
    <li class="itemize">
    <!--l. 899--><p class="noindent" >The device MUST extract extra parameters according to the structures
    used.
    </li>
    <li class="itemize">
    <!--l. 900--><p class="noindent" >The device MUST set the <span 
class="aeti-10">status </span>field to one of the following values of enum
    VIRTIO_CRYPTO_STATUS after finish a session creation:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 903--><p class="noindent" >VIRTIO_CRYPTO_OK if a session is created successfully.
        </li>
        <li class="itemize">
        <!--l. 904--><p class="noindent" >VIRTIO_CRYPTO_NOTSUPP if the requested algorithm or operation
        is unsupported.
        </li>
        <li class="itemize">
        <!--l. 905--><p class="noindent" >VIRTIO_CRYPTO_NOSPC  if  no  free  session  ID  (only  when  the
        VIRTIO_CRYPTO_F_REVISION_1 feature bit is negotiated).
        </li>
        <li class="itemize">
        <!--l. 907--><p class="noindent" >VIRTIO_CRYPTO_ERR if failure not mentioned above occurs.</li></ul>
    </li>
    <li class="itemize">
    <!--l. 909--><p class="noindent" >The device MUST set the <span 
class="aeti-10">session_id </span>field to a unique session identifier only if
    the status is set to VIRTIO_CRYPTO_OK.</li></ul>
<a 
 id="x1-519001r531"></a>
<!--l. 914--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.8</span> <a 
 id="x1-5200008"></a>Driver Requirements: Session operation: destroy session</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 917--><p class="noindent" >The driver MUST set the <span 
class="aeti-10">opcode </span>field based on service type: CIPHER,
    HASH, MAC, AEAD or AKCIPHER.
    </li>
    <li class="itemize">
    <!--l. 918--><p class="noindent" >The driver MUST set the <span 
class="aeti-10">session_id </span>to a valid value assigned by the device
    when the session was created.</li></ul>
<a 
 id="x1-520001r532"></a>
                                                                  

                                                                  
<!--l. 923--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.9.7.2.1.9</span> <a 
 id="x1-5210009"></a>Device Requirements: Session operation: destroy session</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 926--><p class="noindent" >The device MUST set the <span 
class="aeti-10">status </span>field to one of the following values of enum
    VIRTIO_CRYPTO_STATUS.
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 928--><p class="noindent" >VIRTIO_CRYPTO_OK if a session is created successfully.
        </li>
        <li class="itemize">
        <!--l. 929--><p class="noindent" >VIRTIO_CRYPTO_ERR if any failure occurs.</li></ul>
    </li></ul>
<a 
 id="x1-521001r523"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.3   </span> <a 
 id="x1-5220003"></a>Data Virtqueue</h5>
<!--l. 936--><p class="noindent" >The driver uses the data virtqueues to transmit crypto operation requests to the
device, and completes the crypto operations.
<!--l. 939--><p class="noindent" >The header for dataq is as follows:
<!--l. 941-->
<pre class="lstlisting" id="listing-200"><span class="label"><a 
 id="x1-522001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_op_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_ENCRYPT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_CIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER_DECRYPT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_CIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x01</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_HASH</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_MAC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_ENCRYPT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AEAD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_DECRYPT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AEAD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x01</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_ENCRYPT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AKCIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_DECRYPT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AKCIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x01</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_SIGN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AKCIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_VERIFY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' </span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OPCODE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SERVICE_AKCIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">should</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">service</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algorithms</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">session_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522026r26"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_FLAG_SESSION_MODE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flag</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flag</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522030r30"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<span 
class="aeb10-">Note:</span> If  VIRTIO_CRYPTO_F_REVISION_1  is  not  negotiated  the  <span 
class="aeti-10">flag  </span>is
      ignored.
      <!--l. 977--><p class="noindent" >If          VIRTIO_CRYPTO_F_REVISION_1          is          negotiated
      but   VIRTIO_CRYPTO_F_<SERVICE>_STATELESS_MODE   is   not
      negotiated,  then  the  device  SHOULD  reject  <SERVICE>  requests  if
      VIRTIO_CRYPTO_FLAG_SESSION_MODE is not set (in <span 
class="aeti-10">flag</span>).
<!--l. 982--><p class="noindent" >The dataq request is composed of four parts: <!--l. 983-->
<pre class="lstlisting" id="listing-201"><span class="label"><a 
 id="x1-522031r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_op_data_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522032r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522033r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522034r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_op_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">header</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522035r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522036r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_DATAQ_OP_SPEC_HDR_LEGACY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">48</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522037r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fixed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522038r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_flf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flf_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522039r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522040r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;&amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522041r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">variable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">opcode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522042r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_vlf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vlf_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522043r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522044r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522045r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_inhdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">inhdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522046r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1002--><p class="noindent" ><span 
class="aeti-10">header </span>is a general header (see above).
<!--l. 1004--><p class="noindent" ><span 
class="aeti-10">op_flf  </span>is the opcode (in <span 
class="aeti-10">header</span>) specific header.
<!--l. 1006--><p class="noindent" ><span 
class="aeti-10">flf_len </span>depends on the VIRTIO_CRYPTO_F_REVISION_1 feature bit (see
below).
<!--l. 1009--><p class="noindent" ><span 
class="aeti-10">op_vlf  </span>is the opcode (in <span 
class="aeti-10">header</span>) specific parameters.
<!--l. 1011--><p class="noindent" ><span 
class="aeti-10">vlf_len </span>is the size of the specific structure used.
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1014--><p class="noindent" >If the the opcode (in <span 
class="aeti-10">header</span>) is VIRTIO_CRYPTO_CIPHER_ENCRYPT or
    VIRTIO_CRYPTO_CIPHER_DECRYPT then:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1017--><p class="noindent" >If VIRTIO_CRYPTO_F_CIPHER_STATELESS_MODE is negotiated,
        <span 
class="aeti-10">op_flf </span>is struct virtio_crypto_sym_data_flf_stateless, and <span 
class="aeti-10">op_vlf </span>is struct
        virtio_crypto_sym_data_vlf_stateless.
        </li>
        <li class="itemize">
        <!--l. 1020--><p class="noindent" >If                   VIRTIO_CRYPTO_F_CIPHER_STATELESS_MODE
        is   NOT   negotiated,   <span 
class="aeti-10">op_flf   </span>is   struct   virtio_crypto_sym_data_flf
        if   VIRTIO_CRYPTO_F_REVISION_1   is   negotiated   and   struct
        virtio_crypto_sym_data_flf is padded to 48 bytes if NOT negotiated,
        and <span 
class="aeti-10">op_vlf  </span>is struct virtio_crypto_sym_data_vlf.</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1025--><p class="noindent" >If the the opcode (in <span 
class="aeti-10">header</span>) is VIRTIO_CRYPTO_HASH:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1027--><p class="noindent" >If  VIRTIO_CRYPTO_F_HASH_STATELESS_MODE  is  negotiated,
        <span 
class="aeti-10">op_flf  </span>is  struct  virtio_crypto_hash_data_flf_stateless,  and  <span 
class="aeti-10">op_vlf  </span>is
        struct virtio_crypto_hash_data_vlf_stateless.
        </li>
        <li class="itemize">
        <!--l. 1030--><p class="noindent" >If                       VIRTIO_CRYPTO_F_HASH_STATELESS_MODE
        is   NOT   negotiated,   <span 
class="aeti-10">op_flf   </span>is   struct   virtio_crypto_hash_data_flf
        if   VIRTIO_CRYPTO_F_REVISION_1   is   negotiated   and   struct
        virtio_crypto_hash_data_flf is padded to 48 bytes if NOT negotiated,
        and <span 
class="aeti-10">op_vlf  </span>is struct virtio_crypto_hash_data_vlf.</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1035--><p class="noindent" >If the the opcode (in <span 
class="aeti-10">header</span>) is VIRTIO_CRYPTO_MAC:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1037--><p class="noindent" >If   VIRTIO_CRYPTO_F_MAC_STATELESS_MODE   is   negotiated,
        <span 
class="aeti-10">op_flf   </span>is  struct  virtio_crypto_mac_data_flf_stateless,  and  <span 
class="aeti-10">op_vlf   </span>is
        struct virtio_crypto_mac_data_vlf_stateless.
        </li>
        <li class="itemize">
        <!--l. 1040--><p class="noindent" >If                        VIRTIO_CRYPTO_F_MAC_STATELESS_MODE
        is   NOT   negotiated,   <span 
class="aeti-10">op_flf   </span>is   struct   virtio_crypto_mac_data_flf
        if   VIRTIO_CRYPTO_F_REVISION_1   is   negotiated   and   struct
        virtio_crypto_mac_data_flf is padded to 48 bytes if NOT negotiated,
        and <span 
class="aeti-10">op_vlf  </span>is struct virtio_crypto_mac_data_vlf.</li></ul>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 1045--><p class="noindent" >If the the opcode (in <span 
class="aeti-10">header</span>) is VIRTIO_CRYPTO_AEAD_ENCRYPT or
    VIRTIO_CRYPTO_AEAD_DECRYPT then:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1048--><p class="noindent" >If  VIRTIO_CRYPTO_F_AEAD_STATELESS_MODE  is  negotiated,
        <span 
class="aeti-10">op_flf  </span>is  struct  virtio_crypto_aead_data_flf_stateless,  and  <span 
class="aeti-10">op_vlf  </span>is
        struct virtio_crypto_aead_data_vlf_stateless.
        </li>
        <li class="itemize">
        <!--l. 1051--><p class="noindent" >If                      VIRTIO_CRYPTO_F_AEAD_STATELESS_MODE
        is   NOT   negotiated,   <span 
class="aeti-10">op_flf   </span>is   struct   virtio_crypto_aead_data_flf
        if   VIRTIO_CRYPTO_F_REVISION_1   is   negotiated   and   struct
        virtio_crypto_aead_data_flf is padded to 48 bytes if NOT negotiated,
        and <span 
class="aeti-10">op_vlf  </span>is struct virtio_crypto_aead_data_vlf.</li></ul>
    </li>
    <li class="itemize">
    <!--l. 1056--><p class="noindent" >If the opcode (in <span 
class="aeti-10">header</span>) is VIRTIO_CRYPTO_AKCIPHER_ENCRYPT,
    VIRTIO_CRYPTO_AKCIPHER_DECRYPT, VIRTIO_CRYPTO_AKCIPHER_SIGN
    or VIRTIO_CRYPTO_AKCIPHER_VERIFY then:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1059--><p class="noindent" >If               VIRTIO_CRYPTO_F_AKCIPHER_STATELESS_MODE
        is negotiated, <span 
class="aeti-10">op_flf  </span>is struct virtio_crypto_akcipher_data_flf_statless,
        and <span 
class="aeti-10">op_vlf  </span>is struct virtio_crypto_akcipher_data_vlf_stateless.
        </li>
        <li class="itemize">
        <!--l. 1062--><p class="noindent" >If               VIRTIO_CRYPTO_F_AKCIPHER_STATELESS_MODE
        is  NOT  negotiated,  <span 
class="aeti-10">op_flf  </span>is  struct  virtio_crypto_akcipher_data_flf
        if   VIRTIO_CRYPTO_F_REVISION_1   is   negotiated   and   struct
        virtio_crypto_akcipher_data_flf   is   padded   to   48   bytes   if   NOT
        negotiated, and <span 
class="aeti-10">op_vlf  </span>is struct virtio_crypto_akcipher_data_vlf.</li></ul>
    </li></ul>
<!--l. 1069--><p class="noindent" ><span 
class="aeti-10">inhdr </span>is a unified input header that used to return the status of the operations, is
defined as follows:
<!--l. 1072-->
<pre class="lstlisting" id="listing-202"><span class="label"><a 
 id="x1-522047r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_inhdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522048r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-522049r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-522050r534"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.4   </span> <a 
 id="x1-5230004"></a>HASH Service Operation</h5>
<!--l. 1080--><p class="noindent" >Session mode HASH service requests are as follows:
                                                                  

                                                                  
<!--l. 1082-->
<pre class="lstlisting" id="listing-203"><span class="label"><a 
 id="x1-523001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_hash_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_hash_data_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1101--><p class="noindent" >Each data request uses the virtio_crypto_hash_data_flf structure and the
virtio_crypto_hash_data_vlf structure to store information used to run the HASH
operations.
<!--l. 1105--><p class="noindent" ><span 
class="aeti-10">src_data </span>is the source data that will be processed. <span 
class="aeti-10">src_data_len </span>is the length of
source data. <span 
class="aeti-10">hash_result </span>is the result data and <span 
class="aeti-10">hash_result_len </span>is the length of
it.
<!--l. 1110--><p class="noindent" >Stateless mode HASH service requests are as follows:
<!--l. 1112-->
<pre class="lstlisting" id="listing-204"><span class="label"><a 
 id="x1-523017r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_hash_data_flf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523018r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523019r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523020r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523021r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sess_para</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523022r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523023r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523024r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523025r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523026r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523027r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523028r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523029r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_hash_data_vlf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523030r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523031r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523032r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523033r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523034r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523035r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523036r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-523037r21"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-523038r524"></a>
<!--l. 1136--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.4.1</span> <a 
 id="x1-5240001"></a>Driver Requirements: HASH Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1139--><p class="noindent" >If the driver uses the session mode, then the driver MUST set <span 
class="aeti-10">session_id</span>
    in struct virtio_crypto_op_header to a valid value assigned by the device
    when the session was created.
    </li>
    <li class="itemize">
    <!--l. 1142--><p class="noindent" >If  the  VIRTIO_CRYPTO_F_HASH_STATELESS_MODE  feature  bit  is
    negotiated, 1) if the driver uses the stateless mode, then the driver MUST
    set the <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header to ZERO and MUST set
    the fields in struct virtio_crypto_hash_data_flf_stateless.sess_para, 2) if the
    driver                uses                the                session                mode,
    then the driver MUST set the <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header
    to VIRTIO_CRYPTO_FLAG_SESSION_MODE.
    </li>
    <li class="itemize">
    <!--l. 1148--><p class="noindent" >The  driver  MUST  set  <span 
class="aeti-10">opcode  </span>in  struct  virtio_crypto_op_header  to
    VIRTIO_CRYPTO_HASH.</li></ul>
<a 
 id="x1-524001r536"></a>
<!--l. 1151--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.4.2</span> <a 
 id="x1-5250002"></a>Device Requirements: HASH Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1154--><p class="noindent" >The device MUST use the corresponding structure according to the <span 
class="aeti-10">opcode</span>
    in the data general header.
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 1156--><p class="noindent" >If            the            VIRTIO_CRYPTO_F_HASH_STATELESS_MODE
    feature  bit  is  negotiated,  the  device  MUST  parse  <span 
class="aeti-10">flag  </span>field  in  struct
    virtio_crypto_op_header in order to decide which mode the driver uses.
    </li>
    <li class="itemize">
    <!--l. 1159--><p class="noindent" >The device MUST copy the results of HASH operations in the hash_result[]
    if HASH operations success.
    </li>
    <li class="itemize">
    <!--l. 1161--><p class="noindent" >The device MUST set <span 
class="aeti-10">status </span>in struct virtio_crypto_inhdr to one of the following
    values of enum VIRTIO_CRYPTO_STATUS:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1164--><p class="noindent" >VIRTIO_CRYPTO_OK if the operation success.
        </li>
        <li class="itemize">
        <!--l. 1165--><p class="noindent" >VIRTIO_CRYPTO_NOTSUPP if the requested algorithm or operation
        is unsupported.
        </li>
        <li class="itemize">
        <!--l. 1166--><p class="noindent" >VIRTIO_CRYPTO_INVSESS if the session ID invalid when in session
        mode.
        </li>
        <li class="itemize">
        <!--l. 1167--><p class="noindent" >VIRTIO_CRYPTO_ERR if any failure not mentioned above occurs.</li></ul>
    </li></ul>
<a 
 id="x1-525001r535"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.5   </span> <a 
 id="x1-5260005"></a>MAC Service Operation</h5>
<!--l. 1174--><p class="noindent" >Session mode MAC service requests are as follows:
<!--l. 1176-->
<pre class="lstlisting" id="listing-205"><span class="label"><a 
 id="x1-526001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_mac_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_hash_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_mac_data_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1192--><p class="noindent" >Each request uses the virtio_crypto_mac_data_flf structure and the
virtio_crypto_mac_data_vlf structure to store information used to run the MAC
operations.
<!--l. 1196--><p class="noindent" ><span 
class="aeti-10">src_data </span>is the source data that will be processed. <span 
class="aeti-10">src_data_len </span>is the length of
source data. <span 
class="aeti-10">hash_result </span>is the result data and <span 
class="aeti-10">hash_result_len </span>is the length of
it.
<!--l. 1201--><p class="noindent" >Stateless mode MAC service requests are as follows:
<!--l. 1203-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-206"><span class="label"><a 
 id="x1-526014r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_mac_data_flf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526015r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526016r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526017r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526018r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526019r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526020r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sess_para</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526021r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526022r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526023r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526024r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526025r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526026r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526027r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526028r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_mac_data_vlf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526029r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526030r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526031r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526032r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526033r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526034r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526035r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526036r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526037r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-526038r25"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1231--><p class="noindent" ><span 
class="aeti-10">auth_key </span>is the authenticated key that will be used during the process. <span 
class="aeti-10">auth_key_len</span>
is the length of the key.
<a 
 id="x1-526039r537"></a>
<!--l. 1234--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.5.1</span> <a 
 id="x1-5270001"></a>Driver Requirements: MAC Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1237--><p class="noindent" >If the driver uses the session mode, then the driver MUST set <span 
class="aeti-10">session_id</span>
    in struct virtio_crypto_op_header to a valid value assigned by the device
    when the session was created.
    </li>
    <li class="itemize">
    <!--l. 1240--><p class="noindent" >If  the  VIRTIO_CRYPTO_F_MAC_STATELESS_MODE  feature  bit  is
    negotiated, 1) if the driver uses the stateless mode, then the driver MUST
    set the <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header to ZERO and MUST set
    the fields in struct virtio_crypto_mac_data_flf_stateless.sess_para, 2) if the
    driver                uses                the                session                mode,
    then the driver MUST set the <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header
    to VIRTIO_CRYPTO_FLAG_SESSION_MODE.
    </li>
    <li class="itemize">
    <!--l. 1246--><p class="noindent" >The  driver  MUST  set  <span 
class="aeti-10">opcode  </span>in  struct  virtio_crypto_op_header  to
    VIRTIO_CRYPTO_MAC.</li></ul>
<a 
 id="x1-527001r539"></a>
<!--l. 1249--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.5.2</span> <a 
 id="x1-5280002"></a>Device Requirements: MAC Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1252--><p class="noindent" >If             the             VIRTIO_CRYPTO_F_MAC_STATELESS_MODE
    feature  bit  is  negotiated,  the  device  MUST  parse  <span 
class="aeti-10">flag  </span>field  in  struct
    virtio_crypto_op_header in order to decide which mode the driver uses.
    </li>
    <li class="itemize">
    <!--l. 1255--><p class="noindent" >The device MUST copy the results of MAC operations in the hash_result[]
    if HASH operations success.
    </li>
    <li class="itemize">
    <!--l. 1257--><p class="noindent" >The device MUST set <span 
class="aeti-10">status </span>in struct virtio_crypto_inhdr to one of the following
    values of enum VIRTIO_CRYPTO_STATUS:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1260--><p class="noindent" >VIRTIO_CRYPTO_OK if the operation success.
                                                                  

                                                                  
        </li>
        <li class="itemize">
        <!--l. 1261--><p class="noindent" >VIRTIO_CRYPTO_NOTSUPP if the requested algorithm or operation
        is unsupported.
        </li>
        <li class="itemize">
        <!--l. 1262--><p class="noindent" >VIRTIO_CRYPTO_INVSESS if the session ID invalid when in session
        mode.
        </li>
        <li class="itemize">
        <!--l. 1263--><p class="noindent" >VIRTIO_CRYPTO_ERR if any failure not mentioned above occurs.</li></ul>
    </li></ul>
<a 
 id="x1-528001r538"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.6   </span> <a 
 id="x1-5290006"></a>Symmetric algorithms Operation</h5>
<!--l. 1269--><p class="noindent" >Session mode CIPHER service requests are as follows:
<!--l. 1271-->
<pre class="lstlisting" id="listing-207"><span class="label"><a 
 id="x1-529001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_cipher_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">valid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pointed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">below</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ciphers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CBC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">F8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Kasumi</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">F8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SNOW3G</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">UEA2</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">which</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">must</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">same</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ciphers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CTR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">counter</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">which</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">must</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">same</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529019r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_cipher_data_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Initialization</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ciphers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CBC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">F8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Kasumi</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">F8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SNOW3G</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">UEA2</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Initialization</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ciphers</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CTR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">counter</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AES</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">XTS</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">128</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bit</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tweak</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">i</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IEEE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Std</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1619-2007.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">will</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">updated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">after</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">every</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">partial</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cryptographic</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">operation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529041r41"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1315--><p class="noindent" >Session mode requests of algorithm chaining are as follows:
<!--l. 1317-->
<pre class="lstlisting" id="listing-208"><span class="label"><a 
 id="x1-529042r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_alg_chain_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529043r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529044r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529045r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529046r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529047r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529048r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">point</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">processing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529049r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_start_src_offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529050r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">will</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">computed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529051r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len_to_cipher</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529052r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">point</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">processing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529053r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_start_src_offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529054r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">will</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">computed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529055r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len_to_hash</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529056r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529057r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529058r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529059r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529060r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529061r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529062r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529063r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_alg_chain_data_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529064r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529065r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529066r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Initialization</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529067r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529068r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529069r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529070r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">exists</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529071r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529072r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529073r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529074r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529075r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529076r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529077r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529078r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529079r38"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1358--><p class="noindent" >Session mode requests of symmetric algorithm are as follows:
<!--l. 1360-->
<pre class="lstlisting" id="listing-209"><span class="label"><a 
 id="x1-529080r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_sym_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529081r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529082r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529083r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_DATA_REQ_HDR_SIZE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">40</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529084r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_type_flf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_DATA_REQ_HDR_SIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529085r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529086r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_OP_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529087r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529088r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529089r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529090r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529091r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_sym_data_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529092r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_type_vlf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sym_para_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529093r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1377--><p class="noindent" >Each request uses the virtio_crypto_sym_data_flf structure and the
virtio_crypto_sym_data_flf structure to store information used to run the CIPHER
operations.
<!--l. 1381--><p class="noindent" ><span 
class="aeti-10">op_type_flf  </span>is the <span 
class="aeti-10">op_type </span>specific header, it MUST starts with or be one of the
following structures:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1384--><p class="noindent" >struct virtio_crypto_cipher_data_flf
    </li>
    <li class="itemize">
    <!--l. 1385--><p class="noindent" >struct virtio_crypto_alg_chain_data_flf</li></ul>
<!--l. 1388--><p class="noindent" >The length of <span 
class="aeti-10">op_type_flf </span>is fixed to 40 bytes, the data of unused part (if has) will be
ignored.
                                                                  

                                                                  
<!--l. 1391--><p class="noindent" ><span 
class="aeti-10">op_type_vlf </span>is the <span 
class="aeti-10">op_type </span>specific parameters, it MUST starts with or be one of the
following structures:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1394--><p class="noindent" >struct virtio_crypto_cipher_data_vlf
    </li>
    <li class="itemize">
    <!--l. 1395--><p class="noindent" >struct virtio_crypto_alg_chain_data_vlf</li></ul>
<!--l. 1398--><p class="noindent" ><span 
class="aeti-10">sym_para_len </span>is the size of the specific structure used.
<!--l. 1400--><p class="noindent" >Stateless mode CIPHER service requests are as follows:
<!--l. 1402-->
<pre class="lstlisting" id="listing-210"><span class="label"><a 
 id="x1-529094r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_cipher_data_flf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529095r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529096r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529097r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529098r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529099r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529100r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529101r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OP_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529102r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529103r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sess_para</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529104r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529105r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529106r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">valid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pointed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">below</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529107r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529108r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529109r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529110r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529111r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529112r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529113r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529114r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529115r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_cipher_data_vlf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529116r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529117r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529118r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529119r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529120r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529121r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Initialization</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529122r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529123r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529124r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529125r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529126r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529127r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529128r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529129r36"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1441--><p class="noindent" >Stateless mode requests of algorithm chaining are as follows:
<!--l. 1443-->
<pre class="lstlisting" id="listing-211"><span class="label"><a 
 id="x1-529130r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_alg_chain_data_flf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529131r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529132r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_ALG_CHAIN_ORDER_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529133r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">alg_chain_order</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529134r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529135r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529136r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529137r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529138r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_CIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529139r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529140r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529141r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529142r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OP_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529143r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529144r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529145r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529146r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529147r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_HASH_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_MAC_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529148r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529149r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529150r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529151r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_HASH_MODE_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529152r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529153r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529154r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sess_para</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529155r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529156r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529157r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529158r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529159r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529160r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529161r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">point</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">processing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529162r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_start_src_offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529163r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">will</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">computed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529164r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len_to_cipher</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529165r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">point</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">processing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529166r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_start_src_offset</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529167r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">will</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">computed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529168r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len_to_hash</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529169r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529170r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529171r42"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529172r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529173r44"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529174r45"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529175r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529176r47"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_alg_chain_data_vlf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529177r48"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529178r49"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529179r50"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529180r51"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529181r52"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529182r53"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth_key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529183r54"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Initialization</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529184r55"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529185r56"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">exists</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529186r57"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529187r58"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529188r59"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529189r60"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529190r61"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529191r62"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529192r63"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529193r64"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529194r65"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Hash</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529195r66"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hash_result_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529196r67"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1513--><p class="noindent" >Stateless mode requests of symmetric algorithm are as follows:
<!--l. 1515-->
<pre class="lstlisting" id="listing-212"><span class="label"><a 
 id="x1-529197r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_sym_data_flf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529198r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529199r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_DATE_REQ_HDR_STATELESS_SIZE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">72</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529200r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_type_flf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_DATE_REQ_HDR_STATELESS_SIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529201r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529202r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529203r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_SYM_OP_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529204r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529205r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529206r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529207r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_sym_data_vlf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529208r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op_type_vlf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sym_para_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-529209r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1531--><p class="noindent" ><span 
class="aeti-10">op_type_flf  </span>is the <span 
class="aeti-10">op_type </span>specific header, it MUST starts with or be one of the
following structures:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1534--><p class="noindent" >struct virtio_crypto_cipher_data_flf_stateless
    </li>
    <li class="itemize">
    <!--l. 1535--><p class="noindent" >struct virtio_crypto_alg_chain_data_flf_stateless</li></ul>
<!--l. 1538--><p class="noindent" >The length of <span 
class="aeti-10">op_type_flf </span>is fixed to 72 bytes, the data of unused part (if has) will be
ignored.
<!--l. 1541--><p class="noindent" ><span 
class="aeti-10">op_type_vlf </span>is the <span 
class="aeti-10">op_type </span>specific parameters, it MUST starts with or be one of the
following structures:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1544--><p class="noindent" >struct virtio_crypto_cipher_data_vlf_stateless
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 1545--><p class="noindent" >struct virtio_crypto_alg_chain_data_vlf_stateless</li></ul>
<!--l. 1548--><p class="noindent" ><span 
class="aeti-10">sym_para_len </span>is the size of the specific structure used.
<a 
 id="x1-529210r540"></a>
<!--l. 1550--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.6.1</span> <a 
 id="x1-5300001"></a>Driver Requirements: Symmetric algorithms Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1553--><p class="noindent" >If the driver uses the session mode, then the driver MUST set <span 
class="aeti-10">session_id</span>
    in struct virtio_crypto_op_header to a valid value assigned by the device
    when the session was created.
    </li>
    <li class="itemize">
    <!--l. 1556--><p class="noindent" >If the VIRTIO_CRYPTO_F_CIPHER_STATELESS_MODE feature bit is
    negotiated, 1) if the driver uses the stateless mode, then the driver MUST
    set the <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header to ZERO and MUST
    set the fields in struct virtio_crypto_cipher_data_flf_stateless.sess_para or
    struct virtio_crypto_alg_chain_data_flf_stateless.sess_para, 2) if the driver
    uses the session mode, then the driver MUST set the <span 
class="aeti-10">flag </span>field in struct
    virtio_crypto_op_header to VIRTIO_CRYPTO_FLAG_SESSION_MODE.
    </li>
    <li class="itemize">
    <!--l. 1563--><p class="noindent" >The driver MUST set the <span 
class="aeti-10">opcode </span>field in struct virtio_crypto_op_header to
    VIRTIO_CRYPTO_CIPHER_ENCRYPT                                        or
    VIRTIO_CRYPTO_CIPHER_DECRYPT.
    </li>
    <li class="itemize">
    <!--l. 1565--><p class="noindent" >The driver MUST specify the fields of struct virtio_crypto_cipher_data_flf in
    struct virtio_crypto_sym_data_flf and struct virtio_crypto_cipher_data_vlf
    in   struct   virtio_crypto_sym_data_vlf   if   the   request   is   based   on
    VIRTIO_CRYPTO_SYM_OP_CIPHER.
    </li>
    <li class="itemize">
    <!--l. 1568--><p class="noindent" >The         driver         MUST         specify         the         fields         of
    struct virtio_crypto_alg_chain_data_flf in struct virtio_crypto_sym_data_flf
    and                                                                                    struct
    virtio_crypto_alg_chain_data_vlf in struct virtio_crypto_sym_data_vlf if the
    request is of the VIRTIO_CRYPTO_SYM_OP_ALGORITHM_CHAINING
    type.</li></ul>
<a 
 id="x1-530001r542"></a>
<!--l. 1574--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.6.2</span> <a 
 id="x1-5310002"></a>Device Requirements: Symmetric algorithms Operation</h5>
    <ul class="itemize1">
                                                                  

                                                                  
    <li class="itemize">
    <!--l. 1577--><p class="noindent" >If the VIRTIO_CRYPTO_F_CIPHER_STATELESS_MODE feature bit is
    negotiated,              the              device              MUST              parse
    <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header in order to decide which mode
    the driver uses.
    </li>
    <li class="itemize">
    <!--l. 1580--><p class="noindent" >The  device  MUST  parse  the  virtio_crypto_sym_data_req  based  on  the
    <span 
class="aeti-10">opcode </span>field in general header.
    </li>
    <li class="itemize">
    <!--l. 1582--><p class="noindent" >The device MUST parse the fields of struct virtio_crypto_cipher_data_flf in
    struct virtio_crypto_sym_data_flf and struct virtio_crypto_cipher_data_vlf
    in   struct   virtio_crypto_sym_data_vlf   if   the   request   is   based   on
    VIRTIO_CRYPTO_SYM_OP_CIPHER.
    </li>
    <li class="itemize">
    <!--l. 1585--><p class="noindent" >The device MUST parse the fields of struct virtio_crypto_alg_chain_data_flf
    in          struct          virtio_crypto_sym_data_flf          and          struct
    virtio_crypto_alg_chain_data_vlf in struct virtio_crypto_sym_data_vlf if the
    request is of the VIRTIO_CRYPTO_SYM_OP_ALGORITHM_CHAINING
    type.
    </li>
    <li class="itemize">
    <!--l. 1589--><p class="noindent" >The  device  MUST  copy  the  result  of  cryptographic  operation  in  the
    dst_data[] in both plain CIPHER mode and algorithms chain mode.
    </li>
    <li class="itemize">
    <!--l. 1591--><p class="noindent" >The device MUST check the <span 
class="aeti-10">para</span>.<span 
class="aeti-10">add_len </span>is bigger than 0 before parse the
    additional authenticated data in plain algorithms chain mode.
    </li>
    <li class="itemize">
    <!--l. 1593--><p class="noindent" >The                                                                                    device
    MUST copy the result of HASH/MAC operation in the hash_result[] is of
    the VIRTIO_CRYPTO_SYM_OP_ALGORITHM_CHAINING type.
    </li>
    <li class="itemize">
    <!--l. 1595--><p class="noindent" >The device MUST set the <span 
class="aeti-10">status </span>field in struct virtio_crypto_inhdr to one of the
    following values of enum VIRTIO_CRYPTO_STATUS:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1598--><p class="noindent" >VIRTIO_CRYPTO_OK if the operation success.
        </li>
        <li class="itemize">
        <!--l. 1599--><p class="noindent" >VIRTIO_CRYPTO_NOTSUPP if the requested algorithm or operation
        is unsupported.
                                                                  

                                                                  
        </li>
        <li class="itemize">
        <!--l. 1600--><p class="noindent" >VIRTIO_CRYPTO_INVSESS  if  the  session  ID  is  invalid  in  session
        mode.
        </li>
        <li class="itemize">
        <!--l. 1601--><p class="noindent" >VIRTIO_CRYPTO_ERR if failure not mentioned above occurs.</li></ul>
    </li></ul>
<a 
 id="x1-531001r541"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.7   </span> <a 
 id="x1-5320007"></a>AEAD Service Operation</h5>
<!--l. 1607--><p class="noindent" >Session mode requests of symmetric algorithm are as follows:
<!--l. 1609-->
<pre class="lstlisting" id="listing-213"><span class="label"><a 
 id="x1-532001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_aead_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">valid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">GCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">either</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">12</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">96-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bit</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IVs</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">which</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">case</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">points</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">J0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nonce</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">which</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">can</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">range</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">13</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">inclusive</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">should</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">at</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">least</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag_len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Authentication</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532022r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_aead_data_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Initialization</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">GCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">either</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">96</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">J0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">other</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">where</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">J0</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">defined</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">by</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">NIST</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SP800</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-38</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Regardless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">full</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">needs</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">allocated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">first</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nonce</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">should</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">written</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">starting</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">at</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[1]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">allow</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">space</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">implementation</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">first</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">byte</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Note</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">full</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">should</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">allocated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">even</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">though</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">will</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">have</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">less</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">than</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">will</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">updated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">after</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">every</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">partial</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cryptographic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">operation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532042r42"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">exists</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532043r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532044r44"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532045r45"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532046r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Pointer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">output</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532047r47"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532048r48"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1660--><p class="noindent" >Each request uses the virtio_crypto_aead_data_flf structure and the
virtio_crypto_aead_data_flf structure to store information used to run the AEAD
operations.
<!--l. 1664--><p class="noindent" >Stateless mode AEAD service requests are as follows:
<!--l. 1666-->
<pre class="lstlisting" id="listing-214"><span class="label"><a 
 id="x1-532049r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_aead_data_flf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532050r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532051r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AEAD_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532052r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532053r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532054r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532055r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">encrypt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">decrypt</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_OP_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532056r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532057r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sess_para</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532058r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532059r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Byte</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">valid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IV</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532060r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532061r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Authentication</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532062r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532063r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">auth</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532064r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532065r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532066r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532067r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">should</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">at</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">least</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag_len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532068r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532069r21"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532070r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532071r23"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_aead_data_vlf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532072r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532073r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532074r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cipher</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532075r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532076r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Initialization</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Vector</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532077r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iv_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532078r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532079r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532080r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Additional</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">authenticated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">exists</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532081r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">aad_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532082r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532083r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532084r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Pointer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">output</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532085r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-532086r38"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-532087r543"></a>
<!--l. 1707--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.7.1</span> <a 
 id="x1-5330001"></a>Driver Requirements: AEAD Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1710--><p class="noindent" >If the driver uses the session mode, then the driver MUST set <span 
class="aeti-10">session_id</span>
    in struct virtio_crypto_op_header to a valid value assigned by the device
    when the session was created.
    </li>
    <li class="itemize">
    <!--l. 1713--><p class="noindent" >If  the  VIRTIO_CRYPTO_F_AEAD_STATELESS_MODE  feature  bit  is
    negotiated, 1) if the driver uses the stateless mode, then the driver MUST
    set the <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header to ZERO and MUST set
    the fields in struct virtio_crypto_aead_data_flf_stateless.sess_para, 2) if the
    driver                uses                the                session                mode,
    then the driver MUST set the <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header
    to VIRTIO_CRYPTO_FLAG_SESSION_MODE.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 1719--><p class="noindent" >The driver MUST set the <span 
class="aeti-10">opcode </span>field in struct virtio_crypto_op_header to
    VIRTIO_CRYPTO_AEAD_ENCRYPT                                           or
    VIRTIO_CRYPTO_AEAD_DECRYPT.</li></ul>
<a 
 id="x1-533001r545"></a>
<!--l. 1723--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.7.2</span> <a 
 id="x1-5340002"></a>Device Requirements: AEAD Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1726--><p class="noindent" >If  the  VIRTIO_CRYPTO_F_AEAD_STATELESS_MODE  feature  bit  is
    negotiated,                                                                              the
    device MUST parse the virtio_crypto_aead_data_vlf_stateless based on the
    <span 
class="aeti-10">opcode </span>field in general header.
    </li>
    <li class="itemize">
    <!--l. 1729--><p class="noindent" >The  device  MUST  copy  the  result  of  cryptographic  operation  in  the
    dst_data[].
    </li>
    <li class="itemize">
    <!--l. 1730--><p class="noindent" >The device MUST copy the authentication tag in the dst_data[] offset the
    cipher result.
    </li>
    <li class="itemize">
    <!--l. 1731--><p class="noindent" >The device MUST set the <span 
class="aeti-10">status </span>field in struct virtio_crypto_inhdr to one
    of the following values of enum VIRTIO_CRYPTO_STATUS:
    </li>
    <li class="itemize">
    <!--l. 1733--><p class="noindent" >When the <span 
class="aeti-10">opcode </span>field is VIRTIO_CRYPTO_AEAD_DECRYPT, the device
    MUST verify and return the verification result to the driver.
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1736--><p class="noindent" >VIRTIO_CRYPTO_OK if the operation success.
        </li>
        <li class="itemize">
        <!--l. 1737--><p class="noindent" >VIRTIO_CRYPTO_NOTSUPP if the requested algorithm or operation
        is unsupported.
        </li>
        <li class="itemize">
        <!--l. 1738--><p class="noindent" >VIRTIO_CRYPTO_BADMSG if the verification result is incorrect.
        </li>
        <li class="itemize">
        <!--l. 1739--><p class="noindent" >VIRTIO_CRYPTO_INVSESS if the session ID invalid when in session
        mode.
        </li>
        <li class="itemize">
        <!--l. 1740--><p class="noindent" >VIRTIO_CRYPTO_ERR if any failure not mentioned above occurs.</li></ul>
                                                                  

                                                                  
    </li></ul>
<a 
 id="x1-534001r544"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.9.7.8   </span> <a 
 id="x1-5350008"></a>AKCIPHER Service Operation</h5>
<!--l. 1746--><p class="noindent" >Session mode AKCIPHER requests are as follows:
<!--l. 1748-->
<pre class="lstlisting" id="listing-215"><span class="label"><a 
 id="x1-535001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_akcipher_data_flf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_akcipher_data_vlf</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Pointer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">output</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1767--><p class="noindent" >Each data request uses the virtio_crypto_akcipher_flf structure and the
virtio_crypto_akcipher_data_vlf structure to store information used to run the
AKCIPHER operations.
<!--l. 1770--><p class="noindent" >For encryption, decryption, and signing: <span 
class="aeti-10">src_data </span>is the source data that will
be processed, note that for signing operations, src_data stores the data to
be signed, which usually is the digest of some data rather than the data
itself. <span 
class="aeti-10">src_data_len </span>is the length of source data. <span 
class="aeti-10">dst_result </span>is the result data
and <span 
class="aeti-10">dst_data_len </span>is the length of it. Note that the length of the result is
not always exactly equal to dst_data_len, the driver needs to check how
many bytes the device has written and calculate the actual length of the
result.
<!--l. 1779--><p class="noindent" >For verification: <span 
class="aeti-10">src_data_len </span>refers to the length of the signature, and <span 
class="aeti-10">dst_data_len</span>
refers to the length of signed data, where the signed data is usually the digest of some
data. <span 
class="aeti-10">src_data </span>is spliced by the signature and the signed data, the src_data with the
lower address stores the signature, and the higher address stores the signed data.
<span 
class="aeti-10">dst_data </span>is always empty for verification.
<!--l. 1786--><p class="noindent" >Different algorithms have different signature formats. For the RSA algorithm, the
result is determined by the padding algorithm specified by <span 
class="aeti-10">padding_algo </span>in structure
virtio_crypto_rsa_session_para.
<!--l. 1790--><p class="noindent" >For the ECDSA algorithm, the signature is composed of the following ASN.1
structure (see <a 
href="#x1-3024x23">RFC3279</a>) and MUST be DER encoded (see <a 
href="#x1-3023x22">rfc6025</a>).
<!--l. 1794-->
<pre class="lstlisting" id="listing-216"><span class="label"><a 
 id="x1-535017r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Ecdsa</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Sig</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">::=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SEQUENCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535018r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535019r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTEGER</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535020r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<!--l. 1801--><p class="noindent" >Stateless mode AKCIPHER service requests are as follows: <!--l. 1802-->
<pre class="lstlisting" id="listing-217"><span class="label"><a 
 id="x1-535021r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_akcipher_data_flf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535022r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535023r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CYRPTO_AKCIPHER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535024r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algo</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535025r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">See</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CRYPTO_AKCIPHER_KEY_TYPE_</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535026r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535027r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535028r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535029r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535030r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">algothrim</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parameters</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">described</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535031r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535032r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_rsa_session_para</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rsa</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535033r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_ecdsa_session_para</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ecdsa</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535034r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535035r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sess_para</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535036r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535037r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535038r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535039r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">destination</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535040r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535041r21"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535042r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535043r23"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_crypto_akcipher_data_vlf_stateless</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535044r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535045r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">akcipher_key</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535046r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535047r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535048r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535049r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535050r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">portion</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535051r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_data_len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-535052r32"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1837--><p class="noindent" >In stateless mode, the format of key and signature, the meaning of src_data and
dst_data, are all the same with session mode.
<a 
 id="x1-535053r546"></a>
                                                                  

                                                                  
<!--l. 1840--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.8.1</span> <a 
 id="x1-5360001"></a>Driver Requirements: AKCIPHER Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1843--><p class="noindent" >If the driver uses the session mode, then the driver MUST set <span 
class="aeti-10">session_id</span>
    in struct virtio_crypto_op_header to a valid value assigned by the device
    when the session was created.
    </li>
    <li class="itemize">
    <!--l. 1846--><p class="noindent" >If the VIRTIO_CRYPTO_F_AKCIPHER_STATELESS_MODE feature bit
    is                                                                                negotiated,
    1) if the driver uses the stateless mode, then the driver MUST set the
    <span 
class="aeti-10">flag </span>field in struct virtio_crypto_op_header to ZERO and MUST set the
    fields in struct virtio_crypto_akcipher_flf_stateless.sess_para, 2) if the driver
    uses the session mode, then the driver MUST set the <span 
class="aeti-10">flag </span>field in struct
    virtio_crypto_op_header to VIRTIO_CRYPTO_FLAG_SESSION_MODE.
    </li>
    <li class="itemize">
    <!--l. 1852--><p class="noindent" >The driver MUST set the <span 
class="aeti-10">opcode </span>field in struct virtio_crypto_op_header to
    one               of               VIRTIO_CRYPTO_AKCIPHER_ENCRYPT,
    VIRTIO_CRYPTO_AKCIPHER_DESTROY_SESSION,
    VIRTIO_CRYPTO_AKCIPHER_SIGN,                                        and
    VIRTIO_CRYPTO_AKCIPHER_VERIFY.</li></ul>
<a 
 id="x1-536001r548"></a>
<!--l. 1857--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.9.7.8.2</span> <a 
 id="x1-5370002"></a>Device Requirements: AKCIPHER Service Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1860--><p class="noindent" >If the VIRTIO_CRYPTO_F_AKCIPHER_STATELESS_MODE feature bit
    is                                      negotiated,                                      the
    device MUST parse the virtio_crypto_akcipher_data_vlf_stateless based on
    the <span 
class="aeti-10">opcode </span>field in general header.
    </li>
    <li class="itemize">
    <!--l. 1863--><p class="noindent" >The  device  MUST  copy  the  result  of  cryptographic  operation  in  the
    dst_data[].
    </li>
    <li class="itemize">
    <!--l. 1864--><p class="noindent" >The device MUST set the <span 
class="aeti-10">status </span>field in struct virtio_crypto_inhdr to one of the
    following values of enum VIRTIO_CRYPTO_STATUS:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 1867--><p class="noindent" >VIRTIO_CRYPTO_OK if the operation success.
        </li>
        <li class="itemize">
                                                                  

                                                                  
        <!--l. 1868--><p class="noindent" >VIRTIO_CRYPTO_NOTSUPP if the requested algorithm or operation
        is unsupported.
        </li>
        <li class="itemize">
        <!--l. 1869--><p class="noindent" >VIRTIO_CRYPTO_BADMSG if the verification result is incorrect.
        </li>
        <li class="itemize">
        <!--l. 1870--><p class="noindent" >VIRTIO_CRYPTO_INVSESS if the session ID invalid when in session
        mode.
        </li>
        <li class="itemize">
        <!--l. 1871--><p class="noindent" >VIRTIO_CRYPTO_KEY_REJECTED  if  the  signature  verification
        failed.
        </li>
        <li class="itemize">
        <!--l. 1872--><p class="noindent" >VIRTIO_CRYPTO_ERR if any failure not mentioned above occurs.</li></ul>
    </li></ul>
<a 
 id="x1-537001r505"></a>
<h3 class="sectionHead"><span class="titlemark">5.10   </span> <a 
 id="x1-53800010"></a>Socket Device</h3>
<!--l. 3--><p class="noindent" >The virtio socket device is a zero-configuration socket communications device. It
facilitates data transfer between the guest and device without using the Ethernet or
IP protocols.
<a 
 id="x1-538001r521"></a>
<h4 class="subsectionHead"><span class="titlemark">5.10.1   </span> <a 
 id="x1-5390001"></a>Device ID</h4>
<!--l. 8--><p class="noindent" >19
<a 
 id="x1-539001r551"></a>
<h4 class="subsectionHead"><span class="titlemark">5.10.2   </span> <a 
 id="x1-5400002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 12--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 12--><p class="noindent" >rx
    </dd><dt class="description">
    <!--l. 13--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 13--><p class="noindent" >tx
    </dd><dt class="description">
    <!--l. 14--><p class="noindent" >
<span 
class="aeb10-">2</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 14--><p class="noindent" >event</dd></dl>
<a 
 id="x1-540001r552"></a>
<h4 class="subsectionHead"><span class="titlemark">5.10.3   </span> <a 
 id="x1-5410003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 20--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_VSOCK_F_STREAM (0)</span> </dt><dd 
class="description">
    <!--l. 20--><p class="noindent" >stream socket type is supported.
    </dd><dt class="description">
    <!--l. 21--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_VSOCK_F_SEQPACKET (1)</span> </dt><dd 
class="description">
    <!--l. 21--><p class="noindent" >seqpacket socket type is supported.
    </dd><dt class="description">
    <!--l. 22--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_VSOCK_F_NO_IMPLIED_STREAM (2)</span> </dt><dd 
class="description">
    <!--l. 22--><p class="noindent" >stream socket type is not implied.</dd></dl>
<a 
 id="x1-541001r547"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.3.1   </span> <a 
 id="x1-5420001"></a>Driver Requirements: Feature bits</h5>
<!--l. 27--><p class="noindent" >The driver SHOULD accept the VIRTIO_VSOCK_F_NO_IMPLIED_STREAM
feature if offered by the device.
<!--l. 30--><p class="noindent" >If no feature bit has been negotiated, the driver SHOULD act as if
VIRTIO_VSOCK_F_STREAM has been negotiated.
<!--l. 33--><p class="noindent" >If VIRTIO_VSOCK_F_SEQPACKET has been negotiated, but not
VIRTIO_VSOCK_F_NO_IMPLIED_STREAM, the driver MAY act as if
VIRTIO_VSOCK_F_STREAM has also been negotiated.
<a 
 id="x1-542001r554"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.3.2   </span> <a 
 id="x1-5430002"></a>Device Requirements: Feature bits</h5>
<!--l. 39--><p class="noindent" >The device SHOULD offer the VIRTIO_VSOCK_F_NO_IMPLIED_STREAM
feature.
<!--l. 41--><p class="noindent" >If no feature bit has been negotiated, the device SHOULD act as if
VIRTIO_VSOCK_F_STREAM has been negotiated.
<!--l. 44--><p class="noindent" >If VIRTIO_VSOCK_F_SEQPACKET has been negotiated, but not
VIRTIO_VSOCK_F_NO_IMPLIED_STREAM, the device MAY act as if
VIRTIO_VSOCK_F_STREAM has also been negotiated.
<a 
 id="x1-543001r553"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">5.10.4   </span> <a 
 id="x1-5440004"></a>Device configuration layout</h4>
<!--l. 50--><p class="noindent" >Socket device configuration uses the following layout structure:
<!--l. 52-->
<pre class="lstlisting" id="listing-218"><span class="label"><a 
 id="x1-544001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_vsock_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-544002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">guest_cid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-544003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 58--><p class="noindent" >The <span 
class="aeti-10">guest_cid </span>field contains the guest’s context ID, which uniquely identifies
the device for its lifetime. The upper 32 bits of the CID are reserved and
zeroed.
<!--l. 62--><p class="noindent" >The following CIDs are reserved and cannot be used as the guest’s context
ID:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > CID             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Notes                                 </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >Reserved</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1                 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 2                 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Well-known CID for the host  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0xffffffff         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0xffffffffffffffff  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved                            </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<a 
 id="x1-544004r556"></a>
<h4 class="subsectionHead"><span class="titlemark">5.10.5   </span> <a 
 id="x1-5450005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The guest’s cid is read from <span 
class="aeti-10">guest_cid</span>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Buffers are added to the event virtqueue to receive events from the device.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Buffers are added to the rx virtqueue to start receiving packets.</dd></dl>
<a 
 id="x1-545004r557"></a>
<h4 class="subsectionHead"><span class="titlemark">5.10.6   </span> <a 
 id="x1-5460006"></a>Device Operation</h4>
<!--l. 92--><p class="noindent" >Packets transmitted or received contain a header before the payload:
<!--l. 94-->
<pre class="lstlisting" id="listing-219"><span class="label"><a 
 id="x1-546001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_vsock_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_cid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_cid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">src_port</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dst_port</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">op</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buf_alloc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fwd_cnt</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 109--><p class="noindent" >The upper 32 bits of src_cid and dst_cid are reserved and zeroed.
<!--l. 111--><p class="noindent" >Most packets simply transfer data but control packets are also used for connection
and buffer space management. <span 
class="aeti-10">op </span>is one of the following operation constants:
<!--l. 115-->
<pre class="lstlisting" id="listing-220"><span class="label"><a 
 id="x1-546013r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_INVALID</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546014r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Connect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">operations</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546015r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_REQUEST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546016r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_RESPONSE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546017r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_RST</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546018r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_SHUTDOWN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546019r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">To</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">send</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">payload</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546020r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_RW</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546021r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Tell</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">peer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">our</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">credit</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546022r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_CREDIT_UPDATE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546023r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">peer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">send</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">credit</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">us</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-546024r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_OP_CREDIT_REQUEST</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span></pre>
                                                                  

                                                                  
<!--l. 130--><p class="noindent" ><span 
class="aeti-10">len </span>is the size of the payload, in bytes. However, the driver may provide buffer(s) for
the payload that have a total size longer than <span 
class="aeti-10">len</span>, in which case only the first <span 
class="aeti-10">len</span>
bytes will be used for the actual data.
<a 
 id="x1-546025r555"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.6.1   </span> <a 
 id="x1-5470001"></a>Virtqueue Flow Control</h5>
<!--l. 137--><p class="noindent" >The tx virtqueue carries packets initiated by applications and replies to received
packets. The rx virtqueue carries packets initiated by the device and replies to
previously transmitted packets.
<!--l. 141--><p class="noindent" >If both rx and tx virtqueues are filled by the driver and device at the same time then
it appears that a deadlock is reached. The driver has no free tx descriptors to send
replies. The device has no free rx descriptors to send replies either. Therefore neither
device nor driver can process virtqueues since that may involve sending new
replies.
<!--l. 147--><p class="noindent" >This is solved using additional resources outside the virtqueue to hold packets. With
additional resources, it becomes possible to process incoming packets even when
outgoing packets cannot be sent.
<!--l. 151--><p class="noindent" >Eventually even the additional resources will be exhausted and further processing is
not possible until the other side processes the virtqueue that it has neglected. This
stop to processing prevents one side from causing unbounded resource consumption
in the other side.
<a 
 id="x1-547001r549"></a>
<!--l. 156--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.1.1</span> <a 
 id="x1-5480001"></a>Driver Requirements: Device Operation: Virtqueue Flow Control</h5>
The rx virtqueue MUST be processed even when the tx virtqueue is full so long
as there are additional resources available to hold packets outside the tx
virtqueue.
<a 
 id="x1-548001r560"></a>
<!--l. 160--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.1.2</span> <a 
 id="x1-5490002"></a>Device Requirements: Device Operation: Virtqueue Flow Control</h5>
The tx virtqueue MUST be processed even when the rx virtqueue is full so long
as there are additional resources available to hold packets outside the rx
virtqueue.
<a 
 id="x1-549001r559"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.6.2   </span> <a 
 id="x1-5500002"></a>Addressing</h5>
<!--l. 166--><p class="noindent" >Flows are identified by a (source, destination) address tuple. An address consists of a
(cid, port number) tuple. The header fields used for this are <span 
class="aeti-10">src_cid</span>, <span 
class="aeti-10">src_port</span>, <span 
class="aeti-10">dst_cid</span>,
and <span 
class="aeti-10">dst_port</span>.
<!--l. 170--><p class="noindent" >Currently stream and seqpacket sockets are supported. <span 
class="aeti-10">type </span>is 1
(VIRTIO_VSOCK_TYPE_STREAM) for stream socket types, and 2
(VIRTIO_VSOCK_TYPE_SEQPACKET) for seqpacket socket types.
                                                                  

                                                                  
<!--l. 173-->
<pre class="lstlisting" id="listing-221"><span class="label"><a 
 id="x1-550001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_TYPE_STREAM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-550002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_TYPE_SEQPACKET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<!--l. 178--><p class="noindent" >Stream sockets provide in-order, guaranteed, connection-oriented delivery
without message boundaries. Seqpacket sockets provide in-order, guaranteed,
connection-oriented delivery with message and record boundaries.
<a 
 id="x1-550003r562"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.6.3   </span> <a 
 id="x1-5510003"></a>Buffer Space Management</h5>
<!--l. 183--><p class="noindent" ><span 
class="aeti-10">buf_alloc </span>and <span 
class="aeti-10">fwd_cnt </span>are used for buffer space management of stream sockets. The
guest and the device publish how much buffer space is available per socket. Only
payload bytes are counted and header bytes are not included. This facilitates flow
control so data is never dropped.
<!--l. 188--><p class="noindent" ><span 
class="aeti-10">buf_alloc </span>is the total receive buffer space, in bytes, for this socket. This includes both
free and in-use buffers. <span 
class="aeti-10">fwd_cnt </span>is the free-running bytes received counter. The sender
calculates the amount of free receive buffer space as follows:
<!--l. 193-->
<pre class="lstlisting" id="listing-222"><span class="label"><a 
 id="x1-551001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_cnt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sender</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">free</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">running</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">transmitted</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">counter</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-551002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">peer_free</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">peer_buf_alloc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_cnt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">peer_fwd_cnt</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span></pre>
<!--l. 198--><p class="noindent" >If there is insufficient buffer space, the sender waits until virtqueue
buffers are returned and checks <span 
class="aeti-10">buf_alloc </span>and <span 
class="aeti-10">fwd_cnt </span>again. Sending the
VIRTIO_VSOCK_OP_CREDIT_REQUEST packet queries how much buffer space is
available. The reply to this query is a VIRTIO_VSOCK_OP_CREDIT_UPDATE
packet. It is also valid to send a VIRTIO_VSOCK_OP_CREDIT_UPDATE packet
without previously receiving a VIRTIO_VSOCK_OP_CREDIT_REQUEST
packet. This allows communicating updates any time a change in buffer space
occurs.
<a 
 id="x1-551003r561"></a>
<!--l. 206--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.3.1</span> <a 
 id="x1-5520001"></a>Driver Requirements: Device Operation: Buffer Space Management</h5>
VIRTIO_VSOCK_OP_RW data packets MUST only be transmitted when the peer
has sufficient free buffer space for the payload.
<!--l. 210--><p class="noindent" >All packets associated with a stream flow MUST contain valid information in
<span 
class="aeti-10">buf_alloc </span>and <span 
class="aeti-10">fwd_cnt </span>fields.
<a 
 id="x1-552001r564"></a>
<!--l. 213--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.3.2</span> <a 
 id="x1-5530002"></a>Device Requirements: Device Operation: Buffer Space Management</h5>
VIRTIO_VSOCK_OP_RW data packets MUST only be transmitted when the peer
has sufficient free buffer space for the payload.
                                                                  

                                                                  
<!--l. 217--><p class="noindent" >All packets associated with a stream flow MUST contain valid information in
<span 
class="aeti-10">buf_alloc </span>and <span 
class="aeti-10">fwd_cnt </span>fields.
<a 
 id="x1-553001r563"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.6.4   </span> <a 
 id="x1-5540004"></a>Receive and Transmit</h5>
<!--l. 221--><p class="noindent" >The driver enqueues outgoing packets to the tx virtqueue and incoming packet
receive buffers on the rx virtqueue. Packets are of the following form:
<!--l. 224-->
<pre class="lstlisting" id="listing-223"><span class="label"><a 
 id="x1-554001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_vsock_packet</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-554002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_vsock_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-554003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-554004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 231--><p class="noindent" >Virtqueue buffers for outgoing packets are read-only. Virtqueue buffers for incoming
packets are write-only.
<a 
 id="x1-554005r565"></a>
<!--l. 234--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.4.1</span> <a 
 id="x1-5550001"></a>Driver Requirements: Device Operation: Receive and Transmit</h5>
The <span 
class="aeti-10">guest_cid </span>configuration field MUST be used as the source CID when sending
outgoing packets.
<!--l. 239--><p class="noindent" >A VIRTIO_VSOCK_OP_RST reply MUST be sent if a packet is received with an
unknown <span 
class="aeti-10">type </span>value.
<a 
 id="x1-555001r567"></a>
<!--l. 242--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.4.2</span> <a 
 id="x1-5560002"></a>Device Requirements: Device Operation: Receive and Transmit</h5>
The <span 
class="aeti-10">guest_cid </span>configuration field MUST NOT contain a reserved CID as listed in
<a 
href="#x1-5440004">5.10.4<!--tex4ht:ref: sec:Device Types / Socket Device / Device configuration layout --></a>.
<!--l. 246--><p class="noindent" >A VIRTIO_VSOCK_OP_RST reply MUST be sent if a packet is received with an
unknown <span 
class="aeti-10">type </span>value.
<a 
 id="x1-556001r566"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.6.5   </span> <a 
 id="x1-5570005"></a>Stream Sockets</h5>
<!--l. 251--><p class="noindent" >Connections are established by sending a VIRTIO_VSOCK_OP_REQUEST packet. If
a listening socket exists on the destination a VIRTIO_VSOCK_OP_RESPONSE reply
is sent and the connection is established. A VIRTIO_VSOCK_OP_RST reply is sent if
a listening socket does not exist on the destination or the destination has insufficient
resources to establish the connection.
<!--l. 257--><p class="noindent" >When a connected socket receives VIRTIO_VSOCK_OP_SHUTDOWN the header <span 
class="aeti-10">flags</span>
field bit VIRTIO_VSOCK_SHUTDOWN_F_RECEIVE (bit 0) set indicates that the
peer will not receive any more data and bit VIRTIO_VSOCK_SHUTDOWN_F_SEND
(bit 1) set indicates that the peer will not send any more data. These hints are
permanent once sent and successive packets with bits clear do not reset
them.
<!--l. 263-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-224"><span class="label"><a 
 id="x1-557001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_SHUTDOWN_F_RECEIVE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-557002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_SHUTDOWN_F_SEND</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<!--l. 268--><p class="noindent" >The VIRTIO_VSOCK_OP_RST packet aborts the connection process or forcibly
disconnects a connected socket.
<!--l. 271--><p class="noindent" >Clean disconnect is achieved by one or more VIRTIO_VSOCK_OP_SHUTDOWN
packets that indicate no more data will be sent and received, followed by a
VIRTIO_VSOCK_OP_RST response from the peer. If no VIRTIO_VSOCK_OP_RST
response is received within an implementation-specific amount of time, a
VIRTIO_VSOCK_OP_RST packet is sent to forcibly disconnect the socket.
<!--l. 277--><p class="noindent" >The clean disconnect process ensures that neither peer reuses the (source,
destination) address tuple for a new connection while the other peer is still processing
the old connection.
<a 
 id="x1-557003r569"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.6.6   </span> <a 
 id="x1-5580006"></a>Seqpacket Sockets</h5>
<a 
 id="x1-558001r568"></a>
<!--l. 283--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.6.1</span> <a 
 id="x1-5590001"></a>Message and record boundaries</h5>
Two types of boundaries are supported: message and record boundaries.
<!--l. 286--><p class="noindent" >A message contains data sent in a single operation. A single message can be split into
multiple RW packets. To provide message boundaries, last RW packet of each
message has VIRTIO_VSOCK_SEQ_EOM bit (bit 0) set in the <span 
class="aeti-10">flags </span>of packet’s
header.
<!--l. 291--><p class="noindent" >Record is any number of subsequent messages, where last message is sent with
POSIX MSG_EOR flag set. Record boundary means that receiver gets MSG_EOR
flag set in the corresponding message where sender set it. To provide record
boundaries, last RW packet of each record has VIRTIO_VSOCK_SEQ_EOR bit (bit
1) set in the <span 
class="aeti-10">flags </span>of packet’s header.
<!--l. 297-->
<pre class="lstlisting" id="listing-225"><span class="label"><a 
 id="x1-559001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_SEQ_EOM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-559002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_SEQ_EOR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span></pre>
<a 
 id="x1-559003r570"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.10.6.7   </span> <a 
 id="x1-5600007"></a>Device Events</h5>
<!--l. 304--><p class="noindent" >Certain events are communicated by the device to the driver using the event
virtqueue.
<!--l. 307--><p class="noindent" >The event buffer is as follows:
<!--l. 309-->
<pre class="lstlisting" id="listing-226"><span class="label"><a 
 id="x1-560001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_VSOCK_EVENT_TRANSPORT_RESET</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-560002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-560003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_vsock_event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-560004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-560005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
                                                                  

                                                                  
<!--l. 317--><p class="noindent" >The VIRTIO_VSOCK_EVENT_TRANSPORT_RESET event indicates that
communication has been interrupted. This usually occurs if the guest has been
physically migrated. The driver shuts down established connections and the <span 
class="aeti-10">guest_cid</span>
configuration field is fetched again. Existing listen sockets remain but their CID is
updated to reflect the current <span 
class="aeti-10">guest_cid</span>.
<a 
 id="x1-560006r571"></a>
<!--l. 324--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.10.6.7.1</span> <a 
 id="x1-5610001"></a>Driver Requirements: Device Operation: Device Events</h5>
Event virtqueue buffers SHOULD be replenished quickly so that no events are
missed.
<!--l. 329--><p class="noindent" >The <span 
class="aeti-10">guest_cid </span>configuration field MUST be fetched to determine the current CID
when a VIRTIO_VSOCK_EVENT_TRANSPORT_RESET event is received.
<!--l. 332--><p class="noindent" >Existing connections MUST be shut down when a VIRTIO_VSOCK_EVENT_TRANSPORT_RESET
event is received.
<!--l. 335--><p class="noindent" >Listen connections MUST remain operational with the current CID when a
VIRTIO_VSOCK_EVENT_TRANSPORT_RESET event is received.
<a 
 id="x1-561001r550"></a>
<h3 class="sectionHead"><span class="titlemark">5.11   </span> <a 
 id="x1-56200011"></a>File System Device</h3>
<!--l. 3--><p class="noindent" >The virtio file system device provides file system access. The device either directly
manages a file system or it acts as a gateway to a remote file system. The details of
how the device implementation accesses files are hidden by the device interface,
allowing for a range of use cases.
<!--l. 8--><p class="noindent" >Unlike block-level storage devices such as virtio block and SCSI, the virtio file system
device provides file-level access to data. The device interface is based on the Linux
Filesystem in Userspace (FUSE) protocol. This consists of requests for file system
traversal and access the files and directories within it. The protocol details are
defined by <a 
href="#x1-3014x13">FUSE</a>.
<!--l. 14--><p class="noindent" >The device acts as the FUSE file system daemon and the driver acts as the FUSE
client mounting the file system. The virtio file system device provides the mechanism
for transporting FUSE requests, much like /dev/fuse in a traditional FUSE
application.
<!--l. 19--><p class="noindent" >This section relies on definitions from <a 
href="#x1-3014x13">FUSE</a>.
<a 
 id="x1-562001r558"></a>
<h4 class="subsectionHead"><span class="titlemark">5.11.1   </span> <a 
 id="x1-5630001"></a>Device ID</h4>
<!--l. 22--><p class="noindent" >26
<a 
 id="x1-563001r575"></a>
<h4 class="subsectionHead"><span class="titlemark">5.11.2   </span> <a 
 id="x1-5640002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
                                                                  

                                                                  
    <!--l. 27--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 27--><p class="noindent" >hiprio
    </dd><dt class="description">
    <!--l. 28--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 28--><p class="noindent" >notification queue
    </dd><dt class="description">
    <!--l. 29--><p class="noindent" >
<span 
class="aeb10-">2</span><span 
class="aeb10-">…n</span> </dt><dd 
class="description">
    <!--l. 29--><p class="noindent" >request queues</dd></dl>
<!--l. 32--><p class="noindent" >The notification queue only exists if VIRTIO_FS_F_NOTIFICATION is
set.
<a 
 id="x1-564001r576"></a>
<h4 class="subsectionHead"><span class="titlemark">5.11.3   </span> <a 
 id="x1-5650003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 37--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_FS_F_NOTIFICATION (0)</span> </dt><dd 
class="description">
    <!--l. 37--><p class="noindent" >Device has support for FUSE notify messages. The notification queue is
    virtqueue 1.</dd></dl>
<a 
 id="x1-565001r577"></a>
<h4 class="subsectionHead"><span class="titlemark">5.11.4   </span> <a 
 id="x1-5660004"></a>Device configuration layout</h4>
<!--l. 43-->
<pre class="lstlisting" id="listing-227"><span class="label"><a 
 id="x1-566001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_fs_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-566002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">char</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tag</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[36];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-566003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num_request_queues</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-566004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notify_buf_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-566005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 51--><p class="noindent" >The <span 
class="aeti-10">tag </span>and <span 
class="aeti-10">num_request_queues </span>fields are always available. The <span 
class="aeti-10">notify_buf_size </span>field
is only available when VIRTIO_FS_F_NOTIFICATION is set.
    <dl class="description"><dt class="description">
    <!--l. 56--><p class="noindent" >
<span 
class="aebxti-10">tag</span> </dt><dd 
class="description">
    <!--l. 56--><p class="noindent" >is the name associated with this file system. The tag is encoded in UTF-8
    and padded with NUL bytes if shorter than the available space. This field
    is not NUL-terminated if the encoded bytes take up the entire field.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 60--><p class="noindent" >
<span 
class="aebxti-10">num_request_queues</span> </dt><dd 
class="description">
    <!--l. 60--><p class="noindent" >is the total number of request virtqueues exposed by the device. Each
    virtqueue offers identical functionality and there are no ordering guarantees
    between requests made available on different queues. Use of multiple queues
    is intended to increase performance.
    </dd><dt class="description">
    <!--l. 65--><p class="noindent" >
<span 
class="aebxti-10">notify_buf_size</span> </dt><dd 
class="description">
    <!--l. 65--><p class="noindent" >is the minimum number of bytes required for each buffer in the notification
    queue.</dd></dl>
<a 
 id="x1-566006r572"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.4.1   </span> <a 
 id="x1-5670001"></a>Driver Requirements: Device configuration layout</h5>
<!--l. 71--><p class="noindent" >The driver MUST NOT write to device configuration fields.
<!--l. 73--><p class="noindent" >The driver MAY use from one up to <span 
class="aeti-10">num_request_queues </span>request virtqueues.
<a 
 id="x1-567001r579"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.4.2   </span> <a 
 id="x1-5680002"></a>Device Requirements: Device configuration layout</h5>
<!--l. 77--><p class="noindent" >The device MUST set <span 
class="aeti-10">num_request_queues </span>to 1 or greater.
<!--l. 79--><p class="noindent" >The device MUST set <span 
class="aeti-10">notify_buf_size </span>to be large enough to hold any of the FUSE
notify messages that this device emits.
<a 
 id="x1-568001r578"></a>
<h4 class="subsectionHead"><span class="titlemark">5.11.5   </span> <a 
 id="x1-5690005"></a>Device Initialization</h4>
<!--l. 84--><p class="noindent" >On initialization the driver first discovers the device’s virtqueues.
<!--l. 86--><p class="noindent" >The driver populates the notification queue with buffers for receiving FUSE notify
messages if VIRTIO_FS_F_NOTIFICATION is set.
<!--l. 89--><p class="noindent" >The FUSE session is started by sending a FUSE_INIT request as defined by the
FUSE protocol on one request virtqueue. All virtqueues provide access to the same
FUSE session and therefore only one FUSE_INIT request is required regardless of the
number of available virtqueues.
<a 
 id="x1-569001r581"></a>
<h4 class="subsectionHead"><span class="titlemark">5.11.6   </span> <a 
 id="x1-5700006"></a>Device Operation</h4>
<!--l. 96--><p class="noindent" >Device operation consists of operating the virtqueues to facilitate file system
access.
<!--l. 99--><p class="noindent" >The FUSE request types are as follows:
    <ul class="itemize1">
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 101--><p class="noindent" >Normal requests are made available by the driver on request queues and
    are used by the device.
    </li>
    <li class="itemize">
    <!--l. 103--><p class="noindent" >High   priority   requests   (FUSE_INTERRUPT,   FUSE_FORGET,   and
    FUSE_BATCH_FORGET) are made available by the driver on the hiprio
    queue so the device is able to process them even if the request queues are
    full.</li></ul>
<!--l. 109--><p class="noindent" >FUSE notify messages are received on the notification queue if
VIRTIO_FS_F_NOTIFICATION is set.
<a 
 id="x1-570001r580"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.6.1   </span> <a 
 id="x1-5710001"></a>Device Operation: Request Queues</h5>
<!--l. 114--><p class="noindent" >The driver enqueues normal requests on an arbitrary request queue. High priority
requests are not placed on request queues. The device processes requests in any order.
The driver is responsible for ensuring that ordering constraints are met by making
available a dependent request only after its prerequisite request has been
used.
<!--l. 120--><p class="noindent" >Requests have the following format with endianness chosen by the driver in the
FUSE_INIT request used to initiate the session as detailed below:
<!--l. 123-->
<pre class="lstlisting" id="listing-228"><span class="label"><a 
 id="x1-571001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_fs_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_in_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">datain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_out_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">out</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dataout</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 135--><p class="noindent" >Note that the words "in" and "out" follow the FUSE meaning and do not indicate the
direction of data transfer under VIRTIO. "In" means input to a request and "out"
means output from processing a request.
<!--l. 139--><p class="noindent" ><span 
class="aeti-10">in </span>is the common header for all types of FUSE requests.
<!--l. 141--><p class="noindent" ><span 
class="aeti-10">datain </span>consists of request-specific data, if any. This is identical to the data read from
the /dev/fuse device by a FUSE daemon.
<!--l. 144--><p class="noindent" ><span 
class="aeti-10">out </span>is the completion header common to all types of FUSE requests.
<!--l. 146--><p class="noindent" ><span 
class="aeti-10">dataout </span>consists of request-specific data, if any. This is identical to the data written
to the /dev/fuse device by a FUSE daemon.
<!--l. 149--><p class="noindent" >For example, the full layout of a FUSE_READ request is as follows:
<!--l. 151-->
<pre class="lstlisting" id="listing-229"><span class="label"><a 
 id="x1-571010r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_fs_read_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571011r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571012r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_in_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571013r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571014r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_read_in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readin</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571015r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">datain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_read_in</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571016r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571017r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571018r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571019r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_out_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">out</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571020r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dataout</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">out</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_out_header</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-571021r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 166--><p class="noindent" >The FUSE protocol documented in <a 
href="#x1-3014x13">FUSE</a> specifies the set of request types and their
contents.
                                                                  

                                                                  
<!--l. 169--><p class="noindent" >The endianness of the FUSE protocol session is detectable by inspecting
the uint32_t <span 
class="aeti-10">in.opcode </span>field of the FUSE_INIT request sent by the driver
to the device. This allows the device to determine whether the session is
little-endian or big-endian. The next FUSE_INIT message terminates the
current session and starts a new session with the possibility of changing
endianness.
<a 
 id="x1-571022r583"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.6.2   </span> <a 
 id="x1-5720002"></a>Device Operation: High Priority Queue</h5>
<!--l. 178--><p class="noindent" >The hiprio queue follows the same request format as the request queues. This queue
only contains FUSE_INTERRUPT, FUSE_FORGET, and FUSE_BATCH_FORGET
requests.
<!--l. 182--><p class="noindent" >Interrupt and forget requests have a higher priority than normal requests. The
separate hiprio queue is used for these requests to ensure they can be delivered even
when all request queues are full.
<a 
 id="x1-572001r573"></a>
<!--l. 186--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.11.6.2.1</span> <a 
 id="x1-5730001"></a>Device Requirements: Device Operation: High Priority Queue</h5>
The device MUST NOT pause processing of the hiprio queue due to activity on a
normal request queue.
<!--l. 191--><p class="noindent" >The device MAY process request queues concurrently with the hiprio queue.
<a 
 id="x1-573001r585"></a>
<!--l. 193--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.11.6.2.2</span> <a 
 id="x1-5740002"></a>Driver Requirements: Device Operation: High Priority Queue</h5>
The driver MUST submit FUSE_INTERRUPT, FUSE_FORGET, and
FUSE_BATCH_FORGET requests solely on the hiprio queue.
<!--l. 197--><p class="noindent" >The driver MUST not submit normal requests on the hiprio queue.
<!--l. 199--><p class="noindent" >The driver MUST anticipate that request queues are processed concurrently with the
hiprio queue.
<a 
 id="x1-574001r584"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.6.3   </span> <a 
 id="x1-5750003"></a>Device Operation: Notification Queue</h5>
<!--l. 203--><p class="noindent" >The notification queue is populated with buffers by the driver and these buffers are
used by the device to emit FUSE notify messages. Notification queue buffer layout is
as follows:
<!--l. 207-->
<pre class="lstlisting" id="listing-230"><span class="label"><a 
 id="x1-575001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_fs_notify</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-575002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">//</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">part</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-575003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_out_header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">out_hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-575004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">char</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">outarg</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notify_buf_size</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sizeof</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fuse_out_header</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-575005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 215--><p class="noindent" ><span 
class="aeti-10">outarg </span>contains the FUSE notify message payload that depends on the type of
notification being emitted.
                                                                  

                                                                  
<!--l. 218--><p class="noindent" >If the driver provides notification queue buffers at a slower rate than the
device emits FUSE notify messages then the virtqueue will eventually become
empty. The behavior in response to an empty virtqueue depends on the
FUSE notify message type. The following FUSE notify message types are
supported:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 223--><p class="noindent" >FUSE_NOTIFY_LOCK  messages  are  delivered  when  buffers  become
    available  again.  The  device  has  resources  for  a  certain  number  of  lock
    requests. If the device runs out of resources new lock requests fail with
    ENOLCK.</li></ul>
<a 
 id="x1-575006r586"></a>
<!--l. 226--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.11.6.3.1</span> <a 
 id="x1-5760001"></a>Driver Requirements: Device Operation: Notification Queue</h5>
The driver MUST provide buffers of at least <span 
class="aeti-10">notify_buf_size </span>bytes.
<!--l. 230--><p class="noindent" >The driver SHOULD replenish notification queue buffers sufficiently quickly so that
there is always at least one available buffer.
<a 
 id="x1-576001r587"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.6.4   </span> <a 
 id="x1-5770004"></a>Device Operation: DAX Window</h5>
<!--l. 235--><p class="noindent" >FUSE_READ and FUSE_WRITE requests transfer file contents between the
driver-provided buffer and the device. In cases where data transfer is undesirable, the
device can map file contents into the DAX window shared memory region. The driver
then accesses file contents directly in device-owned memory without a data
transfer.
<!--l. 241--><p class="noindent" >The DAX Window is an alternative mechanism for accessing file contents.
FUSE_READ/FUSE_WRITE requests and DAX Window accesses are possible at the
same time. Providing the DAX Window is optional for devices. Using the DAX
Window is optional for drivers.
<!--l. 246--><p class="noindent" >Shared memory region ID 0 is called the DAX window. Drivers map this
shared memory region with writeback caching as if it were regular RAM. The
contents of the DAX window are undefined unless a mapping exists for that
range.
<!--l. 250--><p class="noindent" >The driver maps a file range into the DAX window using the FUSE_SETUPMAPPING
request. Alignment constraints for FUSE_SETUPMAPPING and
FUSE_REMOVEMAPPING requests are communicated during FUSE_INIT
negotiation.
<!--l. 254--><p class="noindent" >When a FUSE_SETUPMAPPING request perfectly overlaps a previous mapping, the
previous mapping is replaced. When a mapping partially overlaps a previous
mapping, the previous mapping is split into one or two smaller mappings. When
a mapping is partially unmapped it is also split into one or two smaller
                                                                  

                                                                  
mappings.
<!--l. 260--><p class="noindent" >Establishing new mappings or splitting existing mappings consumes resources. If the
device runs out of resources the FUSE_SETUPMAPPING request fails until
resources are available again following FUSE_REMOVEMAPPING.
<!--l. 264--><p class="noindent" >After FUSE_SETUPMAPPING has completed successfully the file range is
accessible from the DAX window at the offset provided by the driver in
the request. A mapping is removed using the FUSE_REMOVEMAPPING
request.
<!--l. 268--><p class="noindent" >Data is only guaranteed to be persistent when a FUSE_FSYNC request is used
by the device after having been made available by the driver following the
write.
<a 
 id="x1-577001r588"></a>
<!--l. 271--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.11.6.4.1</span> <a 
 id="x1-5780001"></a>Device Requirements: Device Operation: DAX Window</h5>
The device MAY provide the DAX Window to memory-mapped access to file
contents. If present, the DAX Window MUST be shared memory region ID
0.
<!--l. 275--><p class="noindent" >The device MUST support FUSE_READ and FUSE_WRITE requests regardless of
whether the DAX Window is being used or not.
<!--l. 277--><p class="noindent" >The device MUST allow mappings that completely or partially overlap existing
mappings within the DAX window.
<!--l. 279--><p class="noindent" >The device MUST reject mappings that would go beyond the end of the DAX
window.
<a 
 id="x1-578001r590"></a>
<!--l. 281--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.11.6.4.2</span> <a 
 id="x1-5790002"></a>Driver Requirements: Device Operation: DAX Window</h5>
The driver SHOULD be prepared to find shared memory region ID 0 absent and fall
back to FUSE_READ and FUSE_WRITE requests.
<!--l. 285--><p class="noindent" >The driver MAY use both FUSE_READ/FUSE_WRITE requests and the DAX
Window to access file contents.
<!--l. 287--><p class="noindent" >The driver MUST NOT access DAX window areas that have not been mapped.
<a 
 id="x1-579001r589"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.6.5   </span> <a 
 id="x1-5800005"></a>Security Considerations</h5>
<!--l. 291--><p class="noindent" >The device provides access to a file system containing files owned by one or more
POSIX user ids and group ids. The device has no secure way of differentiating
between users originating requests via the driver. Therefore the device accepts the
POSIX user ids and group ids provided by the driver and security is enforced by the
driver rather than the device. It is nevertheless possible for devices to implement
POSIX user id and group id mapping or whitelisting to control the ownership and
access available to the driver.
                                                                  

                                                                  
<!--l. 299--><p class="noindent" >File systems containing special files including device nodes and setuid executable files
pose a security concern. These properties are defined by the file type and mode,
which are set by the driver when creating new files or by changes at a later time.
These special files present a security risk when the file system is shared with another
machine. A setuid executable or a device node placed by a malicious machine
make it possible for unprivileged users on other machines to elevate their
privileges through the shared file system. This issue can be solved on some
operating systems using mount options that ignore special files. It is also
possible for devices to implement restrictions on special files by refusing their
creation.
<!--l. 310--><p class="noindent" >When the device provides shared access to a file system between multiple machines,
symlink race conditions, exhausting file system capacity, and overwriting or deleting
files used by others are factors to consider. These issues have a long history in
multi-user operating systems and also apply to virtio-fs. They are typically managed
at the file system administration level by providing shared access only to mutually
trusted users.
<!--l. 317--><p class="noindent" >Multiple machines sharing access to a file system are susceptible to timing
side-channel attacks. By measuring the latency of accesses to file contents or file
system metadata it is possible to infer whether other machines also accessed the same
information. Short latencies indicate that the information was cached due to a
previous access. This can reveal sensitive information, such as whether certain code
paths were taken. The DAX Window provides direct access to file contents and is
therefore a likely target of such attacks. These attacks are also possible with
traditional FUSE requests. The safest approach is to avoid sharing file systems
between untrusted machines.
<a 
 id="x1-580001r592"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.11.6.6   </span> <a 
 id="x1-5810006"></a>Live migration considerations</h5>
<!--l. 329--><p class="noindent" >When a driver is migrated to a new device it is necessary to consider the FUSE
session and its state. The continuity of FUSE inode numbers (also known as
nodeids) and fh values is necessary so the driver can continue operation without
disruption.
<!--l. 334--><p class="noindent" >It is possible to maintain the FUSE session across live migration either by
transferring the state or by redirecting requests from the new device to the
old device where the state resides. The details of how to achieve this are
implementation-dependent and are not visible at the device interface level.
<!--l. 339--><p class="noindent" >Maintaining version and feature information negotiated by FUSE_INIT is necessary
so that no FUSE protocol feature changes are visible to the driver across live
migration. The FUSE_INIT information forms part of the FUSE session state that
needs to be transferred during live migration.
<a 
 id="x1-581001r574"></a>
                                                                  

                                                                  
<h3 class="sectionHead"><span class="titlemark">5.12   </span> <a 
 id="x1-58200012"></a>RPMB Device</h3>
<!--l. 3--><p class="noindent" >virtio-rpmb is a virtio based RPMB (Replay Protected Memory Block) device. It is
used as a tamper-resistant and anti-replay storage. The device is driven via requests
including read, write, get write counter and program key, which are submitted via a
request queue. This section relies on definitions from paragraph 6.6.22 of
<a 
href="#x1-3016x15">eMMC</a>.
<a 
 id="x1-582001r582"></a>
<h4 class="subsectionHead"><span class="titlemark">5.12.1   </span> <a 
 id="x1-5830001"></a>Device ID</h4>
<!--l. 11--><p class="noindent" >28
<a 
 id="x1-583001r595"></a>
<h4 class="subsectionHead"><span class="titlemark">5.12.2   </span> <a 
 id="x1-5840002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 16--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 16--><p class="noindent" >requestq</dd></dl>
<a 
 id="x1-584001r596"></a>
<h4 class="subsectionHead"><span class="titlemark">5.12.3   </span> <a 
 id="x1-5850003"></a>Feature bits</h4>
<!--l. 21--><p class="noindent" >None.
<a 
 id="x1-585001r597"></a>
<h4 class="subsectionHead"><span class="titlemark">5.12.4   </span> <a 
 id="x1-5860004"></a>Device configuration layout</h4>
<!--l. 25--><p class="noindent" >All fields of this configuration are always available and read-only for the
driver.
<!--l. 27-->
<pre class="lstlisting" id="listing-231"><span class="label"><a 
 id="x1-586001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_rpmb_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-586002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">capacity</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-586003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_wr_cnt</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-586004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_rd_cnt</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-586005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 36--><p class="noindent" >
<span 
class="aebxti-10">capacity</span> </dt><dd 
class="description">
    <!--l. 36--><p class="noindent" >is the capacity of the device (expressed in 128KB units). The values MUST
    range between 0x00 and 0x80 inclusive.
    </dd><dt class="description">
    <!--l. 38--><p class="noindent" >
<span 
class="aebxti-10">max_wr_cnt and max_rd_cnt</span> </dt><dd 
class="description">
    <!--l. 38--><p class="noindent" >are  the  maximum  numbers  of  RPMB  block  count  (256B)  that  can  be
    performed to device in one request. 0 implies no limitation.</dd></dl>
<a 
 id="x1-586006r598"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">5.12.5   </span> <a 
 id="x1-5870005"></a>Device Requirements: Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The virtqueue is initialized.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">The device capacity MUST be initialized to a multiple of 128Kbytes and
    up to 16Mbytes.</dd></dl>
<a 
 id="x1-587003r599"></a>
<h4 class="subsectionHead"><span class="titlemark">5.12.6   </span> <a 
 id="x1-5880006"></a>Device Operation</h4>
<!--l. 53--><p class="noindent" >The operation of a virtio RPMB device is driven by the requests placed on the virtqueue.
The type of request can be program key (VIRTIO_RPMB_REQ_PROGRAM_KEY),
get write counter (VIRTIO_RPMB_REQ_GET_WRITE_COUNTER), write
(VIRTIO_RPMB_REQ_DATA_WRITE), and read (VIRTIO_RPMB_REQ_DATA_READ).
A program key or write request can also combine with a result read
(VIRTIO_RPMB_REQ_RESULT_READ) for a returned result.
<!--l. 60-->
<pre class="lstlisting" id="listing-232"><span class="label"><a 
 id="x1-588001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RPMB</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_REQ_PROGRAM_KEY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0001</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_REQ_GET_WRITE_COUNTER</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0002</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_REQ_DATA_WRITE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0003</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_REQ_DATA_READ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0004</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_REQ_RESULT_READ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0005</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RPMB</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Response</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RESP_PROGRAM_KEY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0100</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RESP_GET_COUNTER</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0200</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RESP_DATA_WRITE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0300</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-588012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RESP_DATA_READ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0400</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 76--><p class="noindent" >
<span 
class="aebxti-10">VIRTIO_RPMB_REQ_PROGRAM_KEY</span> </dt><dd 
class="description">
    <!--l. 76--><p class="noindent" >requests          for          authentication          key          programming.
    If VIRTIO_RPMB_REQ_RESULT_READ is requested, the device returns
    the           RPMB           frame           with           the           response
    (VIRTIO_RPMB_RESP_PROGRAM_KEY), the calculated MAC and the
    result.
    </dd><dt class="description">
    <!--l. 80--><p class="noindent" >
<span 
class="aebxti-10">VIRTIO_RPMB_REQ_GET_WRITE_COUNTER</span> </dt><dd 
class="description">
    <!--l. 80--><p class="noindent" >requests for reading the write counter. The device returns the RPMB frame
    with the response (VIRTIO_RPMB_RESP_GET_COUNTER), the writer
    counter, a copy of the nonce received in the request, the calculated MAC
    and the result.
    </dd><dt class="description">
    <!--l. 85--><p class="noindent" >
<span 
class="aebxti-10">VIRTIO_RPMB_REQ_DATA_WRITE</span> </dt><dd 
class="description">
    <!--l. 85--><p class="noindent" >requests
    for authenticated data write. If VIRTIO_RPMB_REQ_RESULT_READ is
    requested, the device returns the RPMB data frame with the response
                                                                  

                                                                  
    (VIRTIO_RPMB_RESP_DATA_WRITE), the incremented counter value,
    the data address, the calculated MAC and the result.
    </dd><dt class="description">
    <!--l. 90--><p class="noindent" >
<span 
class="aebxti-10">VIRTIO_RPMB_REQ_DATA_READ</span> </dt><dd 
class="description">
    <!--l. 90--><p class="noindent" >requests  for  authenticated  data  read.  The  device  returns  the  RPMB
    frame with the response (VIRTIO_RPMB_RESP_DATA_READ), the block
    count, a copy of the nonce received in the request, the address, the data,
    the calculated MAC and the result.
    </dd><dt class="description">
    <!--l. 95--><p class="noindent" >
<span 
class="aebxti-10">VIRTIO_RPMB_REQ_RESULT_READ</span> </dt><dd 
class="description">
    <!--l. 95--><p class="noindent" >requests                       for                       a                       returned
    result. It is used following with VIRTIO_RPMB_REQ_PROGRAM_KEY
    or  VIRTIO_RPMB_REQ_DATA_WRITE  request  types  for  a  returned
    result in one or multiple RPMB frames. If it’s not requested, the device
    will not return result frame to the driver.</dd></dl>
<a 
 id="x1-588013r593"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.12.6.1   </span> <a 
 id="x1-5890001"></a>Device Operation: Request Queue</h5>
<!--l. 104--><p class="noindent" >The request information is delivered in RPMB frame. The frame is in size of
512B.
<!--l. 107-->
<pre class="lstlisting" id="listing-233"><span class="label"><a 
 id="x1-589001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_rpmb_frame</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">stuff</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[196];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">key_mac</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[32];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[256];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nonce</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[16];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write_counter</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">address</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block_count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">req_resp</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">RPMB</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Operation</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Results</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0000</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_GENERAL_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0001</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_AUTH_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0002</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_COUNT_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0003</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_ADDR_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0004</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589019r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_WRITE_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0005</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589020r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_READ_FAILURE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0006</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589021r21"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_NO_AUTH_KEY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0007</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-589022r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_RPMB_RES_WRITE_COUNTER_EXPIRED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0080</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 133--><p class="noindent" >
<span 
class="aebxti-10">stuff</span> </dt><dd 
class="description">
    <!--l. 133--><p class="noindent" >Padding for the frame.
    </dd><dt class="description">
    <!--l. 135--><p class="noindent" >
<span 
class="aebxti-10">key_mac</span> </dt><dd 
class="description">
    <!--l. 135--><p class="noindent" >is   the   authentication   key   or   the   message   authentication   code
    (MAC)  depending  on  the  request/response  type.  If  the  request  is
    VIRTIO_RPMB_REQ_PROGRAM_KEY, it’s used as an authentication
    key. Otherwise, it’s used as MAC. The MAC is calculated using HMAC
    SHA-256. It takes as input a key and a message. The key used for the MAC
    calculation is always the 256-bit RPMB authentication key. The message
                                                                  

                                                                  
    used as input to the MAC calculation is the concatenation of the fields in
    the RPMB frames excluding stuff bytes and the MAC itself.
    </dd><dt class="description">
    <!--l. 145--><p class="noindent" >
<span 
class="aebxti-10">data</span> </dt><dd 
class="description">
    <!--l. 145--><p class="noindent" >is used to be written or read via authenticated read/write access. It’s fixed
    256B.
    </dd><dt class="description">
    <!--l. 148--><p class="noindent" >
<span 
class="aebxti-10">nonce</span> </dt><dd 
class="description">
    <!--l. 148--><p class="noindent" >is a random number generated by the user for the read or get write counter
    requests and copied to the response by the device. It’s used for anti-replay
    protection.
    </dd><dt class="description">
    <!--l. 152--><p class="noindent" >
<span 
class="aebxti-10">writer_counter</span> </dt><dd 
class="description">
    <!--l. 152--><p class="noindent" >is the counter value for the total amount of the successful authenticated
    data write requests.
    </dd><dt class="description">
    <!--l. 155--><p class="noindent" >
<span 
class="aebxti-10">address</span> </dt><dd 
class="description">
    <!--l. 155--><p class="noindent" >is the address of the data to be written to or read from the RPMB virtio
    device. It is the number of the accessed half sector (256B).
    </dd><dt class="description">
    <!--l. 159--><p class="noindent" >
<span 
class="aebxti-10">block_count</span> </dt><dd 
class="description">
    <!--l. 159--><p class="noindent" >is the number of blocks (256B) requested to be read/written. It’s limited
    by <span 
class="aeti-10">max_wr_cnt </span>or <span 
class="aeti-10">max_rd_cnt</span>. For RPMB read request, one virtio buffer
    including request command and the subsequent [<span 
class="aeti-10">block_count</span>] virtio buffers
    for  response  data  are  placed  in  the  queue.  For  RPMB  write  request,
    [<span 
class="aeti-10">block_count</span>] virtio buffers including request command and data are placed
    in the queue.
    </dd><dt class="description">
    <!--l. 167--><p class="noindent" >
<span 
class="aebxti-10">result</span> </dt><dd 
class="description">
    <!--l. 167--><p class="noindent" >includes information about the status of access made to the device. It is
    written by the device.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 170--><p class="noindent" >
<span 
class="aebxti-10">req_resp</span> </dt><dd 
class="description">
    <!--l. 170--><p class="noindent" >is the type of request or response, to/from the device.</dd></dl>
<a 
 id="x1-589023r591"></a>
<!--l. 173--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.12.6.1.1</span> <a 
 id="x1-5900001"></a>Device Requirements: Device Operation: Program Key</h5>
If VIRTIO_RPMB_REQ_RESULT_READ is requested, the device SHOULD
return the RPMB frame with the response, the calculated MAC and the
result:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">If                         the                         <span 
class="aeti-10">block_count                       </span>is
    not set to 1 then VIRTIO_RPMB_RES_GENERAL_FAILURE SHOULD
    be responded as <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If       the       programming       of       authentication       key       fails,
    then VIRTIO_RPMB_RES_WRITE_FAILURE SHOULD be responded as
    <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If            some            other            error            occurs            then
    returned result VIRTIO_RPMB_RES_GENERAL_FAILURE SHOULD be
    responded as <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">The <span 
class="aeti-10">req_resp </span>value VIRTIO_RPMB_RESP_PROGRAM_KEY SHOULD be
    responded.</dd></dl>
<a 
 id="x1-590005r602"></a>
<!--l. 191--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.12.6.1.2</span> <a 
 id="x1-5910002"></a>Device Requirements: Device Operation: Get Write Counter</h5>
If the authentication key is not yet programmed then VIRTIO_RPMB_RES_NO_AUTH_KEY
SHOULD be returned in <span 
class="aeti-10">result</span>.
<!--l. 196--><p class="noindent" >If block count has not been set to 1 then VIRTIO_RPMB_RES_GENERAL_FAILURE
SHOULD be responded as <span 
class="aeti-10">result</span>.
<!--l. 199--><p class="noindent" >The <span 
class="aeti-10">req_resp </span>value VIRTIO_RPMB_RESP_GET_COUNTER SHOULD be
responded.
<a 
 id="x1-591001r603"></a>
<!--l. 201--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.12.6.1.3</span> <a 
 id="x1-5920003"></a>Device Requirements: Device Operation: Data Write</h5>
If VIRTIO_RPMB_REQ_RESULT_READ is requested, the device SHOULD return
the RPMB data frame with the response VIRTIO_RPMB_RESP_DATA_WRITE, the
incremented counter value, the data address, the calculated MAC and the
                                                                  

                                                                  
result:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">If    the    authentication    key    is    not    yet    programmed,    then
    VIRTIO_RPMB_RES_NO_AUTH_KEY SHOULD be returned in <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If    block    count    is    zero    or    greater    than    <span 
class="aeti-10">max_wr_cnt    </span>then
    VIRTIO_RPMB_RES_GENERAL_FAILURE SHOULD be responded.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">The  device  MUST  check  whether  the  write  counter  has  expired.  If
    the  write  counter  is  expired  then  the  <span 
class="aeti-10">result  </span>SHOULD  be  set  to
    VIRTIO_RPMB_RES_WRITE_COUNTER_EXPIRED.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">If there is an error in the address (out of range) then the <span 
class="aeti-10">result </span>SHOULD
    be set to VIRTIO_RPMB_RES_ADDR_FAILURE.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">The device MUST calculate the MAC taking authentication key and frame
    as input, and compare this with the MAC in the request. If the two MAC’s
    are  different  then  VIRTIO_RPMB_RES_AUTH_FAILURE  SHOULD  be
    returned in <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">If the writer counter in the request is different from the one maintained
    by the device then VIRTIO_RPMB_RES_COUNT_FAILURE SHOULD be
    returned in <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">If the MAC and write counter comparisons are matched then the write
    request  is  considered  to  be  authenticated.  The  data  from  the  request
    SHOULD be written to the address indicated in the request and the write
    counter SHOULD be incremented by 1.
    </dd><dt class="enumerate-enumitem">
  8. </dt><dd 
class="enumerate-enumitem">If      the      write      fails      then      the      <span 
class="aeti-10">result      </span>SHOULD      be
    VIRTIO_RPMB_RES_WRITE_FAILURE.
    </dd><dt class="enumerate-enumitem">
  9. </dt><dd 
class="enumerate-enumitem">If some other error occurs during the writing procedure then the <span 
class="aeti-10">result</span>
    SHOULD be VIRTIO_RPMB_RES_GENERAL_FAILURE.
    </dd><dt class="enumerate-enumitem">
 10. </dt><dd 
class="enumerate-enumitem">The <span 
class="aeti-10">req_resp  </span>value VIRTIO_RPMB_RESP_DATA_WRITE SHOULD be
    responded.</dd></dl>
<a 
 id="x1-592011r604"></a>
                                                                  

                                                                  
<!--l. 240--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.12.6.1.4</span> <a 
 id="x1-5930004"></a>Device Requirements: Device Operation: Data Read</h5>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">If    the    authentication    key    is    not    yet    programmed    then
    VIRTIO_RPMB_RES_NO_AUTH_KEY SHOULD be returned in <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">If     block     count     is     zero     or     greater     than     <span 
class="aeti-10">max_rd_cnt</span>
    then VIRTIO_RPMB_RES_GENERAL_FAILURE SHOULD be responded
    as <span 
class="aeti-10">result</span>.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">If there is an error in the address (out of range) then the <span 
class="aeti-10">result </span>SHOULD
    be set to VIRTIO_RPMB_RES_ADDR_FAILURE.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">If data fetch from addressed location inside the device fails then the <span 
class="aeti-10">result</span>
    SHOULD be VIRTIO_RPMB_RES_READ_FAILURE.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">If  some  other  error  occurs  during  the  read  procedure  then  the  <span 
class="aeti-10">result</span>
    SHOULD be VIRTIO_RPMB_RES_GENERAL_FAILURE.
    </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">The device SHOULD respond with <span 
class="aeti-10">block_count </span>frames containing the data
    and <span 
class="aeti-10">req_resp </span>value set to VIRTIO_RPMB_RESP_DATA_READ.</dd></dl>
<a 
 id="x1-593007r605"></a>
<!--l. 261--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.12.6.1.5</span> <a 
 id="x1-5940005"></a>Device Requirements: Device Operation: Result Read</h5>
If the <span 
class="aeti-10">block_count </span>has not been set to 1 of VIRTIO_RPMB_REQ_RESULT_READ
request then VIRTIO_RPMB_RES_GENERAL_FAILURE SHOULD be responded as
<span 
class="aeti-10">result</span>.
<a 
 id="x1-594001r601"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.12.6.2   </span> <a 
 id="x1-5950002"></a>Driver Requirements: Device Operation</h5>
<!--l. 268--><p class="noindent" >The RPMB frames MUST not be packed by the driver. The driver MUST configure,
initialize and format virtqueue for the RPMB requests received from its caller then
send it to the device.
<a 
 id="x1-595001r607"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.12.6.3   </span> <a 
 id="x1-5960003"></a>Device Requirements: Device Operation</h5>
<!--l. 273--><p class="noindent" >The virtio-rpmb device could be backed in a number of ways. It SHOULD keep
consistent behaviors with hardware as described in paragraph 6.6.22 of <a 
href="#x1-3016x15">eMMC</a>. Some
elements are maintained by the device:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The device MUST maintain a one-time programmable authentication key.
    It cannot be overwritten, erased or read. The key is used to authenticate
                                                                  

                                                                  
    the accesses when MAC is calculated. This key MUST be kept regardless
    of device reset or reboot.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">The device MUST maintain a read-only monotonic write counter. It MUST
    be initialized to zero and added by one automatically along with successful
    write operation. The value cannot be reset. After the counter has reached
    its maximum value 0xFFFF FFFF, it will not be incremented anymore.
    This counter MUST be kept regardless of device reset or reboot.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">The  device  MUST  maintain  the  data  for  read/write  via  authenticated
    access.</dd></dl>
<a 
 id="x1-596004r594"></a>
<h3 class="sectionHead"><span class="titlemark">5.13   </span> <a 
 id="x1-59700013"></a>IOMMU device</h3>
<!--l. 3--><p class="noindent" >The virtio-iommu device manages Direct Memory Access (DMA) from one or more
endpoints. It may act both as a proxy for physical IOMMUs managing devices
assigned to the guest, and as virtual IOMMU managing emulated and paravirtualized
devices.
<!--l. 8--><p class="noindent" >The driver first discovers endpoints managed by the virtio-iommu device using
platform specific mechanisms. It then sends requests to create virtual address spaces
and virtual-to-physical mappings for these endpoints. In its simplest form, the
virtio-iommu supports four request types:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Create a domain and attach an endpoint to it. <br 
class="newline" /><span 
class="pcrr8t-">attach(endpoint = 0x8, domain = 1)</span>
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Create  a  mapping  between  a  range  of  guest-virtual  and  guest-physical
    address. <br 
class="newline" /><span 
class="pcrr8t-">map(domain = 1, virt_start = 0x1000, virt_end =</span>
    <span 
class="pcrr8t-">0x1fff, phys = 0xa000, flags = READ)</span>
    <!--l. 22--><p class="noindent" >Endpoint 0x8, for example a hardware PCI endpoint with BDF 00:01.0,
    can now read at addresses 0x1000-0x1fff. These accesses are translated into
    system-physical addresses by the IOMMU.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Remove the mapping.<br 
class="newline" /><span 
class="pcrr8t-">unmap(domain = 1, virt_start = 0x1000, virt_end =</span>
    <span 
class="pcrr8t-">0x1fff)</span>
    <!--l. 29--><p class="noindent" >Any  access  to  addresses  0x1000-0x1fff  by  endpoint  0x8  would  now  be
    rejected.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Detach the device and remove the domain.<br 
class="newline" /><span 
class="pcrr8t-">detach(endpoint = 0x8, domain = 1)</span></dd></dl>
<a 
 id="x1-597005r600"></a>
<h4 class="subsectionHead"><span class="titlemark">5.13.1   </span> <a 
 id="x1-5980001"></a>Device ID</h4>
<!--l. 37--><p class="noindent" >23
<a 
 id="x1-598001r610"></a>
<h4 class="subsectionHead"><span class="titlemark">5.13.2   </span> <a 
 id="x1-5990002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 42--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >requestq
    </dd><dt class="description">
    <!--l. 43--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 43--><p class="noindent" >eventq</dd></dl>
<a 
 id="x1-599001r611"></a>
<h4 class="subsectionHead"><span class="titlemark">5.13.3   </span> <a 
 id="x1-6000003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 49--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_F_INPUT_RANGE (0)</span> </dt><dd 
class="description">
    <!--l. 49--><p class="noindent" >Available range of virtual addresses is described in <span 
class="aeti-10">input_range</span>.
    </dd><dt class="description">
    <!--l. 53--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_F_DOMAIN_RANGE (1)</span> </dt><dd 
class="description">
    <!--l. 53--><p class="noindent" >The number of domains supported is described in <span 
class="aeti-10">domain_range</span>.
    </dd><dt class="description">
    <!--l. 56--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_F_MAP_UNMAP (2)</span> </dt><dd 
class="description">
    <!--l. 56--><p class="noindent" >Map and unmap requests are available.<span class="footnote-mark"><a 
href="#fn21x5" id="fn21x5-bk"><sup class="textsuperscript">21</sup></a></span><a 
 id="x1-600001f21"></a>
    </dd><dt class="description">
    <!--l. 61--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_F_BYPASS (3)</span> </dt><dd 
class="description">
    <!--l. 61--><p class="noindent" >Endpoints that are not attached to a domain are in bypass mode.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 64--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_F_PROBE (4)</span> </dt><dd 
class="description">
    <!--l. 64--><p class="noindent" >The PROBE request is available.
    </dd><dt class="description">
    <!--l. 67--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_F_MMIO (5)</span> </dt><dd 
class="description">
    <!--l. 67--><p class="noindent" >The VIRTIO_IOMMU_MAP_F_MMIO flag is available.
    </dd><dt class="description">
    <!--l. 70--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_F_BYPASS_CONFIG (6)</span> </dt><dd 
class="description">
    <!--l. 70--><p class="noindent" >Field <span 
class="aeti-10">bypass </span>of struct virtio_iommu_config determines whether endpoints
    that   are   not   attached   to   a   domain   are   in   bypass   mode.   Flag
    VIRTIO_IOMMU_ATTACH_F_BYPASS  determines  whether  endpoints
    that are attached to a domain are in bypass mode.
    </dd></dl>
<a 
 id="x1-600002r608"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.3.1   </span> <a 
 id="x1-6010001"></a>Driver Requirements: Feature bits</h5>
<!--l. 81--><p class="noindent" >The driver SHOULD accept any of the VIRTIO_IOMMU_F_INPUT_RANGE,
VIRTIO_IOMMU_F_DOMAIN_RANGE and VIRTIO_IOMMU_F_PROBE feature
bits if offered by the device.
<a 
 id="x1-601001r613"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.3.2   </span> <a 
 id="x1-6020002"></a>Device Requirements: Feature bits</h5>
<!--l. 87--><p class="noindent" >The device SHOULD offer feature bit VIRTIO_IOMMU_F_MAP_UNMAP.
<!--l. 89--><p class="noindent" >The VIRTIO_IOMMU_F_BYPASS_CONFIG feature supersedes VIRTIO_IOMMU_F_BYPASS.
New devices SHOULD NOT offer VIRTIO_IOMMU_F_BYPASS. Devices SHOULD NOT
offer both VIRTIO_IOMMU_F_BYPASS and VIRTIO_IOMMU_F_BYPASS_CONFIG.
<a 
 id="x1-602001r612"></a>
<h4 class="subsectionHead"><span class="titlemark">5.13.4   </span> <a 
 id="x1-6030004"></a>Device configuration layout</h4>
<!--l. 96--><p class="noindent" >The <span 
class="aeti-10">page_size_mask </span>field is always present. Availability of the others all depend on
feature bits described in <a 
href="#x1-6000003">5.13.3<!--tex4ht:ref: sec:Device Types / IOMMU Device / Feature bits --></a>.
<!--l. 100-->
<pre class="lstlisting" id="listing-234"><span class="label"><a 
 id="x1-603001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">page_size_mask</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_range_64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">input_range</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_range_32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">domain_range</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">probe_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bypass</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-603014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-603015r614"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.13.4.1   </span> <a 
 id="x1-6040001"></a>Driver Requirements: Device configuration layout</h5>
<!--l. 119--><p class="noindent" >When the VIRTIO_IOMMU_F_BYPASS_CONFIG feature is negotiated, the driver
MAY write to <span 
class="aeti-10">bypass</span>. The driver MUST NOT write to any other device configuration
field.
<!--l. 123--><p class="noindent" >The driver MUST NOT write a value different than 0 or 1 to <span 
class="aeti-10">bypass</span>. The driver
SHOULD ignore bits 1-7 of <span 
class="aeti-10">bypass</span>.
<a 
 id="x1-604001r616"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.4.2   </span> <a 
 id="x1-6050002"></a>Device Requirements: Device configuration layout</h5>
<!--l. 129--><p class="noindent" >The device MUST set at least one bit in <span 
class="aeti-10">page_size_mask</span>, describing the page
granularity. The device MAY set more than one bit in <span 
class="aeti-10">page_size_mask</span>.
<!--l. 133--><p class="noindent" >If the device offers the VIRTIO_IOMMU_F_BYPASS_CONFIG feature, it MAY
initialize the <span 
class="aeti-10">bypass </span>field to 1. Field <span 
class="aeti-10">bypass </span>SHOULD NOT change on device reset,
but SHOULD be restored to its initial value on system reset.
<!--l. 138--><p class="noindent" >The device MUST NOT present a value different than 0 or 1 in <span 
class="aeti-10">bypass</span>.
<a 
 id="x1-605001r615"></a>
<h4 class="subsectionHead"><span class="titlemark">5.13.5   </span> <a 
 id="x1-6060005"></a>Device initialization</h4>
<!--l. 143--><p class="noindent" >When the device is reset, endpoints are not attached to any domain.
<!--l. 145--><p class="noindent" >Future devices might support more modes of operation besides MAP/UNMAP.
Drivers verify that devices set VIRTIO_IOMMU_F_MAP_UNMAP and fail gracefully
if they don’t.
<a 
 id="x1-606001r617"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.5.1   </span> <a 
 id="x1-6070001"></a>Driver Requirements: Device Initialization</h5>
<!--l. 151--><p class="noindent" >The driver MUST NOT negotiate VIRTIO_IOMMU_F_MAP_UNMAP if it is
incapable of sending VIRTIO_IOMMU_T_MAP and VIRTIO_IOMMU_T_UNMAP
requests.
<!--l. 154--><p class="noindent" >If the VIRTIO_IOMMU_F_PROBE feature is negotiated, the driver SHOULD send a
VIRTIO_IOMMU_T_PROBE request for each endpoint before attaching the endpoint
to a domain.
<a 
 id="x1-607001r618"></a>
<h4 class="subsectionHead"><span class="titlemark">5.13.6   </span> <a 
 id="x1-6080006"></a>Device operations</h4>
<!--l. 160--><p class="noindent" >Driver send requests on the request virtqueue, notifies the device and waits for the
device to return the request with a status in the used ring. All requests are split in
two parts: one device-readable, one device- writable.
<!--l. 165-->
<pre class="lstlisting" id="listing-235"><span class="label"><a 
 id="x1-608001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_tail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 177--><p class="noindent" >Type may be one of:
                                                                  

                                                                  
<!--l. 179-->
<pre class="lstlisting" id="listing-236"><span class="label"><a 
 id="x1-608010r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_T_ATTACH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608011r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_T_DETACH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608012r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_T_MAP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608013r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_T_UNMAP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608014r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_T_PROBE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span></pre>
<!--l. 187--><p class="noindent" >A few general-purpose status codes are defined here.
<!--l. 189-->
<pre class="lstlisting" id="listing-237"><span class="label"><a 
 id="x1-608015r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">All</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">good</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">!</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Carry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">on</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608016r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608017r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Virtio</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">communication</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">error</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608018r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_IOERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608019r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Unsupported</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608020r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_UNSUPP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608021r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Internal</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">error</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608022r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_DEVERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608023r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Invalid</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parameters</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608024r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_INVAL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608025r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Out</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">range</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parameters</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608026r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_RANGE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">5</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608027r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Entry</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">not</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">found</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608028r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_NOENT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">6</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608029r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Bad</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">address</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608030r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_FAULT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">7</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608031r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Insufficient</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">resources</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-608032r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_S_NOMEM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span></pre>
<!--l. 210--><p class="noindent" >When the device fails to parse a request, for instance if a request is too small for its
type and the device cannot find the tail, then it is unable to set <span 
class="aeti-10">status</span>. In that case,
it returns the buffers without writing to them.
<!--l. 215--><p class="noindent" >Range limits of some request fields are described in the device configuration:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 219--><p class="noindent" ><span 
class="aeti-10">page_size_mask </span>contains the bitmask of all page sizes that can be mapped.
    The  least  significant  bit  set  defines  the  page  granularity  of  IOMMU
    mappings.
    <!--l. 223--><p class="noindent" >The smallest page granularity supported by the IOMMU is one byte. It is
    legal for the driver to map one byte at a time if bit 0 of <span 
class="aeti-10">page_size_mask </span>is
    set.
    <!--l. 227--><p class="noindent" >Other bits in <span 
class="aeti-10">page_size_mask </span>are hints and describe larger page sizes that
    the IOMMU device handles efficiently. For example, when the device stores
    mappings using a page table tree, it may be able to describe large mappings
    using a few leaf entries in intermediate tables, rather than using lots of
    entries in the last level of the tree. Creating mappings aligned on large
    page sizes can improve performance since they require fewer page table and
    TLB entries.
    </li>
    <li class="itemize">
    <!--l. 235--><p class="noindent" >If       the       VIRTIO_IOMMU_F_DOMAIN_RANGE       feature       is
    offered, <span 
class="aeti-10">domain_range </span>describes the values supported in a <span 
class="aeti-10">domain </span>field. If
    the feature is not offered, any <span 
class="aeti-10">domain </span>value is valid.
    </li>
    <li class="itemize">
    <!--l. 239--><p class="noindent" >If the VIRTIO_IOMMU_F_INPUT_RANGE feature is offered, <span 
class="aeti-10">input_range</span>
    contains the virtual address range that the IOMMU is able to translate.
    Any mapping request to virtual addresses outside of this range fails.
    <!--l. 244--><p class="noindent" >If the feature is not offered, virtual mappings span over the whole 64-bit
    address space (<span 
class="pcrr8t-">start = 0, end = 0xffffffff ffffffff</span>)</li></ul>
                                                                  

                                                                  
<!--l. 248--><p class="noindent" >An endpoint is in bypass mode if:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 250--><p class="noindent" >the VIRTIO_IOMMU_F_BYPASS_CONFIG feature is offered and:
        <ul class="itemize2">
        <li class="itemize">
        <!--l. 252--><p class="noindent" >config  field  <span 
class="aeti-10">bypass  </span>is  1  and  the  endpoint  is  not  attached  to
        a   domain.   This   applies   even   if   the   driver   does   not   accept
        the  VIRTIO_IOMMU_F_BYPASS_CONFIG  feature  and  the  device
        initializes field <span 
class="aeti-10">bypass </span>to 1.
        <!--l. 257--><p class="noindent" >or
        </li>
        <li class="itemize">
        <!--l. 258--><p class="noindent" >the      endpoint      is      attached      to      a      domain      with
        VIRTIO_IOMMU_ATTACH_F_BYPASS.</li></ul>
    <!--l. 261--><p class="noindent" >or
    </li>
    <li class="itemize">
    <!--l. 262--><p class="noindent" >the VIRTIO_IOMMU_F_BYPASS feature is negotiated and the endpoint is not
    attached to a domain.</li></ul>
<!--l. 266--><p class="noindent" >All accesses from an endpoint in bypass mode are allowed and translated by the
IOMMU using the identity function.
<a 
 id="x1-608033r619"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.1   </span> <a 
 id="x1-6090001"></a>Driver Requirements: Device operations</h5>
<!--l. 271--><p class="noindent" >The driver SHOULD set field <span 
class="aeti-10">reserved </span>of struct virtio_iommu_req_head to zero and
MUST ignore field <span 
class="aeti-10">reserved </span>of struct virtio_iommu_req_tail.
<!--l. 275--><p class="noindent" >When a device uses a buffer without having written to it (i.e. used length is zero), the
driver SHOULD interpret it as a request failure.
<!--l. 278--><p class="noindent" >If the VIRTIO_IOMMU_F_INPUT_RANGE feature is negotiated, the driver MUST
NOT send requests with <span 
class="aeti-10">virt_start </span>less than <span 
class="aeti-10">input_range.start </span>or <span 
class="aeti-10">virt_end </span>greater
than <span 
class="aeti-10">input_range.end</span>.
<!--l. 283--><p class="noindent" >If the VIRTIO_IOMMU_F_DOMAIN_RANGE feature is negotiated, the driver
MUST NOT send requests with <span 
class="aeti-10">domain </span>less than <span 
class="aeti-10">domain_range.start </span>or greater than
<span 
class="aeti-10">domain_range.end</span>.
<a 
 id="x1-609001r621"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.2   </span> <a 
 id="x1-6100002"></a>Device Requirements: Device operations</h5>
<!--l. 289--><p class="noindent" >The device SHOULD set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_OK if a request succeeds.
<!--l. 292--><p class="noindent" >If a request <span 
class="aeti-10">type </span>is not recognized, the device SHOULD NOT write the buffer and
SHOULD set the used length to zero.
<!--l. 295--><p class="noindent" >The device MUST ignore field <span 
class="aeti-10">reserved </span>of struct virtio_iommu_req_head and
SHOULD set field <span 
class="aeti-10">reserved </span>of struct virtio_iommu_req_tail to zero.
<!--l. 299--><p class="noindent" >The device SHOULD NOT let unattached endpoints that are not in bypass mode
access the guest-physical address space.
<a 
 id="x1-610001r622"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.3   </span> <a 
 id="x1-6110003"></a>ATTACH request</h5>
<!--l. 304-->
<pre class="lstlisting" id="listing-238"><span class="label"><a 
 id="x1-611001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_attach</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">domain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">endpoint</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_tail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-611010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_ATTACH_F_BYPASS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span></pre>
<!--l. 317--><p class="noindent" >Attach an endpoint to a domain. <span 
class="aeti-10">domain </span>uniquely identifies a domain within the
virtio-iommu device. If the domain doesn’t exist in the device, it is created.
Semantics of the <span 
class="aeti-10">endpoint </span>identifier are platform specific, but the following rules
apply:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 323--><p class="noindent" >The endpoint ID uniquely identifies an endpoint from the virtio-iommu
    point  of  view.  Multiple  endpoints  whose  DMA  transactions  are  not
    translated by the same virtio-iommu device can have the same endpoint
    ID. Endpoints whose DMA transactions may be translated by the same
    virtio-iommu device have different endpoint IDs.
    </li>
    <li class="itemize">
    <!--l. 329--><p class="noindent" >On some platforms, it might not be possible to completely isolate two
    endpoints  from  each  other.  For  example  on  a  conventional  PCI  bus,
    endpoints can snoop DMA transactions from other endpoints on the same
    bus. Such limitations need to be communicated in a platform specific way.</li></ul>
<!--l. 336--><p class="noindent" >Multiple endpoints can be attached to the same domain. An endpoint can be
attached to a single domain at a time. Endpoints attached to different domains are
isolated from each other.
<!--l. 340--><p class="noindent" >When the VIRTIO_IOMMU_F_BYPASS_CONFIG is negotiated, the driver can set
the VIRTIO_IOMMU_ATTACH_F_BYPASS flag to create a bypass domain.
Endpoints attached to this domain are in bypass mode.
<a 
 id="x1-611011r606"></a>
                                                                  

                                                                  
<!--l. 344--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.3.1</span> <a 
 id="x1-6120001"></a>Driver Requirements: ATTACH request</h5>
The driver SHOULD set <span 
class="aeti-10">reserved </span>to zero.
<!--l. 348--><p class="noindent" >The driver SHOULD ensure that endpoints that cannot be isolated from each other
are attached to the same domain.
<!--l. 351--><p class="noindent" >If the domain already exists and is a bypass domain, the driver SHOULD set the
VIRTIO_IOMMU_ATTACH_F_BYPASS flag. If the domain exists and is not a bypass
domain, the driver SHOULD NOT set the VIRTIO_IOMMU_ATTACH_F_BYPASS
flag.
<a 
 id="x1-612001r624"></a>
<!--l. 356--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.3.2</span> <a 
 id="x1-6130002"></a>Device Requirements: ATTACH request</h5>
If the <span 
class="aeti-10">reserved </span>field of an ATTACH request is not zero, the device MUST reject the
request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_INVAL.
<!--l. 361--><p class="noindent" >If the device does not recognize a <span 
class="aeti-10">flags </span>bit, it MUST reject the request and set <span 
class="aeti-10">status</span>
to VIRTIO_IOMMU_S_INVAL.
<!--l. 365--><p class="noindent" >If the endpoint identified by <span 
class="aeti-10">endpoint </span>doesn’t exist, the device MUST reject the
request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_NOENT.
<!--l. 368--><p class="noindent" >If another endpoint is already attached to the domain identified by <span 
class="aeti-10">domain</span>, then
the device MAY attach the endpoint identified by <span 
class="aeti-10">endpoint </span>to the domain.
If it cannot do so, the device MUST reject the request and set <span 
class="aeti-10">status </span>to
VIRTIO_IOMMU_S_UNSUPP.
<!--l. 373--><p class="noindent" >If the domain already exists and the VIRTIO_IOMMU_ATTACH_F_BYPASS flag is
not consistent with that domain, the device SHOULD reject the request and set
<span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_INVAL.
<!--l. 377--><p class="noindent" >If the endpoint identified by <span 
class="aeti-10">endpoint </span>is already attached to another domain, then
the device SHOULD first detach it from that domain and attach it to the one
identified by <span 
class="aeti-10">domain</span>. In that case the device SHOULD behave as if the driver issued
a DETACH request with this <span 
class="aeti-10">endpoint</span>, followed by the ATTACH request.
If the device cannot do so, it MUST reject the request and set <span 
class="aeti-10">status </span>to
VIRTIO_IOMMU_S_UNSUPP.
<!--l. 385--><p class="noindent" >If properties of the endpoint (obtained with a PROBE request) are compatible with
properties of other endpoints already attached to the requested domain, then the
device SHOULD attach the endpoint. Otherwise the device SHOULD reject the
request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_UNSUPP.
<!--l. 391--><p class="noindent" >A device that does not reject the request MUST attach the endpoint.
<a 
 id="x1-613001r623"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.4   </span> <a 
 id="x1-6140004"></a>DETACH request</h5>
<!--l. 395-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-239"><span class="label"><a 
 id="x1-614001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_detach</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-614002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-614003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">domain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-614004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">endpoint</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-614005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[8];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-614006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_tail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-614007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 405--><p class="noindent" >Detach an endpoint from a domain. When this request completes, the endpoint
cannot access any mapping from that domain anymore. However the endpoint may
then be in bypass mode and access the guest-physical address space.
<!--l. 410--><p class="noindent" >After all endpoints have been successfully detached from a domain, it ceases to exist
and its ID can be reused by the driver for another domain.
<a 
 id="x1-614008r625"></a>
<!--l. 413--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.4.1</span> <a 
 id="x1-6150001"></a>Driver Requirements: DETACH request</h5>
The driver SHOULD set <span 
class="aeti-10">reserved </span>to zero.
<a 
 id="x1-615001r627"></a>
<!--l. 417--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.4.2</span> <a 
 id="x1-6160002"></a>Device Requirements: DETACH request</h5>
The device MUST ignore <span 
class="aeti-10">reserved</span>.
<!--l. 421--><p class="noindent" >If the endpoint identified by <span 
class="aeti-10">endpoint </span>doesn’t exist, then the device MUST reject the
request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_NOENT.
<!--l. 425--><p class="noindent" >If the domain identified by <span 
class="aeti-10">domain </span>doesn’t exist, or if the endpoint identified by
<span 
class="aeti-10">endpoint </span>isn’t attached to this domain, then the device MAY set the request <span 
class="aeti-10">status </span>to
VIRTIO_IOMMU_S_INVAL.
<!--l. 430--><p class="noindent" >The device MUST ensure that after being detached from a domain, the endpoint
cannot access any mapping from that domain.
<a 
 id="x1-616001r626"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.5   </span> <a 
 id="x1-6170005"></a>MAP request</h5>
<!--l. 435-->
<pre class="lstlisting" id="listing-240"><span class="label"><a 
 id="x1-617001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_map</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">domain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">phys_start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_tail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Read</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">access</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">allowed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_MAP_F_READ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Write</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">access</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">allowed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_MAP_F_WRITE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Accesses</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">memory</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mapped</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">I</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">O</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-617016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_MAP_F_MMIO</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2)</span></span></pre>
<!--l. 454--><p class="noindent" >Map a range of virtually-contiguous addresses to a range of physically-contiguous
addresses of the same size. After the request succeeds, all endpoints attached to this
domain can access memory in the range <span 
class="cmr-10">[</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">start</span><span 
class="cmr-10">;</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">end</span><span 
class="cmr-10">] </span>(inclusive). For
example, if an endpoint accesses address <span 
class="cmmi-10">V A </span><span 
class="cmsy-10">∈ </span><span 
class="cmr-10">[</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">start</span><span 
class="cmr-10">;</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">end</span><span 
class="cmr-10">]</span>, the device (or
the physical IOMMU) translates the address: <span 
class="cmmi-10">PA </span><span 
class="cmr-10">= </span><span 
class="cmmi-10">V A</span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">start </span><span 
class="cmr-10">+ </span><span 
class="cmmi-10">phys</span>_<span 
class="cmmi-10">start</span>. If
the access parameters are compatible with <span 
class="aeti-10">flags </span>(for instance, the access is write and
<span 
class="aeti-10">flags </span>are VIRTIO_IOMMU_MAP_F_READ | VIRTIO_IOMMU_MAP_F_WRITE)
then the IOMMU allows the access to reach <span 
class="cmmi-10">PA</span>.
<!--l. 465--><p class="noindent" >The range defined by <span 
class="aeti-10">virt_start </span>and <span 
class="aeti-10">virt_end </span>should be within the limits specified by
<span 
class="aeti-10">input_range</span>. Given <span 
class="cmmi-10">phys</span>_<span 
class="cmmi-10">end </span><span 
class="cmr-10">= </span><span 
class="cmmi-10">phys</span>_<span 
class="cmmi-10">start </span><span 
class="cmr-10">+ </span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">end</span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">start</span>, the range defined
by <span 
class="aeti-10">phys_start </span>and phys_end should be within the guest-physical address space. This
includes upper and lower limits, as well as any carving of guest-physical addresses for
                                                                  

                                                                  
use by the host. Guest physical boundaries are set by the host in a platform specific
way.
<!--l. 473--><p class="noindent" >Availability and allowed combinations of <span 
class="aeti-10">flags </span>depend on the underlying IOMMU
architectures. VIRTIO_IOMMU_MAP_F_READ and VIRTIO_IOMMU_MAP_F_WRITE
are usually implemented, although READ is sometimes implied by WRITE.
In addition combinations such as "WRITE and not READ" might not be
supported.
<!--l. 479--><p class="noindent" >The VIRTIO_IOMMU_MAP_F_MMIO flag is a memory type rather than a
protection flag. It is only available when the VIRTIO_IOMMU_F_MMIO feature
has been negotiated. Accesses to the mapping are not speculated, buffered,
cached, split into multiple accesses or combined with other accesses. It may be
used, for example, to map Message Signaled Interrupt doorbells when a
VIRTIO_IOMMU_RESV_MEM_T_MSI region isn’t available. To trigger interrupts
the endpoint performs a direct memory write to another peripheral, the IRQ
chip.
<!--l. 488--><p class="noindent" >This request is only available when VIRTIO_IOMMU_F_MAP_UNMAP has been
negotiated.
<a 
 id="x1-617017r628"></a>
<!--l. 491--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.5.1</span> <a 
 id="x1-6180001"></a>Driver Requirements: MAP request</h5>
The driver SHOULD set undefined <span 
class="aeti-10">flags </span>bits to zero.
<!--l. 495--><p class="noindent" >The driver SHOULD NOT send MAP requests on a bypass domain.
<!--l. 497--><p class="noindent" ><span 
class="aeti-10">virt_end </span>MUST be strictly greater than <span 
class="aeti-10">virt_start</span>.
<!--l. 499--><p class="noindent" >The driver SHOULD set the VIRTIO_IOMMU_MAP_F_MMIO flag when the
physical range corresponds to memory-mapped device registers. The physical range
SHOULD have a single memory type: either normal memory or memory-mapped
I/O.
<!--l. 504--><p class="noindent" >If it intends to allow read accesses from endpoints attached to the domain, the driver
MUST set the VIRTIO_IOMMU_MAP_F_READ flag.
<!--l. 507--><p class="noindent" >If the VIRTIO_IOMMU_F_MMIO feature isn’t negotiated, the driver MUST NOT
use the VIRTIO_IOMMU_MAP_F_MMIO flag.
<a 
 id="x1-618001r630"></a>
<!--l. 510--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.5.2</span> <a 
 id="x1-6190002"></a>Device Requirements: MAP request</h5>
If <span 
class="aeti-10">virt_start</span>, <span 
class="aeti-10">phys_start </span>or (<span 
class="aeti-10">virt_end </span>+ 1) is not aligned on the page granularity, the
device SHOULD reject the request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_RANGE.
<!--l. 516--><p class="noindent" >If a mapping already exists in the requested range, the device SHOULD reject the
request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_INVAL.
<!--l. 519--><p class="noindent" >If the device doesn’t recognize a <span 
class="aeti-10">flags </span>bit, it MUST reject the request and set <span 
class="aeti-10">status</span>
                                                                  

                                                                  
to VIRTIO_IOMMU_S_INVAL.
<!--l. 522--><p class="noindent" >If <span 
class="aeti-10">domain </span>does not exist, the device SHOULD reject the request and set <span 
class="aeti-10">status </span>to
VIRTIO_IOMMU_S_NOENT.
<!--l. 525--><p class="noindent" >If the domain is a bypass domain, the device SHOULD reject the request and set
<span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_INVAL.
<!--l. 528--><p class="noindent" >The device MUST NOT allow writes to a range mapped without the
VIRTIO_IOMMU_MAP_F_WRITE flag. However, if the underlying architecture does
not support write-only mappings, the device MAY allow reads to a range mapped
with VIRTIO_IOMMU_MAP_F_WRITE but not VIRTIO_IOMMU_MAP_F_READ.
<a 
 id="x1-619001r629"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.6   </span> <a 
 id="x1-6200006"></a>UNMAP request</h5>
<!--l. 536-->
<pre class="lstlisting" id="listing-241"><span class="label"><a 
 id="x1-620001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_unmap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">domain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_tail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 547--><p class="noindent" >Unmap a range of addresses mapped with VIRTIO_IOMMU_T_MAP. We define here
a mapping as a virtual region created with a single MAP request. All mappings
covered by the range <span 
class="cmr-10">[</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">start</span><span 
class="cmr-10">;</span><span 
class="cmmi-10">virt</span>_<span 
class="cmmi-10">end</span><span 
class="cmr-10">] </span>(inclusive) are removed.
<!--l. 552--><p class="noindent" >The semantics of unmapping are specified in <a 
href="#x1-6210001">5.13.6.6.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / UNMAP request --></a> and <a 
href="#x1-6220002">5.13.6.6.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / UNMAP request --></a>, and illustrated
with the following requests, assuming each example sequence starts with a blank
address space. We define two pseudocode functions <span 
class="pcrr8t-">map(virt_start,</span>
<span 
class="pcrr8t-">virt_end) -&gt; mapping </span>and <span 
class="pcrr8t-">unmap(virt_start, virt_end)</span>.
<!--l. 560-->
<pre class="lstlisting" id="listing-242"><span class="label"><a 
 id="x1-620009r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620010r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=4)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">succeeds</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">doesn</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">anything</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620011r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620012r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(2)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620013r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virt_end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=9)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620014r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">succeeds</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmaps</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620015r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620016r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(3)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620017r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(5,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620018r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">succeeds</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmaps</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620019r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620020r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(4)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620021r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fails</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">doesn</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">anything</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620022r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620023r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(5)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620024r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(5,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620025r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">succeeds</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmaps</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620026r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620027r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(6)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620028r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">9)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">succeeds</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmaps</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620029r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620030r22"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(7)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620031r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(10,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">14)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-620032r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmap</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(0,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">14)</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">succeeds</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unmaps</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">b</span></span></pre>
<!--l. 587--><p class="noindent" >As illustrated by example (4), partially removing a mapping isn’t supported.
<!--l. 590--><p class="noindent" >This request is only available when VIRTIO_IOMMU_F_MAP_UNMAP has been
negotiated.
<a 
 id="x1-620033r631"></a>
<!--l. 593--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.6.1</span> <a 
 id="x1-6210001"></a>Driver Requirements: UNMAP request</h5>
The driver SHOULD set the <span 
class="aeti-10">reserved </span>field to zero.
<!--l. 597--><p class="noindent" >The range, defined by <span 
class="aeti-10">virt_start </span>and <span 
class="aeti-10">virt_end</span>, SHOULD cover one or more contiguous
mappings created with MAP requests. The range MAY spill over unmapped virtual
addresses.
<!--l. 601--><p class="noindent" >The first address of a range MUST either be the first address of a mapping or be
outside any mapping. The last address of a range MUST either be the last address of
a mapping or be outside any mapping.
                                                                  

                                                                  
<!--l. 605--><p class="noindent" >The driver SHOULD NOT send UNMAP requests on a bypass domain.
<a 
 id="x1-621001r633"></a>
<!--l. 607--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.6.2</span> <a 
 id="x1-6220002"></a>Device Requirements: UNMAP request</h5>
If the <span 
class="aeti-10">reserved </span>field of an UNMAP request is not zero, the device MAY set the
request <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_INVAL, in which case the device MAY perform
the UNMAP operation.
<!--l. 613--><p class="noindent" >If <span 
class="aeti-10">domain </span>does not exist, the device SHOULD set the request <span 
class="aeti-10">status </span>to
VIRTIO_IOMMU_S_NOENT.
<!--l. 616--><p class="noindent" >If the domain is a bypass domain, the device SHOULD reject the request and set
<span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_INVAL.
<!--l. 619--><p class="noindent" >If a mapping affected by the range is not covered in its entirety by the range (the
UNMAP request would split the mapping), then the device SHOULD set the request
<span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_RANGE, and SHOULD NOT remove any
mapping.
<!--l. 624--><p class="noindent" >If part of the range or the full range is not covered by an existing mapping, then the
device SHOULD remove all mappings affected by the range and set the request <span 
class="aeti-10">status</span>
to VIRTIO_IOMMU_S_OK.
<a 
 id="x1-622001r632"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.7   </span> <a 
 id="x1-6230007"></a>PROBE request</h5>
<!--l. 630--><p class="noindent" >If the VIRTIO_IOMMU_F_PROBE feature bit is present, the driver sends a
VIRTIO_IOMMU_T_PROBE request for each endpoint that the virtio-iommu
device manages. This probe is performed before attaching the endpoint to a
domain.
<!--l. 635-->
<pre class="lstlisting" id="listing-243"><span class="label"><a 
 id="x1-623001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_probe</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">readable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">endpoint</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[64];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">properties</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">probe_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_req_tail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 649--><p class="noindent" >
<span 
class="aebxti-10">endpoint</span> </dt><dd 
class="description">
    <!--l. 649--><p class="noindent" >has the same meaning as in ATTACH and DETACH requests.
    </dd><dt class="description">
    <!--l. 652--><p class="noindent" >
<span 
class="aebxti-10">reserved</span> </dt><dd 
class="description">
    <!--l. 652--><p class="noindent" >is  used  as  padding,  so  that  future  extensions  can  add  fields  to  the
    device-readable part.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 655--><p class="noindent" >
<span 
class="aebxti-10">properties</span> </dt><dd 
class="description">
    <!--l. 655--><p class="noindent" >contains a list of properties of the <span 
class="aeti-10">endpoint</span>, filled by the device. The length
    of the <span 
class="aeti-10">properties </span>field is <span 
class="aeti-10">probe_size </span>bytes. Each property is described with
    a struct virtio_iommu_probe_property header, which may be followed by a
    value of size <span 
class="aeti-10">length</span>.
    <!--l. 661-->
    <pre class="lstlisting" id="listing-244"><span class="label"><a 
 id="x1-623011r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_probe_property</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623012r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623013r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">12;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623014r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623015r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623016r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-623017r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    
    </dd></dl>
<!--l. 673--><p class="noindent" >The driver allocates a buffer for the PROBE request, large enough to accommodate
<span 
class="aeti-10">probe_size </span>bytes of <span 
class="aeti-10">properties</span>. It writes <span 
class="aeti-10">endpoint </span>and adds the buffer to the request
queue. The device fills the <span 
class="aeti-10">properties </span>field with a list of properties for this
endpoint.
<!--l. 679--><p class="noindent" >The driver parses the first property by reading <span 
class="aeti-10">type</span>, then <span 
class="aeti-10">length</span>. If the driver
recognizes <span 
class="aeti-10">type</span>, it reads and handles the rest of the property. The driver then reads
the next property, that is located <span 
class="cmr-10">(</span><span 
class="aeti-10">length</span> <span 
class="cmr-10">+ 4) </span>bytes after the beginning of the first
one, and so on. The driver parses all properties until it reaches an empty property
(<span 
class="aeti-10">type </span>is 0) or the end of <span 
class="aeti-10">properties</span>.
<!--l. 686--><p class="noindent" >Available property types are described in section <a 
href="#x1-6260008">5.13.6.8<!--tex4ht:ref: sec:Device Types / IOMMU Device / Device operations / PROBE properties --></a>.
<a 
 id="x1-623018r634"></a>
<!--l. 689--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.7.1</span> <a 
 id="x1-6240001"></a>Driver Requirements: PROBE request</h5>
The size of <span 
class="aeti-10">properties </span>MUST be <span 
class="aeti-10">probe_size </span>bytes.
<!--l. 693--><p class="noindent" >The driver SHOULD set field <span 
class="aeti-10">reserved </span>of the PROBE request to zero.
<!--l. 695--><p class="noindent" >If the driver doesn’t recognize the <span 
class="aeti-10">type </span>of a property, it SHOULD ignore the
property.
<!--l. 698--><p class="noindent" >The driver SHOULD NOT deduce the property length from <span 
class="aeti-10">type</span>.
<!--l. 700--><p class="noindent" >The driver MUST ignore a property whose <span 
class="aeti-10">reserved </span>field is not zero.
<!--l. 703--><p class="noindent" >If the driver ignores a property, it SHOULD continue parsing the list.
<a 
 id="x1-624001r636"></a>
<!--l. 705--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.7.2</span> <a 
 id="x1-6250002"></a>Device Requirements: PROBE request</h5>
The device MUST ignore field <span 
class="aeti-10">reserved </span>of a PROBE request.
<!--l. 709--><p class="noindent" >If the endpoint identified by <span 
class="aeti-10">endpoint </span>doesn’t exist, then the device SHOULD reject
the request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_NOENT.
                                                                  

                                                                  
<!--l. 713--><p class="noindent" >If the device does not offer the VIRTIO_IOMMU_F_PROBE feature, and if the driver
sends a VIRTIO_IOMMU_T_PROBE request, then the device SHOULD NOT write
the buffer and SHOULD set the used length to zero.
<!--l. 717--><p class="noindent" >The device SHOULD set field <span 
class="aeti-10">reserved </span>of a property to zero.
<!--l. 719--><p class="noindent" >The device MUST write the size of a property without the struct
virtio_iommu_probe_property header, in bytes, into <span 
class="aeti-10">length</span>.
<!--l. 722--><p class="noindent" >When two properties follow each other, the device MUST put the second property
exactly <span 
class="cmr-10">(</span><span 
class="aeti-10">length</span> <span 
class="cmr-10">+ 4) </span>bytes after the beginning of the first one.
<!--l. 726--><p class="noindent" >If the <span 
class="aeti-10">properties </span>list is smaller than <span 
class="aeti-10">probe_size</span>, the device SHOULD NOT write any
property. It SHOULD reject the request and set <span 
class="aeti-10">status </span>to VIRTIO_IOMMU_S_INVAL.
<!--l. 730--><p class="noindent" >If the device doesn’t fill all <span 
class="aeti-10">probe_size </span>bytes with properties, it SHOULD fill the
remaining bytes of <span 
class="aeti-10">properties </span>with zeroes.
<a 
 id="x1-625001r635"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.8   </span> <a 
 id="x1-6260008"></a>PROBE properties</h5>
<!--l. 735-->
<pre class="lstlisting" id="listing-245"><span class="label"><a 
 id="x1-626001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_PROBE_T_RESV_MEM</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<a 
 id="x1-626002r637"></a>
<!--l. 739--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.8.1</span> <a 
 id="x1-6270001"></a>Property RESV_MEM</h5>
The RESV_MEM property describes a chunk of reserved virtual memory. It may be
used by the device to describe virtual address ranges that cannot be used by the
driver, or that are special.
<!--l. 745-->
<pre class="lstlisting" id="listing-246"><span class="label"><a 
 id="x1-627001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_probe_resv_mem</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-627002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_probe_property</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-627003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">subtype</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-627004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-627005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-627006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-627007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 755--><p class="noindent" >Fields <span 
class="aeti-10">start </span>and <span 
class="aeti-10">end </span>describe the range of reserved virtual addresses. <span 
class="aeti-10">subtype </span>may be
one of:
    <dl class="description"><dt class="description">
    <!--l. 759--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_RESV_MEM_T_RESERVED (0)</span> </dt><dd 
class="description">
    <!--l. 759--><p class="noindent" >These virtual addresses cannot be used in a MAP requests. The region is
    be reserved by the device, for example, if the platform needs to setup DMA
    mappings of its own.
    </dd><dt class="description">
    <!--l. 764--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_IOMMU_RESV_MEM_T_MSI (1)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 764--><p class="noindent" >This  region  is  a  doorbell  for  Message  Signaled  Interrupts  (MSIs).  It
    is similar to VIRTIO_IOMMU_RESV_MEM_T_RESERVED, in that the
    driver cannot map virtual addresses described by the property.
    <!--l. 769--><p class="noindent" >In addition it provides information about MSI doorbells. If the endpoint
    doesn’t have a VIRTIO_IOMMU_RESV_MEM_T_MSI property, then the
    driver creates an MMIO mapping to the doorbell of the MSI controller.</dd></dl>
<a 
 id="x1-627008r533"></a>
<!--l. 774--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.13.6.8.1.1</span> <a 
 id="x1-6280001"></a>Driver Requirements: Property RESV_MEM</h6>
The driver SHOULD NOT map any virtual address described by a
VIRTIO_IOMMU_RESV_MEM_T_RESERVED or VIRTIO_IOMMU_RESV_MEM_T_MSI
property.
<!--l. 779--><p class="noindent" >The driver MUST ignore <span 
class="aeti-10">reserved</span>.
<!--l. 781--><p class="noindent" >The driver SHOULD treat any <span 
class="aeti-10">subtype </span>it doesn’t recognize as if it was
VIRTIO_IOMMU_RESV_MEM_T_RESERVED.
<a 
 id="x1-628001r640"></a>
<!--l. 784--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.13.6.8.1.2</span> <a 
 id="x1-6290002"></a>Device Requirements: Property RESV_MEM</h6>
The device SHOULD set <span 
class="aeti-10">reserved </span>to zero.
<!--l. 788--><p class="noindent" >The device SHOULD NOT present more than one VIRTIO_IOMMU_RESV_MEM_T_MSI
property per endpoint.
<!--l. 791--><p class="noindent" >The device SHOULD NOT present multiple RESV_MEM properties that overlap
each other for the same endpoint.
<!--l. 794--><p class="noindent" >The device SHOULD reject a MAP request that overlaps a RESV_MEM
region.
<!--l. 796--><p class="noindent" >The device SHOULD NOT allow accesses from the endpoint to RESV_MEM regions
to affect any other component than the endpoint and the driver.
<a 
 id="x1-629001r638"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.13.6.9   </span> <a 
 id="x1-6300009"></a>Fault reporting</h5>
<!--l. 801--><p class="noindent" >The device can report translation faults and other significant asynchronous events on
the event virtqueue. The driver initially populates the queue with device-writeable
buffers. When the device needs to report an event, it fills a buffer and notifies
the driver. The driver consumes the report and adds a new buffer to the
virtqueue.
<!--l. 807--><p class="noindent" >If no buffer is available, the device can either wait for one to be consumed, or drop
the event.
<!--l. 810-->
<pre class="lstlisting" id="listing-247"><span class="label"><a 
 id="x1-630001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_iommu_fault</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reason</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">endpoint</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved1</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">address</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_FAULT_F_READ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_FAULT_F_WRITE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-630012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_IOMMU_FAULT_F_ADDRESS</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8)</span></span></pre>
                                                                  

                                                                  
    <dl class="description"><dt class="description">
    <!--l. 826--><p class="noindent" >
<span 
class="aebxti-10">reason</span> </dt><dd 
class="description">
    <!--l. 826--><p class="noindent" >The reason for this report. It may have the following values:
        <dl class="description"><dt class="description">
        <!--l. 829--><p class="noindent" >
    <span 
class="aeb10-">VIRTIO_IOMMU_FAULT_R_UNKNOWN (0)</span> </dt><dd 
class="description">
        <!--l. 829--><p class="noindent" >An internal error happened, or an error that cannot be described with
        the following reasons.
        </dd><dt class="description">
        <!--l. 831--><p class="noindent" >
    <span 
class="aeb10-">VIRTIO_IOMMU_FAULT_R_DOMAIN (1)</span> </dt><dd 
class="description">
        <!--l. 831--><p class="noindent" >The endpoint attempted to access <span 
class="aeti-10">address </span>without being attached to
        a domain.
        </dd><dt class="description">
        <!--l. 833--><p class="noindent" >
    <span 
class="aeb10-">VIRTIO_IOMMU_FAULT_R_MAPPING (2)</span> </dt><dd 
class="description">
        <!--l. 833--><p class="noindent" >The endpoint attempted to access <span 
class="aeti-10">address</span>, which wasn’t mapped in
        the domain or didn’t have the correct protection flags.</dd></dl>
    </dd><dt class="description">
    <!--l. 837--><p class="noindent" >
<span 
class="aebxti-10">flags</span> </dt><dd 
class="description">
    <!--l. 837--><p class="noindent" >Information about the fault context.
    </dd><dt class="description">
    <!--l. 838--><p class="noindent" >
<span 
class="aebxti-10">endpoint</span> </dt><dd 
class="description">
    <!--l. 838--><p class="noindent" >The endpoint causing the fault.
    </dd><dt class="description">
    <!--l. 839--><p class="noindent" >
<span 
class="aebxti-10">reserved </span><span 
class="aeb10-">and </span><span 
class="aebxti-10">reserved1</span> </dt><dd 
class="description">
    <!--l. 839--><p class="noindent" >Should be zero.
    </dd><dt class="description">
    <!--l. 840--><p class="noindent" >
<span 
class="aebxti-10">address</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 840--><p class="noindent" >If VIRTIO_IOMMU_FAULT_F_ADDRESS is set, the address causing the
    fault.</dd></dl>
<!--l. 844--><p class="noindent" >When the fault is reported by a physical IOMMU, the fault reasons may not match
exactly the reason of the original fault report. The device does its best to find the
closest match.
<!--l. 848--><p class="noindent" >If the device encounters an internal error that wasn’t caused by a specific endpoint, it
is unlikely that the driver would be able to do anything else than print the fault and
stop using the device, so reporting the fault on the event queue isn’t useful.
In that case, we recommend using the DEVICE_NEEDS_RESET status
bit.
<a 
 id="x1-630013r639"></a>
<!--l. 854--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.9.1</span> <a 
 id="x1-6310001"></a>Driver Requirements: Fault reporting</h5>
If the <span 
class="aeti-10">reserved </span>field is not zero, the driver MUST ignore the fault report.
<!--l. 859--><p class="noindent" >The driver MUST ignore <span 
class="aeti-10">reserved1</span>.
<!--l. 861--><p class="noindent" >The driver MUST ignore undefined <span 
class="aeti-10">flags</span>.
<!--l. 863--><p class="noindent" >If the driver doesn’t recognize <span 
class="aeti-10">reason</span>, it SHOULD treat the fault as if it was
VIRTIO_IOMMU_FAULT_R_UNKNOWN.
<a 
 id="x1-631001r643"></a>
<!--l. 866--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.13.6.9.2</span> <a 
 id="x1-6320002"></a>Device Requirements: Fault reporting</h5>
The device SHOULD set <span 
class="aeti-10">reserved </span>and <span 
class="aeti-10">reserved1 </span>to zero.
<!--l. 870--><p class="noindent" >The device SHOULD set undefined <span 
class="aeti-10">flags </span>to zero.
<!--l. 872--><p class="noindent" >The device SHOULD write a valid endpoint ID in <span 
class="aeti-10">endpoint</span>.
<!--l. 874--><p class="noindent" >The device MAY omit setting VIRTIO_IOMMU_FAULT_F_ADDRESS and writing
<span 
class="aeti-10">address </span>in any fault report, regardless of the <span 
class="aeti-10">reason</span>.
<!--l. 877--><p class="noindent" >If a buffer is too small to contain the fault report<span class="footnote-mark"><a 
href="#fn22x5" id="fn22x5-bk"><sup class="textsuperscript">22</sup></a></span>, the device SHOULD NOT use
multiple buffers to describe it. The device MAY fall back to using an older fault
report format that fits in the buffer.
<!--l. 883--><p class="noindent" ><a 
 id="x1-632001f22"></a>
<a 
 id="x1-632002r609"></a>
<h3 class="sectionHead"><span class="titlemark">5.14   </span> <a 
 id="x1-63300014"></a>Sound Device</h3>
<!--l. 3--><p class="noindent" >The virtio sound card is a virtual audio device supporting input and output PCM
streams.
<!--l. 6--><p class="noindent" >A device is managed by control requests and can send various notifications through
dedicated queues. A driver can transmit PCM frames using message-based transport
or shared memory.
                                                                  

                                                                  
<!--l. 10--><p class="noindent" >A small part of the specification reuses existing layouts and values from the High
Definition Audio specification (<a 
href="#x1-3017x16">HDA</a>). It allows to provide the same functionality and
assist in two possible cases:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">implementation of a universal sound driver,
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">implementation of a sound driver as part of the High Definition Audio
    subsystem.</dd></dl>
<a 
 id="x1-633003r620"></a>
<h4 class="subsectionHead"><span class="titlemark">5.14.1   </span> <a 
 id="x1-6340001"></a>Device ID</h4>
<!--l. 22--><p class="noindent" >25
<a 
 id="x1-634001r646"></a>
<h4 class="subsectionHead"><span class="titlemark">5.14.2   </span> <a 
 id="x1-6350002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 27--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 27--><p class="noindent" >controlq
    </dd><dt class="description">
    <!--l. 28--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 28--><p class="noindent" >eventq
    </dd><dt class="description">
    <!--l. 29--><p class="noindent" >
<span 
class="aeb10-">2</span> </dt><dd 
class="description">
    <!--l. 29--><p class="noindent" >txq
    </dd><dt class="description">
    <!--l. 30--><p class="noindent" >
<span 
class="aeb10-">3</span> </dt><dd 
class="description">
    <!--l. 30--><p class="noindent" >rxq</dd></dl>
<!--l. 33--><p class="noindent" >The control queue is used for sending control messages from the driver to the
device.
<!--l. 36--><p class="noindent" >The event queue is used for sending notifications from the device to the
driver.
<!--l. 38--><p class="noindent" >The tx queue is used to send PCM frames for output streams.
<!--l. 40--><p class="noindent" >The rx queue is used to receive PCM frames from input streams.
                                                                  

                                                                  
<a 
 id="x1-635001r647"></a>
<h4 class="subsectionHead"><span class="titlemark">5.14.3   </span> <a 
 id="x1-6360003"></a>Feature Bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 45--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SND_F_CTLS (0)</span> </dt><dd 
class="description">
    <!--l. 45--><p class="noindent" >Device supports control elements.</dd></dl>
<a 
 id="x1-636001r648"></a>
<h4 class="subsectionHead"><span class="titlemark">5.14.4   </span> <a 
 id="x1-6370004"></a>Device Configuration Layout</h4>
<!--l. 51-->
<pre class="lstlisting" id="listing-248"><span class="label"><a 
 id="x1-637001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-637002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">jacks</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-637003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">streams</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-637004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chmaps</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-637005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">controls</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-637006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 60--><p class="noindent" >A configuration space contains the following fields:
    <dl class="description"><dt class="description">
    <!--l. 63--><p class="noindent" >
<span 
class="aebxti-10">jacks</span> </dt><dd 
class="description">
    <!--l. 63--><p class="noindent" >(driver-read-only) indicates a total number of all available jacks.
    </dd><dt class="description">
    <!--l. 65--><p class="noindent" >
<span 
class="aebxti-10">streams</span> </dt><dd 
class="description">
    <!--l. 65--><p class="noindent" >(driver-read-only) indicates a total number of all available PCM streams.
    </dd><dt class="description">
    <!--l. 67--><p class="noindent" >
<span 
class="aebxti-10">chmaps</span> </dt><dd 
class="description">
    <!--l. 67--><p class="noindent" >(driver-read-only) indicates a total number of all available channel maps.
    </dd><dt class="description">
    <!--l. 69--><p class="noindent" >
<span 
class="aebxti-10">controls</span> </dt><dd 
class="description">
    <!--l. 69--><p class="noindent" >(driver-read-only) indicates a total number of all available control elements
    if VIRTIO_SND_F_CTLS has been negotiated.
    </dd></dl>
<a 
 id="x1-637007r649"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">5.14.5   </span> <a 
 id="x1-6380005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">Configure the control, event, tx and rx queues.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">Read the <span 
class="aeti-10">jacks </span>field and send a control request to query information about
    the available jacks.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Read the <span 
class="aeti-10">streams </span>field and send a control request to query information
    about the available PCM streams.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">Read the <span 
class="aeti-10">chmaps </span>field and send a control request to query information
    about the available channel maps.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">If VIRTIO_SND_F_CTLS has been negotiated, read the <span 
class="aeti-10">controls </span>field and
    send a control request to query information about the available control
    elements.
    </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">Populate the event queue with empty buffers.</dd></dl>
<a 
 id="x1-638007r642"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.5.1   </span> <a 
 id="x1-6390001"></a>Driver Requirements: Device Initialization</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 92--><p class="noindent" >The driver MUST NOT read the <span 
class="aeti-10">controls </span>field if VIRTIO_SND_F_CTLS
    has not been negotiated.
    </li>
    <li class="itemize">
    <!--l. 94--><p class="noindent" >The driver MUST populate the event queue with empty buffers of at least
    the struct virtio_snd_event size.
    </li>
    <li class="itemize">
    <!--l. 96--><p class="noindent" >The driver MUST NOT put a device-readable buffers in the event queue.</li></ul>
<a 
 id="x1-639001r650"></a>
<h4 class="subsectionHead"><span class="titlemark">5.14.6   </span> <a 
 id="x1-6400006"></a>Device Operation</h4>
<!--l. 101--><p class="noindent" >All control messages are placed into the control queue and all notifications are
placed into the event queue. They use the following layout structure and
definitions:
<!--l. 105-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-249"><span class="label"><a 
 id="x1-640001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">jack</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_JACK_INFO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_JACK_REMAP</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_PCM_INFO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0100</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_PCM_SET_PARAMS</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_PCM_PREPARE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_PCM_RELEASE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_PCM_START</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_PCM_STOP</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channel</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">map</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CHMAP_INFO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0200</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">element</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CTL_INFO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0300</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CTL_ENUM_ITEMS</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CTL_READ</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CTL_WRITE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CTL_TLV_READ</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CTL_TLV_WRITE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_CTL_TLV_COMMAND</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">jack</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_EVT_JACK_CONNECTED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_EVT_JACK_DISCONNECTED</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_EVT_PCM_PERIOD_ELAPSED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1100</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_EVT_PCM_XRUN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">element</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_EVT_CTL_NOTIFY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1200</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">common</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">codes</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_S_OK</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x8000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_S_BAD_MSG</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_S_NOT_SUPP</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_S_IO_ERR</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640042r42"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640043r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640044r44"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">common</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640045r45"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640046r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">code</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640047r47"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640048r48"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640049r49"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">an</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notification</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640050r50"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640051r51"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640052r52"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640053r53"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 161--><p class="noindent" >A generic control message consists of a request part and a response part.
<!--l. 163--><p class="noindent" >A request part has, or consists of, a common header containing the following
device-readable field:
    <dl class="description"><dt class="description">
    <!--l. 167--><p class="noindent" >
<span 
class="aebxti-10">code</span> </dt><dd 
class="description">
    <!--l. 167--><p class="noindent" >specifies a device request type (VIRTIO_SND_R_*).</dd></dl>
<!--l. 170--><p class="noindent" >A response part has, or consists of, a common header containing the following
device-writable field:
    <dl class="description"><dt class="description">
    <!--l. 174--><p class="noindent" >
<span 
class="aebxti-10">code</span> </dt><dd 
class="description">
    <!--l. 174--><p class="noindent" >indicates a device request status (VIRTIO_SND_S_*).</dd></dl>
<!--l. 177--><p class="noindent" >The status field can take one of the following values:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 180--><p class="noindent" >VIRTIO_SND_S_OK - success.
    </li>
    <li class="itemize">
    <!--l. 181--><p class="noindent" >VIRTIO_SND_S_BAD_MSG - a control message is malformed or contains
    invalid parameters.
    </li>
    <li class="itemize">
    <!--l. 183--><p class="noindent" >VIRTIO_SND_S_NOT_SUPP - requested operation or parameters are not
    supported.
    </li>
    <li class="itemize">
    <!--l. 184--><p class="noindent" >VIRTIO_SND_S_IO_ERR - an I/O error occurred.</li></ul>
<!--l. 187--><p class="noindent" >The request part may be followed by an additional device-readable payload,
and the response part may be followed by an additional device-writable
payload.
<!--l. 190--><p class="noindent" >An event notification contains the following device-writable fields:
                                                                  

                                                                  
    <dl class="description"><dt class="description">
    <!--l. 193--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 193--><p class="noindent" >indicates an event type (VIRTIO_SND_EVT_*).
    </dd><dt class="description">
    <!--l. 194--><p class="noindent" >
<span 
class="aebxti-10">data</span> </dt><dd 
class="description">
    <!--l. 194--><p class="noindent" >indicates an optional event data.</dd></dl>
<!--l. 197--><p class="noindent" >For all entities involved in the exchange of audio data, the device uses one of the
following data flow directions:
<!--l. 200-->
<pre class="lstlisting" id="listing-250"><span class="label"><a 
 id="x1-640054r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640055r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_D_OUTPUT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640056r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_D_INPUT</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-640057r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<a 
 id="x1-640058r651"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.1   </span> <a 
 id="x1-6410001"></a>Item Information Request</h5>
<!--l. 209--><p class="noindent" >A special control message is used to request information about any kind of
configuration item. The request part uses the following structure definition:
<!--l. 212-->
<pre class="lstlisting" id="listing-251"><span class="label"><a 
 id="x1-641001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_query_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-641002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-641003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-641004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-641005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-641006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 221--><p class="noindent" >The request contains the following device-readable fields:
    <dl class="description"><dt class="description">
    <!--l. 224--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 224--><p class="noindent" >specifies a particular item request type (VIRTIO_SND_R_*_INFO).
    </dd><dt class="description">
    <!--l. 225--><p class="noindent" >
<span 
class="aebxti-10">start_id</span> </dt><dd 
class="description">
    <!--l. 225--><p class="noindent" >specifies the starting identifier for the item (the range of available identifiers
    is limited by the total number of particular items that is indicated in the
    device configuration space).
    </dd><dt class="description">
    <!--l. 228--><p class="noindent" >
<span 
class="aebxti-10">count</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 228--><p class="noindent" >specifies the number of items for which information is requested (the total
    number of particular items is indicated in the device configuration space).
    </dd><dt class="description">
    <!--l. 231--><p class="noindent" >
<span 
class="aebxti-10">size</span> </dt><dd 
class="description">
    <!--l. 231--><p class="noindent" >specifies the size of the structure containing information for one item (used
    for backward compatibility).</dd></dl>
<!--l. 235--><p class="noindent" >The response consists of the virtio_snd_hdr structure (contains the request status
code), followed by the device-writable information structures of the item. Each
information structure begins with the following common header:
<!--l. 239-->
<pre class="lstlisting" id="listing-252"><span class="label"><a 
 id="x1-641007r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-641008r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hda_fn_nid</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-641009r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 245--><p class="noindent" >The header contains the following field:
    <dl class="description"><dt class="description">
    <!--l. 248--><p class="noindent" >
<span 
class="aebxti-10">hda_fn_nid</span> </dt><dd 
class="description">
    <!--l. 248--><p class="noindent" >indicates a function group node identifier (see <a 
href="#x1-3017x16">HDA</a>, section 7.1.2). This
    field can be used to link together different types of resources (e.g. jacks
    with streams and channel maps with streams).</dd></dl>
<a 
 id="x1-641010r653"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.2   </span> <a 
 id="x1-6420002"></a>Driver Requirements: Item Information Request</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 257--><p class="noindent" >The driver MUST NOT set <span 
class="aeti-10">start_id </span>and <span 
class="aeti-10">count </span>such that <span 
class="aeti-10">start_id </span>+ <span 
class="aeti-10">count</span>
    is greater than the total number of particular items that is indicated in the
    device configuration space.
    </li>
    <li class="itemize">
    <!--l. 260--><p class="noindent" >The driver MUST provide a buffer of sizeof(struct virtio_snd_hdr) + <span 
class="aeti-10">count</span>
    * <span 
class="aeti-10">size </span>bytes for the response.</li></ul>
<a 
 id="x1-642001r654"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.3   </span> <a 
 id="x1-6430003"></a>Relationships with the High Definition Audio Specification</h5>
<!--l. 266--><p class="noindent" >The High Definition Audio specification introduces the codec as part of the hardware
that implements some of the functionality. The codec architecture and capabilities
are described by tree structure of special nodes each of which is either a function
module or a function group (see <a 
href="#x1-3017x16">HDA</a> for details).
                                                                  

                                                                  
<!--l. 272--><p class="noindent" >The virtio sound specification assumes that a single codec is implemented in the
device. Function module nodes are simulated by item information structures, and
function group nodes are simulated by the <span 
class="aeti-10">hda_fn_nid </span>field in each such
structure.
<a 
 id="x1-643001r655"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.4   </span> <a 
 id="x1-6440004"></a>Jack Control Messages</h5>
<!--l. 279--><p class="noindent" >A jack control request has, or consists of, a common header with the following layout
structure:
<!--l. 282-->
<pre class="lstlisting" id="listing-253"><span class="label"><a 
 id="x1-644001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_jack_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-644002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-644003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">jack_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-644004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 289--><p class="noindent" >The header consists of the following device-readable fields:
    <dl class="description"><dt class="description">
    <!--l. 292--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 292--><p class="noindent" >specifies a request type (VIRTIO_SND_R_JACK_*).
    </dd><dt class="description">
    <!--l. 293--><p class="noindent" >
<span 
class="aebxti-10">jack_id</span> </dt><dd 
class="description">
    <!--l. 293--><p class="noindent" >specifies a jack identifier from 0 to <span 
class="aeti-10">jacks </span>- 1.</dd></dl>
<a 
 id="x1-644005r644"></a>
<!--l. 296--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.4.1</span> <a 
 id="x1-6450001"></a>VIRTIO_SND_R_JACK_INFO</h5>
Query information about the available jacks.
<!--l. 300--><p class="noindent" >The request consists of the virtio_snd_query_info structure (see <a 
href="#x1-6410001">Item Information
Request<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation / Item Information Request --></a>). The response consists of the virtio_snd_hdr structure, followed by the
following jack information structures:
<!--l. 305-->
<pre class="lstlisting" id="listing-254"><span class="label"><a 
 id="x1-645001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">jack</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">features</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_JACK_F_REMAP</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_jack_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">features</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_JACK_F_XXX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hda_reg_defconf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hda_reg_caps</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">connected</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[7];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-645014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 322--><p class="noindent" >The structure contains the following device-writable fields:
    <dl class="description"><dt class="description">
    <!--l. 325--><p class="noindent" >
<span 
class="aebxti-10">features</span> </dt><dd 
class="description">
    <!--l. 325--><p class="noindent" >indicates a supported feature bit map:
                                                                  

                                                                  
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 327--><p class="noindent" >VIRTIO_SND_JACK_F_REMAP - jack remapping support.</li></ul>
    </dd><dt class="description">
    <!--l. 329--><p class="noindent" >
<span 
class="aebxti-10">hda_reg_defconf</span> </dt><dd 
class="description">
    <!--l. 329--><p class="noindent" >indicates a pin default configuration value (see <a 
href="#x1-3017x16">HDA</a>, section 7.3.3.31).
    </dd><dt class="description">
    <!--l. 331--><p class="noindent" >
<span 
class="aebxti-10">hda_reg_caps</span> </dt><dd 
class="description">
    <!--l. 331--><p class="noindent" >indicates a pin capabilities value (see <a 
href="#x1-3017x16">HDA</a>, section 7.3.4.9).
    </dd><dt class="description">
    <!--l. 333--><p class="noindent" >
<span 
class="aebxti-10">connected</span> </dt><dd 
class="description">
    <!--l. 333--><p class="noindent" >indicates the current jack connection status (1 - connected, 0 - disconnected).</dd></dl>
<a 
 id="x1-645015r641"></a>
<!--l. 337--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.4.1.1</span> <a 
 id="x1-6460001"></a>Device Requirements: Jack Information</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 340--><p class="noindent" >The device MUST NOT set undefined feature values.
    </li>
    <li class="itemize">
    <!--l. 341--><p class="noindent" >The device MUST initialize the <span 
class="aeti-10">padding </span>bytes to 0.</li></ul>
<a 
 id="x1-646001r657"></a>
<!--l. 344--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.4.2</span> <a 
 id="x1-6470002"></a>VIRTIO_SND_R_JACK_REMAP</h5>
If the VIRTIO_SND_JACK_F_REMAP feature bit is set in the jack information, then
the driver can send a control request to change the association and/or sequence
number for the specified jack ID.
<!--l. 350--><p class="noindent" >The request uses the following structure and layout definitions:
<!--l. 352-->
<pre class="lstlisting" id="listing-255"><span class="label"><a 
 id="x1-647001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_jack_remap</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-647002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_jack_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">code</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_JACK_REMAP</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-647003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">association</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-647004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sequence</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-647005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 360--><p class="noindent" >The request contains the following device-readable fields:
                                                                  

                                                                  
    <dl class="description"><dt class="description">
    <!--l. 363--><p class="noindent" >
<span 
class="aebxti-10">association</span> </dt><dd 
class="description">
    <!--l. 363--><p class="noindent" >specifies the selected association number.
    </dd><dt class="description">
    <!--l. 364--><p class="noindent" >
<span 
class="aebxti-10">sequence</span> </dt><dd 
class="description">
    <!--l. 364--><p class="noindent" >specifies the selected sequence number.</dd></dl>
<a 
 id="x1-647006r656"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.5   </span> <a 
 id="x1-6480005"></a>Jack Notifications</h5>
<!--l. 369--><p class="noindent" >Jack notifications consist of a virtio_snd_event structure, which has the following
device-writable fields:
    <dl class="description"><dt class="description">
    <!--l. 373--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 373--><p class="noindent" >indicates a jack event type:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 375--><p class="noindent" >VIRTIO_SND_EVT_JACK_CONNECTED  -  an  external  device  has
        been connected to the jack.
        </li>
        <li class="itemize">
        <!--l. 376--><p class="noindent" >VIRTIO_SND_EVT_JACK_DISCONNECTED  -  an  external  device
        has been disconnected from the jack.</li></ul>
    </dd><dt class="description">
    <!--l. 378--><p class="noindent" >
<span 
class="aebxti-10">data</span> </dt><dd 
class="description">
    <!--l. 378--><p class="noindent" >indicates a jack identifier from 0 to <span 
class="aeti-10">jacks </span>- 1.</dd></dl>
<a 
 id="x1-648001r660"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.6   </span> <a 
 id="x1-6490006"></a>PCM Control Messages</h5>
<!--l. 383--><p class="noindent" >A PCM control request has, or consists of, a common header with the following
layout structure:
<!--l. 386-->
<pre class="lstlisting" id="listing-256"><span class="label"><a 
 id="x1-649001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_pcm_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-649002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-649003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">stream_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-649004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
                                                                  

                                                                  
<!--l. 393--><p class="noindent" >The header consists of the following device-readable fields:
    <dl class="description"><dt class="description">
    <!--l. 396--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 396--><p class="noindent" >specifies request type (VIRTIO_SND_R_PCM_*).
    </dd><dt class="description">
    <!--l. 397--><p class="noindent" >
<span 
class="aebxti-10">stream_id</span> </dt><dd 
class="description">
    <!--l. 397--><p class="noindent" >specifies a PCM stream identifier from 0 to <span 
class="aeti-10">streams </span>- 1.</dd></dl>
<a 
 id="x1-649005r659"></a>
<!--l. 400--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.6.1</span> <a 
 id="x1-6500001"></a>PCM Command Lifecycle</h5>
A PCM stream has the following command lifecycle:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">SET PARAMETERS
    <!--l. 407--><p class="noindent" >The driver negotiates the stream parameters (format, transport, etc) with
    the device.
    <!--l. 410--><p class="noindent" >Possible valid transitions: set parameters, prepare.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">PREPARE
    <!--l. 414--><p class="noindent" >The device prepares the stream (allocates resources, etc).
    <!--l. 416--><p class="noindent" >Possible valid transitions: set parameters, prepare, start, release.
    </dd><dt class="enumerate-enumitem">
  3. </dt><dd 
class="enumerate-enumitem">Output only: the driver transfers data for pre-buffing.
    </dd><dt class="enumerate-enumitem">
  4. </dt><dd 
class="enumerate-enumitem">START
    <!--l. 422--><p class="noindent" >The device starts the stream (unmute, putting into running state, etc).
    <!--l. 424--><p class="noindent" >Possible valid transitions: stop.
    </dd><dt class="enumerate-enumitem">
  5. </dt><dd 
class="enumerate-enumitem">The driver transfers data to/from the stream.
    </dd><dt class="enumerate-enumitem">
  6. </dt><dd 
class="enumerate-enumitem">STOP
    <!--l. 430--><p class="noindent" >The device stops the stream (mute, putting into non-running state, etc).
    <!--l. 432--><p class="noindent" >Possible valid transitions: start, release.
                                                                  

                                                                  
    </dd><dt class="enumerate-enumitem">
  7. </dt><dd 
class="enumerate-enumitem">RELEASE
    <!--l. 436--><p class="noindent" >The device releases the stream (frees resources, etc).
    <!--l. 438--><p class="noindent" >Possible valid transitions: set parameters, prepare.
    </dd></dl>
<a 
 id="x1-650008r662"></a>
<!--l. 442--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.6.2</span> <a 
 id="x1-6510002"></a>VIRTIO_SND_R_PCM_INFO</h5>
Query information about the available streams.
<!--l. 446--><p class="noindent" >The request consists of the virtio_snd_query_info structure (see <a 
href="#x1-6410001">Item Information
Request<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation / Item Information Request --></a>). The response consists of the virtio_snd_hdr structure, followed by the
following stream information structures:
<!--l. 451-->
<pre class="lstlisting" id="listing-257"><span class="label"><a 
 id="x1-651001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">stream</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">features</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_F_SHMEM_HOST</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_F_SHMEM_GUEST</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_F_MSG_POLLING</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_F_EVT_SHMEM_PERIODS</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_F_EVT_XRUNS</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sample</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">formats</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">analog</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">formats</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">width</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">physical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">width</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_IMA_ADPCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_MU_LAW</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_A_LAW</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S8</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U8</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S16</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U16</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S18_3</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">18</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U18_3</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">18</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S20_3</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">20</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U20_3</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">20</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S24_3</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U24_3</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S20</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">20</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U20</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">20</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S24</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U24</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">24</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_S32</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_U32</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_FLOAT</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_FLOAT64</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">digital</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">formats</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">width</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">physical</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">width</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_DSD_U8</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_DSD_U16</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_DSD_U32</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_IEC958_SUBFRAME</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651039r39"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651041r41"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">supported</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">frame</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rates</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651042r42"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651043r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_5512</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651044r44"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_8000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651045r45"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_11025</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651046r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_16000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651047r47"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_22050</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651048r48"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_32000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651049r49"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_44100</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651050r50"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_48000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651051r51"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_64000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651052r52"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_88200</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651053r53"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_96000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651054r54"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_176400</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651055r55"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_192000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651056r56"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_384000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651057r57"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_12000</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651058r58"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_24000</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651059r59"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651060r60"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651061r61"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_pcm_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651062r62"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651063r63"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">features</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_F_XXX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651064r64"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">formats</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_FMT_XXX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651065r65"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rates</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_RATE_XXX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651066r66"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">direction</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651067r67"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channels_min</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651068r68"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channels_max</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651069r69"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651070r70"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[5];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-651071r71"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 525--><p class="noindent" >The structure contains the following device-writable fields:
    <dl class="description"><dt class="description">
    <!--l. 528--><p class="noindent" >
<span 
class="aebxti-10">features</span> </dt><dd 
class="description">
    <!--l. 528--><p class="noindent" >indicates a bit map of the supported features, which can be negotiated by
    setting the stream parameters:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 531--><p class="noindent" >VIRTIO_SND_PCM_F_SHMEM_HOST  -  supports  sharing  a  host
        memory with a guest,
        </li>
        <li class="itemize">
        <!--l. 532--><p class="noindent" >VIRTIO_SND_PCM_F_SHMEM_GUEST - supports sharing a guest
        memory with a host,
        </li>
        <li class="itemize">
        <!--l. 533--><p class="noindent" >VIRTIO_SND_PCM_F_MSG_POLLING - supports polling mode for
        message-based transport,
        </li>
        <li class="itemize">
                                                                  

                                                                  
        <!--l. 535--><p class="noindent" >VIRTIO_SND_PCM_F_EVT_SHMEM_PERIODS  -  supports  elapsed
        period notifications for shared memory transport,
        </li>
        <li class="itemize">
        <!--l. 537--><p class="noindent" >VIRTIO_SND_PCM_F_EVT_XRUNS  -  supports  underrun/overrun
        notifications.</li></ul>
    </dd><dt class="description">
    <!--l. 539--><p class="noindent" >
<span 
class="aebxti-10">formats</span> </dt><dd 
class="description">
    <!--l. 539--><p class="noindent" >indicates a supported sample format bit map.
    </dd><dt class="description">
    <!--l. 540--><p class="noindent" >
<span 
class="aebxti-10">rates</span> </dt><dd 
class="description">
    <!--l. 540--><p class="noindent" >indicates a supported frame rate bit map.
    </dd><dt class="description">
    <!--l. 541--><p class="noindent" >
<span 
class="aebxti-10">direction</span> </dt><dd 
class="description">
    <!--l. 541--><p class="noindent" >indicates the direction of data flow (VIRTIO_SND_D_*).
    </dd><dt class="description">
    <!--l. 542--><p class="noindent" >
<span 
class="aebxti-10">channels_min</span> </dt><dd 
class="description">
    <!--l. 542--><p class="noindent" >indicates a minimum number of supported channels.
    </dd><dt class="description">
    <!--l. 543--><p class="noindent" >
<span 
class="aebxti-10">channels_max</span> </dt><dd 
class="description">
    <!--l. 543--><p class="noindent" >indicates a maximum number of supported channels.</dd></dl>
<!--l. 546--><p class="noindent" >Only interleaved samples are supported.
<a 
 id="x1-651072r658"></a>
<!--l. 548--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.6.2.1</span> <a 
 id="x1-6520001"></a>Device Requirements: Stream Information</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 551--><p class="noindent" >The device MUST NOT set undefined feature, format, rate and direction
    values.
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 553--><p class="noindent" >The device MUST initialize the <span 
class="aeti-10">padding </span>bytes to 0.</li></ul>
<a 
 id="x1-652001r663"></a>
<!--l. 556--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.6.3</span> <a 
 id="x1-6530003"></a>VIRTIO_SND_R_PCM_SET_PARAMS</h5>
Set selected stream parameters for the specified stream ID.
<!--l. 560--><p class="noindent" >The request uses the following structure and layout definitions:
<!--l. 562-->
<pre class="lstlisting" id="listing-258"><span class="label"><a 
 id="x1-653001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_pcm_set_params</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_pcm_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">code</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_R_PCM_SET_PARAMS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">period_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">features</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_PCM_F_XXX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channels</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">format</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rate</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-653011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 576--><p class="noindent" >The request contains the following device-readable fields:
    <dl class="description"><dt class="description">
    <!--l. 579--><p class="noindent" >
<span 
class="aebxti-10">buffer_bytes</span> </dt><dd 
class="description">
    <!--l. 579--><p class="noindent" >specifies the size of the hardware buffer used by the driver.
    </dd><dt class="description">
    <!--l. 581--><p class="noindent" >
<span 
class="aebxti-10">period_bytes</span> </dt><dd 
class="description">
    <!--l. 581--><p class="noindent" >specifies the size of the hardware period used by the driver.
    </dd><dt class="description">
    <!--l. 583--><p class="noindent" >
<span 
class="aebxti-10">features</span> </dt><dd 
class="description">
    <!--l. 583--><p class="noindent" >specifies a selected feature bit map:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 585--><p class="noindent" >VIRTIO_SND_PCM_F_SHMEM_HOST - use shared memory allocated
        by  the  host  (is  a  placeholder  and  MUST  NOT  be  selected  at  the
        moment),
        </li>
        <li class="itemize">
        <!--l. 587--><p class="noindent" >VIRTIO_SND_PCM_F_SHMEM_GUEST        -        use        shared
        memory allocated by the guest (is a placeholder and MUST NOT be
        selected at the moment),
                                                                  

                                                                  
        </li>
        <li class="itemize">
        <!--l. 589--><p class="noindent" >VIRTIO_SND_PCM_F_MSG_POLLING  -  suppress  available  buffer
        notifications for tx and rx queues (device should poll virtqueue),
        </li>
        <li class="itemize">
        <!--l. 591--><p class="noindent" >VIRTIO_SND_PCM_F_EVT_SHMEM_PERIODS   -   enable   elapsed
        period notifications for shared memory transport,
        </li>
        <li class="itemize">
        <!--l. 593--><p class="noindent" >VIRTIO_SND_PCM_F_EVT_XRUNS   -   enable   underrun/overrun
        notifications.</li></ul>
    </dd><dt class="description">
    <!--l. 595--><p class="noindent" >
<span 
class="aebxti-10">channels</span> </dt><dd 
class="description">
    <!--l. 595--><p class="noindent" >specifies a selected number of channels.
    </dd><dt class="description">
    <!--l. 596--><p class="noindent" >
<span 
class="aebxti-10">format</span> </dt><dd 
class="description">
    <!--l. 596--><p class="noindent" >specifies a selected sample format (VIRTIO_SND_PCM_FMT_*).
    </dd><dt class="description">
    <!--l. 597--><p class="noindent" >
<span 
class="aebxti-10">rate</span> </dt><dd 
class="description">
    <!--l. 597--><p class="noindent" >specifies a selected frame rate (VIRTIO_SND_PCM_RATE_*).</dd></dl>
<a 
 id="x1-653012r664"></a>
<!--l. 600--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.6.3.1</span> <a 
 id="x1-6540001"></a>Device Requirements: Stream Parameters</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 603--><p class="noindent" >If the device has an intermediate buffer, its size MUST be no less than the
    specified <span 
class="aeti-10">buffer_bytes </span>value.</li></ul>
<a 
 id="x1-654001r666"></a>
<!--l. 607--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.6.3.2</span> <a 
 id="x1-6550002"></a>Driver Requirements: Stream Parameters</h6>
    <ul class="itemize1">
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 610--><p class="noindent" ><span 
class="aeti-10">period_bytes   </span>MUST   be   a   divider   <span 
class="aeti-10">buffer_bytes</span>,   i.e.   <span 
class="aeti-10">buffer_bytes   </span>%
    <span 
class="aeti-10">period_bytes </span>== 0.
    </li>
    <li class="itemize">
    <!--l. 611--><p class="noindent" >The driver MUST NOT set undefined feature, format and rate values.
    </li>
    <li class="itemize">
    <!--l. 612--><p class="noindent" >The driver MUST NOT set the feature, format, and rate that are not
    specified in the stream configuration.
    </li>
    <li class="itemize">
    <!--l. 614--><p class="noindent" >The  driver  MUST  NOT  set  the  <span 
class="aeti-10">channels  </span>value  as  less  than  the
    <span 
class="aeti-10">channels_min  </span>or greater than the <span 
class="aeti-10">channels_max  </span>values specified in the
    stream configuration.
    </li>
    <li class="itemize">
    <!--l. 616--><p class="noindent" >The driver MUST NOT set the VIRTIO_SND_PCM_F_SHMEM_HOST
    and VIRTIO_SND_PCM_F_SHMEM_GUEST bits at the same time.
    </li>
    <li class="itemize">
    <!--l. 618--><p class="noindent" >The driver MUST initialize the <span 
class="aeti-10">padding </span>byte to 0.
    </li>
    <li class="itemize">
    <!--l. 619--><p class="noindent" >If the bits associated with the shared memory are not selected, the driver
    MUST use the tx and rx queues for data transfer (see <a 
href="#x1-6620008">PCM I/O Messages<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation / PCM IO Messages --></a>).</li></ul>
<a 
 id="x1-655001r665"></a>
<!--l. 624--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.6.4</span> <a 
 id="x1-6560004"></a>VIRTIO_SND_R_PCM_PREPARE</h5>
Prepare a stream with specified stream ID.
<a 
 id="x1-656001r668"></a>
<!--l. 628--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.6.5</span> <a 
 id="x1-6570005"></a>VIRTIO_SND_R_PCM_RELEASE</h5>
Release a stream with specified stream ID.
<a 
 id="x1-657001r667"></a>
<!--l. 632--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.6.5.1</span> <a 
 id="x1-6580001"></a>Device Requirements: Stream Release</h6>
    <ul class="itemize1">
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 635--><p class="noindent" >The device MUST complete all pending I/O messages for the specified
    stream ID.
    </li>
    <li class="itemize">
    <!--l. 637--><p class="noindent" >The  device  MUST  NOT  complete  the  control  request  while  there  are
    pending I/O messages for the specified stream ID.</li></ul>
<a 
 id="x1-658001r669"></a>
<!--l. 641--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.6.6</span> <a 
 id="x1-6590006"></a>VIRTIO_SND_R_PCM_START</h5>
Start a stream with specified stream ID.
<a 
 id="x1-659001r671"></a>
<!--l. 645--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.6.7</span> <a 
 id="x1-6600007"></a>VIRTIO_SND_R_PCM_STOP</h5>
Stop a stream with specified stream ID.
<a 
 id="x1-660001r661"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.7   </span> <a 
 id="x1-6610007"></a>PCM Notifications</h5>
<!--l. 651--><p class="noindent" >The device can announce support for different PCM events using feature
bits in the stream information structure. To enable notifications, the driver
must negotiate these features using the set stream parameters request (see
<a 
href="#x1-6530003">5.14.6.6.3<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation / PCM Stream Parameters --></a>).
<!--l. 656--><p class="noindent" >PCM stream notifications consist of a virtio_snd_event structure, which has the
following device-writable fields:
    <dl class="description"><dt class="description">
    <!--l. 660--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 660--><p class="noindent" >indicates a PCM stream event type:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 662--><p class="noindent" >VIRTIO_SND_EVT_PCM_PERIOD_ELAPSED  -  a  hardware  buffer
        period has elapsed, the period size is controlled using the <span 
class="aeti-10">period_bytes</span>
        field.
        </li>
        <li class="itemize">
        <!--l. 664--><p class="noindent" >VIRTIO_SND_EVT_PCM_XRUN - an underflow for the output stream
        or an overflow for the input stream has occurred.</li></ul>
    </dd><dt class="description">
    <!--l. 667--><p class="noindent" >
<span 
class="aebxti-10">data</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 667--><p class="noindent" >indicates a PCM stream identifier from 0 to <span 
class="aeti-10">streams </span>- 1.</dd></dl>
<a 
 id="x1-661001r673"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.8   </span> <a 
 id="x1-6620008"></a>PCM I/O Messages</h5>
<!--l. 672--><p class="noindent" >An I/O message consists of the header part, followed by the buffer, and then the
status part.
<!--l. 675-->
<pre class="lstlisting" id="listing-259"><span class="label"><a 
 id="x1-662001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">an</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">I</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">O</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_pcm_xfer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">stream_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">an</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">I</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">O</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_pcm_status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">latency_bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-662010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 688--><p class="noindent" >The header part consists of the following device-readable field:
    <dl class="description"><dt class="description">
    <!--l. 691--><p class="noindent" >
<span 
class="aebxti-10">stream_id</span> </dt><dd 
class="description">
    <!--l. 691--><p class="noindent" >specifies a PCM stream identifier from 0 to <span 
class="aeti-10">streams </span>- 1.</dd></dl>
<!--l. 694--><p class="noindent" >The status part consists of the following device-writable fields:
    <dl class="description"><dt class="description">
    <!--l. 697--><p class="noindent" >
<span 
class="aebxti-10">status</span> </dt><dd 
class="description">
    <!--l. 697--><p class="noindent" >contains   VIRTIO_SND_S_OK   if   an   operation   is   successful,   and
    VIRTIO_SND_S_IO_ERR otherwise.
    </dd><dt class="description">
    <!--l. 699--><p class="noindent" >
<span 
class="aebxti-10">latency_bytes</span> </dt><dd 
class="description">
    <!--l. 699--><p class="noindent" >indicates the current device latency.</dd></dl>
<!--l. 702--><p class="noindent" >Since all buffers in the queue (with one exception) should be of the size <span 
class="aeti-10">period_bytes</span>,
the completion of such an I/O request can be considered an elapsed period
notification.
<a 
 id="x1-662011r672"></a>
<!--l. 706--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.8.1</span> <a 
 id="x1-6630001"></a>Output Stream</h5>
In case of an output stream, the header is followed by a device-readable buffer
containing PCM frames for writing to the device. All messages are placed into the tx
queue.
<a 
 id="x1-663001r670"></a>
<!--l. 712--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.8.1.1</span> <a 
 id="x1-6640001"></a>Device Requirements: Output Stream</h6>
    <ul class="itemize1">
                                                                  

                                                                  
    <li class="itemize">
    <!--l. 715--><p class="noindent" >The device MUST NOT complete the I/O request until the buffer is totally
    consumed.</li></ul>
<a 
 id="x1-664001r676"></a>
<!--l. 719--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.8.1.2</span> <a 
 id="x1-6650002"></a>Driver Requirements: Output Stream</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 722--><p class="noindent" >The driver SHOULD populate the tx queue with <span 
class="aeti-10">period_bytes </span>sized buffers.
    The only exception is the end of the stream.
    </li>
    <li class="itemize">
    <!--l. 724--><p class="noindent" >The driver MUST NOT place device-writable buffers into the tx queue.</li></ul>
<a 
 id="x1-665001r675"></a>
<!--l. 727--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.8.2</span> <a 
 id="x1-6660002"></a>Input Stream</h5>
In case of an input stream, the header is followed by a device-writable buffer being
populated with PCM frames from the device. All messages are placed into the rx
queue.
<!--l. 733--><p class="noindent" >A used descriptor specifies the length of the buffer that was written by the device. It
should be noted that the length value contains the size of the virtio_snd_pcm_status
structure plus the size of the recorded frames.
<a 
 id="x1-666001r677"></a>
<!--l. 737--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.8.2.1</span> <a 
 id="x1-6670001"></a>Device Requirements: Input Stream</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 740--><p class="noindent" >The device MUST NOT complete the I/O request until the buffer is full.
    The only exception is the end of the stream.</li></ul>
<a 
 id="x1-667001r679"></a>
<!--l. 744--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.8.2.2</span> <a 
 id="x1-6680002"></a>Driver Requirements: Input Stream</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 747--><p class="noindent" >The driver SHOULD populate the rx queue with <span 
class="aeti-10">period_bytes </span>sized empty
    buffers before starting the stream.
    </li>
    <li class="itemize">
    <!--l. 749--><p class="noindent" >The driver MUST NOT place device-readable buffers into the rx queue.</li></ul>
<a 
 id="x1-668001r674"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.9   </span> <a 
 id="x1-6690009"></a>Channel Map Control Messages</h5>
<!--l. 754--><p class="noindent" >A device can provide one or more channel maps assigned to all streams with the same
data flow direction in the same function group.
<a 
 id="x1-669001r678"></a>
<!--l. 757--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.9.1</span> <a 
 id="x1-6700001"></a>VIRTIO_SND_R_CHMAP_INFO</h5>
Query information about the available channel maps.
<!--l. 761--><p class="noindent" >The request consists of the virtio_snd_query_info structure (see <a 
href="#x1-6410001">Item Information
Request<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation / Item Information Request --></a>). The response consists of the virtio_snd_hdr structure, followed by the
following channel map information structures:
<!--l. 766-->
<pre class="lstlisting" id="listing-260"><span class="label"><a 
 id="x1-670001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">standard</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channel</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">position</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">definition</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_NONE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">undefined</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_NA</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">silent</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_MONO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mono</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">stream</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_RL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_RR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_LFE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">low</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">frequency</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LFE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_SL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">side</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_SR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">side</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_RC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FLC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FRC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_RLC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_RRC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FLW</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">wide</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FRW</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">wide</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FLH</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">high</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FCH</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">high</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_FRH</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">high</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670025r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TFL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TFR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670027r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TFC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TRL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TRR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TRC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rear</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TFLC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TFRC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">front</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TSL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">side</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_TSR</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">top</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">side</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_LLFE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LFE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_RLFE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LFE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_BC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bottom</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_BLC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bottom</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">left</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_BRC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bottom</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">right</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">center</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670040r40"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670042r42"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">maximum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">possible</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">number</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channels</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670043r43"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_MAX_SIZE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">18</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670044r44"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670045r45"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_chmap_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670046r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670047r47"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">direction</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670048r48"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channels</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670049r49"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">positions</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CHMAP_MAX_SIZE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-670050r50"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 819--><p class="noindent" >The structure contains the following device-writable fields:
    <dl class="description"><dt class="description">
    <!--l. 822--><p class="noindent" >
<span 
class="aebxti-10">direction</span> </dt><dd 
class="description">
    <!--l. 822--><p class="noindent" >indicates the direction of data flow (VIRTIO_SND_D_*).
    </dd><dt class="description">
    <!--l. 823--><p class="noindent" >
<span 
class="aebxti-10">channels</span> </dt><dd 
class="description">
    <!--l. 823--><p class="noindent" >indicates the number of valid channel position values.
    </dd><dt class="description">
    <!--l. 824--><p class="noindent" >
<span 
class="aebxti-10">positions</span> </dt><dd 
class="description">
    <!--l. 824--><p class="noindent" >indicates channel position values (VIRTIO_SND_CHMAP_*).</dd></dl>
<a 
 id="x1-670051r680"></a>
<!--l. 827--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.9.1.1</span> <a 
 id="x1-6710001"></a>Device Requirements: Channel Map Information</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 830--><p class="noindent" >The device MUST NOT set undefined direction values.
    </li>
    <li class="itemize">
    <!--l. 831--><p class="noindent" >The   device   MUST   NOT   set   the   channels   value   to   more   than
    VIRTIO_SND_CHMAP_MAX_SIZE.</li></ul>
                                                                  

                                                                  
<a 
 id="x1-671001r681"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.14.6.10   </span> <a 
 id="x1-67200010"></a>Control Elements</h5>
<!--l. 836--><p class="noindent" >Control elements can be used to set the volume level, mute/unmute the
audio signal, switch different modes/states of the virtual sound device, etc.
Design of virtual audio controls is based on and derived from ALSA audio
controls.
<!--l. 840--><p class="noindent" >The device informs about the support of audio controls by setting the
VIRTIO_SND_F_CTLS feature bit. If VIRTIO_SND_F_CTLS has been negotiated,
the following messages are available for manipulation of control elements.
<!--l. 844--><p class="noindent" >A control request has, or consists of, a common header with the following layout
structure:
<!--l. 847-->
<pre class="lstlisting" id="listing-261"><span class="label"><a 
 id="x1-672001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-672002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-672003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-672004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 854--><p class="noindent" >The header consists of the following device-readable fields:
    <dl class="description"><dt class="description">
    <!--l. 857--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 857--><p class="noindent" >specifies request type (VIRTIO_SND_R_CTL_*).
    </dd><dt class="description">
    <!--l. 858--><p class="noindent" >
<span 
class="aebxti-10">control_id</span> </dt><dd 
class="description">
    <!--l. 858--><p class="noindent" >specifies a control element identifier from 0 to <span 
class="aeti-10">virtio_snd_config::controls </span>-
    1.</dd></dl>
<a 
 id="x1-672005r682"></a>
<!--l. 862--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.10.1</span> <a 
 id="x1-6730001"></a>Query information</h5>
The VIRTIO_SND_R_CTL_INFO control message is used to query basic information
about the available control elements.
<!--l. 867--><p class="noindent" >The request consists of the virtio_snd_query_info structure (see <a 
href="#x1-6410001">Item Information
Request<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation / Item Information Request --></a>). The response consists of the virtio_snd_hdr structure, followed by the
following control element information structures:
<!--l. 872-->
<pre class="lstlisting" id="listing-262"><span class="label"><a 
 id="x1-673001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ROLE_UNDEFINED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ROLE_VOLUME</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ROLE_MUTE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ROLE_GAIN</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_TYPE_BOOLEAN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_TYPE_INTEGER</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_TYPE_INTEGER64</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_TYPE_ENUMERATED</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_TYPE_BYTES</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_TYPE_IEC958</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673015r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673016r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673017r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673018r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_READ</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673019r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_WRITE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673020r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_VOLATILE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673021r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_INACTIVE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673022r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_TLV_READ</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673023r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_TLV_WRITE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673024r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_TLV_COMMAND</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673025r25"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673026r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673027r27"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673028r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_info</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673029r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">role</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673030r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673031r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">access</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_ACCESS_XXX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673032r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">count</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673033r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673034r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">name</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[44];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673035r35"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673036r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673037r37"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">min</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673038r38"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673039r39"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">step</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673040r40"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">integer</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673041r41"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673042r42"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">min</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673043r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673044r44"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">step</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673045r45"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">integer64</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673046r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673047r47"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">items</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673048r48"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enumerated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673049r49"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673050r50"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 925--><p class="noindent" >The structure contains the following device-writable fields:
                                                                  

                                                                  
    <dl class="description"><dt class="description">
    <!--l. 928--><p class="noindent" >
<span 
class="aebxti-10">role</span> </dt><dd 
class="description">
    <!--l. 928--><p class="noindent" >indicates a role for the element. If the field value is not equal to UNDEFINED,
    then the least significant bit indicates the direction of data flow
    (VIRTIO_SND_D_*), and (<span 
class="aeti-10">role </span>& 0xfffffffe) » 1 is equal to one of the following
    values (VIRTIO_SND_CTL_ROLE_*):
        <dl class="description"><dt class="description">
        <!--l. 933--><p class="noindent" >
    <span 
class="aeb10-">VOLUME</span> </dt><dd 
class="description">
        <!--l. 933--><p class="noindent" >is for a volume control.
        </dd><dt class="description">
        <!--l. 934--><p class="noindent" >
    <span 
class="aeb10-">MUTE</span> </dt><dd 
class="description">
        <!--l. 934--><p class="noindent" >is for a mute switch.
        </dd><dt class="description">
        <!--l. 935--><p class="noindent" >
    <span 
class="aeb10-">GAIN</span> </dt><dd 
class="description">
        <!--l. 935--><p class="noindent" >is for a gain control.</dd></dl>
    </dd><dt class="description">
    <!--l. 937--><p class="noindent" >
<span 
class="aebxti-10">type</span> </dt><dd 
class="description">
    <!--l. 937--><p class="noindent" >indicates the element value type (VIRTIO_SND_CTL_TYPE_*):
        <dl class="description"><dt class="description">
        <!--l. 939--><p class="noindent" >
    <span 
class="aeb10-">BOOLEAN</span> </dt><dd 
class="description">
        <!--l. 939--><p class="noindent" >This is a special case of the INTEGER type, which can take only two
        values: 0 (off) and 1 (on).
        </dd><dt class="description">
        <!--l. 941--><p class="noindent" >
    <span 
class="aeb10-">INTEGER</span> </dt><dd 
class="description">
        <!--l. 941--><p class="noindent" >32-bit integer values.
        </dd><dt class="description">
        <!--l. 942--><p class="noindent" >
    <span 
class="aeb10-">INTEGER64</span> </dt><dd 
class="description">
                                                                  

                                                                  
        <!--l. 942--><p class="noindent" >64-bit integer values.
        </dd><dt class="description">
        <!--l. 943--><p class="noindent" >
    <span 
class="aeb10-">ENUMERATED</span> </dt><dd 
class="description">
        <!--l. 943--><p class="noindent" >The value is represented by an array of ASCII strings.
        </dd><dt class="description">
        <!--l. 944--><p class="noindent" >
    <span 
class="aeb10-">BYTES</span> </dt><dd 
class="description">
        <!--l. 944--><p class="noindent" >8-bit integer values.
        </dd><dt class="description">
        <!--l. 945--><p class="noindent" >
    <span 
class="aeb10-">IEC958</span> </dt><dd 
class="description">
        <!--l. 945--><p class="noindent" >This element is connected to the digital audio interface. The value is
        in the form of the virtio_snd_ctl_iec958 structure.</dd></dl>
    </dd><dt class="description">
    <!--l. 948--><p class="noindent" >
<span 
class="aebxti-10">access</span> </dt><dd 
class="description">
    <!--l. 948--><p class="noindent" >indicates a bit mask describing access rights to the element
    (VIRTIO_SND_CTL_ACCESS_*):
        <dl class="description"><dt class="description">
        <!--l. 951--><p class="noindent" >
    <span 
class="aeb10-">READ</span> </dt><dd 
class="description">
        <!--l. 951--><p class="noindent" >It is possible to read the value.
        </dd><dt class="description">
        <!--l. 952--><p class="noindent" >
    <span 
class="aeb10-">WRITE</span> </dt><dd 
class="description">
        <!--l. 952--><p class="noindent" >It is possible to write (change) the value.
        </dd><dt class="description">
        <!--l. 953--><p class="noindent" >
    <span 
class="aeb10-">VOLATILE</span> </dt><dd 
class="description">
        <!--l. 953--><p class="noindent" >The value may be changed without a notification.
        </dd><dt class="description">
        <!--l. 954--><p class="noindent" >
    <span 
class="aeb10-">INACTIVE</span> </dt><dd 
class="description">
                                                                  

                                                                  
        <!--l. 954--><p class="noindent" >The element does actually nothing, but may be updated.
        </dd><dt class="description">
        <!--l. 955--><p class="noindent" >
    <span 
class="aeb10-">TLV_READ</span> </dt><dd 
class="description">
        <!--l. 955--><p class="noindent" >It is possible to read metadata.
        </dd><dt class="description">
        <!--l. 956--><p class="noindent" >
    <span 
class="aeb10-">TLV_WRITE</span> </dt><dd 
class="description">
        <!--l. 956--><p class="noindent" >It is possible to write (change) metadata.
        </dd><dt class="description">
        <!--l. 957--><p class="noindent" >
    <span 
class="aeb10-">TLV_COMMAND</span> </dt><dd 
class="description">
        <!--l. 957--><p class="noindent" >It is possible to execute a command for metadata.</dd></dl>
    </dd><dt class="description">
    <!--l. 959--><p class="noindent" >
<span 
class="aebxti-10">count</span> </dt><dd 
class="description">
    <!--l. 959--><p class="noindent" >indicates the number of <span 
class="aeti-10">type </span>members that represent the value of the
    element.
    </dd><dt class="description">
    <!--l. 961--><p class="noindent" >
<span 
class="aebxti-10">index</span> </dt><dd 
class="description">
    <!--l. 961--><p class="noindent" >indicates the index for an element with a non-unique <span 
class="aeti-10">name</span>.
    </dd><dt class="description">
    <!--l. 962--><p class="noindent" >
<span 
class="aebxti-10">name</span> </dt><dd 
class="description">
    <!--l. 962--><p class="noindent" >indicates the name identifier string for the element.
    </dd><dt class="description">
    <!--l. 963--><p class="noindent" >
<span 
class="aebxti-10">value</span> </dt><dd 
class="description">
    <!--l. 963--><p class="noindent" >indicates some additional information about the value for certain types of
    elements:
        <dl class="description"><dt class="description">
        <!--l. 966--><p class="noindent" >
    <span 
class="aebxti-10">integer</span> </dt><dd 
class="description">
                                                                  

                                                                  
        <!--l. 966--><p class="noindent" >
        </dd><dt class="description">
        <!--l. 967--><p class="noindent" >
    <span 
class="aebxti-10">integer64</span> </dt><dd 
class="description">
        <!--l. 967--><p class="noindent" ><span 
class="aeti-10">min </span>and <span 
class="aeti-10">max </span>indicate minimum and maximum element values. <span 
class="aeti-10">step</span>
        indicates  a  fixed  step  size  for  changing  the  element  value  between
        minimum and maximum values. The special value 0 means that the
        step has variable size.
        </dd><dt class="description">
        <!--l. 971--><p class="noindent" >
    <span 
class="aebxti-10">enumerated</span> </dt><dd 
class="description">
        <!--l. 971--><p class="noindent" ><span 
class="aeti-10">items </span>indicates the number of items from which the element value can
        be selected.</dd></dl>
    </dd></dl>
<!--l. 976--><p class="noindent" >To query an array of items for elements with the ENUMERATED type, an additional
VIRTIO_SND_R_CTL_ENUM_ITEMS control message is used. The request consists
of the virtio_snd_ctl_hdr structure. The response consists of the virtio_snd_hdr
structure, followed by an array of size <span 
class="aeti-10">value.enumerated.items</span>, consisting of the
following structures:
<!--l. 982-->
<pre class="lstlisting" id="listing-263"><span class="label"><a 
 id="x1-673051r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_enum_item</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673052r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">item</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[64];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-673053r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 988--><p class="noindent" >The structure contains the only device-writable field:
    <dl class="description"><dt class="description">
    <!--l. 991--><p class="noindent" >
<span 
class="aebxti-10">item</span> </dt><dd 
class="description">
    <!--l. 991--><p class="noindent" >indicates the name of an available element option.</dd></dl>
<a 
 id="x1-673054r683"></a>
<!--l. 994--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.10.1.1</span> <a 
 id="x1-6740001"></a>Device Requirements: Control Element Information</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 997--><p class="noindent" >The device MUST NOT set undefined <span 
class="aeti-10">role</span>, <span 
class="aeti-10">type </span>and <span 
class="aeti-10">access </span>values.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 999--><p class="noindent" >The device MUST set the <span 
class="aeti-10">count </span>to a value other than zero. The maximum
    allowed value depends on the element type:
        <dl class="description"><dt class="description">
        <!--l. 1002--><p class="noindent" >
    <span 
class="aeb10-">BOOLEAN</span> </dt><dd 
class="description">
        <!--l. 1002--><p class="noindent" >128
        </dd><dt class="description">
        <!--l. 1003--><p class="noindent" >
    <span 
class="aeb10-">INTEGER</span> </dt><dd 
class="description">
        <!--l. 1003--><p class="noindent" >128
        </dd><dt class="description">
        <!--l. 1004--><p class="noindent" >
    <span 
class="aeb10-">INTEGER64</span> </dt><dd 
class="description">
        <!--l. 1004--><p class="noindent" >64
        </dd><dt class="description">
        <!--l. 1005--><p class="noindent" >
    <span 
class="aeb10-">ENUMERATED</span> </dt><dd 
class="description">
        <!--l. 1005--><p class="noindent" >128
        </dd><dt class="description">
        <!--l. 1006--><p class="noindent" >
    <span 
class="aeb10-">BYTES</span> </dt><dd 
class="description">
        <!--l. 1006--><p class="noindent" >512
        </dd><dt class="description">
        <!--l. 1007--><p class="noindent" >
    <span 
class="aeb10-">IEC958</span> </dt><dd 
class="description">
        <!--l. 1007--><p class="noindent" >1</dd></dl>
    </li>
    <li class="itemize">
    <!--l. 1009--><p class="noindent" >The device MUST set <span 
class="aeti-10">name </span>and <span 
class="aeti-10">item </span>fields to a non-empty 0-terminated ASCII
    strings.
    </li>
    <li class="itemize">
    <!--l. 1011--><p class="noindent" >The device MUST ensure that the combination (<span 
class="aeti-10">name</span>, <span 
class="aeti-10">index</span>) is unique for each
    available element.</li></ul>
<a 
 id="x1-674001r685"></a>
                                                                  

                                                                  
<!--l. 1015--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.10.2</span> <a 
 id="x1-6750002"></a>Value</h5>
If the element has VIRTIO_SND_CTL_ACCESS_READ access right, then the driver
can issue VIRTIO_SND_R_CTL_READ request to the device to read the element’s
value.
<!--l. 1021--><p class="noindent" >If the element has VIRTIO_SND_CTL_ACCESS_WRITE access right, then the driver
can issue VIRTIO_SND_R_CTL_WRITE request to the device to write the element’s
value.
<!--l. 1025--><p class="noindent" >The following structure and layout definitions are used in read and write
requests:
<!--l. 1027-->
<pre class="lstlisting" id="listing-264"><span class="label"><a 
 id="x1-675001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_iec958</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[24];</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AES</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IEC958</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">channel</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">subcode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[147];</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AES</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IEC958</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">subcode</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pad</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nothing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">dig_subframe</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[4];</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AES</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IEC958</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">subframe</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675006r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_value</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">integer</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[128];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">integer64</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[64];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enumerated</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[128];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[512];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675014r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_iec958</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">iec958</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-675016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1046--><p class="noindent" >The element value structure consists of a single <span 
class="aeti-10">value </span>union, which contains the
following fields:
    <dl class="description"><dt class="description">
    <!--l. 1050--><p class="noindent" >
<span 
class="aebxti-10">integer</span> </dt><dd 
class="description">
    <!--l. 1050--><p class="noindent" >specifies values for an element of type BOOLEAN or INTEGER.
    </dd><dt class="description">
    <!--l. 1052--><p class="noindent" >
<span 
class="aebxti-10">integer64</span> </dt><dd 
class="description">
    <!--l. 1052--><p class="noindent" >specifies values for an element of type INTEGER64.
    </dd><dt class="description">
    <!--l. 1053--><p class="noindent" >
<span 
class="aebxti-10">enumerated</span> </dt><dd 
class="description">
    <!--l. 1053--><p class="noindent" >specifies indexes of items for an element of type ENUMERATED.
    </dd><dt class="description">
    <!--l. 1055--><p class="noindent" >
<span 
class="aebxti-10">bytes</span> </dt><dd 
class="description">
    <!--l. 1055--><p class="noindent" >specifies values for an element of type BYTES.
    </dd><dt class="description">
    <!--l. 1056--><p class="noindent" >
<span 
class="aebxti-10">iec958</span> </dt><dd 
class="description">
    <!--l. 1056--><p class="noindent" >specifies a value for an element of type IEC958.</dd></dl>
                                                                  

                                                                  
<!--l. 1059--><p class="noindent" >For all types, except for IEC958, the array contains <span 
class="aeti-10">count </span>values (the <span 
class="aeti-10">count </span>is
reported in the element information structure).
<!--l. 1062--><p class="noindent" >A read request consists of a (device-readable) virtio_snd_ctl_hdr structure containing
request, followed by (device-writable) virtio_snd_hdr and virtio_snd_ctl_value
structures, into which the status of the request and the current value of the element
will be written.
<!--l. 1067--><p class="noindent" >A write request consists of (device-readable) virtio_snd_ctl_hdr and virtio_snd_ctl_value
structures containing request and the new element value, followed by
(device-writable) virtio_snd_hdr structure, into which the status of the request will be
written.
<a 
 id="x1-675017r686"></a>
<!--l. 1072--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.10.2.1</span> <a 
 id="x1-6760001"></a>Driver Requirements: Control Element Value</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1075--><p class="noindent" >The driver MUST NOT send READ request if the element does not have
    ACCESS_READ access right.
    </li>
    <li class="itemize">
    <!--l. 1076--><p class="noindent" >The driver MUST NOT send WRITE request if the element does not have
    ACCESS_WRITE access right.</li></ul>
<a 
 id="x1-676001r687"></a>
<!--l. 1079--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.10.3</span> <a 
 id="x1-6770003"></a>Metadata</h5>
Metadata can be used to provide additional (arbitrary) information about the
element (e.g. dB range).
<!--l. 1084--><p class="noindent" >If the element has VIRTIO_SND_CTL_ACCESS_TLV_READ access right, then the
driver can issue VIRTIO_SND_R_CTL_TLV_READ request to the device to read the
element’s metadata.
<!--l. 1088--><p class="noindent" >If the element has VIRTIO_SND_CTL_ACCESS_TLV_WRITE access right, then the
driver can issue VIRTIO_SND_R_CTL_TLV_WRITE request to the device to write
the element’s metadata.
<!--l. 1092--><p class="noindent" >If the element has VIRTIO_SND_CTL_ACCESS_TLV_COMMAND access right, then
the driver can issue VIRTIO_SND_R_CTL_TLV_COMMAND request to the device to
execute a command for element’s metadata.
<!--l. 1096--><p class="noindent" >All information related to metadata is presented in the form of TLV
(Type-Length-Value):
<!--l. 1098-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-265"><span class="label"><a 
 id="x1-677001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_tlv</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-677002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-677003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-677004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-677005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1106--><p class="noindent" >The structure contains the following fields:
    <dl class="description"><dt class="description">
    <!--l. 1109--><p class="noindent" >
<span 
class="aebxti-10">type</span> </dt><dd 
class="description">
    <!--l. 1109--><p class="noindent" >specifies metadata type. ALSA defines several standard metadata types
    for  control  elements,  details  of  which  can  be  found  in  various  ALSA
    documentation. Device implementers can also define their own types and
    formats.
    </dd><dt class="description">
    <!--l. 1112--><p class="noindent" >
<span 
class="aebxti-10">length</span> </dt><dd 
class="description">
    <!--l. 1112--><p class="noindent" >specifies the <span 
class="aeti-10">value </span>length in bytes aligned to 4.
    </dd><dt class="description">
    <!--l. 1113--><p class="noindent" >
<span 
class="aebxti-10">value</span> </dt><dd 
class="description">
    <!--l. 1113--><p class="noindent" >contains metadata in form of an array of 4-byte integers.</dd></dl>
<!--l. 1116--><p class="noindent" >A read request consists of a (device-readable) virtio_snd_ctl_hdr structure containing
request, followed by (device-writable) virtio_snd_hdr and virtio_snd_ctl_tlv
structures, into which the status of the request and element’s metadata will be
written.
<!--l. 1121--><p class="noindent" >A write and command requests consist of (device-readable) virtio_snd_ctl_hdr and
virtio_snd_ctl_tlv structures containing request and element’s metadata/command
content, followed by (device-writable) virtio_snd_hdr structure, into which the status
of the request will be written.
<a 
 id="x1-677006r688"></a>
<!--l. 1126--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.10.3.1</span> <a 
 id="x1-6780001"></a>Device Requirements: Control Element Metadata</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1129--><p class="noindent" >For a read request, if there is not enough space in the <span 
class="aeti-10">value </span>field, the device
    SHOULD write as much as it can and successfully complete the request.</li></ul>
<a 
 id="x1-678001r690"></a>
<!--l. 1133--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.10.3.2</span> <a 
 id="x1-6790002"></a>Driver Requirements: Control Element Metadata</h6>
    <ul class="itemize1">
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 1136--><p class="noindent" >The driver MUST NOT send TLV_READ request if the element does not
    have ACCESS_TLV_READ access right.
    </li>
    <li class="itemize">
    <!--l. 1138--><p class="noindent" >The driver MUST NOT send TLV_WRITE request if the element does not
    have ACCESS_TLV_WRITE access right.
    </li>
    <li class="itemize">
    <!--l. 1140--><p class="noindent" >The driver MUST NOT send TLV_COMMAND request if the element does
    not have ACCESS_TLV_COMMAND access right.
    </li>
    <li class="itemize">
    <!--l. 1142--><p class="noindent" >The driver MUST NOT submit the <span 
class="aeti-10">value </span>field larger than 65536 bytes.</li></ul>
<a 
 id="x1-679001r689"></a>
<!--l. 1145--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.14.6.10.4</span> <a 
 id="x1-6800004"></a>Notifications</h5>
The notification uses the following structure and layout definitions:
<!--l. 1149-->
<pre class="lstlisting" id="listing-266"><span class="label"><a 
 id="x1-680001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">enum</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_EVT_MASK_VALUE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_EVT_MASK_INFO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_EVT_MASK_TLV</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680007r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_ctl_event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_snd_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">code</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_EVT_CTL_NOTIFY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">control_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mask</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SND_CTL_EVT_MASK_XXX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-680011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 1163--><p class="noindent" >The structure contains the following device-writable fields:
    <dl class="description"><dt class="description">
    <!--l. 1166--><p class="noindent" >
<span 
class="aebxti-10">control_id</span> </dt><dd 
class="description">
    <!--l. 1166--><p class="noindent" >indicates a control element identifier from 0 to <span 
class="aeti-10">virtio_snd_config::controls </span>-
    1.
    </dd><dt class="description">
    <!--l. 1168--><p class="noindent" >
<span 
class="aebxti-10">mask</span> </dt><dd 
class="description">
    <!--l. 1168--><p class="noindent" >indicates a bit mask describing the reason(s) for sending the notification
    (VIRTIO_SND_CTL_EVT_MASK_*):
        <dl class="description"><dt class="description">
        <!--l. 1171--><p class="noindent" >
    <span 
class="aeb10-">VALUE</span> </dt><dd 
class="description">
        <!--l. 1171--><p class="noindent" >means the element’s value has changed.
                                                                  

                                                                  
        </dd><dt class="description">
        <!--l. 1172--><p class="noindent" >
    <span 
class="aeb10-">INFO</span> </dt><dd 
class="description">
        <!--l. 1172--><p class="noindent" >means the element’s information has changed.
        </dd><dt class="description">
        <!--l. 1173--><p class="noindent" >
    <span 
class="aeb10-">TLV</span> </dt><dd 
class="description">
        <!--l. 1173--><p class="noindent" >means the element’s metadata has changed.</dd></dl>
    </dd></dl>
<a 
 id="x1-680012r691"></a>
<!--l. 1177--><p class="noindent" ><h6 class="subparagraphHead"><span class="titlemark">5.14.6.10.4.1</span> <a 
 id="x1-6810001"></a>Device Requirements: Control Element Notifications</h6>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 1180--><p class="noindent" >The device MUST NOT set undefined <span 
class="aeti-10">mask </span>values.</li></ul>
<a 
 id="x1-681001r645"></a>
<h3 class="sectionHead"><span class="titlemark">5.15   </span> <a 
 id="x1-68200015"></a>Memory Device</h3>
<!--l. 3--><p class="noindent" >The virtio memory device provides and manages a memory region in guest physical
address space. This memory region is partitioned into memory blocks of fixed size
that can either be in the state plugged or unplugged. Once plugged, a memory block
can be used like ordinary RAM. The driver selects memory blocks to (un)plug and
requests the device to perform the (un)plug.
<!--l. 10--><p class="noindent" >The device requests the driver to plug a certain amount of memory, by setting the
<span 
class="aeti-10">requested_size </span>in the device configuration, which can change at runtime. It is up to
the device driver to fulfill this request by (un)plugging memory blocks. Once the
<span 
class="aeti-10">plugged_size </span>is greater or equal to the <span 
class="aeti-10">requested_size</span>, requests to plug memory blocks
will be rejected by the device.
<!--l. 17--><p class="noindent" >The device-managed memory region is split into two parts, the usable region and the
unusable region. All memory blocks in the unusable region are unplugged and
requests to plug them will be rejected. The device will grow the usable region to fit
the <span 
class="aeti-10">requested_size</span>. Usually, the usable region is bigger than the <span 
class="aeti-10">requested_size </span>of the
device, to give the driver some flexibility when selecting memory blocks to
plug.
<!--l. 24--><p class="noindent" >On initial start, and after a system reset, all memory blocks are unplugged. In corner
cases, memory blocks might still be plugged after a system reset, and the driver
usually requests to unplug all memory while initializing, before starting to select
memory blocks to plug.
                                                                  

                                                                  
<!--l. 29--><p class="noindent" >The device-managed memory region is not exposed as RAM via other firmware / hw
interfaces (e.g., e820 on x86). The driver is responsible for deciding how
plugged memory blocks will be used. A common use case is to expose plugged
memory blocks to the operating system as system RAM, available for the page
allocator.
<!--l. 35--><p class="noindent" >Some platforms provide memory properties for system RAM that are
usually queried and modified using special CPU instructions. Memory
properties might be implicitly queried or modified on memory access. Memory
properties can include advanced memory protection, access and change
indication, or memory usage indication relevant in virtualized environments.
<span class="footnote-mark"><a 
href="#fn23x5" id="fn23x5-bk"><sup class="textsuperscript">23</sup></a></span><a 
 id="x1-682001f23"></a> The
device provides the exact same properties with the exact same semantics
for plugged device memory as available for comparable RAM in the same
configuration.
<a 
 id="x1-682002r652"></a>
<h4 class="subsectionHead"><span class="titlemark">5.15.1   </span> <a 
 id="x1-6830001"></a>Device ID</h4>
<!--l. 46--><p class="noindent" >24
<a 
 id="x1-683001r695"></a>
<h4 class="subsectionHead"><span class="titlemark">5.15.2   </span> <a 
 id="x1-6840002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 51--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 51--><p class="noindent" >guest-request</dd></dl>
<a 
 id="x1-684001r696"></a>
<h4 class="subsectionHead"><span class="titlemark">5.15.3   </span> <a 
 id="x1-6850003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 57--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_MEM_F_ACPI_PXM (0)</span> </dt><dd 
class="description">
    <!--l. 57--><p class="noindent" >The field <span 
class="aeti-10">node_id </span>in the device configuration is valid and corresponds to
    an ACPI PXM.
    </dd><dt class="description">
    <!--l. 59--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_MEM_F_UNPLUGGED_INACCESSIBLE (1)</span> </dt><dd 
class="description">
    <!--l. 59--><p class="noindent" >The driver is not allowed to access unplugged memory. <span class="footnote-mark"><a 
href="#fn24x5" id="fn24x5-bk"><sup class="textsuperscript">24</sup></a></span><a 
 id="x1-685001f24"></a></dd></dl>
<a 
 id="x1-685002r697"></a>
<h4 class="subsectionHead"><span class="titlemark">5.15.4   </span> <a 
 id="x1-6860004"></a>Device configuration layout</h4>
<!--l. 67--><p class="noindent" >All fields of this configuration are always available and read-only for the
                                                                  

                                                                  
driver.
<!--l. 70-->
<pre class="lstlisting" id="listing-267"><span class="label"><a 
 id="x1-686001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">block_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">node_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[6];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">region_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">usable_region_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">plugged_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">requested_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-686010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 84--><p class="noindent" >
<span 
class="aebxti-10">block_size</span> </dt><dd 
class="description">
    <!--l. 84--><p class="noindent" >is the size and the alignment in bytes of a memory block. Cannot change.
    </dd><dt class="description">
    <!--l. 86--><p class="noindent" >
<span 
class="aebxti-10">node_id</span> </dt><dd 
class="description">
    <!--l. 86--><p class="noindent" >has       no       meaning       without       VIRTIO_MEM_F_ACPI_PXM.
    With VIRTIO_MEM_F_ACPI_PXM, this field is valid and corresponds to
    an ACPI PXM. Cannot change.
    </dd><dt class="description">
    <!--l. 89--><p class="noindent" >
<span 
class="aebxti-10">padding</span> </dt><dd 
class="description">
    <!--l. 89--><p class="noindent" >has no meaning and is reserved for future use.
    </dd><dt class="description">
    <!--l. 90--><p class="noindent" >
<span 
class="aebxti-10">addr</span> </dt><dd 
class="description">
    <!--l. 90--><p class="noindent" >is the guest physical address of the start of the device-managed memory
    region in bytes. Cannot change.
    </dd><dt class="description">
    <!--l. 92--><p class="noindent" >
<span 
class="aebxti-10">region_size</span> </dt><dd 
class="description">
    <!--l. 92--><p class="noindent" >is the size of device-managed memory region in bytes. Cannot change.
    </dd><dt class="description">
    <!--l. 94--><p class="noindent" >
<span 
class="aebxti-10">usable_region_size</span> </dt><dd 
class="description">
    <!--l. 94--><p class="noindent" >is the size of the usable device-managed memory region. Can grow up to
    <span 
class="aeti-10">region_size</span>. Can only shrink due to VIRTIO_MEM_REQ_UNPLUG_ALL
    requests.
    </dd><dt class="description">
                                                                  

                                                                  
    <!--l. 97--><p class="noindent" >
<span 
class="aebxti-10">plugged_size</span> </dt><dd 
class="description">
    <!--l. 97--><p class="noindent" >is   the   amount   of   plugged   memory   in   bytes   within   the   usable
    device-managed memory region.
    </dd><dt class="description">
    <!--l. 99--><p class="noindent" >
<span 
class="aebxti-10">requested_size</span> </dt><dd 
class="description">
    <!--l. 99--><p class="noindent" >is   the   requested   amount   of   plugged   memory   within   the   usable
    device-managed memory region.</dd></dl>
<a 
 id="x1-686011r684"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.4.1   </span> <a 
 id="x1-6870001"></a>Driver Requirements: Device configuration layout</h5>
<!--l. 105--><p class="noindent" >The driver MUST NOT write to device configuration fields.
<!--l. 107--><p class="noindent" >The driver MUST ignore the value of <span 
class="aeti-10">padding</span>.
<!--l. 109--><p class="noindent" >The driver MUST ignore the value of <span 
class="aeti-10">node_id </span>without VIRTIO_MEM_F_ACPI_PXM.
<a 
 id="x1-687001r699"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.4.2   </span> <a 
 id="x1-6880002"></a>Device Requirements: Device configuration layout</h5>
<!--l. 114--><p class="noindent" >The device MAY change <span 
class="aeti-10">usable_region_size </span>and <span 
class="aeti-10">requested_size</span>.
<!--l. 117--><p class="noindent" >The device MUST NOT change <span 
class="aeti-10">block_size</span>, <span 
class="aeti-10">node_id</span>, <span 
class="aeti-10">addr</span>, and <span 
class="aeti-10">region_size</span>, except
during a system reset.
<!--l. 120--><p class="noindent" >The device MUST change <span 
class="aeti-10">plugged_size </span>to reflect the size of plugged memory
blocks.
<!--l. 123--><p class="noindent" >The device MUST set <span 
class="aeti-10">usable_region_size </span>to <span 
class="aeti-10">requested_size </span>or greater.
<!--l. 126--><p class="noindent" >The device MUST set <span 
class="aeti-10">block_size </span>to a power of two.
<!--l. 128--><p class="noindent" >The device MUST set <span 
class="aeti-10">addr</span>, <span 
class="aeti-10">region_size</span>, <span 
class="aeti-10">usable_region_size</span>, <span 
class="aeti-10">plugged_size</span>, <span 
class="aeti-10">requested_size</span>
to multiples of <span 
class="aeti-10">block_size</span>.
<!--l. 132--><p class="noindent" >The device MUST set <span 
class="aeti-10">region_size </span>to 0 or greater.
<!--l. 134--><p class="noindent" >The device MUST NOT shrink <span 
class="aeti-10">usable_region_size</span>, except when processing an
UNPLUG ALL request, or during a system reset.
<!--l. 137--><p class="noindent" >The device MUST send a configuration update notification when changing
<span 
class="aeti-10">usable_region_size </span>or <span 
class="aeti-10">requested_size</span>, except when processing an UNPLUG ALL
request.
<!--l. 141--><p class="noindent" >The device SHOULD NOT send a configuration update notification when changing
<span 
class="aeti-10">plugged_size</span>.
<!--l. 144--><p class="noindent" >The device MAY send a configuration update notification even if nothing
changed.
                                                                  

                                                                  
<a 
 id="x1-688001r698"></a>
<h4 class="subsectionHead"><span class="titlemark">5.15.5   </span> <a 
 id="x1-6890005"></a>Device Initialization</h4>
<!--l. 149--><p class="noindent" >On initialization, the driver first discovers the device’s virtqueues. It then reads the
device configuration.
<!--l. 152--><p class="noindent" >In case the driver detects that the device still has memory plugged (<span 
class="aeti-10">plugged_size </span>in
the device configuration is greater than 0), the driver will either try to re-initialize by
issuing STATE requests, or try to unplug all memory before continuing.
Special handling might be necessary in case some plugged memory might
still be relevant (e.g., system dump, memory still in use after unloading the
driver).
<a 
 id="x1-689001r700"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.5.1   </span> <a 
 id="x1-6900001"></a>Driver Requirements: Device Initialization</h5>
<!--l. 161--><p class="noindent" >The driver SHOULD accept VIRTIO_MEM_F_UNPLUGGED_INACCESSIBLE if it
is offered and the driver supports it.
<!--l. 164--><p class="noindent" >The driver SHOULD issue UNPLUG ALL requests until successful if the device still
has memory plugged and the plugged memory is not in use.
<a 
 id="x1-690001r702"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.5.2   </span> <a 
 id="x1-6910002"></a>Device Requirements: Device Initialization</h5>
<!--l. 169--><p class="noindent" >A device MAY fail to operate further if VIRTIO_MEM_F_UNPLUGGED_INACCESSIBLE
is not accepted.
<!--l. 172--><p class="noindent" >The device MUST NOT change the state of memory blocks during device
reset.
<!--l. 174--><p class="noindent" >The device MUST NOT modify memory or memory properties of plugged memory
blocks during device reset.
<a 
 id="x1-691001r701"></a>
<h4 class="subsectionHead"><span class="titlemark">5.15.6   </span> <a 
 id="x1-6920006"></a>Device Operation</h4>
<!--l. 179--><p class="noindent" >The device notifies the driver about the amount of memory the device wants the
driver to consume via the device. These resize requests from the device are
communciated via the <span 
class="aeti-10">requested_size </span>in the device configuration. The driver will react
by requesting to (un)plug specific memory blocks, to make the <span 
class="aeti-10">plugged_size </span>match the
<span 
class="aeti-10">requested_size </span>as close as possible.
<!--l. 186--><p class="noindent" >The driver sends requests to the device on the guest-request virtqueue, notifies the
device, and waits for the device to respond. Requests have a common header, defining
the request type, followed by request-specific data. All requests are 24 bytes long and
have the layout:
<!--l. 191-->
<pre class="lstlisting" id="listing-268"><span class="label"><a 
 id="x1-692001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_req_plug</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">plug</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_req_unplug</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unplug</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_req_state</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">state</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
                                                                  

                                                                  
<!--l. 204--><p class="noindent" >Possible request types are:
<!--l. 206-->
<pre class="lstlisting" id="listing-269"><span class="label"><a 
 id="x1-692011r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_REQ_PLUG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692012r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_REQ_UNPLUG</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692013r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_REQ_UNPLUG_ALL</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692014r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_REQ_STATE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
<!--l. 213--><p class="noindent" >Responses have a common header, defining the response type, followed by
request-specific data. All responses are 10 bytes long and have the layout:
<!--l. 216-->
<pre class="lstlisting" id="listing-270"><span class="label"><a 
 id="x1-692015r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_resp</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692016r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692017r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692018r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692019r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">union</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692020r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_resp_state</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">state</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692021r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692022r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<!--l. 227--><p class="noindent" >Possible response types, in general, are:
<!--l. 229-->
<pre class="lstlisting" id="listing-271"><span class="label"><a 
 id="x1-692023r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_RESP_ACK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692024r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_RESP_NACK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692025r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_RESP_BUSY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-692026r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_RESP_ERROR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3</span></span></pre>
<a 
 id="x1-692027r703"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.6.1   </span> <a 
 id="x1-6930001"></a>Driver Requirements: Device Operation</h5>
<!--l. 238--><p class="noindent" >The driver MUST NOT write memory or modify memory properties of unplugged
memory blocks.
<!--l. 241--><p class="noindent" >The driver MUST NOT read memory or query memory properties of unplugged
memory blocks outside <span 
class="aeti-10">usable_region_size</span>.
<!--l. 244--><p class="noindent" >The driver MUST NOT read memory or query memory properties of unplugged
memory blocks inside <span 
class="aeti-10">usable_region_size </span>via DMA.
<!--l. 247--><p class="noindent" >If VIRTIO_MEM_F_UNPLUGGED_INACCESSIBLE has not been negotiated, the
driver SHOULD NOT read memory or query memory properties of unplugged
memory blocks inside <span 
class="aeti-10">usable_region_size </span>via the CPU.
<!--l. 251--><p class="noindent" >If VIRTIO_MEM_F_UNPLUGGED_INACCESSIBLE has been negotiated, the driver
MUST NOT read memory or query memory properties of unplugged memory
blocks.
<!--l. 254--><p class="noindent" >The driver MUST NOT request unplug of memory blocks while corresponding
memory or memory properties are still in use.
<!--l. 257--><p class="noindent" >The driver SHOULD initialize memory blocks after plugging them, the content is
undefined.
<!--l. 260--><p class="noindent" >The driver SHOULD react to resize requests from the device (<span 
class="aeti-10">requested_size </span>in the
device configuration changed) by (un)plugging memory blocks.
<!--l. 264--><p class="noindent" >The driver SHOULD only plug memory blocks it can actually use.
                                                                  

                                                                  
<!--l. 266--><p class="noindent" >The driver MAY not reach the requested size (<span 
class="aeti-10">requested_size </span>in the device
configuration), for example, because it cannot free up any plugged memory blocks to
unplug them, or it would not be able to make use of unplugged memory blocks after
plugging them (e.g., alignment).
<a 
 id="x1-693001r705"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.6.2   </span> <a 
 id="x1-6940002"></a>Device Requirements: Device Operation</h5>
<!--l. 273--><p class="noindent" >The device MUST provide the exact same memory properties with the exact same
semantics for device memory the platform provides in the same configuration for
comparable RAM.
<!--l. 277--><p class="noindent" >The device MAY modify memory of unplugged memory blocks or reset memory
properties of such memory blocks to platform defaults at any time.
<!--l. 280--><p class="noindent" >The device MUST NOT modify memory or memory properties of plugged memory
blocks.
<!--l. 283--><p class="noindent" >The device MUST allow the driver to read and write memory and to query and
modify memory attributes of plugged memory blocks.
<!--l. 286--><p class="noindent" >If VIRTIO_MEM_F_UNPLUGGED_INACCESSIBLE has not been negotiated,
the device MUST allow the driver to read memory and to query memory
properties of unplugged memory blocks inside <span 
class="aeti-10">usable_region_size </span>via the CPU.
<span class="footnote-mark"><a 
href="#fn25x5" id="fn25x5-bk"><sup class="textsuperscript">25</sup></a></span><a 
 id="x1-694001f25"></a>
<!--l. 292--><p class="noindent" >The device MAY change the state of memory blocks during system resets.
<!--l. 294--><p class="noindent" >The device SHOULD unplug all memory blocks during system resets.
<a 
 id="x1-694002r706"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.6.3   </span> <a 
 id="x1-6950003"></a>PLUG request</h5>
<!--l. 298--><p class="noindent" >Request to plug consecutive memory blocks that are currently unplugged.
<!--l. 300--><p class="noindent" >The request-specific data in a PLUG request has the format:
<!--l. 302-->
<pre class="lstlisting" id="listing-272"><span class="label"><a 
 id="x1-695001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_req_plug</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-695002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-695003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nb_blocks</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-695004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-695005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<!--l. 310--><p class="noindent" ><span 
class="aeti-10">addr </span>is the guest physical address of the first memory block. <span 
class="aeti-10">nb_blocks </span>is the number
of consecutive memory blocks
<!--l. 313--><p class="noindent" >Responses don’t have request-specific data defined.
<a 
 id="x1-695006r692"></a>
<!--l. 315--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.3.1</span> <a 
 id="x1-6960001"></a>Driver Requirements: PLUG request</h5>
The driver MUST ignore anything except the response type in a response.
<a 
 id="x1-696001r708"></a>
                                                                  

                                                                  
<!--l. 319--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.3.2</span> <a 
 id="x1-6970002"></a>Device Requirements: PLUG request</h5>
The device MUST ignore anything except the request type and the request-specific
data in a request.
<!--l. 324--><p class="noindent" >The device MUST ignore the <span 
class="aeti-10">padding </span>in the request-specific data in a request.
<!--l. 327--><p class="noindent" >The device MUST reject requests with VIRTIO_MEM_RESP_ERROR if <span 
class="aeti-10">addr </span>is not
aligned to the <span 
class="aeti-10">block_size </span>in the device configuration, if <span 
class="aeti-10">nb_blocks </span>is not greater than 0,
or if any memory block outside of the usable device-managed memory region is
covered by the request.
<!--l. 332--><p class="noindent" >The device MUST reject requests with VIRTIO_MEM_RESP_ERROR if any memory
block covered by the request is already plugged.
<!--l. 335--><p class="noindent" >The device MAY reject requests with VIRTIO_MEM_RESP_BUSY if the request can
currently not be processed.
<!--l. 338--><p class="noindent" >The device MUST acknowledge requests with VIRTIO_MEM_RESP_ACK in case all
memory blocks were successfully plugged. The device MUST reflect the change in the
device configuration <span 
class="aeti-10">plugged_size</span>.
<a 
 id="x1-697001r707"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.6.4   </span> <a 
 id="x1-6980004"></a>UNPLUG request</h5>
<!--l. 344--><p class="noindent" >Request to unplug consecutive memory blocks that are currently plugged.
<!--l. 346--><p class="noindent" >The request-specific data in an UNPLUG request has the format:
<!--l. 348-->
<pre class="lstlisting" id="listing-273"><span class="label"><a 
 id="x1-698001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_req_unplug</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-698002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-698003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nb_blocks</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-698004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-698005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span></pre>
<!--l. 356--><p class="noindent" ><span 
class="aeti-10">addr </span>is the guest physical address of the first memory block. <span 
class="aeti-10">nb_blocks </span>is the number
of consecutive memory blocks
<!--l. 359--><p class="noindent" >Responses don’t have request-specific data defined.
<a 
 id="x1-698006r709"></a>
<!--l. 361--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.4.1</span> <a 
 id="x1-6990001"></a>Driver Requirements: UNPLUG request</h5>
The driver MUST ignore anything except the response type in a response.
<a 
 id="x1-699001r711"></a>
<!--l. 365--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.4.2</span> <a 
 id="x1-7000002"></a>Device Requirements: UNPLUG request</h5>
The device MUST ignore anything except the request type and the request-specific
data in a request.
<!--l. 370--><p class="noindent" >The device MUST ignore the <span 
class="aeti-10">padding </span>in the request-specific data in a request.
<!--l. 373--><p class="noindent" >The device MUST reject requests with VIRTIO_MEM_RESP_ERROR if <span 
class="aeti-10">addr </span>is not
                                                                  

                                                                  
aligned to the <span 
class="aeti-10">block_size </span>in the device configuration, if <span 
class="aeti-10">nb_blocks </span>is not greater than 0,
or if any memory block outside of the usable device-managed memory region is
covered by the request.
<!--l. 378--><p class="noindent" >The device MUST reject requests with VIRTIO_MEM_RESP_ERROR if any memory
block covered by the request is already unplugged.
<!--l. 381--><p class="noindent" >The device MAY reject requests with VIRTIO_MEM_RESP_BUSY if the request can
currently not be processed.
<!--l. 384--><p class="noindent" >The device MUST acknowledge requests with VIRTIO_MEM_RESP_ACK in case all
memory blocks were successfully unplugged. The device MUST reflect the change in
the device configuration <span 
class="aeti-10">plugged_size</span>.
<a 
 id="x1-700001r710"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.6.5   </span> <a 
 id="x1-7010005"></a>UNPLUG ALL request</h5>
<!--l. 390--><p class="noindent" >Request to unplug all memory blocks the device has currently plugged. If successful,
the <span 
class="aeti-10">plugged_size </span>in the device configuration will be 0 and <span 
class="aeti-10">usable_region_size </span>might
have changed.
<!--l. 394--><p class="noindent" >Requests don’t have request-specific data defined, only the request type is relevant.
Responses don’t have request-specific data defined, only the response type is
relevant.
<a 
 id="x1-701001r712"></a>
<!--l. 398--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.5.1</span> <a 
 id="x1-7020001"></a>Driver Requirements: UNPLUG request</h5>
The driver MUST ignore any data in a response except the response type.
<a 
 id="x1-702001r714"></a>
<!--l. 402--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.5.2</span> <a 
 id="x1-7030002"></a>Device Requirements: UNPLUG request</h5>
The device MUST ignore any data in a request except the request type.
<!--l. 406--><p class="noindent" >The device MUST ignore the <span 
class="aeti-10">padding </span>in the request-specific data in a request.
<!--l. 409--><p class="noindent" >The device MAY reject requests with VIRTIO_MEM_RESP_BUSY if the request can
currently not be processed.
<!--l. 412--><p class="noindent" >The device MUST acknowledge requests with VIRTIO_MEM_RESP_ACK in case all
memory blocks were successfully unplugged.
<!--l. 415--><p class="noindent" >The device MUST set <span 
class="aeti-10">plugged_size </span>to 0 in case the request is acknowledged with
VIRTIO_MEM_RESP_ACK.
<!--l. 418--><p class="noindent" >The device MAY modify <span 
class="aeti-10">usable_region_size </span>before responding with
VIRTIO_MEM_RESP_ACK.
<a 
 id="x1-703001r713"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.15.6.6   </span> <a 
 id="x1-7040006"></a>STATE request</h5>
<!--l. 423--><p class="noindent" >Request the state (plugged, unplugged, mixed) of consecutive memory blocks.
                                                                  

                                                                  
<!--l. 425--><p class="noindent" >The request-specific data in a STATE request has the format:
<!--l. 427-->
<pre class="lstlisting" id="listing-274"><span class="label"><a 
 id="x1-704001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_req_state</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nb_blocks</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 435--><p class="noindent" ><span 
class="aeti-10">addr </span>is the guest physical address of the first memory block. <span 
class="aeti-10">nb_blocks </span>is the number
of consecutive memory blocks.
<!--l. 438--><p class="noindent" >The request-specific data in a STATE response has the format:
<!--l. 440-->
<pre class="lstlisting" id="listing-275"><span class="label"><a 
 id="x1-704006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_mem_resp_state</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704007r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704008r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 446--><p class="noindent" >Whereby <span 
class="aeti-10">type </span>defines one of three different state types:
<!--l. 448-->
<pre class="lstlisting" id="listing-276"><span class="label"><a 
 id="x1-704009r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_STATE_PLUGGED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704010r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_STATE_UNPLUGGED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-704011r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_MEM_STATE_MIXED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
<a 
 id="x1-704012r715"></a>
<!--l. 454--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.6.1</span> <a 
 id="x1-7050001"></a>Driver Requirements: STATE request</h5>
The driver MUST ignore anything except the response type and the request-specific
data in a response.
<!--l. 459--><p class="noindent" >The driver MUST ignore the request-specific data in a response in case the response
type is not VIRTIO_MEM_RESP_ACK.
<a 
 id="x1-705001r717"></a>
<!--l. 462--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.15.6.6.2</span> <a 
 id="x1-7060002"></a>Device Requirements: STATE request</h5>
The device MUST ignore anything except the request type and the request-specific
data in a request.
<!--l. 467--><p class="noindent" >The device MUST ignore the <span 
class="aeti-10">padding </span>in the request-specific data in a request.
<!--l. 470--><p class="noindent" >The device MUST reject requests with VIRTIO_MEM_RESP_ERROR if <span 
class="aeti-10">addr </span>is not
aligned to the <span 
class="aeti-10">block_size </span>in the device configuration, if <span 
class="aeti-10">nb_blocks </span>is not greater than 0,
or if any memory block outside of the usable device-managed memory region is
covered by the request.
<!--l. 475--><p class="noindent" >The device MUST acknowledge requests with VIRTIO_MEM_RESP_ACK, supplying
the state of the memory blocks.
<!--l. 478--><p class="noindent" >The device MUST set the state type in the response to VIRTIO_MEM_STATE_PLUGGED
if all requested memory blocks are plugged. The device MUST set the state type in
the response to VIRTIO_MEM_STATE_UNPLUGGED if all requested memory
blocks are unplugged. Otherwise, the device MUST set state type in the response to
VIRTIO_MEM_STATE_MIXED.
                                                                  

                                                                  
<a 
 id="x1-706001r694"></a>
<h3 class="sectionHead"><span class="titlemark">5.16   </span> <a 
 id="x1-70700016"></a>I2C Adapter Device</h3>
<!--l. 3--><p class="noindent" >virtio-i2c is a virtual I2C adapter device. It provides a way to flexibly organize and
use the host I2C controlled devices from the guest. By attaching the host ACPI I2C
controlled nodes to the virtual I2C adapter device, the guest can communicate
with them without changing or adding extra drivers for these controlled I2C
devices.
<a 
 id="x1-707001r704"></a>
<h4 class="subsectionHead"><span class="titlemark">5.16.1   </span> <a 
 id="x1-7080001"></a>Device ID</h4>
<!--l. 10--><p class="noindent" >34
<a 
 id="x1-708001r720"></a>
<h4 class="subsectionHead"><span class="titlemark">5.16.2   </span> <a 
 id="x1-7090002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 15--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 15--><p class="noindent" >requestq</dd></dl>
<a 
 id="x1-709001r721"></a>
<h4 class="subsectionHead"><span class="titlemark">5.16.3   </span> <a 
 id="x1-7100003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 21--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_I2C_F_ZERO_LENGTH_REQUEST (0)</span> </dt><dd 
class="description">
    <!--l. 21--><p class="noindent" >The
    device supports zero-length I2C request and <span 
class="aeti-10">VIRTIO_I2C_FLAGS_M_RD</span>
    flag. It is mandatory to implement this feature.</dd></dl>
<span 
class="aeb10-">Note:</span> The  <span 
class="aeti-10">VIRTIO_I2C_FLAGS_M_RD  </span>flag  was  not  present  in  the  initial
      implementation of the specification and the direction of the transfer (read
      or  write)  was  inferred  from  the  permissions  (read-only  or  write-only)
      of the buffer itself. There is no need of having backwards compatibility
      for the older specification and so the <span 
class="aeti-10">VIRTIO_I2C_FLAGS_FAIL_NEXT</span>
      feature is made mandatory. The driver should abort negotiation with the
      device, if the device doesn’t offer this feature.
<a 
 id="x1-710001r722"></a>
<h4 class="subsectionHead"><span class="titlemark">5.16.4   </span> <a 
 id="x1-7110004"></a>Device configuration layout</h4>
<!--l. 38--><p class="noindent" >None currently defined.
<a 
 id="x1-711001r723"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">5.16.5   </span> <a 
 id="x1-7120005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The virtqueue is initialized.</dd></dl>
<a 
 id="x1-712002r724"></a>
<h4 class="subsectionHead"><span class="titlemark">5.16.6   </span> <a 
 id="x1-7130006"></a>Device Operation</h4>
<a 
 id="x1-713001r716"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.16.6.1   </span> <a 
 id="x1-7140001"></a>Device Operation: Request Queue</h5>
<!--l. 50--><p class="noindent" >The driver enqueues requests to the virtqueue, and they are used by the device. The
request is the representation of segments of an I2C transaction. Each request is of the
form:
<!--l. 54-->
<pre class="lstlisting" id="listing-277"><span class="label"><a 
 id="x1-714001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_i2c_out_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 62-->
<pre class="lstlisting" id="listing-278"><span class="label"><a 
 id="x1-714006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_i2c_in_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714007r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714008r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 68-->
<pre class="lstlisting" id="listing-279"><span class="label"><a 
 id="x1-714009r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_i2c_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714010r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_i2c_out_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">out_hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714011r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714012r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_i2c_in_hdr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in_hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714013r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 76--><p class="noindent" >The <span 
class="aeti-10">addr </span>of the request is the address of the I2C controlled device. For 7-bit address
mode (A0 ... A6) and 10-bit address mode (A0 ... A9), the format of <span 
class="aeti-10">addr </span>is defined
as follows:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Bits               </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 15   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 14   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 13   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 12   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 11   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 10   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 9    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 8    </td><td style="text-align: left; min-width: \@testpach 10 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 7    </td><td style="text-align: left; min-width: \@testpach 11 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 6    </td><td style="text-align: left; min-width: \@testpach 12 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 5    </td><td style="text-align: left; min-width: \@testpach 13 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4    </td><td style="text-align: left; min-width: \@testpach 14 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 3    </td><td style="text-align: left; min-width: \@testpach 15 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 2    </td><td style="text-align: left; min-width: \@testpach 16 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1    </td><td style="text-align: left; min-width: \@testpach 17 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >7-bit address </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \@testpach 10 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >A6 </td><td style="text-align: left; min-width: \@testpach 11 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >A5 </td><td style="text-align: left; min-width: \@testpach 12 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >A4 </td><td style="text-align: left; min-width: \@testpach 13 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >A3 </td><td style="text-align: left; min-width: \@testpach 14 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >A2 </td><td style="text-align: left; min-width: \@testpach 15 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >A1 </td><td style="text-align: left; min-width: \@testpach 16 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >A0 </td><td style="text-align: left; min-width: \@testpach 17 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 10-bit address  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A7  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A6  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A5  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A4  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A3  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A2  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A1  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A0  </td><td style="text-align: left; min-width: \@testpach 10 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1    </td><td style="text-align: left; min-width: \@testpach 11 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1    </td><td style="text-align: left; min-width: \@testpach 12 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1    </td><td style="text-align: left; min-width: \@testpach 13 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1    </td><td style="text-align: left; min-width: \@testpach 14 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0    </td><td style="text-align: left; min-width: \@testpach 15 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A9  </td><td style="text-align: left; min-width: \@testpach 16 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > A8  </td><td style="text-align: left; min-width: \@testpach 17 ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<!--l. 90--><p class="noindent" >The <span 
class="aeti-10">padding </span>is used to pad to full dword.
<!--l. 92--><p class="noindent" >The <span 
class="aeti-10">flags </span>of the request is defined as follows:
    <dl class="description"><dt class="description">
    <!--l. 95--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_I2C_FLAGS_FAIL_NEXT(0)</span> </dt><dd 
class="description">
    <!--l. 95--><p class="noindent" >is used to group the requests. For a group requests, a driver clears this bit
    on the final request and sets it on the other requests. If this bit is set and a
    device fails to process the current request, it needs to fail the next request
    instead of attempting to execute it.
    </dd><dt class="description">
    <!--l. 101--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_I2C_FLAGS_M_RD(1)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 101--><p class="noindent" >is           used           to           mark           the           request           as
    READ or WRITE. If <span 
class="aeti-10">VIRTIO_I2C_FLAGS_M_RD </span>bit is set in the <span 
class="aeti-10">flags</span>,
    then the request is called a read request. If <span 
class="aeti-10">VIRTIO_I2C_FLAGS_M_RD</span>
    bit is unset in the <span 
class="aeti-10">flags</span>, then the request is called a write request.</dd></dl>
<!--l. 107--><p class="noindent" >Other bits of <span 
class="aeti-10">flags </span>are currently reserved as zero for future feature extensibility.
<!--l. 110--><p class="noindent" >The <span 
class="aeti-10">buf </span>is optional and will not be present for a zero-length request, like the SMBus
"Quick" command. The <span 
class="aeti-10">buf </span>contains one segment of an I2C transaction being read
from or written to the device, based on the value of the <span 
class="aeti-10">VIRTIO_I2C_FLAGS_M_RD</span>
bit in the <span 
class="aeti-10">flags </span>field.
<!--l. 115--><p class="noindent" >The final <span 
class="aeti-10">status </span>byte of the request is written by the device: either VIRTIO_I2C_MSG_OK
for success or VIRTIO_I2C_MSG_ERR for error.
<!--l. 118-->
<pre class="lstlisting" id="listing-280"><span class="label"><a 
 id="x1-714014r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_I2C_MSG_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-714015r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_I2C_MSG_ERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<!--l. 123--><p class="noindent" >The virtio I2C protocol supports write-read requests, i.e. an I2C write segment
followed by a read segment (usually, the write segment provides the number of an I2C
controlled device register to be read), by grouping a list of requests together using the
<span 
class="aeti-10">VIRTIO_I2C_FLAGS_FAIL_NEXT </span>flag.
<a 
 id="x1-714016r726"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.16.6.2   </span> <a 
 id="x1-7150002"></a>Device Operation: Operation Status</h5>
<!--l. 130--><p class="noindent" ><span 
class="aeti-10">addr</span>, <span 
class="aeti-10">flags</span>, and “length of <span 
class="aeti-10">buf </span>” are determined by the driver, while <span 
class="aeti-10">status </span>is
determined by the processing of the device. A driver, for a write request, puts the
data to be written to the device into the <span 
class="aeti-10">buf</span>, while a device, for a read request, puts
the data read from device into the <span 
class="aeti-10">buf  </span>according to the request from the
driver.
<!--l. 136--><p class="noindent" >A driver may send one request or multiple requests to the device at a time. The
requests in the virtqueue are both queued and processed in order.
<!--l. 139--><p class="noindent" >If a driver sends multiple requests at a time and a device fails to process some of
them, then a device needs to set the <span 
class="aeti-10">status </span>of the first failed request to be
VIRTIO_I2C_MSG_ERR. For the remaining requests in the same group with the first
failed one, a driver needs to treat them as VIRTIO_I2C_MSG_ERR, no matter what
<span 
class="aeti-10">status </span>of them, a device needs to fail them instead of attempting to execute them
according to the VIRTIO_I2C_FLAGS_FAIL_NEXT bit.
<a 
 id="x1-715001r727"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.16.6.3   </span> <a 
 id="x1-7160003"></a>Driver Requirements: Device Operation</h5>
<!--l. 148--><p class="noindent" >A driver MUST accept the <span 
class="aeti-10">VIRTIO_I2C_F_ZERO_LENGTH_REQUEST </span>feature and
MUST abort negotiation with the device, if the device doesn’t offer this
feature.
                                                                  

                                                                  
<!--l. 152--><p class="noindent" >A driver MUST set <span 
class="aeti-10">addr </span>and <span 
class="aeti-10">flags </span>before sending the request.
<!--l. 154--><p class="noindent" >A driver MUST set the reserved bits of <span 
class="aeti-10">flags </span>to be zero.
<!--l. 156--><p class="noindent" >A driver MUST NOT send the <span 
class="aeti-10">buf</span>, for a zero-length request.
<!--l. 158--><p class="noindent" >A driver MUST NOT use <span 
class="aeti-10">buf</span>, for a read request, if the final <span 
class="aeti-10">status </span>returned from the
device is VIRTIO_I2C_MSG_ERR.
<!--l. 161--><p class="noindent" >A driver MUST set the <span 
class="aeti-10">VIRTIO_I2C_FLAGS_M_RD </span>flag for a read operation, where
the buffer is write-only for the device.
<!--l. 164--><p class="noindent" >A driver MUST NOT set the <span 
class="aeti-10">VIRTIO_I2C_FLAGS_M_RD </span>flag for a write operation,
where the buffer is read-only for the device.
<!--l. 167--><p class="noindent" >A driver MUST queue the requests in order if multiple requests are going to be sent
at a time.
<!--l. 170--><p class="noindent" >If multiple requests are sent at a time and some of them returned from the device
have the <span 
class="aeti-10">status </span>being VIRTIO_I2C_MSG_ERR, a driver MUST treat the first failed
request and the remaining requests in the same group with the first failed one as
VIRTIO_I2C_MSG_ERR.
<a 
 id="x1-716001r728"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.16.6.4   </span> <a 
 id="x1-7170004"></a>Device Requirements: Device Operation</h5>
<!--l. 177--><p class="noindent" >A device MUST offer the <span 
class="aeti-10">VIRTIO_I2C_F_ZERO_LENGTH_REQUEST </span>feature and
MUST reject any driver that doesn’t negotiate this feature.
<!--l. 180--><p class="noindent" >A device SHOULD keep consistent behaviors with the hardware as described in
<a 
href="#x1-3018x17">I2C</a>.
<!--l. 183--><p class="noindent" >A device MUST NOT change the value of <span 
class="aeti-10">addr</span>, and reserved bits of <span 
class="aeti-10">flags</span>.
<!--l. 186--><p class="noindent" >A device MUST not change the value of the <span 
class="aeti-10">buf  </span>for a write request.
<!--l. 188--><p class="noindent" >A device MUST place one I2C segment of the “length of <span 
class="aeti-10">buf </span>”, for the read request,
into the <span 
class="aeti-10">buf  </span>according the driver’s request.
<!--l. 191--><p class="noindent" >A device MUST guarantee the requests in the virtqueue being processed in order if
multiple requests are received at a time.
<!--l. 194--><p class="noindent" >If multiple requests are received at a time and processing of some of the
requests fails, a device MUST set the <span 
class="aeti-10">status </span>of the first failed request to be
VIRTIO_I2C_MSG_ERR and MAY set the <span 
class="aeti-10">status </span>of the remaining requests in the
same group with the first failed one to be VIRTIO_I2C_MSG_ERR.
<a 
 id="x1-717001r719"></a>
<h3 class="sectionHead"><span class="titlemark">5.17   </span> <a 
 id="x1-71800017"></a>SCMI Device</h3>
<!--l. 3--><p class="noindent" >An SCMI device implements the Arm System Control and Management Interface
(SCMI). SCMI can be used for sensors, power state management, clock management
and performance management among other things.
                                                                  

                                                                  
<!--l. 7--><p class="noindent" >This section relies on definitions from the <a 
href="#x1-3019x18">SCMI specification</a>.
<!--l. 10--><p class="noindent" >Virtio SCMI device and driver are mapped to SCMI platform and agent respectively.
The device is visible to a particular SCMI agent. The device allows a guest to
communicate as an SCMI agent using one or more SCMI protocols. The default
SCMI protocols are defined in the <a 
href="#x1-3019x18">SCMI specification</a>. Virtio provides a transport
medium for exchanging SCMI messages between the SCMI agent and platform.
The virtio SCMI transport allows the queueing of multiple messages and
responses.
<!--l. 19--><p class="noindent" >SCMI FastChannels are not supported.
<a 
 id="x1-718001r725"></a>
<h4 class="subsectionHead"><span class="titlemark">5.17.1   </span> <a 
 id="x1-7190001"></a>Device ID</h4>
<!--l. 23--><p class="noindent" >32
<a 
 id="x1-719001r731"></a>
<h4 class="subsectionHead"><span class="titlemark">5.17.2   </span> <a 
 id="x1-7200002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 28--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 28--><p class="noindent" >cmdq
    </dd><dt class="description">
    <!--l. 29--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 29--><p class="noindent" >eventq</dd></dl>
<!--l. 32--><p class="noindent" >The cmdq is used by the driver to send commands to the device. The device replies
with responses (not delayed responses) over the cmdq.
<!--l. 35--><p class="noindent" >The eventq is used by the device to send notifications and delayed responses. The
eventq only exists if VIRTIO_SCMI_F_P2A_CHANNELS was negotiated.
<a 
 id="x1-720001r732"></a>
<h4 class="subsectionHead"><span class="titlemark">5.17.3   </span> <a 
 id="x1-7210003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 42--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCMI_F_P2A_CHANNELS (0)</span> </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >Device implements some SCMI notifications, or delayed responses.
    </dd><dt class="description">
    <!--l. 44--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_SCMI_F_SHARED_MEMORY (1)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 44--><p class="noindent" >Device implements any SCMI statistics shared memory region.</dd></dl>
<!--l. 48--><p class="noindent" >VIRTIO_SCMI_F_P2A_CHANNELS is used to determine the existence of the eventq.
The eventq is required for SCMI notifications and delayed responses.
<!--l. 52--><p class="noindent" >VIRTIO_SCMI_F_SHARED_MEMORY is used to determine whether the device
provides any SCMI statistics shared memory region. SCMI statistics shared memory
regions are defined by some SCMI protocols.
<!--l. 56--><p class="noindent" >The SCMI protocols provide the PROTOCOL_MESSAGE_ATTRIBUTES
commands to inquire about the particular SCMI notifications and delayed responses
implemented by the device. The SCMI protocols provide additional commands to
detect other features implemented by the device.
<a 
 id="x1-721001r729"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.17.3.1   </span> <a 
 id="x1-7220001"></a>Device Requirements: Feature bits</h5>
<!--l. 63--><p class="noindent" >The device MUST offer VIRTIO_SCMI_F_P2A_CHANNELS if the device can
implement at least one SCMI notification, or delayed response.
<!--l. 66--><p class="noindent" >The device MUST offer VIRTIO_SCMI_F_SHARED_MEMORY if the device can
implement at least one SCMI statistics shared memory region.
<a 
 id="x1-722001r733"></a>
<h4 class="subsectionHead"><span class="titlemark">5.17.4   </span> <a 
 id="x1-7230004"></a>Device configuration layout</h4>
<!--l. 71--><p class="noindent" >There is no configuration data for the device.
<a 
 id="x1-723001r735"></a>
<h4 class="subsectionHead"><span class="titlemark">5.17.5   </span> <a 
 id="x1-7240005"></a>Device Initialization</h4>
<!--l. 75--><p class="noindent" >The <a 
href="#x1-1550001">general requirements on device initialization</a> apply.
<a 
 id="x1-724001r736"></a>
<h4 class="subsectionHead"><span class="titlemark">5.17.6   </span> <a 
 id="x1-7250006"></a>Device Operation</h4>
<!--l. 81--><p class="noindent" >The SCMI transport used for the device puts each SCMI message into a dedicated
virtio buffer. The driver uses the cmdq for transmitting SCMI commands and
receiving the corresponding SCMI responses. The device uses the eventq
for transmitting SCMI notifications and delayed responses. Each message
includes an SCMI protocol header and payload, as defined by the <a 
href="#x1-3019x18">SCMI
specification</a>.
<a 
 id="x1-725001r734"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.17.6.1   </span> <a 
 id="x1-7260001"></a>cmdq Operation</h5>
<!--l. 90--><p class="noindent" >Each buffer in the cmdq holds a single SCMI command once the buffer has been
made available. When the buffer has been marked as used, it contains the SCMI
response. An arbitrary number of such SCMI messages can be in transit at the same
time. Conceptually, each SCMI message in the cmdq uses its own SCMI A2P (agent
to platform) channel.
<!--l. 96--><p class="noindent" >The SCMI response is in the same virtio buffer as the corresponding SCMI command.
                                                                  

                                                                  
The response contains the return values which SCMI specifies for each command,
whether synchronous or asynchronous. Delayed responses are distinct SCMI messages
transmitted over the eventq.
<!--l. 101--><p class="noindent" >Buffers in the cmdq contain both the request and the response. A request has the
following layout:
<!--l. 104-->
<pre class="lstlisting" id="listing-281"><span class="label"><a 
 id="x1-726001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scmi_request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-726002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-726003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">params</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[&lt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actual</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">parameters</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-726004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 111--><p class="noindent" >The virtio_scmi_request fields are interpreted as follows:
    <dl class="description"><dt class="description">
    <!--l. 114--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 114--><p class="noindent" >(device-readable) contains the SCMI message header
    </dd><dt class="description">
    <!--l. 115--><p class="noindent" >
<span 
class="aebxti-10">params</span> </dt><dd 
class="description">
    <!--l. 115--><p class="noindent" >(device-readable) comprises the SCMI message parameters</dd></dl>
<!--l. 119--><p class="noindent" >A cmdq response has the following layout:
<!--l. 121-->
<pre class="lstlisting" id="listing-282"><span class="label"><a 
 id="x1-726005r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scmi_response</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-726006r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-726007r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ret_values</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[&lt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actual</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-726008r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 128--><p class="noindent" >The virtio_scmi_response fields are interpreted as follows:
    <dl class="description"><dt class="description">
    <!--l. 131--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 131--><p class="noindent" >(device-writable) contains the SCMI message header
    </dd><dt class="description">
    <!--l. 132--><p class="noindent" >
<span 
class="aebxti-10">ret_values</span> </dt><dd 
class="description">
    <!--l. 132--><p class="noindent" >(device-writable) comprises the SCMI message return values</dd></dl>
<!--l. 136--><p class="noindent" >If VIRTIO_SCMI_F_P2A_CHANNELS was not negotiated, the device responds
to SCMI commands as if no SCMI notifications or delayed responses were
implemented.
<a 
 id="x1-726009r718"></a>
                                                                  

                                                                  
<!--l. 140--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.17.6.1.1</span> <a 
 id="x1-7270001"></a>Device Requirements: cmdq Operation</h5>
The device MAY process available commands out of order and in parallel.
<!--l. 144--><p class="noindent" >The device MUST process all available commands eventually, even in the case of
bursts of multiple command messages.
<!--l. 147--><p class="noindent" >If the <span 
class="aeti-10">status </span>field in the <span 
class="aeti-10">virtio_scmi_response ret_values </span>has a value other than
SUCCESS, the device MUST set the size of <span 
class="aeti-10">ret_values </span>to the size of the <span 
class="aeti-10">status</span>
field.
<!--l. 151--><p class="noindent" >If the driver requests an SCMI notification or a delayed response and there are
currently NOT enough available buffers in the eventq, the device SHOULD still
return SCMI status code SUCCESS.
<!--l. 155--><p class="noindent" >If VIRTIO_SCMI_F_P2A_CHANNELS was not negotiated, the device MUST deny
any request for an SCMI notification or a delayed response by returning SCMI status
code NOT_SUPPORTED.
<!--l. 159--><p class="noindent" >If VIRTIO_SCMI_F_P2A_CHANNELS was not negotiated, the device MUST NOT
indicate in the PROTOCOL_MESSAGE_ATTRIBUTES return values that any
SCMI notification, or delayed response, is implemented.
<a 
 id="x1-727001r739"></a>
<!--l. 163--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.17.6.1.2</span> <a 
 id="x1-7280002"></a>Driver Requirements: cmdq Operation</h5>
Before sending a command, the driver MUST wait for responses to all commands
whose completion the driver considers prerequisites to executing the command.
<!--l. 169--><p class="noindent" >With every command message, the driver MUST provide enough device-writable
memory to enable the device to return corresponding return values.
<!--l. 173--><p class="noindent" >If VIRTIO_SCMI_F_P2A_CHANNELS was not negotiated, the driver MUST NOT
request any SCMI notification, nor any delayed response.
<a 
 id="x1-728001r738"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.17.6.2   </span> <a 
 id="x1-7290002"></a>Setting Up eventq Buffers</h5>
<!--l. 178--><p class="noindent" >The driver has to populate the eventq before the device can use it.
<a 
 id="x1-729001r740"></a>
<!--l. 180--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.17.6.2.1</span> <a 
 id="x1-7300001"></a>Driver Requirements: Setting Up eventq Buffers</h5>
If VIRTIO_SCMI_F_P2A_CHANNELS was negotiated, the driver SHOULD populate
the eventq with buffers.
<!--l. 185--><p class="noindent" >The driver MUST NOT put device-readable descriptors into the eventq.
<!--l. 187--><p class="noindent" >The driver MUST NOT put into the eventq any buffer which is smaller than
the largest SCMI P2A (platform to agent) message which the driver will
request.
<a 
 id="x1-730001r741"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.17.6.3   </span> <a 
 id="x1-7310003"></a>eventq Operation</h5>
<!--l. 193--><p class="noindent" >Each buffer in the eventq holds (once the buffer is marked as used) either a single
SCMI notification, or a single SCMI delayed response. An arbitrary number of such
SCMI messages can be in transit at the same time. Conceptually, each SCMI message
transmitted over the eventq uses its own SCMI P2A (platform to agent) channel.
Buffers in the eventq have the following layout:
<!--l. 200-->
<pre class="lstlisting" id="listing-283"><span class="label"><a 
 id="x1-731001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_scmi_event_msg</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-731002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">writable</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">data</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-731003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">hdr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-731004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">payload</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[&lt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">actual</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">payload</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-731005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 209--><p class="noindent" >
<span 
class="aebxti-10">hdr</span> </dt><dd 
class="description">
    <!--l. 209--><p class="noindent" >(device-writable) contains the SCMI message header
    </dd><dt class="description">
    <!--l. 210--><p class="noindent" >
<span 
class="aebxti-10">payload</span> </dt><dd 
class="description">
    <!--l. 210--><p class="noindent" >(device-writable) comprises the SCMI message payload</dd></dl>
<a 
 id="x1-731006r742"></a>
<!--l. 214--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.17.6.3.1</span> <a 
 id="x1-7320001"></a>Device Requirements: eventq Operation</h5>
If the device intends to send a notification and there are no available buffers in the
eventq, the device MAY drop the notification, or send a corresponding notification
later, once enough buffers become available.
<!--l. 220--><p class="noindent" >The device MAY send the notification later if the events which cause the notification
take place in quick succession.
<!--l. 223--><p class="noindent" >If the device sends the notification later, the device MAY send the notification with
updated data, unless the specific SCMI protocol disallows this.
<!--l. 227--><p class="noindent" >If the device intends to send a notification and there are available buffers, but one of
the buffers is too small to fit the notification, the device MAY omit the
notification.
<!--l. 231--><p class="noindent" >If the device intends to send a delayed response and there are no available buffers in
the eventq, the device MUST send the corresponding delayed response once enough
buffers become available.
<!--l. 235--><p class="noindent" >If the <span 
class="aeti-10">status </span>field in a delayed response <span 
class="aeti-10">payload </span>has a value other than SUCCESS, the
device MUST set the size of <span 
class="aeti-10">payload </span>to the size of the <span 
class="aeti-10">status </span>field.
<a 
 id="x1-732001r743"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.17.6.4   </span> <a 
 id="x1-7330004"></a>Shared Memory Operation</h5>
<!--l. 241--><p class="noindent" >Various SCMI protocols define statistics shared memory regions (for statistics and
sensor values).
<a 
 id="x1-733001r744"></a>
<!--l. 244--><p class="noindent" ><h5 class="paragraphHead"><span class="titlemark">5.17.6.4.1</span> <a 
 id="x1-7340001"></a>Device Requirements: Shared Memory Operation</h5>
If VIRTIO_SCMI_F_SHARED_MEMORY was negotiated, the device MAY
implement an SCMI statistics shared memory region using a virtio shared memory
region.
<!--l. 250--><p class="noindent" >If the device implements a shared memory region, the device MUST assign the
corresponding shmid as per the following table:
<div class="tabular"><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > SCMI statistics shared memory region                     </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Virtio shmid         </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved (invalid)                                                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Power state statistics shared memory region              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 1                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-4"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Performance domain statistics shared memory region  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 2                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-5"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Sensor Values Shared Memory                                </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 3                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-6"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved for future use                                         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 4 to 0x7F             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-7"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Vendor-specific statistics shared memory regions        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x80 to 0xFF        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-8"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > Reserved for future use                                         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0x100 and greater  </td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr class="row-9"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table></div>
<a 
 id="x1-734001r730"></a>
<h3 class="sectionHead"><span class="titlemark">5.18   </span> <a 
 id="x1-73500018"></a>GPIO Device</h3>
<!--l. 3--><p class="noindent" >The Virtio GPIO device is a virtual General Purpose Input/Output device that
supports a variable number of named I/O lines, which can be configured in input
mode or in output mode with logical level low (0) or high (1).
<a 
 id="x1-735001r737"></a>
<h4 class="subsectionHead"><span class="titlemark">5.18.1   </span> <a 
 id="x1-7360001"></a>Device ID</h4>
<!--l. 8--><p class="noindent" >41
<a 
 id="x1-736001r748"></a>
<h4 class="subsectionHead"><span class="titlemark">5.18.2   </span> <a 
 id="x1-7370002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 13--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 13--><p class="noindent" >requestq
    </dd><dt class="description">
    <!--l. 14--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 14--><p class="noindent" >eventq</dd></dl>
<!--l. 17--><p class="noindent" >The <span 
class="aeti-10">eventq </span>virtqueue is available only if the <span 
class="aeti-10">VIRTIO_GPIO_F_IRQ </span>feature has been
negotiated.
                                                                  

                                                                  
<a 
 id="x1-737001r749"></a>
<h4 class="subsectionHead"><span class="titlemark">5.18.3   </span> <a 
 id="x1-7380003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 23--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_GPIO_F_IRQ (0)</span> </dt><dd 
class="description">
    <!--l. 23--><p class="noindent" >The device supports interrupts on GPIO lines.</dd></dl>
<a 
 id="x1-738001r750"></a>
<h4 class="subsectionHead"><span class="titlemark">5.18.4   </span> <a 
 id="x1-7390004"></a>Device configuration layout</h4>
<!--l. 28--><p class="noindent" >GPIO device uses the following configuration structure layout:
<!--l. 30-->
<pre class="lstlisting" id="listing-284"><span class="label"><a 
 id="x1-739001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpio_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-739002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ngpio</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-739003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[2];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-739004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">gpio_names_size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-739005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 39--><p class="noindent" >
<span 
class="aebxti-10">ngpio</span> </dt><dd 
class="description">
    <!--l. 39--><p class="noindent" >is the total number of GPIO lines supported by the device.
    </dd><dt class="description">
    <!--l. 41--><p class="noindent" >
<span 
class="aebxti-10">padding</span> </dt><dd 
class="description">
    <!--l. 41--><p class="noindent" >has no meaning and is reserved for future use. This is set to zero by the
    device.
    </dd><dt class="description">
    <!--l. 44--><p class="noindent" >
<span 
class="aebxti-10">gpio_names_size</span> </dt><dd 
class="description">
    <!--l. 44--><p class="noindent" >is the size of the gpio-names memory block in bytes, which can be fetched by
    the driver using the <span 
class="aeti-10">VIRTIO_GPIO_MSG_GET_LINE_NAMES </span>message.
    The device sets this to 0 if it doesn’t support names for the GPIO lines.</dd></dl>
<a 
 id="x1-739006r751"></a>
<h4 class="subsectionHead"><span class="titlemark">5.18.5   </span> <a 
 id="x1-7400005"></a>Device Initialization</h4>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 54--><p class="noindent" >The driver configures and initializes the <span 
class="aeti-10">requestq </span>virtqueue.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 56--><p class="noindent" >The  driver  configures  and  initializes  the  <span 
class="aeti-10">eventq   </span>virtqueue,  if  the
    <span 
class="aeti-10">VIRTIO_GPIO_F_IRQ </span>feature has been negotiated.</li></ul>
<a 
 id="x1-740001r752"></a>
<h4 class="subsectionHead"><span class="titlemark">5.18.6   </span> <a 
 id="x1-7410006"></a>Device Operation: requestq</h4>
<!--l. 62--><p class="noindent" >The driver uses the <span 
class="aeti-10">requestq </span>virtqueue to send messages to the device. The driver
sends a pair of buffers, request (filled by driver) and response (to be filled by device
later), to the device. The device in turn fills the response buffer and sends it back to
the driver.
<!--l. 67-->
<pre class="lstlisting" id="listing-285"><span class="label"><a 
 id="x1-741001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpio_request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">gpio</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 75--><p class="noindent" >All the fields of this structure are set by the driver and read by the device.
    <dl class="description"><dt class="description">
    <!--l. 78--><p class="noindent" >
<span 
class="aebxti-10">type</span> </dt><dd 
class="description">
    <!--l. 78--><p class="noindent" >is the GPIO message type, i.e. one of <span 
class="aeti-10">VIRTIO_GPIO_MSG_* </span>values.
    </dd><dt class="description">
    <!--l. 81--><p class="noindent" >
<span 
class="aebxti-10">gpio</span> </dt><dd 
class="description">
    <!--l. 81--><p class="noindent" >is the GPIO line number, i.e. 0 <= <span 
class="aeti-10">gpio </span>< <span 
class="aeti-10">ngpio</span>.
    </dd><dt class="description">
    <!--l. 84--><p class="noindent" >
<span 
class="aebxti-10">value</span> </dt><dd 
class="description">
    <!--l. 84--><p class="noindent" >is a message specific value.</dd></dl>
<!--l. 87-->
<pre class="lstlisting" id="listing-286"><span class="label"><a 
 id="x1-741006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpio_response</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741007r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741008r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741009r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741010r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741011r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Possible</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741012r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_STATUS_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741013r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_STATUS_ERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1</span></span></pre>
<!--l. 98--><p class="noindent" >All the fields of this structure are set by the device and read by the driver.
    <dl class="description"><dt class="description">
    <!--l. 101--><p class="noindent" >
<span 
class="aebxti-10">status</span> </dt><dd 
class="description">
    <!--l. 101--><p class="noindent" >of  the  GPIO  message,  <span 
class="aeti-10">VIRTIO_GPIO_STATUS_OK  </span>on  success  and
    <span 
class="aeti-10">VIRTIO_GPIO_STATUS_ERR </span>on failure.
                                                                  

                                                                  
    </dd><dt class="description">
    <!--l. 105--><p class="noindent" >
<span 
class="aebxti-10">value</span> </dt><dd 
class="description">
    <!--l. 105--><p class="noindent" >is a message specific value.</dd></dl>
<!--l. 108--><p class="noindent" >Following is the list of messages supported by the virtio gpio specification.
<!--l. 110-->
<pre class="lstlisting" id="listing-287"><span class="label"><a 
 id="x1-741014r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">GPIO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">message</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741015r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_MSG_GET_LINE_NAMES</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0001</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741016r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_MSG_GET_DIRECTION</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0002</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741017r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_MSG_SET_DIRECTION</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0003</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741018r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_MSG_GET_VALUE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0004</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741019r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_MSG_SET_VALUE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0005</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741020r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_MSG_SET_IRQ_TYPE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0006</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741021r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741022r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">GPIO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Direction</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741023r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_DIRECTION_NONE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741024r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_DIRECTION_OUT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x01</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741025r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_DIRECTION_IN</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741026r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741027r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">GPIO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">interrupt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">types</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741028r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_TYPE_NONE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x00</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741029r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_TYPE_EDGE_RISING</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x01</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741030r17"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_TYPE_EDGE_FALLING</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x02</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741031r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_TYPE_EDGE_BOTH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x03</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741032r19"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_TYPE_LEVEL_HIGH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x04</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-741033r20"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_TYPE_LEVEL_LOW</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x08</span></span></pre>
<a 
 id="x1-741034r745"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.1   </span> <a 
 id="x1-7420001"></a>requestq Operation: Get Line Names</h5>
<!--l. 135--><p class="noindent" >The driver sends this message to receive a stream of zero-terminated strings, where
each string represents the name of a GPIO line, present in increasing order of the
GPIO line numbers. The names of the GPIO lines are optional and may be present
only for a subset of GPIO lines. If missing, then a zero-byte must be present for the
GPIO line. If present, the name string must be zero-terminated and the name must
be unique within a GPIO Device. The names of the GPIO lines are encoded in 7-bit
ASCII.
<!--l. 143--><p class="noindent" >These names of the GPIO lines should be most meaningful producer names for the
system, such as name indicating the usage. For example "MMC-CD", "Red LED
Vdd" and "ethernet reset" are reasonable line names as they describe what
the line is used for, while "GPIO0" is not a good name to give to a GPIO
line.
<!--l. 148--><p class="noindent" >Here is an example of how the gpio names memory block may look like for a GPIO
device with 10 GPIO lines, where line names are provided only for lines 0
("MMC-CD"), 5 ("Red LED Vdd") and 7 ("ethernet reset").
<!--l. 152-->
<pre class="lstlisting" id="listing-288"><span class="label"><a 
 id="x1-742001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">gpio_names</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[]</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">M</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">M</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">C</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’-’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">C</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">R</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">L</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">E</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">D</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">V</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">d</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">E</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">h</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">n</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">r</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">e</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0,</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742012r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 167--><p class="noindent" >The device sets the <span 
class="aeti-10">gpio_names_size </span>to a non-zero value if this message is supported
by the device, else it must be set to zero.
<!--l. 170--><p class="noindent" >This message type uses different layout for the response structure, as the device needs
to return the <span 
class="aeti-10">gpio_names </span>array.
<!--l. 173-->
<pre class="lstlisting" id="listing-289"><span class="label"><a 
 id="x1-742013r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpio_response_N</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742014r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742015r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">value</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">N</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-742016r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 180--><p class="noindent" >The driver must allocate the <span 
class="aeti-10">value[N] </span>buffer in the <span 
class="aeti-10">struct virtio_gpio_response_N </span>for
N bytes, where N = <span 
class="aeti-10">gpio_names_size</span>.
                                                                  

                                                                  
<!--l. 189--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Request  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">type</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">gpio</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_MSG_GET_LINE_NAMES</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >0 </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                 </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<!--l. 197--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Response  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">status</span>             </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value[N]</span>           </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">Where N is</span>        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_STATUS_*</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >gpio-names        </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">gpio_names_size</span>    </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<a 
 id="x1-742017r754"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.2   </span> <a 
 id="x1-7430002"></a>requestq Operation: Get Direction</h5>
<!--l. 201--><p class="noindent" >The driver sends this message to request the device to return a line’s configured
direction.
<!--l. 210--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Request  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">type</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">gpio</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_MSG_GET_DIRECTION</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >line number  </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                 </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<!--l. 218--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Response  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">status</span>                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_STATUS_*</span>    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0  =  none,  1  =  output,  2  =
 input                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td>
</tr></table>
<a 
 id="x1-743001r755"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.3   </span> <a 
 id="x1-7440003"></a>requestq Operation: Set Direction</h5>
<!--l. 222--><p class="noindent" >The driver sends this message to request the device to configure a line’s direction.
The driver can either set the direction to <span 
class="aeti-10">VIRTIO_GPIO_DIRECTION_IN</span>
or <span 
class="aeti-10">VIRTIO_GPIO_DIRECTION_OUT</span>, which also activates the line, or to
<span 
class="aeti-10">VIRTIO_GPIO_DIRECTION_NONE</span>, which deactivates the line.
<!--l. 228--><p class="noindent" >The driver should set the value of the GPIO line, using the <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_VALUE</span>
message, before setting the direction of the line to output to avoid any undesired
behavior.
<!--l. 238--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Request  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">type</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">gpio</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_DIRECTION</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >line number   </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0   =   none,   1   =
 output, 2 = input   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td>
</tr></table>
<!--l. 246--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Response  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">status</span>                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_STATUS_*</span>    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                          </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<a 
 id="x1-744001r756"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.4   </span> <a 
 id="x1-7450004"></a>requestq Operation: Get Value</h5>
<!--l. 250--><p class="noindent" >The driver sends this message to request the device to return current value sensed on
a line.
                                                                  

                                                                  
<!--l. 259--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Request  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">type</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">gpio</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_MSG_GET_VALUE</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >line number       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                 </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<!--l. 267--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Response  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">status</span>                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_STATUS_*</span>    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0 = low, 1 = high            </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<a 
 id="x1-745001r757"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.5   </span> <a 
 id="x1-7460005"></a>requestq Operation: Set Value</h5>
<!--l. 271--><p class="noindent" >The driver sends this message to request the device to set the value of a line. The
line may already be configured for output or may get configured to output
later, at which point this output value must be used by the device for the
line.
<!--l. 281--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Request  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">type</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">gpio</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_VALUE</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >line number       </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0 = low, 1 = high   </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<!--l. 289--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Response  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">status</span>                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_STATUS_*</span>    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                          </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<a 
 id="x1-746001r758"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.6   </span> <a 
 id="x1-7470006"></a>requestq Operation: Set IRQ Type</h5>
<!--l. 293--><p class="noindent" >This request is allowed only if the <span 
class="aeti-10">VIRTIO_GPIO_F_IRQ </span>feature has been
negotiated.
<!--l. 296--><p class="noindent" >The interrupt configuration is divided into two steps, enabling or disabling of the
interrupt at the device and masking or unmasking of the interrupt for delivery at the
driver. This request only pertains to enabling or disabling of the interrupt at the
device, the masking and unmasking of the interrupt is handled by a separate request
that takes place over the <span 
class="aeti-10">eventq </span>virtqueue.
<!--l. 303--><p class="noindent" >The driver sends the <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_IRQ_TYPE </span>message over the
<span 
class="aeti-10">requestq </span>virtqueue to enable or disable interrupt for a GPIO line at the
device.
<!--l. 307--><p class="noindent" >The driver sends this message with trigger type set to any valid value other than
<span 
class="aeti-10">VIRTIO_GPIO_IRQ_TYPE_NONE</span>, to enable the interrupt for a GPIO line, this
doesn’t unmask the interrupt for delivery at the driver though. For edge trigger type,
the device should latch the interrupt events from this point onward and notify it to
the driver once the interrupt is unmasked. For level trigger type, the device should
notify the driver once the interrupt signal on a line is sensed and the interrupt is
unmasked for the line.
<!--l. 315--><p class="noindent" >The driver sends this message with trigger type set to <span 
class="aeti-10">VIRTIO_GPIO_IRQ_TYPE_NONE</span>,
to disable the interrupt for a GPIO line. The device should discard any latched
                                                                  

                                                                  
interrupt event associated with it. In order to change the trigger type of an already
enabled interrupt, the driver should first disable the interrupt and then re-enable it
with appropriate trigger type.
<!--l. 321--><p class="noindent" >The interrupts are masked at initialization and the driver unmasks them by queuing
a pair of buffers, of type <span 
class="aeti-10">virtio_gpio_irq_request </span>and <span 
class="aeti-10">virtio_gpio_irq_response</span>, over
the <span 
class="aeti-10">eventq </span>virtqueue for a GPIO line. A separate pair of buffers must be
queued for each GPIO line, the driver wants to configure for interrupts.
Once an already enabled interrupt is unmasked by the driver, the device
can notify the driver of an active interrupt signal on the GPIO line. This is
done by updating the <span 
class="aeti-10">struct virtio_gpio_irq_response </span>buffer’s <span 
class="aeti-10">status </span>with
<span 
class="aeti-10">VIRTIO_GPIO_IRQ_STATUS_VALID </span>and returning the updated buffers to the
driver. The interrupt is masked automatically at this point until the buffers are
available again at the device.
<!--l. 333--><p class="noindent" >The interrupt for a GPIO line should not be unmasked before being enabled by the
driver.
<!--l. 336--><p class="noindent" >If the interrupt is disabled by the driver, by setting the trigger type to
<span 
class="aeti-10">VIRTIO_GPIO_IRQ_TYPE_NONE</span>, or the interrupt is unmasked without
being enabled first, the device should return any unused pair of buffers for
the GPIO line, over the <span 
class="aeti-10">eventq </span>virtqueue, after setting the <span 
class="aeti-10">status </span>field to
<span 
class="aeti-10">VIRTIO_GPIO_IRQ_STATUS_INVALID</span>. This also masks the interrupt.
<!--l. 348--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Request  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">type</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">gpio</span>              </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_IRQ_TYPE</span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >line number    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > one                   of
 <span 
class="aeti-10">VIRTIO_GPIO_IRQ_TYPE_*</span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >         </td>
</tr></table>
<!--l. 356--><p class="noindent" ><table style="border-collapse:collapse;"><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-1"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeb10-">Response  </span></td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">status</span>                      </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">value</span>                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-2"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" >          </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > <span 
class="aeti-10">VIRTIO_GPIO_STATUS_*</span>    </td><td style="text-align: left; min-width: \TX@col@width ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" > 0                          </td></tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td></tr><tr class="row-3"><td style="text-align: left; min-width: 0.2\textwidth ; border-left-style:solid; border-right-style:solid; border-width:thin; padding-left:6pt; padding-right:6pt;" ></td>
</tr></table>
<a 
 id="x1-747001r759"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.7   </span> <a 
 id="x1-7480007"></a>requestq Operation: Message Flow</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 361--><p class="noindent" >The  driver  enqueues  <span 
class="aeti-10">struct  virtio_gpio_request  </span>and  <span 
class="aeti-10">virtio_gpio_response</span>
    buffers  to  the  <span 
class="aeti-10">requestq  </span>virtqueue,  after  filling  all  fields  of  the  <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpio_request </span>buffer as defined by the specific message type.
    </li>
    <li class="itemize">
    <!--l. 366--><p class="noindent" >The driver notifies the device of the presence of buffers on the <span 
class="aeti-10">requestq</span>
    virtqueue.
    </li>
                                                                  

                                                                  
    <li class="itemize">
    <!--l. 369--><p class="noindent" >The device, after receiving the message from the driver, processes it and
    fills all the fields of the <span 
class="aeti-10">struct virtio_gpio_response </span>buffer (received from the
    driver). The <span 
class="aeti-10">status </span>must be set to <span 
class="aeti-10">VIRTIO_GPIO_STATUS_OK </span>on success
    and <span 
class="aeti-10">VIRTIO_GPIO_STATUS_ERR </span>on failure.
    </li>
    <li class="itemize">
    <!--l. 375--><p class="noindent" >The device puts the buffers back on the <span 
class="aeti-10">requestq </span>virtqueue and notifies the
    driver of the same.
    </li>
    <li class="itemize">
    <!--l. 378--><p class="noindent" >The driver fetches the buffers and processes the response received in the
    <span 
class="aeti-10">virtio_gpio_response </span>buffer.
    </li>
    <li class="itemize">
    <!--l. 381--><p class="noindent" >The driver can send multiple messages in parallel for same or different
    GPIO line.</li></ul>
<a 
 id="x1-748001r760"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.8   </span> <a 
 id="x1-7490008"></a>Driver Requirements: requestq Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 388--><p class="noindent" >The driver MUST send messages on the <span 
class="aeti-10">requestq </span>virtqueue.
    </li>
    <li class="itemize">
    <!--l. 390--><p class="noindent" >The                       driver                       MUST                       queue
    both <span 
class="aeti-10">struct virtio_gpio_request </span>and <span 
class="aeti-10">virtio_gpio_response </span>for every message
    sent to the device.
    </li>
    <li class="itemize">
    <!--l. 393--><p class="noindent" >The <span 
class="aeti-10">struct virtio_gpio_request  </span>buffer MUST be filled by the driver and
    MUST be read-only for the device.
    </li>
    <li class="itemize">
    <!--l. 396--><p class="noindent" >The <span 
class="aeti-10">struct virtio_gpio_response </span>buffer MUST be filled by the device and
    MUST be writable by the device.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 399--><p class="noindent" >The driver MAY send multiple messages for same or different GPIO lines
    in parallel.
    </li>
    <li class="itemize">
    <!--l. 402--><p class="noindent" >The driver MUST NOT send IRQ messages if the <span 
class="aeti-10">VIRTIO_GPIO_F_IRQ</span>
    feature has not been negotiated.
    </li>
    <li class="itemize">
    <!--l. 405--><p class="noindent" >The driver MUST NOT send IRQ messages for a GPIO line configured for
    output.
    </li>
    <li class="itemize">
    <!--l. 408--><p class="noindent" >The                                      driver                                      MUST
    set the IRQ trigger type to <span 
class="aeti-10">VIRTIO_GPIO_IRQ_TYPE_NONE </span>once it is
    done using the GPIO line configured for interrupts.
    </li>
    <li class="itemize">
    <!--l. 412--><p class="noindent" >In  order  to  change  the  trigger  type  of  an  already  enabled  interrupt,
    the driver MUST first disable the interrupt and then re-enable it with
    appropriate trigger type.</li></ul>
<a 
 id="x1-749001r761"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.6.9   </span> <a 
 id="x1-7500009"></a>Device Requirements: requestq Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 420--><p class="noindent" >The device MUST set all the fields of the <span 
class="aeti-10">struct virtio_gpio_response </span>before
    sending it back to the driver.
    </li>
    <li class="itemize">
    <!--l. 423--><p class="noindent" >The  device  MUST  set  all  the  fields  of  the  <span 
class="aeti-10">struct  virtio_gpio_config  </span>on
    receiving a configuration request from the driver.
    </li>
    <li class="itemize">
    <!--l. 426--><p class="noindent" >The  device  MUST  set  the  <span 
class="aeti-10">gpio_names_size  </span>field  as  zero  in  the  <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpio_config</span>, if it doesn’t implement names for individual GPIO lines.
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 430--><p class="noindent" >The   device   MUST   set   the   <span 
class="aeti-10">gpio_names_size   </span>field,   in   the   <span 
class="aeti-10">struct</span>
    <span 
class="aeti-10">virtio_gpio_config</span>, with the size of gpio-names memory block in bytes, if the
    device implements names for individual GPIO lines. The strings MUST be
    zero-terminated and an unique (if available) within the GPIO device.
    </li>
    <li class="itemize">
    <!--l. 436--><p class="noindent" >The device MUST process multiple messages, for the same GPIO line,
    sequentially and respond to them in the order they were received on the
    virtqueue.
    </li>
    <li class="itemize">
    <!--l. 440--><p class="noindent" >The device MAY process messages, for different GPIO lines, out of order
    and in parallel, and MAY send message’s response to the driver out of
    order.
    </li>
    <li class="itemize">
    <!--l. 443--><p class="noindent" >The  device  MUST  discard  all  state  information  corresponding  to  a
    GPIO  line,  once  the  driver  has  requested  to  set  its  direction  to
    <span 
class="aeti-10">VIRTIO_GPIO_DIRECTION_NONE</span>.
    </li>
    <li class="itemize">
    <!--l. 447--><p class="noindent" >The device MUST latch an edge interrupt if the interrupt is enabled but
    still masked.
    </li>
    <li class="itemize">
    <!--l. 450--><p class="noindent" >The device MUST NOT latch an level interrupt if the interrupt is enabled
    but still masked.
    </li>
    <li class="itemize">
    <!--l. 453--><p class="noindent" >The device MUST discard any latched interrupt for a GPIO line, once
    interrupt is disabled for the same.</li></ul>
<a 
 id="x1-750001r753"></a>
<h4 class="subsectionHead"><span class="titlemark">5.18.7   </span> <a 
 id="x1-7510007"></a>Device Operation: eventq</h4>
<!--l. 459--><p class="noindent" >The <span 
class="aeti-10">eventq </span>virtqueue is used by the driver to unmask the interrupts and used by the
device to notify the driver of newly sensed interrupts. In order to unmask interrupt
on a GPIO line, the driver enqueues a pair of buffers, <span 
class="aeti-10">struct virtio_gpio_irq_request</span>
(filled by driver) and <span 
class="aeti-10">struct virtio_gpio_irq_response </span>(to be filled by device later), to
the <span 
class="aeti-10">eventq </span>virtqueue. A separate pair of buffers must be queued for each GPIO
                                                                  

                                                                  
line, the driver wants to configure for interrupts. The device, on sensing an
interrupt, returns the pair of buffers for the respective GPIO line, which also
masks the interrupts. The driver can queue the buffers again to unmask the
interrupt.
<!--l. 469-->
<pre class="lstlisting" id="listing-290"><span class="label"><a 
 id="x1-751001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpio_irq_request</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">gpio</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 475--><p class="noindent" >This structure is filled by the driver and read by the device.
    <dl class="description"><dt class="description">
    <!--l. 478--><p class="noindent" >
<span 
class="aebxti-10">gpio</span> </dt><dd 
class="description">
    <!--l. 478--><p class="noindent" >is the GPIO line number, i.e. 0 <= <span 
class="aeti-10">gpio </span>< <span 
class="aeti-10">ngpio</span>.</dd></dl>
<!--l. 482-->
<pre class="lstlisting" id="listing-291"><span class="label"><a 
 id="x1-751004r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_gpio_irq_response</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751005r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751006r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751007r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751008r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Possible</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">values</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">interrupt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751009r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_STATUS_INVALID</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-751010r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_GPIO_IRQ_STATUS_VALID</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x1</span></span></pre>
<!--l. 492--><p class="noindent" >This structure is filled by the device and read by the driver.
    <dl class="description"><dt class="description">
    <!--l. 495--><p class="noindent" >
<span 
class="aebxti-10">status</span> </dt><dd 
class="description">
    <!--l. 495--><p class="noindent" >of the interrupt event, <span 
class="aeti-10">VIRTIO_GPIO_IRQ_STATUS_VALID </span>on interrupt
    and <span 
class="aeti-10">VIRTIO_GPIO_IRQ_STATUS_INVALID </span>to return the buffers back to
    the driver after interrupt is disabled.</dd></dl>
<a 
 id="x1-751011r762"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.7.1   </span> <a 
 id="x1-7520001"></a>eventq Operation: Message Flow</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 504--><p class="noindent" >The virtio-gpio driver is requested by a client driver to enable interrupt for
    a GPIO line and configure it to a particular trigger type.
    </li>
    <li class="itemize">
    <!--l. 507--><p class="noindent" >The driver sends the <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_IRQ_TYPE </span>message, over
    the <span 
class="aeti-10">requestq </span>virtqueue, and the device configures the GPIO line for the
    requested  trigger  type  and  enables  the  interrupt.  The  interrupt  is  still
    masked for delivery though. The device shall latch the interrupt from now
    onward for edge trigger type.
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 513--><p class="noindent" >The driver unmasks the interrupt by queuing a pair of buffers to the <span 
class="aeti-10">eventq</span>
    virtqueue for the GPIO line. The driver can do this before enabling the
    interrupt as well, though the interrupt must be both unmasked and enabled
    to get delivered at the driver.
    </li>
    <li class="itemize">
    <!--l. 518--><p class="noindent" >The driver notifies the device of the presence of new buffers on the <span 
class="aeti-10">eventq</span>
    virtqueue. The interrupt is fully configured at this point.
    </li>
    <li class="itemize">
    <!--l. 521--><p class="noindent" >The  device,  on  sensing  an  active  interrupt  on  the  GPIO  line,  finds
    the  matching  buffers  (based  on  GPIO  line  number)  from  the  <span 
class="aeti-10">eventq</span>
    virtqueue and update its <span 
class="aeti-10">struct virtio_gpio_irq_response </span>buffer’s <span 
class="aeti-10">status </span>with
    <span 
class="aeti-10">VIRTIO_GPIO_IRQ_STATUS_VALID </span>and returns the pair of buffers to
    the device. This results in masking the interrupt as well.
    </li>
    <li class="itemize">
    <!--l. 528--><p class="noindent" >The device notifies the driver of the presence of returned buffers on the
    <span 
class="aeti-10">eventq </span>virtqueue.
    </li>
    <li class="itemize">
    <!--l. 531--><p class="noindent" >If the GPIO line is configured for level interrupts, the device ignores any
    further interrupt signals on this GPIO line, until the interrupt is unmasked
    again by the driver by making the buffers available to the device. Once the
    interrupt is unmasked again and the interrupt on the line is still active, the
    device shall notify the driver again.
    </li>
    <li class="itemize">
    <!--l. 537--><p class="noindent" >If the GPIO line is configured for edge interrupts, the device latches the
    interrupt received for this GPIO line, until the interrupt is unmasked again
    by  the  driver  by  making  the  buffers  available  to  the  device.  Once  the
    interrupt is unmasked again and an interrupt was latched earlier, the device
    shall notify the driver again.
    </li>
    <li class="itemize">
    <!--l. 543--><p class="noindent" >The  driver  on  receiving  the  notification  from  the  device,  processes  the
    interrupt. The interrupt is masked at the device until the buffers are queued
                                                                  

                                                                  
    again by the driver.
    </li>
    <li class="itemize">
    <!--l. 547--><p class="noindent" >In a typical guest operating system kernel, the virtio-gpio driver notifies
    the client driver, that is associated with this GPIO line, to process the
    event. In the case of a level triggered interrupt, the client driver shall fully
    process and acknowledge the event at its source to return the line to its
    inactive state before the interrupt is unmasked again to avoid a spurious
    interrupt.
    </li>
    <li class="itemize">
    <!--l. 554--><p class="noindent" >Once the interrupt is handled, the driver may queue a pair of buffers for
    the GPIO line to unmask the interrupt again.
    </li>
    <li class="itemize">
    <!--l. 557--><p class="noindent" >The            driver            can            also            disable            the
    interrupt by sending the <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_IRQ_TYPE </span>message,
    with  <span 
class="aeti-10">VIRTIO_GPIO_IRQ_TYPE_NONE  </span>trigger  type.  In  that  case,  the
    device shall return the unused pair of buffers for the GPIO line after setting
    the <span 
class="aeti-10">status </span>field with <span 
class="aeti-10">VIRTIO_GPIO_IRQ_STATUS_INVALID</span>.</li></ul>
<a 
 id="x1-752001r764"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.18.7.2   </span> <a 
 id="x1-7530002"></a>Driver Requirements: eventq Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 567--><p class="noindent" >The driver MUST both enable and unmask the interrupt in order to get
    notified for the same.
    </li>
    <li class="itemize">
    <!--l. 570--><p class="noindent" >The driver MUST enable the interrupt before unmasking it.
    </li>
    <li class="itemize">
    <!--l. 572--><p class="noindent" >To unmask the interrupt, the driver MUST queue a separate pair of buffers
    to the <span 
class="aeti-10">eventq </span>virtqueue for each GPIO line.
    </li>
    <li class="itemize">
    <!--l. 575--><p class="noindent" >The driver MUST NOT add multiple pairs of buffers for the same GPIO
    line on the <span 
class="aeti-10">eventq </span>virtqueue.</li></ul>
<a 
 id="x1-753001r765"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.18.7.3   </span> <a 
 id="x1-7540003"></a>Device Requirements: eventq Operation</h5>
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 582--><p class="noindent" >The device MUST NOT send an interrupt event to the driver for a GPIO
    line unless the interrupt has been both unmasked and enabled by the driver.
    </li>
    <li class="itemize">
    <!--l. 586--><p class="noindent" >On   receiving   <span 
class="aeti-10">VIRTIO_GPIO_MSG_SET_IRQ_TYPE   </span>message,   with
    <span 
class="aeti-10">VIRTIO_GPIO_IRQ_TYPE_NONE </span>trigger type, the device MUST return
    the buffers, if they were received earlier, after setting the <span 
class="aeti-10">status </span>field to
    <span 
class="aeti-10">VIRTIO_GPIO_IRQ_STATUS_INVALID</span>.</li></ul>
<a 
 id="x1-754001r747"></a>
<h3 class="sectionHead"><span class="titlemark">5.19   </span> <a 
 id="x1-75500019"></a>PMEM Device</h3>
<!--l. 3--><p class="noindent" >The virtio pmem device is a persistent memory (NVDIMM) device that provides a
virtio based asynchronous flush mechanism. This avoids the need for a separate page
cache in the guest and keeps the page cache only in the host. Under memory
pressure, the host makes use of efficient memory reclaim decisions for page cache
pages of all the guests. This helps to reduce the memory footprint and fits more
guests in the host system.
<!--l. 11--><p class="noindent" >The virtio pmem device provides access to byte-addressable persistent memory. The
persistent memory is a directly accessible range of system memory. Data written to
this memory is made persistent by separately sending a flush command.
Writes that have been flushed are preserved across device reset and power
failure.
<a 
 id="x1-755001r763"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.1   </span> <a 
 id="x1-7560001"></a>Device ID</h4>
<!--l. 18--><p class="noindent" >27
<a 
 id="x1-756001r768"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.2   </span> <a 
 id="x1-7570002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 22--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 22--><p class="noindent" >req_vq</dd></dl>
<a 
 id="x1-757001r769"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.3   </span> <a 
 id="x1-7580003"></a>Feature bits</h4>
    <dl class="description"><dt class="description">
    <!--l. 28--><p class="noindent" >
                                                                  

                                                                  
<span 
class="aeb10-">VIRTIO_PMEM_F_SHMEM_REGION (0)</span> </dt><dd 
class="description">
    <!--l. 28--><p class="noindent" >The guest physical address range will be indicated as a shared memory
    region.</dd></dl>
<a 
 id="x1-758001r770"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.4   </span> <a 
 id="x1-7590004"></a>Device configuration layout</h4>
<!--l. 34-->
<pre class="lstlisting" id="listing-292"><span class="label"><a 
 id="x1-759001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pmem_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-759002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-759003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">size</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-759004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
    <dl class="description"><dt class="description">
    <!--l. 42--><p class="noindent" >
<span 
class="aebxti-10">start</span> </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >contains the physical address of the first byte of the persistent memory
    region, if VIRTIO_PMEM_F_SHMEM_REGION has not been negotiated.
    </dd><dt class="description">
    <!--l. 45--><p class="noindent" >
<span 
class="aebxti-10">size</span> </dt><dd 
class="description">
    <!--l. 45--><p class="noindent" >contains                        the                        length                        of
    this address range, if VIRTIO_PMEM_F_SHMEM_REGION has not been
    negotiated.</dd></dl>
<a 
 id="x1-759005r771"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.5   </span> <a 
 id="x1-7600005"></a>Device Initialization</h4>
<!--l. 51--><p class="noindent" >The device indicates the guest physical address to the driver in one of two
ways:
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">As a physical address, using virtio_pmem_config.
    </dd><dt class="enumerate-enumitem">
  2. </dt><dd 
class="enumerate-enumitem">As a shared memory region.</dd></dl>
<!--l. 57--><p class="noindent" >The driver determines the start address and size of the persistent memory region in
preparation for reading or writing data.
<!--l. 59--><p class="noindent" >The driver initializes req_vq in preparation for making flush requests.
<a 
 id="x1-760003r766"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.5.1   </span> <a 
 id="x1-7610001"></a>Device Requirements: Device Initialization</h5>
<!--l. 63--><p class="noindent" >If VIRTIO_PMEM_F_SHMEM_REGION has been negotiated, the device MUST
indicate the guest physical address as a shared memory region. The device MUST
use shared memory region ID 0. The device SHOULD set <span 
class="aeti-10">start </span>and <span 
class="aeti-10">size </span>to
zero.
                                                                  

                                                                  
<!--l. 67--><p class="noindent" >If VIRTIO_PMEM_F_SHMEM_REGION has not been negotiated, the device MUST
indicate the guest physical address as a physical address. The device MUST set
<span 
class="aeti-10">start </span>to the absolute address and <span 
class="aeti-10">size </span>to the size of the address range, in
bytes.
<a 
 id="x1-761001r773"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.5.2   </span> <a 
 id="x1-7620002"></a>Driver Requirements: Device Initialization</h5>
<!--l. 74--><p class="noindent" >If VIRTIO_PMEM_F_SHMEM_REGION has been negotiated, the driver MUST
query shared memory ID 0 for the physical address ranges, and MUST NOT use <span 
class="aeti-10">start</span>
or <span 
class="aeti-10">stop</span>.
<!--l. 78--><p class="noindent" >If VIRTIO_PMEM_F_SHMEM_REGION has not been negotiated, the driver MUST
read the physical address ranges from <span 
class="aeti-10">start </span>and <span 
class="aeti-10">stop</span>.
<a 
 id="x1-762001r772"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.6   </span> <a 
 id="x1-7630006"></a>Driver Operations</h4>
<!--l. 83--><p class="noindent" >Requests have the following format:
<!--l. 85-->
<pre class="lstlisting" id="listing-293"><span class="label"><a 
 id="x1-763001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pmem_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-763002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-763003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 91--><p class="noindent" ><span 
class="aeti-10">type </span>is the request command type.
<!--l. 93--><p class="noindent" >Possible request types are:
<!--l. 95-->
<pre class="lstlisting" id="listing-294"><span class="label"><a 
 id="x1-763004r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_PMEM_REQ_TYPE_FLUSH</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span></pre>
<a 
 id="x1-763005r775"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.7   </span> <a 
 id="x1-7640007"></a>Device Operations</h4>
<a 
 id="x1-764001r774"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.7.1   </span> <a 
 id="x1-7650001"></a>Device Requirements: Device Operation: Virtqueue flush</h5>
<!--l. 102--><p class="noindent" >The device MUST ensure that all writes completed before a flush request
persist across device reset and power failure before completing the flush
request.
<a 
 id="x1-765001r777"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.7.2   </span> <a 
 id="x1-7660002"></a>Device Operations</h5>
<!--l. 105-->
<pre class="lstlisting" id="listing-295"><span class="label"><a 
 id="x1-766001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_pmem_resp</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-766002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ret</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-766003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 111--><p class="noindent" ><span 
class="aeti-10">ret </span>is the value which the device returns after command completion.
<a 
 id="x1-766004r778"></a>
                                                                  

                                                                  
<h5 class="subsubsectionHead"><span class="titlemark">5.19.7.3   </span> <a 
 id="x1-7670003"></a>Device Requirements: Device Operation: Virtqueue return</h5>
<!--l. 115--><p class="noindent" >The device MUST return "0" for success and "-1" for failure.
<a 
 id="x1-767001r776"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.8   </span> <a 
 id="x1-7680008"></a>Possible security implications</h4>
<!--l. 119--><p class="noindent" >There could be potential security implications depending on how memory mapped
backing device is used. By default device emulation is done with SHARED memory
mapping. There is a contract between driver and device to access shared memory
region for read or write operations.
<!--l. 124--><p class="noindent" >If a malicious driver or device maps the same memory region, the attacker can make
use of known side channel attacks to predict the current state of data. If both
attacker and victim somehow execute same shared code after a flush or evict
operation, with difference in execution timing attacker could infer another device’s
data.
<a 
 id="x1-768001r780"></a>
<h4 class="subsectionHead"><span class="titlemark">5.19.9   </span> <a 
 id="x1-7690009"></a>Countermeasures</h4>
<a 
 id="x1-769001r779"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.9.1   </span> <a 
 id="x1-7700001"></a>With SHARED mapping</h5>
<!--l. 134--><p class="noindent" >If a device’s backing region is shared between multiple devices, this may
act as a metric for side channel attacks. As a counter measure every device
should have its own (not shared with another driver) SHARED backing
memory.
<a 
 id="x1-770001r782"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.9.2   </span> <a 
 id="x1-7710002"></a>With PRIVATE mapping</h5>
<!--l. 139--><p class="noindent" >There maybe be chances of side channels attack with PRIVATE memory mapping
similar to SHARED with read-only shared mappings. PRIVATE is not used for virtio
pmem making this usecase irrelevant.
<a 
 id="x1-771001r783"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.9.3   </span> <a 
 id="x1-7720003"></a>Workload specific mapping</h5>
<!--l. 145--><p class="noindent" >When using SHARED mappings with a workload that is a single application inside
the driver where the risk in sharing data is very low or nonexisting, the device
sharing the same backing region with a SHARED mapping can be used as a valid
configuration.
<a 
 id="x1-772001r784"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.19.9.4   </span> <a 
 id="x1-7730004"></a>Prevent cache eviction</h5>
<!--l. 151--><p class="noindent" >Don’t allow device shared region eviction from driver filesystem trim or discard like
commands with virtio pmem. This rules out any possibility of evict-reload cache side
channel attacks if backing region is shared (SHARED) between mutliple devices.
Though if we use per device backing file with shared mapping this countermeasure is
not required.
                                                                  

                                                                  
<a 
 id="x1-773001r767"></a>
<h3 class="sectionHead"><span class="titlemark">5.20   </span> <a 
 id="x1-77400020"></a>CAN Device</h3>
<!--l. 3--><p class="noindent" >virtio-can is a virtio based CAN (Controller Area Network) controller. It is used to
give a virtual machine access to a CAN bus. The CAN bus might either be a physical
CAN bus or a virtual CAN bus between virtual machines or a combination of
both.
<a 
 id="x1-774001r781"></a>
<h4 class="subsectionHead"><span class="titlemark">5.20.1   </span> <a 
 id="x1-7750001"></a>Device ID</h4>
<!--l. 10--><p class="noindent" >36
<a 
 id="x1-775001r787"></a>
<h4 class="subsectionHead"><span class="titlemark">5.20.2   </span> <a 
 id="x1-7760002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 15--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 15--><p class="noindent" >Txq
    </dd><dt class="description">
    <!--l. 16--><p class="noindent" >
<span 
class="aeb10-">1</span> </dt><dd 
class="description">
    <!--l. 16--><p class="noindent" >Rxq
    </dd><dt class="description">
    <!--l. 17--><p class="noindent" >
<span 
class="aeb10-">2</span> </dt><dd 
class="description">
    <!--l. 17--><p class="noindent" >Controlq</dd></dl>
<!--l. 20--><p class="noindent" >The <span 
class="aeti-10">Txq </span>is used to send CAN packets to the CAN bus.
<!--l. 22--><p class="noindent" >The <span 
class="aeti-10">Rxq </span>is used to receive CAN packets from the CAN bus.
<!--l. 24--><p class="noindent" >The <span 
class="aeti-10">Controlq </span>is used to control the state of the CAN controller.
<a 
 id="x1-776001r788"></a>
<h4 class="subsectionHead"><span class="titlemark">5.20.3   </span> <a 
 id="x1-7770003"></a>Feature bits</h4>
<!--l. 26--><p class="noindent" >Device Types / CAN Device / Feature bits
<!--l. 28--><p class="noindent" >Actual CAN controllers support Extended CAN IDs with 29 bits (CAN 2.0B) as well
as Standard CAN IDs with 11 bits (CAN 2.0A). The support of CAN 2.0B
Extended CAN IDs is considered as mandatory for this specification.
    <dl class="description"><dt class="description">
                                                                  

                                                                  
    <!--l. 35--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CAN_F_CAN_CLASSIC (0)</span> </dt><dd 
class="description">
    <!--l. 35--><p class="noindent" >
    <!--l. 37--><p class="noindent" >The device supports classic CAN frames with a maximum payload size of
    8 bytes.
    </dd><dt class="description">
    <!--l. 40--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CAN_F_CAN_FD (1)</span> </dt><dd 
class="description">
    <!--l. 40--><p class="noindent" >
    <!--l. 42--><p class="noindent" >The device supports CAN FD frames with a maximum payload size of 64
    bytes.
    </dd><dt class="description">
    <!--l. 45--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CAN_F_RTR_FRAMES (2)</span> </dt><dd 
class="description">
    <!--l. 45--><p class="noindent" >
    <!--l. 47--><p class="noindent" >The  device  supports  RTR  (remote  transmission  request)  frames.  RTR
    frames are only supported with classic CAN.
    </dd><dt class="description">
    <!--l. 50--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CAN_F_LATE_TX_ACK (3)</span> </dt><dd 
class="description">
    <!--l. 50--><p class="noindent" >
    <!--l. 52--><p class="noindent" >The  virtio  CAN  device  marks  transmission  requests  from  the  <span 
class="aeti-10">Txq  </span>as
    used after the CAN message has been transmitted on the CAN bus. If
    this feature bit has not been negotiated, the device is allowed to mark
    transmission requests already as used when the CAN message has been
    scheduled for transmission but might not yet have been transmitted on the
    CAN bus.
    </dd></dl>
<a 
 id="x1-777001r785"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.20.3.1   </span> <a 
 id="x1-7780001"></a>Feature bit requirements</h5>
<!--l. 63--><p class="noindent" >Some CAN feature bits require other CAN feature bits:
    <dl class="description"><dt class="description">
    <!--l. 65--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_CAN_F_RTR_FRAMES</span> </dt><dd 
class="description">
    <!--l. 65--><p class="noindent" >Requires VIRTIO_CAN_F_CAN_CLASSIC.</dd></dl>
                                                                  

                                                                  
<!--l. 68--><p class="noindent" >It is required that at least one of VIRTIO_CAN_F_CAN_CLASSIC and
VIRTIO_CAN_F_CAN_FD is negotiated.
<a 
 id="x1-778001r789"></a>
<h4 class="subsectionHead"><span class="titlemark">5.20.4   </span> <a 
 id="x1-7790004"></a>Device configuration layout</h4>
<!--l. 73--><p class="noindent" >Device configuration fields are listed below, they are read-only for a driver. The
<span 
class="aeti-10">status </span>always exists. A single read-only bit (for the driver) is currently defined for
<span 
class="aeti-10">status</span>:
<!--l. 77-->
<pre class="lstlisting" id="listing-296"><span class="label"><a 
 id="x1-779001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_can_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-779002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_S_CTRL_BUSOFF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(1</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-779003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">status</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-779004r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 84--><p class="noindent" >The bit VIRTIO_CAN_S_CTRL_BUSOFF in <span 
class="aeti-10">status </span>is used to indicate the unsolicited
CAN controller state change from started to stopped due to a detected bus off
condition.
<a 
 id="x1-779005r790"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.20.4.1   </span> <a 
 id="x1-7800001"></a>Driver Requirements: Device Initialization</h5>
<!--l. 90--><p class="noindent" >The driver MUST populate the <span 
class="aeti-10">Rxq </span>with empty device-writeable buffers of at least
the size of struct virtio_can_rx, see section <a 
href="#x1-7840003">5.20.5.3<!--tex4ht:ref: struct virtio-can-rx --></a>.
<a 
 id="x1-780001r791"></a>
<h4 class="subsectionHead"><span class="titlemark">5.20.5   </span> <a 
 id="x1-7810005"></a>Device Operation</h4>
<!--l. 96--><p class="noindent" >A device operation has an outcome which is described by one of the following
values:
<!--l. 99-->
<pre class="lstlisting" id="listing-297"><span class="label"><a 
 id="x1-781001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_RESULT_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-781002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_RESULT_NOT_OK</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span></pre>
<!--l. 104--><p class="noindent" >Other values are to be treated like VIRTIO_CAN_RESULT_NOT_OK.
<a 
 id="x1-781003r792"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.20.5.1   </span> <a 
 id="x1-7820001"></a>Controller Mode</h5>
<!--l. 108--><p class="noindent" >The general format of a request in the <span 
class="aeti-10">Controlq </span>is
<!--l. 110-->
<pre class="lstlisting" id="listing-298"><span class="label"><a 
 id="x1-782001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_can_control_out</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-782002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_SET_CTRL_MODE_START</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0201</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-782003r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_SET_CTRL_MODE_STOP</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0202</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-782004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">msg_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-782005r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 118--><p class="noindent" >To participate in bus communication the CAN controller is started by sending a
VIRTIO_CAN_SET_CTRL_MODE_START control message, to stop participating in bus
communication it is stopped by sending a VIRTIO_CAN_SET_CTRL_MODE_STOP
control message. Both requests are confirmed by the result of the operation.
<!--l. 124-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-299"><span class="label"><a 
 id="x1-782006r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_can_control_in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-782007r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-782008r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 130--><p class="noindent" >If the transition succeeded the <span 
class="aeti-10">result </span>is VIRTIO_CAN_RESULT_OK otherwise it is
VIRTIO_CAN_RESULT_NOT_OK. If a status update is necessary, the device
updates the configuration <span 
class="aeti-10">status </span>before marking the request used. As the
configuration <span 
class="aeti-10">status </span>change is caused by a request from the driver the device is
allowed to omit the configuration change notification here. The device marks the
request used when the CAN controller has finalized the transition to the requested
controller mode.
<!--l. 139--><p class="noindent" >On transition to the STOPPED state the device cancels all CAN messages
already pending for transmission and marks them as used with <span 
class="aeti-10">result</span>
VIRTIO_CAN_RESULT_NOT_OK. In the STOPPED state the device marks messages
received from the <span 
class="aeti-10">Txq </span>as used with <span 
class="aeti-10">result </span>VIRTIO_CAN_RESULT_NOT_OK without
transmitting them to the CAN bus.
<!--l. 146--><p class="noindent" >Initially the CAN controller is in the STOPPED state.
<!--l. 148--><p class="noindent" >Control queue messages are processed in order.
<a 
 id="x1-782009r794"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.20.5.2   </span> <a 
 id="x1-7830002"></a>Device Requirements: CAN Message Transmission</h5>
<!--l. 152--><p class="noindent" >The driver transmits messages by placing outgoing CAN messages in the <span 
class="aeti-10">Txq</span>
virtqueue.
<!--l. 156-->
<pre class="lstlisting" id="listing-300"><span class="label"><a 
 id="x1-783001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_can_tx_out</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_TX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0001</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">msg_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0..8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0..64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">FD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0..2048</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">XL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">12</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved_classic_dlc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">If</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">classic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">then</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">DLC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">can</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8..15</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved_xl_priority</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">May</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">needed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">XL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">priority</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783008r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_FLAGS_FD</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x4000</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783009r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_FLAGS_EXTENDED</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x8000</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783010r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_FLAGS_RTR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x2000</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">can_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sdu</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783015r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783016r16"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_can_tx_in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783017r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-783018r18"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 177--><p class="noindent" >The length of the <span 
class="aeti-10">sdu </span>is determined by the <span 
class="aeti-10">length</span>.
<!--l. 179--><p class="noindent" >The type of a CAN message identifier is determined by <span 
class="aeti-10">flags</span>. The 3 most significant
bits of <span 
class="aeti-10">can_id </span>do not bear the information about the type of the CAN message
identifier and are 0.
<!--l. 183--><p class="noindent" >The device MUST reject any CAN frame type for which support has not been
negotiated with VIRTIO_CAN_RESULT_NOT_OK in <span 
class="aeti-10">result </span>and MUST NOT
schedule the message for transmission. A CAN frame with an undefined bit
set in <span 
class="aeti-10">flags </span>is treated like a CAN frame for which support has not been
negotiated.
<!--l. 189--><p class="noindent" >The device MUST reject any CAN frame for which <span 
class="aeti-10">can_id </span>or <span 
class="aeti-10">sdu </span>length are out of range
or the CAN controller is in an invalid state with VIRTIO_CAN_RESULT_NOT_OK
in <span 
class="aeti-10">result </span>and MUST NOT schedule the message for transmission.
<!--l. 194--><p class="noindent" >If the parameters are valid the message is scheduled for transmission.
<!--l. 196--><p class="noindent" >If feature VIRTIO_CAN_F_CAN_LATE_TX_ACK has been negotiated the
transmission request MUST be marked as used with <span 
class="aeti-10">result </span>set to VIRTIO_CAN_OK
                                                                  

                                                                  
after the CAN controller acknowledged the successful transmission on the CAN bus.
If this feature bit has not been negotiated the transmission request MAY already be
marked as used with <span 
class="aeti-10">result </span>set to VIRTIO_CAN_OK when the transmission request
has been processed by the virtio CAN device and send down the protocol stack being
scheduled for transmission.
<a 
 id="x1-783019r795"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.20.5.3   </span> <a 
 id="x1-7840003"></a>CAN Message Reception</h5>
<!--l. 207--><p class="noindent" >Messages can be received by providing empty incoming buffers to the virtqueue
<span 
class="aeti-10">Rxq</span>.
<!--l. 211-->
<pre class="lstlisting" id="listing-301"><span class="label"><a 
 id="x1-784001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_can_rx</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784002r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_CAN_RX</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0101</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">msg_type</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0..8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CC</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0..64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">FD</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0..2048</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">XL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">12</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved_classic_dlc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">If</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">classic</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">then</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">DLC</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">can</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">8..15</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved_xl_priority</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">May</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">needed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">XL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">priority</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">can_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">sdu</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-784011r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 225--><p class="noindent" >If the feature VIRTIO_CAN_F_CAN_FD has been negotiated the maximal possible
<span 
class="aeti-10">sdu </span>length is 64, if the feature has not been negotiated the maximal possible <span 
class="aeti-10">sdu</span>
length is 8.
<!--l. 229--><p class="noindent" >The actual length of the <span 
class="aeti-10">sdu </span>is determined by the <span 
class="aeti-10">length</span>.
<!--l. 231--><p class="noindent" >The type of a CAN message identifier is determined by <span 
class="aeti-10">flags </span>in the same way as for
transmitted CAN messages, see section <a 
href="#x1-7830002">5.20.5.2<!--tex4ht:ref: struct virtio-can-tx-out --></a>. The 3 most significant bits of
<span 
class="aeti-10">can_id </span>do not bear the information about the type of the CAN message
identifier and are 0. The flag bits are exactly the same as for the <span 
class="aeti-10">flags </span>of struct
virtio_can_tx_out.
<a 
 id="x1-784012r796"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.20.5.4   </span> <a 
 id="x1-7850004"></a>BusOff Indication</h5>
<!--l. 240--><p class="noindent" >There are certain error conditions so that the physical CAN controller has to stop
participating in CAN communication on the bus. If such an error condition occurs
the device informs the driver about the unsolicited CAN controller state change by
setting the VIRTIO_CAN_S_CTRL_BUSOFF bit in the configuration <span 
class="aeti-10">status</span>
field.
<!--l. 246--><p class="noindent" >After bus-off detection the CAN controller is in STOPPED state. The CAN
controller does not participate in bus communication any more so all CAN
messages pending for transmission are put into the used queue with <span 
class="aeti-10">result</span>
VIRTIO_CAN_RESULT_NOT_OK.
<a 
 id="x1-785001r786"></a>
<h3 class="sectionHead"><span class="titlemark">5.21   </span> <a 
 id="x1-78600021"></a>SPI Controller Device</h3>
<!--l. 3--><p class="noindent" >The Virtio SPI (Serial Peripheral Interface) device is a virtual SPI controller that
allows the driver to operate and use the SPI controller under the control of the host,
either a physical SPI controller, or an emulated one.
                                                                  

                                                                  
<!--l. 7--><p class="noindent" >The Virtio SPI device has a single virtqueue. SPI transfer requests are placed into the
virtqueue by the driver, and are serviced by the device.
<!--l. 10--><p class="noindent" >In a typical host and guest architecture with the Virtio SPI device, the Virtio SPI
driver is the front-end running in the guest, and the Virtio SPI device is the back-end
in the host.
<a 
 id="x1-786001r793"></a>
<h4 class="subsectionHead"><span class="titlemark">5.21.1   </span> <a 
 id="x1-7870001"></a>Device ID</h4>
<!--l. 15--><p class="noindent" >45
<a 
 id="x1-787001r799"></a>
<h4 class="subsectionHead"><span class="titlemark">5.21.2   </span> <a 
 id="x1-7880002"></a>Virtqueues</h4>
    <dl class="description"><dt class="description">
    <!--l. 20--><p class="noindent" >
<span 
class="aeb10-">0</span> </dt><dd 
class="description">
    <!--l. 20--><p class="noindent" >requestq</dd></dl>
<a 
 id="x1-788001r800"></a>
<h4 class="subsectionHead"><span class="titlemark">5.21.3   </span> <a 
 id="x1-7890003"></a>Feature bits</h4>
<!--l. 25--><p class="noindent" >None
<a 
 id="x1-789001r801"></a>
<h4 class="subsectionHead"><span class="titlemark">5.21.4   </span> <a 
 id="x1-7900004"></a>Device configuration layout</h4>
<!--l. 29--><p class="noindent" >All fields of this configuration are mandatory and read-only for the driver. The config
space shows the features and settings supported by the device.
<!--l. 32-->
<pre class="lstlisting" id="listing-302"><span class="label"><a 
 id="x1-790001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_spi_config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cs_max_number</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cs_change_supported</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_nbits_supported</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_nbits_supported</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits_per_word_mask</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode_func_supported</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_freq_hz</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_word_delay_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_cs_setup_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_cs_hold_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">max_cs_inactive_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-790013r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 48--><p class="noindent" ><span 
class="aeti-10">cs_max_number </span>is the maximum number of chipselect the device supports.
<!--l. 50--><p class="noindent" >Note: chipselect is an electrical signal, which is used to select the SPI peripherals
connected to the controller.
<!--l. 53--><p class="noindent" ><span 
class="aeti-10">cs_change_supported </span>indicates if the device supports to toggle chipselect after each
transfer in one message: 0: unsupported, chipselect will be kept in active state
throughout the message transaction; 1: supported.
<!--l. 58--><p class="noindent" >Note: Message here contains a sequence of SPI transfers.
<!--l. 60--><p class="noindent" ><span 
class="aeti-10">tx_nbits_supported </span>and <span 
class="aeti-10">rx_nbits_supported </span>indicate the different n-bit transfer modes
supported by the device, for writing and reading respectively. SINGLE is always
supported. A set bit here indicates that the corresponding n-bit transfer is supported,
otherwise not: bit 0: DUAL; bit 1: QUAD; bit 2: OCTAL; other bits are reserved and
must be set as 0 by the device.
                                                                  

                                                                  
<!--l. 68--><p class="noindent" >Note: The commonly used SPI n-bit transfer options are:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 70--><p class="noindent" >SINGLE: 1-bit transfer
    </li>
    <li class="itemize">
    <!--l. 71--><p class="noindent" >DUAL: 2-bit transfer
    </li>
    <li class="itemize">
    <!--l. 72--><p class="noindent" >QUAD: 4-bit transfer
    </li>
    <li class="itemize">
    <!--l. 73--><p class="noindent" >OCTAL: 8-bit transfer</li></ul>
<!--l. 76--><p class="noindent" ><span 
class="aeti-10">bits_per_word_mask </span>is a mask indicating which values of bits_per_word are
supported. If bit n of <span 
class="aeti-10">bits_per_word_mask </span>is set, the bits_per_word with value
(n+1) is supported. If <span 
class="aeti-10">bits_per_word_mask </span>is 0, there is no limitation for
bits_per_word.
<!--l. 80--><p class="noindent" >Note: bits_per_word corresponds to <span 
class="aeti-10">bits_per_word </span>in <span 
class="aeti-10">struct virtio_spi_transfer_head</span>.
<!--l. 82--><p class="noindent" ><span 
class="aeti-10">mode_func_supported </span>indicates whether the following features are supported or not:
bit 0-1: CPHA feature, 0b00: invalid, must support as least one CPHA setting. 0b01:
supports CPHA=0 only; 0b10: supports CPHA=1 only; 0b11: supports CPHA=0
and CPHA=1;
<!--l. 89--><p class="noindent" >bit 2-3: CPOL feature, 0b00: invalid, must support as least one CPOL setting. 0b01:
supports CPOL=0 only; 0b10: supports CPOL=1 only; 0b11: supports CPOL=0 and
CPOL=1;
<!--l. 95--><p class="noindent" >bit 4: chipselect active high feature, 0 for unsupported and 1 for supported, chipselect
active low must always be supported.
<!--l. 98--><p class="noindent" >bit 5: LSB first feature, 0 for unsupported and 1 for supported, MSB first must
always be supported.
<!--l. 101--><p class="noindent" >bit 6: loopback mode feature, 0 for unsupported and 1 for supported, normal mode
must always be supported.
<!--l. 104--><p class="noindent" >Note: CPOL is clock polarity and CPHA is clock phase. If CPOL is 0, the clock idles
at the logical low voltage, otherwise it idles at the logical high voltage. CPHA
determines how data is outputted and sampled. If CPHA is 0, the first bit is
outputted immediately when chipselect is active and subsequent bits are
outputted on the clock edges when the clock transitions from active level to idle
level. Data is sampled on the clock edges when the clock transitions from
idle level to active level. If CPHA is 1, the first bit is outputted on the fist
                                                                  

                                                                  
clock edge after chipselect is active, subsequent bits are outputted on the
clock edges when the clock transitions from idle level to active level. Data is
sampled on the clock edges when the clock transitions from active level to idle
level.
<!--l. 113--><p class="noindent" >Note: LSB first indicates that data is transferred least significant bit first, and MSB
first indicates that data is transferred most significant bit first.
<!--l. 116--><p class="noindent" ><span 
class="aeti-10">max_freq_hz </span>is the maximum clock rate supported in Hz unit, 0 means no limitation
for transfer speed.
<!--l. 119--><p class="noindent" ><span 
class="aeti-10">max_word_delay_ns </span>is the maximum word delay supported in ns unit, 0 means word
delay feature is unsupported.
<!--l. 122--><p class="noindent" >Note: Just as one message contains a sequence of transfers, one transfer may contain
a sequence of words.
<!--l. 125--><p class="noindent" ><span 
class="aeti-10">max_cs_setup_ns </span>is the maximum delay supported after chipselect is asserted,
in ns unit, 0 means delay is not supported to introduce after chipselect is
asserted.
<!--l. 128--><p class="noindent" ><span 
class="aeti-10">max_cs_hold_ns </span>is the maximum delay supported before chipselect is deasserted, in
ns unit, 0 means delay is not supported to introduce before chipselect is
deasserted.
<!--l. 131--><p class="noindent" ><span 
class="aeti-10">max_cs_incative_ns </span>is the maximum delay supported after chipselect is deasserted,
in ns unit, 0 means delay is not supported to introduce after chipselect is
deasserted.
<a 
 id="x1-790014r802"></a>
<h4 class="subsectionHead"><span class="titlemark">5.21.5   </span> <a 
 id="x1-7910005"></a>Device Initialization</h4>
    <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
  1. </dt><dd 
class="enumerate-enumitem">The Virtio SPI driver configures and initializes the virtqueue.</dd></dl>
<a 
 id="x1-791002r803"></a>
<h4 class="subsectionHead"><span class="titlemark">5.21.6   </span> <a 
 id="x1-7920006"></a>Device Operation</h4>
<a 
 id="x1-792001r797"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.21.6.1   </span> <a 
 id="x1-7930001"></a>Device Operation: Request Queue</h5>
<!--l. 144--><p class="noindent" >The Virtio SPI driver enqueues requests to the virtqueue, and they are used by the
Virtio SPI device. Each request represents one SPI transfer and is of the
form:
<!--l. 147-->
<pre class="lstlisting" id="listing-303"><span class="label"><a 
 id="x1-793001r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_spi_transfer_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793002r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chip_select_id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793003r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bits_per_word</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793004r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cs_change</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793005r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_nbits</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793006r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_nbits</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793007r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[3];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793008r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793009r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">freq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793010r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">word_delay_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793011r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cs_setup_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793012r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cs_delay_hold_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793013r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">cs_change_delay_inactive_ns</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793014r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 164-->
                                                                  

                                                                  
<pre class="lstlisting" id="listing-304"><span class="label"><a 
 id="x1-793015r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_spi_transfer_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793016r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793017r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 170-->
<pre class="lstlisting" id="listing-305"><span class="label"><a 
 id="x1-793018r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_spi_transfer_req</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793019r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_spi_transfer_head</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">head</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793020r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tx_buf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793021r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">u8</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rx_buf</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793022r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio_spi_transfer_result</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">result</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793023r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span></pre>
<!--l. 179--><p class="noindent" ><span 
class="aeti-10">chip_select_id </span>indicates the chipselect index to use for the SPI transfer.
<!--l. 181--><p class="noindent" ><span 
class="aeti-10">bits_per_word </span>indicates the number of bits in each SPI transfer word.
<!--l. 183--><p class="noindent" ><span 
class="aeti-10">cs_change </span>indicates whether to deselect device before starting the next SPI transfer,
0 means chipselect keep asserted and 1 means chipselect deasserted then asserted
again.
<!--l. 186--><p class="noindent" ><span 
class="aeti-10">tx_nbits </span>and <span 
class="aeti-10">rx_nbits </span>indicate n-bit transfer mode for writing and reading: 0,1:
SINGLE; 2 : DUAL; 4 : QUAD; 8 : OCTAL; other values are invalid.
<!--l. 193--><p class="noindent" ><span 
class="aeti-10">reserved </span>is currently unused and might be used for further extensions in the
future.
<!--l. 195--><p class="noindent" ><span 
class="aeti-10">mode </span>indicates some transfer settings. Bit definitions as follows: bit 0: CPHA,
determines the timing (i.e. phase) of the data bits relative to the clock pulses. bit 1:
CPOL, determines the polarity of the clock. bit 2: CS_HIGH, if 1, chipselect active
high, else active low. bit 3: LSB_FIRST, determines per-word bits-on-wire, if 0, MSB
first, else LSB first. bit 4: LOOP, if 1, device is in loopback mode, else normal
mode.
<!--l. 203--><p class="noindent" ><span 
class="aeti-10">freq </span>indicates the SPI transfer speed in Hz.
<!--l. 205--><p class="noindent" ><span 
class="aeti-10">word_delay_ns </span>indicates delay to be inserted between consecutive words of a transfer,
in ns unit.
<!--l. 208--><p class="noindent" ><span 
class="aeti-10">cs_setup_ns </span>indicates delay to be introduced after chipselect is asserted, in ns
unit.
<!--l. 210--><p class="noindent" ><span 
class="aeti-10">cs_delay_hold_ns </span>indicates delay to be introduced before chipselect is deasserted, in ns
unit.
<!--l. 213--><p class="noindent" ><span 
class="aeti-10">cs_change_delay_inactive_ns </span>indicates delay to be introduced after chipselect is
deasserted and before next asserted, in ns unit.
<!--l. 216--><p class="noindent" ><span 
class="aeti-10">tx_buf  </span>is the buffer for data sent to the device.
<!--l. 218--><p class="noindent" ><span 
class="aeti-10">rx_buf  </span>is the buffer for data received from the device.
<!--l. 220--><p class="noindent" ><span 
class="aeti-10">result </span>is the transfer result, it may be one of the following values:
<!--l. 222-->
<pre class="lstlisting" id="listing-306"><span class="label"><a 
 id="x1-793024r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SPI_TRANS_OK</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793025r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SPI_PARAM_ERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-793026r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_SPI_TRANS_ERR</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span></pre>
                                                                  

                                                                  
<!--l. 228--><p class="noindent" >VIRTIO_SPI_TRANS_OK indicates successful completion of the transfer.
<!--l. 230--><p class="noindent" >VIRTIO_SPI_PARAM_ERR indicates a parameter error, which means the
parameters in <span 
class="aeti-10">struct virtio_spi_transfer_head </span>are not all valid, or some fields are set as
non-zero values but the corresponding features are not supported by device. In
particular, for full-duplex transfer, VIRTIO_SPI_PARAM_ERR can also indicate that
<span 
class="aeti-10">tx_buf  </span>and <span 
class="aeti-10">rx_buf  </span>are not of the same length.
<!--l. 236--><p class="noindent" >VIRTIO_SPI_TRANS_ERR indicates a transfer error, which means that the
parameters are all valid but the transfer process failed.
<a 
 id="x1-793027r805"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.21.6.2   </span> <a 
 id="x1-7940002"></a>Device Operation: Operation Status</h5>
<!--l. 241--><p class="noindent" >Fields in <span 
class="aeti-10">struct virtio_spi_transfer_head </span>are written by the Virtio SPI driver,
while <span 
class="aeti-10">result </span>in <span 
class="aeti-10">struct virtio_spi_transfer_result </span>is written by the Virtio SPI
device.
<!--l. 244--><p class="noindent" >virtio-spi supports three transfer types:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 246--><p class="noindent" >half-duplex read;
    </li>
    <li class="itemize">
    <!--l. 247--><p class="noindent" >half-duplex write;
    </li>
    <li class="itemize">
    <!--l. 248--><p class="noindent" >full-duplex transfer.</li></ul>
<!--l. 251--><p class="noindent" >For half-duplex read and full-duplex transfer, <span 
class="aeti-10">rx_buf </span>is filled by the Virtio SPI device
and consumed by the Virtio SPI driver. For half-duplex write and full-duplex
transfer, <span 
class="aeti-10">tx_buf  </span>is filled by the Virtio SPI driver and consumed by the Virtio SPI
device.
<a 
 id="x1-794001r806"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.21.6.3   </span> <a 
 id="x1-7950003"></a>Driver Requirements: Device Operation</h5>
<!--l. 257--><p class="noindent" >For half-duplex read, the Virtio SPI driver MUST send <span 
class="aeti-10">struct virtio_spi_transfer_head</span>,
<span 
class="aeti-10">rx_buf  </span>and <span 
class="aeti-10">struct virtio_spi_transfer_result </span>to the SPI Virtio Device in that
order.
<!--l. 260--><p class="noindent" >For half-duplex write, the Virtio SPI driver MUST send <span 
class="aeti-10">struct virtio_spi_transfer_head</span>,
<span 
class="aeti-10">tx_buf  </span>and <span 
class="aeti-10">struct virtio_spi_transfer_result </span>to the SPI Virtio Device in that
order.
<!--l. 263--><p class="noindent" >For full-duplex transfer, the Virtio SPI driver MUST send <span 
class="aeti-10">struct virtio_spi_transfer_head</span>,
<span 
class="aeti-10">tx_buf</span>, <span 
class="aeti-10">rx_buf </span>and <span 
class="aeti-10">struct virtio_spi_transfer_result </span>to the SPI Virtio Device in that
                                                                  

                                                                  
order.
<!--l. 267--><p class="noindent" >For full-duplex transfer, the Virtio SPI driver MUST guarantee that the buffer size of
<span 
class="aeti-10">tx_buf  </span>and <span 
class="aeti-10">rx_buf  </span>is the same.
<!--l. 270--><p class="noindent" >The Virtio SPI driver MUST not use <span 
class="aeti-10">rx_buf  </span>if the <span 
class="aeti-10">result </span>returned from the Virtio
SPI device is not VIRTIO_SPI_TRANS_OK.
<a 
 id="x1-795001r807"></a>
<h5 class="subsubsectionHead"><span class="titlemark">5.21.6.4   </span> <a 
 id="x1-7960004"></a>Device Requirements: Device Operation</h5>
<!--l. 275--><p class="noindent" >The Virtio SPI device MUST set all the fields of <span 
class="aeti-10">struct virtio_spi_config </span>before they
are read by the Virtio SPI driver.
<!--l. 278--><p class="noindent" >The Virtio SPI device MUST NOT change the data in <span 
class="aeti-10">tx_buf</span>.
<!--l. 280--><p class="noindent" >The Virtio SPI device MUST verify the parameters in <span 
class="aeti-10">struct virtio_spi_transfer_head</span>
after receiving the request, and MUST set <span 
class="aeti-10">struct virtio_spi_transfer_result </span>as
VIRTIO_SPI_PARAM_ERR if not all parameters are valid or some device
unsupported features are set.
<!--l. 284--><p class="noindent" >For full-duplex transfer, the Virtio SPI device MUST verify that the buffer size of
<span 
class="aeti-10">tx_buf  </span>is equal to that of <span 
class="aeti-10">rx_buf</span>. If not, the Virtio SPI device MUST set <span 
class="aeti-10">struct</span>
<span 
class="aeti-10">virtio_spi_transfer_result </span>as VIRTIO_SPI_PARAM_ERR.
                                                                  

                                                                  
<!--l. 778--><p class="noindent" ><h2 class="chapterHead"><hr><span class="titlemark">6</span> <a 
 id="x1-7970006"></a>Reserved Feature Bits</h2>
Currently these device-independent feature bits are defined:
    <dl class="description"><dt class="description">
    <!--l. 783--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_INDIRECT_DESC (28)</span> </dt><dd 
class="description">
    <!--l. 783--><p class="noindent" >Negotiating this feature indicates that the driver can use descriptors with
    the VIRTQ_DESC_F_INDIRECT flag set, as described in <a 
href="#x1-460003">2.7.5.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table / Indirect Descriptors --></a> <a 
href="#x1-460003">Indirect
    Descriptors<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table / Indirect Descriptors --></a> and <a 
href="#x1-790007">2.8.7<!--tex4ht:ref: sec:Packed Virtqueues / Indirect Flag: Scatter-Gather Support --></a> <a 
href="#x1-790007">Indirect Flag: Scatter-Gather Support<!--tex4ht:ref: sec:Packed Virtqueues / Indirect Flag: Scatter-Gather Support --></a>.
    </dd><dt class="description">
    <!--l. 790--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_EVENT_IDX(29)</span> </dt><dd 
class="description">
    <!--l. 790--><p class="noindent" >This feature enables the <span 
class="aeti-10">used_event </span>and the <span 
class="aeti-10">avail_event </span>fields as described
    in <a 
href="#x1-510007">2.7.7<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Used Buffer Notification Suppression --></a>, <a 
href="#x1-540008">2.7.8<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Used Ring --></a> and <a 
href="#x1-8200010">2.8.10<!--tex4ht:ref: sec:Packed Virtqueues / Driver and Device Event Suppression --></a>.
    </dd><dt class="description">
    <!--l. 795--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_VERSION_1(32)</span> </dt><dd 
class="description">
    <!--l. 795--><p class="noindent" >This indicates compliance with this specification, giving a simple way to
    detect legacy devices or drivers.
    </dd><dt class="description">
    <!--l. 798--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_ACCESS_PLATFORM(33)</span> </dt><dd 
class="description">
    <!--l. 798--><p class="noindent" >This feature indicates that the device can be used on a platform where
    device access to data in memory is limited and/or translated. E.g. this is
    the case if the device can be located behind an IOMMU that translates
    bus addresses from the device into physical addresses in memory, if the
    device  can  be  limited  to  only  access  certain  memory  addresses  or  if
    special  commands  such  as  a  cache  flush  can  be  needed  to  synchronise
    data in memory with the device. Whether accesses are actually limited
    or  translated  is  described  by  platform-specific  means.  If  this  feature
    bit  is  set  to  0,  then  the  device  has  same  access  to  memory  addresses
    supplied  to  it  as  the  driver  has.  In  particular,  the  device  will  always
    use physical addresses matching addresses used by the driver (typically
    meaning physical addresses used by the CPU) and not translated further,
    and  can  access  any  address  supplied  to  it  by  the  driver.  When  clear,
    this overrides any platform-specific description of whether device access is
    limited or translated in any way, e.g. whether an IOMMU may be present.
    </dd><dt class="description">
    <!--l. 817--><p class="noindent" >
                                                                  

                                                                  
<span 
class="aeb10-">VIRTIO_F_RING_PACKED(34)</span> </dt><dd 
class="description">
    <!--l. 817--><p class="noindent" >This feature indicates support for the packed virtqueue layout as described
    in <a 
href="#x1-720008">2.8<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Packed Virtqueues --></a> <a 
href="#x1-720008">Packed Virtqueues<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Packed Virtqueues --></a>.
    </dd><dt class="description">
    <!--l. 820--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_IN_ORDER(35)</span> </dt><dd 
class="description">
    <!--l. 820--><p class="noindent" >This feature indicates that all buffers are used by the device in the same
    order in which they have been made available.
    </dd><dt class="description">
    <!--l. 823--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_ORDER_PLATFORM(36)</span> </dt><dd 
class="description">
    <!--l. 823--><p class="noindent" >This feature indicates that memory accesses by the driver and the device
    are ordered in a way described by the platform.
    <!--l. 827--><p class="noindent" >If this feature bit is negotiated, the ordering in effect for any memory
    accesses by the driver that need to be ordered in a specific way with respect
    to accesses by the device is the one suitable for devices described by the
    platform. This implies that the driver needs to use memory barriers suitable
    for devices described by the platform; e.g. for the PCI transport in the case
    of hardware PCI devices.
    <!--l. 834--><p class="noindent" >If this feature bit is not negotiated, then the device and driver are assumed
    to be implemented in software, that is they can be assumed to run on
    identical CPUs in an SMP configuration. Thus a weaker form of memory
    barriers is sufficient to yield better performance.
    </dd><dt class="description">
    <!--l. 840--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_SR_IOV(37)</span> </dt><dd 
class="description">
    <!--l. 840--><p class="noindent" >This  feature  indicates  that  the  device  supports  Single  Root  I/O
    Virtualization. Currently only PCI devices support this feature.
    </dd><dt class="description">
    <!--l. 843--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_NOTIFICATION_DATA(38)</span> </dt><dd 
class="description">
    <!--l. 843--><p class="noindent" >This feature indicates that the driver passes extra data (besides identifying
    the virtqueue) in its device notifications. See <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a> <a 
href="#x1-1010009">Driver Notifications<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a>.
    </dd><dt class="description">
    <!--l. 848--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_NOTIF_CONFIG_DATA(39)</span> </dt><dd 
class="description">
                                                                  

                                                                  
    <!--l. 848--><p class="noindent" >This feature indicates that the driver uses the data provided by the device
    as  a  virtqueue  identifier  in  available  buffer  notifications.  As  mentioned
    in  section  <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a>,  when  the  driver  is  required  to  send  an  available  buffer
    notification  to  the  device,  it  sends  the  virtqueue  index  to  be  notified.
    The method of delivering notifications is transport specific. With the PCI
    transport, the device can optionally provide a per-virtqueue value for the
    driver to use in driver notifications, instead of the virtqueue index. Some
    devices  may  benefit  from  this  flexibility  by  providing,  for  example,  an
    internal virtqueue identifier, or an internal offset related to the virtqueue
    index.
    <!--l. 861--><p class="noindent" >This feature indicates the availability of such value. The definition of the
    data  to  be  provided  in  driver  notification  and  the  delivery  method  is
    transport specific. For more details about driver notifications over PCI see
    <a 
href="#x1-2050002">4.1.5.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Available Buffer Notifications --></a>.
    </dd><dt class="description">
    <!--l. 866--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_RING_RESET(40)</span> </dt><dd 
class="description">
    <!--l. 866--><p class="noindent" >This feature indicates that the driver can reset a queue individually. See
    <a 
href="#x1-280001">2.6.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset --></a>.
    </dd><dt class="description">
    <!--l. 870--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_ADMIN_VQ(41)</span> </dt><dd 
class="description">
    <!--l. 870--><p class="noindent" >This feature indicates that the device exposes one or more administration
    virtqueues. At the moment this feature is only supported for devices using
    <a 
href="#x1-1630001">4.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a> <a 
href="#x1-1630001">Virtio Over PCI Bus<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a> as the transport and is reserved for future use
    for devices using other transports (see <a 
href="#x1-150001">2.2.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Feature Bits --></a> and <a 
href="#x1-160002">2.2.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Feature Bits --></a> for handling features
    reserved for future use.
    </dd></dl>
<a 
 id="x1-797001r798"></a>
<h3 class="sectionHead"><span class="titlemark">6.1   </span> <a 
 id="x1-7980001"></a>Driver Requirements: Reserved Feature Bits</h3>
<!--l. 886--><p class="noindent" >A driver MUST accept VIRTIO_F_VERSION_1 if it is offered. A driver MAY fail to
operate further if VIRTIO_F_VERSION_1 is not offered.
<!--l. 889--><p class="noindent" >A driver SHOULD accept VIRTIO_F_ACCESS_PLATFORM if it is offered, and it
MUST then either disable the IOMMU or configure the IOMMU to translate
bus addresses passed to the device into physical addresses in memory. If
VIRTIO_F_ACCESS_PLATFORM is not offered, then a driver MUST pass only
physical addresses to the device.
<!--l. 895--><p class="noindent" >A driver SHOULD accept VIRTIO_F_RING_PACKED if it is offered.
<!--l. 897--><p class="noindent" >A driver SHOULD accept VIRTIO_F_ORDER_PLATFORM if it is offered. If
                                                                  

                                                                  
VIRTIO_F_ORDER_PLATFORM has been negotiated, a driver MUST use the
barriers suitable for hardware devices.
<!--l. 901--><p class="noindent" >If VIRTIO_F_SR_IOV has been negotiated, a driver MAY enable virtual
functions through the device’s PCI SR-IOV capability structure. A driver
MUST NOT negotiate VIRTIO_F_SR_IOV if the device does not have a PCI
SR-IOV capability structure or is not a PCI device. A driver MUST negotiate
VIRTIO_F_SR_IOV and complete the feature negotiation (including checking the
FEATURES_OK <span 
class="aeti-10">device status </span>bit) before enabling virtual functions through the
device’s PCI SR-IOV capability structure. After once successfully negotiating
VIRTIO_F_SR_IOV, the driver MAY enable virtual functions through the device’s
PCI SR-IOV capability structure even if the device or the system has been fully or
partially reset, and even without re-negotiating VIRTIO_F_SR_IOV after the
reset.
<!--l. 916--><p class="noindent" >A driver SHOULD accept VIRTIO_F_NOTIF_CONFIG_DATA if it is offered.
<a 
 id="x1-798001r810"></a>
<h3 class="sectionHead"><span class="titlemark">6.2   </span> <a 
 id="x1-7990002"></a>Device Requirements: Reserved Feature Bits</h3>
<!--l. 920--><p class="noindent" >A device MUST offer VIRTIO_F_VERSION_1. A device MAY fail to operate further
if VIRTIO_F_VERSION_1 is not accepted.
<!--l. 923--><p class="noindent" >A device SHOULD offer VIRTIO_F_ACCESS_PLATFORM if its access to memory is
through bus addresses distinct from and translated by the platform to physical
addresses used by the driver, and/or if it can only access certain memory
addresses with said access specified and/or granted by the platform. A device
MAY fail to operate further if VIRTIO_F_ACCESS_PLATFORM is not
accepted.
<!--l. 931--><p class="noindent" >If VIRTIO_F_IN_ORDER has been negotiated, a device MUST use buffers in the
same order in which they have been available.
<!--l. 934--><p class="noindent" >A device MAY fail to operate further if VIRTIO_F_ORDER_PLATFORM is offered
but not accepted. A device MAY operate in a slower emulation mode if
VIRTIO_F_ORDER_PLATFORM is offered but not accepted.
<!--l. 939--><p class="noindent" >It is RECOMMENDED that an add-in card based PCI device offers both
VIRTIO_F_ACCESS_PLATFORM and VIRTIO_F_ORDER_PLATFORM for
maximum portability.
<!--l. 943--><p class="noindent" >A device SHOULD offer VIRTIO_F_SR_IOV if it is a PCI device and presents a PCI
SR-IOV capability structure, otherwise it MUST NOT offer VIRTIO_F_SR_IOV.
<a 
 id="x1-799001r811"></a>
<h3 class="sectionHead"><span class="titlemark">6.3   </span> <a 
 id="x1-8000003"></a>Legacy Interface: Reserved Feature Bits</h3>
<!--l. 949--><p class="noindent" >Transitional devices MAY offer the following:
    <dl class="description"><dt class="description">
                                                                  

                                                                  
    <!--l. 951--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_NOTIFY_ON_EMPTY (24)</span> </dt><dd 
class="description">
    <!--l. 951--><p class="noindent" >If this feature has been negotiated by driver, the device MUST issue a
    used buffer notification if the device runs out of available descriptors
    on a virtqueue, even though notifications are suppressed using the
    VIRTQ_AVAIL_F_NO_INTERRUPT flag or the <span 
class="aeti-10">used_event </span>field.
    <span 
class="aeb10-">Note:</span> An example of a driver using this feature is the legacy networking
          driver: it doesn’t need to know every time a packet is transmitted,
          but it does need to free the transmitted packets a finite time after
          they are transmitted. It can avoid using a timer if the device notifies
          it when all the packets are transmitted.
    </dd></dl>
<!--l. 967--><p class="noindent" >Transitional devices MUST offer, and if offered by the device transitional drivers
MUST accept the following:
    <dl class="description"><dt class="description">
    <!--l. 970--><p class="noindent" >
<span 
class="aeb10-">VIRTIO_F_ANY_LAYOUT (27)</span> </dt><dd 
class="description">
    <!--l. 970--><p class="noindent" >This feature indicates that the device accepts arbitrary descriptor layouts,
    as described in Section <a 
href="#x1-420003">2.7.4.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Message Framing / Legacy Interface: Message Framing --></a> <a 
href="#x1-420003">Legacy Interface: Message Framing<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Message Framing / Legacy Interface: Message Framing --></a>.
    </dd><dt class="description">
    <!--l. 974--><p class="noindent" >
<span 
class="aeb10-">UNUSED (30)</span> </dt><dd 
class="description">
    <!--l. 974--><p class="noindent" >Bit 30 is used by qemu’s implementation to check for experimental early
    versions of virtio which did not perform correct feature negotiation, and
    SHOULD NOT be negotiated.</dd></dl>
                                                                  

                                                                  
<!--l. 4--><p class="noindent" ><h2 class="chapterHead"><hr><span class="titlemark">7</span> <a 
 id="x1-8010007"></a>Conformance</h2>
This chapter lists the conformance targets and clauses for each; this also forms a
useful checklist which authors are asked to consult for their implementations!
<a 
 id="x1-801001r812"></a>
<h3 class="sectionHead"><span class="titlemark">7.1   </span> <a 
 id="x1-8020001"></a>Conformance Targets</h3>
<!--l. 12--><p class="noindent" >Conformance targets:
    <dl class="description"><dt class="description">
    <!--l. 14--><p class="noindent" >
<span 
class="aeb10-">Driver</span> </dt><dd 
class="description">
    <!--l. 14--><p class="noindent" >A driver MUST conform to four conformance clauses:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 16--><p class="noindent" >Clause <a 
href="#x1-8030002">7.2<!--tex4ht:ref: sec:Conformance / Driver Conformance --></a>.
        </li>
        <li class="itemize">
        <!--l. 17--><p class="noindent" >One of clauses <a 
href="#x1-8040001">7.2.1<!--tex4ht:ref: sec:Conformance / Driver Conformance / PCI Driver Conformance --></a>, <a 
href="#x1-8050002">7.2.2<!--tex4ht:ref: sec:Conformance / Driver Conformance / MMIO Driver Conformance --></a> or <a 
href="#x1-8060003">7.2.3<!--tex4ht:ref: sec:Conformance / Driver Conformance / Channel I/O Driver Conformance --></a>.
        </li>
        <li class="itemize">
        <!--l. 18--><p class="noindent" >One  of  clauses  <a 
href="#x1-8070004">7.2.4<!--tex4ht:ref: sec:Conformance / Driver Conformance / Network Driver Conformance --></a>,  <a 
href="#x1-8080005">7.2.5<!--tex4ht:ref: sec:Conformance / Driver Conformance / Block Driver Conformance --></a>,  <a 
href="#x1-8090006">7.2.6<!--tex4ht:ref: sec:Conformance / Driver Conformance / Console Driver Conformance --></a>,  <a 
href="#x1-8100007">7.2.7<!--tex4ht:ref: sec:Conformance / Driver Conformance / Entropy Driver Conformance --></a>,  <a 
href="#x1-8110008">7.2.8<!--tex4ht:ref: sec:Conformance / Driver Conformance / Traditional Memory Balloon Driver Conformance --></a>,  <a 
href="#x1-8120009">7.2.9<!--tex4ht:ref: sec:Conformance / Driver Conformance / SCSI Host Driver Conformance --></a>,  <a 
href="#x1-81300010">7.2.10<!--tex4ht:ref: sec:Conformance / Driver Conformance / Input Driver Conformance --></a>,  <a 
href="#x1-81400011">7.2.11<!--tex4ht:ref: sec:Conformance / Driver Conformance / Crypto Driver Conformance --></a>,
        <a 
href="#x1-81500012">7.2.12<!--tex4ht:ref: sec:Conformance / Driver Conformance / Socket Driver Conformance --></a>, <a 
href="#x1-81600013">7.2.13<!--tex4ht:ref: sec:Conformance / Driver Conformance / File System Driver Conformance --></a>, <a 
href="#x1-81700014">7.2.14<!--tex4ht:ref: sec:Conformance / Driver Conformance / RPMB Driver Conformance --></a>, <a 
href="#x1-81800015">7.2.15<!--tex4ht:ref: sec:Conformance / Driver Conformance / IOMMU Driver Conformance --></a>, <a 
href="#x1-81900016">7.2.16<!--tex4ht:ref: sec:Conformance / Driver Conformance / Sound Driver Conformance --></a>, <a 
href="#x1-82000017">7.2.17<!--tex4ht:ref: sec:Conformance / Driver Conformance / Memory Driver Conformance --></a>, <a 
href="#x1-82100018">7.2.18<!--tex4ht:ref: sec:Conformance / Driver Conformance / I2C Adapter Driver Conformance --></a>, <a 
href="#x1-82200019">7.2.19<!--tex4ht:ref: sec:Conformance / Driver Conformance / SCMI Driver Conformance --></a>, <a 
href="#x1-82300020">7.2.20<!--tex4ht:ref: sec:Conformance / Driver Conformance / GPIO Driver Conformance --></a>, <a 
href="#x1-82400021">7.2.21<!--tex4ht:ref: sec:Conformance / Driver Conformance / PMEM Driver Conformance --></a>,
        <a 
href="#x1-82500022">7.2.22<!--tex4ht:ref: sec:Conformance / Driver Conformance / CAN Driver Conformance --></a> or <a 
href="#x1-82600023">7.2.23<!--tex4ht:ref: sec:Conformance / Driver Conformance / SPI Controller Driver Conformance --></a>.
        </li>
        <li class="itemize">
        <!--l. 40--><p class="noindent" >Clause <a 
href="#x1-8520004">7.4<!--tex4ht:ref: sec:Conformance / Legacy Interface: Transitional Device and Transitional Driver Conformance --></a>.</li></ul>
    </dd><dt class="description">
    <!--l. 42--><p class="noindent" >
<span 
class="aeb10-">Device</span> </dt><dd 
class="description">
    <!--l. 42--><p class="noindent" >A device MUST conform to four conformance clauses:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 44--><p class="noindent" >Clause <a 
href="#x1-8270003">7.3<!--tex4ht:ref: sec:Conformance / Device Conformance --></a>.
        </li>
        <li class="itemize">
        <!--l. 45--><p class="noindent" >One of clauses <a 
href="#x1-8280001">7.3.1<!--tex4ht:ref: sec:Conformance / Device Conformance / PCI Device Conformance --></a>, <a 
href="#x1-8290002">7.3.2<!--tex4ht:ref: sec:Conformance / Device Conformance / MMIO Device Conformance --></a> or <a 
href="#x1-8300003">7.3.3<!--tex4ht:ref: sec:Conformance / Device Conformance / Channel I/O Device Conformance --></a>.
                                                                  

                                                                  
        </li>
        <li class="itemize">
        <!--l. 46--><p class="noindent" >One  of  clauses  <a 
href="#x1-8310004">7.3.4<!--tex4ht:ref: sec:Conformance / Device Conformance / Network Device Conformance --></a>,  <a 
href="#x1-8320005">7.3.5<!--tex4ht:ref: sec:Conformance / Device Conformance / Block Device Conformance --></a>,  <a 
href="#x1-8330006">7.3.6<!--tex4ht:ref: sec:Conformance / Device Conformance / Console Device Conformance --></a>,  <a 
href="#x1-8340007">7.3.7<!--tex4ht:ref: sec:Conformance / Device Conformance / Entropy Device Conformance --></a>,  <a 
href="#x1-8350008">7.3.8<!--tex4ht:ref: sec:Conformance / Device Conformance / Traditional Memory Balloon Device Conformance --></a>,  <a 
href="#x1-8360009">7.3.9<!--tex4ht:ref: sec:Conformance / Device Conformance / SCSI Host Device Conformance --></a>,  <a 
href="#x1-83700010">7.3.10<!--tex4ht:ref: sec:Conformance / Device Conformance / GPU Device Conformance --></a>,  <a 
href="#x1-83800011">7.3.11<!--tex4ht:ref: sec:Conformance / Device Conformance / Input Device Conformance --></a>,
        <a 
href="#x1-83900012">7.3.12<!--tex4ht:ref: sec:Conformance / Device Conformance / Crypto Device Conformance --></a>, <a 
href="#x1-84000013">7.3.13<!--tex4ht:ref: sec:Conformance / Device Conformance / Socket Device Conformance --></a>, <a 
href="#x1-84100014">7.3.14<!--tex4ht:ref: sec:Conformance / Device Conformance / File System Device Conformance --></a>, <a 
href="#x1-84200015">7.3.15<!--tex4ht:ref: sec:Conformance / Device Conformance / RPMB Device Conformance --></a>, <a 
href="#x1-84300016">7.3.16<!--tex4ht:ref: sec:Conformance / Device Conformance / IOMMU Device Conformance --></a>, <a 
href="#x1-84400017">7.3.17<!--tex4ht:ref: sec:Conformance / Device Conformance / Sound Device Conformance --></a>, <a 
href="#x1-84500018">7.3.18<!--tex4ht:ref: sec:Conformance / Device Conformance / Memory Device Conformance --></a>, <a 
href="#x1-84600019">7.3.19<!--tex4ht:ref: sec:Conformance / Device Conformance / I2C Adapter Device Conformance --></a>, <a 
href="#x1-84700020">7.3.20<!--tex4ht:ref: sec:Conformance / Device Conformance / SCMI Device Conformance --></a>, <a 
href="#x1-84800021">7.3.21<!--tex4ht:ref: sec:Conformance / Device Conformance / GPIO Device Conformance --></a>,
        <a 
href="#x1-84900022">7.3.22<!--tex4ht:ref: sec:Conformance / Device Conformance / PMEM Device Conformance --></a>, <a 
href="#x1-85000023">7.3.23<!--tex4ht:ref: sec:Conformance / Device Conformance / CAN Device Conformance --></a> or <a 
href="#x1-85100024">7.3.24<!--tex4ht:ref: sec:Conformance / Device Conformance / SPI Controller Device Conformance --></a>.
        </li>
        <li class="itemize">
        <!--l. 69--><p class="noindent" >Clause <a 
href="#x1-8520004">7.4<!--tex4ht:ref: sec:Conformance / Legacy Interface: Transitional Device and Transitional Driver Conformance --></a>.</li></ul>
    </dd></dl>
<a 
 id="x1-802001r814"></a>
<h3 class="sectionHead"><span class="titlemark">7.2   </span> <a 
 id="x1-8030002"></a>Clause 1: Driver Conformance</h3>
<!--l. 75--><p class="noindent" >A driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 78--><p class="noindent" ><a 
href="#x1-120001">2.1.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Device Status Field --></a>
    </li>
    <li class="itemize">
    <!--l. 79--><p class="noindent" ><a 
href="#x1-150001">2.2.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Feature Bits --></a>
    </li>
    <li class="itemize">
    <!--l. 80--><p class="noindent" ><a 
href="#x1-210002">2.4.2<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Device Reset --></a>
    </li>
    <li class="itemize">
    <!--l. 81--><p class="noindent" ><a 
href="#x1-230001">2.5.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Device Configuration Space --></a>
    </li>
    <li class="itemize">
    <!--l. 82--><p class="noindent" ><a 
href="#x1-360001">2.7.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues --></a>
    </li>
    <li class="itemize">
    <!--l. 83--><p class="noindent" ><a 
href="#x1-310002">2.6.1.1.2<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset / Virtqueue Reset --></a>
    </li>
    <li class="itemize">
    <!--l. 84--><p class="noindent" ><a 
href="#x1-410002">2.7.4.2<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Message Framing --></a>
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 85--><p class="noindent" ><a 
href="#x1-450002">2.7.5.2<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table --></a>
    </li>
    <li class="itemize">
    <!--l. 86--><p class="noindent" ><a 
href="#x1-470001">2.7.5.3.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table / Indirect Descriptors --></a>
    </li>
    <li class="itemize">
    <!--l. 87--><p class="noindent" ><a 
href="#x1-520001">2.7.7.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / Used Buffer Notification Suppression --></a>
    </li>
    <li class="itemize">
    <!--l. 88--><p class="noindent" ><a 
href="#x1-500001">2.7.6.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Available Ring --></a>
    </li>
    <li class="itemize">
    <!--l. 89--><p class="noindent" ><a 
href="#x1-570003">2.7.8.3<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Used Ring --></a>
    </li>
    <li class="itemize">
    <!--l. 90--><p class="noindent" ><a 
href="#x1-600001">2.7.10.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / Available Buffer Notification Suppression --></a>
    </li>
    <li class="itemize">
    <!--l. 91--><p class="noindent" ><a 
href="#x1-680001">2.7.13.3.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / Supplying Buffers to The Device / Updating idx --></a>
    </li>
    <li class="itemize">
    <!--l. 92--><p class="noindent" ><a 
href="#x1-700001">2.7.13.4.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Virtqueues / Supplying Buffers to The Device / Notifying The Device --></a>
    </li>
    <li class="itemize">
    <!--l. 93--><p class="noindent" ><a 
href="#x1-8400011">2.8.11<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Packed Virtqueues --></a>
    </li>
    <li class="itemize">
    <!--l. 94--><p class="noindent" ><a 
href="#x1-8900016">2.8.16<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / PAcked Virtqueues / The Virtqueue Descriptor Table --></a>
    </li>
    <li class="itemize">
    <!--l. 95--><p class="noindent" ><a 
href="#x1-9000017">2.8.17<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Packed Virtqueues / Scatter-Gather Support --></a>
    </li>
    <li class="itemize">
    <!--l. 96--><p class="noindent" ><a 
href="#x1-9200019">2.8.19<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Packed Virtqueues / The Virtqueue Descriptor Table / Indirect Descriptors --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 97--><p class="noindent" ><a 
href="#x1-960001">2.8.21.1.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Packed Virtqueues / Supplying Buffers to The Device / Updating flags --></a>
    </li>
    <li class="itemize">
    <!--l. 98--><p class="noindent" ><a 
href="#x1-990001">2.8.21.3.1<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Packed Virtqueues / Supplying Buffers to The Device / Sending Available Buffer Notifications --></a>
    </li>
    <li class="itemize">
    <!--l. 99--><p class="noindent" ><a 
href="#x1-1560001">3.1.1<!--tex4ht:ref: drivernormative:General Initialization And Device Operation / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 100--><p class="noindent" ><a 
href="#x1-1610001">3.3.1<!--tex4ht:ref: drivernormative:General Initialization And Device Operation / Device Cleanup --></a>
    </li>
    <li class="itemize">
    <!--l. 101--><p class="noindent" ><a 
href="#x1-7980001">6.1<!--tex4ht:ref: drivernormative:Reserved Feature Bits --></a>
    </li>
    <li class="itemize">
    <!--l. 102--><p class="noindent" ><a 
href="#x1-1210005">2.12.1.2.5<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device and driver capabilities --></a>
    </li>
    <li class="itemize">
    <!--l. 103--><p class="noindent" ><a 
href="#x1-1280006">2.12.1.3.6<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device resource objects --></a>
    </li>
    <li class="itemize">
    <!--l. 104--><p class="noindent" ><a 
href="#x1-1390002">2.12.1.4.4.2<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device parts --></a></li></ul>
<a 
 id="x1-803001r804"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.1   </span> <a 
 id="x1-8040001"></a>Clause 2: PCI Driver Conformance</h4>
<!--l. 109--><p class="noindent" >A PCI driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 112--><p class="noindent" ><a 
href="#x1-1670002">4.1.2.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery --></a>
    </li>
    <li class="itemize">
    <!--l. 113--><p class="noindent" ><a 
href="#x1-1700001">4.1.3.1<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 114--><p class="noindent" ><a 
href="#x1-1730001">4.1.4.1<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / Virtio Structure PCI Capabilities --></a>
    </li>
    <li class="itemize">
    <!--l. 115--><p class="noindent" ><a 
href="#x1-1770002">4.1.4.3.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>
    </li>
    <li class="itemize">
    <!--l. 116--><p class="noindent" ><a 
href="#x1-1820002">4.1.4.5.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / ISR status capability --></a>
    </li>
    <li class="itemize">
    <!--l. 117--><p class="noindent" ><a 
href="#x1-1920002">4.1.4.9.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / PCI configuration access capability --></a>
    </li>
    <li class="itemize">
    <!--l. 118--><p class="noindent" ><a 
href="#x1-2020002">4.1.5.1.2.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Device Initialization / MSI-X Vector Configuration --></a>
    </li>
    <li class="itemize">
    <!--l. 119--><p class="noindent" ><a 
href="#x1-2110002">4.1.5.4.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Notification of Device Configuration Changes --></a></li></ul>
<a 
 id="x1-804001r816"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.2   </span> <a 
 id="x1-8050002"></a>Clause 3: MMIO Driver Conformance</h4>
<!--l. 124--><p class="noindent" >An MMIO driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 127--><p class="noindent" ><a 
href="#x1-2170002">4.2.2.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a>
    </li>
    <li class="itemize">
    <!--l. 128--><p class="noindent" ><a 
href="#x1-2200001">4.2.3.1.1<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over MMIO / MMIO-specific Initialization And Device Operation / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 129--><p class="noindent" ><a 
href="#x1-2240001">4.2.3.4.1<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio Over MMIO / MMIO-specific Initialization And Device Operation / Notifications From The Device --></a></li></ul>
<a 
 id="x1-805001r817"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.3   </span> <a 
 id="x1-8060003"></a>Clause 4: Channel I/O Driver Conformance</h4>
<!--l. 134--><p class="noindent" >A Channel I/O driver MUST conform to the following normative statements:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 137--><p class="noindent" ><a 
href="#x1-2320004">4.3.1.4<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio over channel I/O / Basic Concepts --></a>
    </li>
    <li class="itemize">
    <!--l. 138--><p class="noindent" ><a 
href="#x1-2360002">4.3.2.1.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting the Virtio Revision --></a>
    </li>
    <li class="itemize">
    <!--l. 139--><p class="noindent" ><a 
href="#x1-2420001">4.3.2.3.1<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Communicating Status Information --></a>
    </li>
    <li class="itemize">
    <!--l. 140--><p class="noindent" ><a 
href="#x1-2570002">4.3.3.1.2.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio over channel I/O / Device Operation / Host->Guest Notification / Notification via Adapter I/O Interrupts --></a>
    </li>
    <li class="itemize">
    <!--l. 141--><p class="noindent" ><a 
href="#x1-2610002">4.3.3.2.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio over channel I/O / Device Operation / Guest->Host Notification --></a>
    </li>
    <li class="itemize">
    <!--l. 142--><p class="noindent" ><a 
href="#x1-2640002">4.3.3.3.2<!--tex4ht:ref: drivernormative:Virtio Transport Options / Virtio over channel I/O / Device Operation / Resetting Devices --></a></li></ul>
<a 
 id="x1-806001r818"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.4   </span> <a 
 id="x1-8070004"></a>Clause 5: Network Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A network driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-2750002">5.1.4.2<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-2830001">5.1.8.2.1<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Packet Transmission --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-2870001">5.1.8.3.1<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Setting Up Receive Buffers --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-2910002">5.1.8.4.2<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Processing of Incoming Packets --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-3070002">5.1.8.5.1.2<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Packet Receive Filtering --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-3100002">5.1.8.5.2.2<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Setting MAC Address Filtering --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-3160001">5.1.8.5.4.1<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Gratuitous Packet Sending --></a>
    </li>
    <li class="itemize">
    <!--l. 13--><p class="noindent" ><a 
href="#x1-3200001">5.1.8.5.6.1<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Automatic receive steering in multiqueue mode --></a>
    </li>
    <li class="itemize">
    <!--l. 14--><p class="noindent" ><a 
href="#x1-3350002">5.1.8.5.9.2<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Offloads State Configuration / Setting Offloads State --></a>
    </li>
    <li class="itemize">
    <!--l. 15--><p class="noindent" ><a 
href="#x1-3260002">5.1.8.5.7.2<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS)  --></a>
    </li>
    <li class="itemize">
    <!--l. 16--><p class="noindent" ><a 
href="#x1-3420005">5.1.8.5.10.5<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Notifications Coalescing --></a>
    </li>
    <li class="itemize">
    <!--l. 17--><p class="noindent" ><a 
href="#x1-3020005">5.1.8.4.4.5<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Inner Header Hash --></a>
    </li>
    <li class="itemize">
    <!--l. 18--><p class="noindent" ><a 
href="#x1-35700013">5.1.8.5.11.13<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / Device Statistics --></a>
    </li>
    <li class="itemize">
    <!--l. 19--><p class="noindent" ><a 
href="#x1-3320004">5.1.8.5.8.4<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Control Virtqueue / RSS Context --></a>
    </li>
    <li class="itemize">
    <!--l. 20--><p class="noindent" ><a 
href="#x1-3690005">5.1.8.6.5<!--tex4ht:ref: drivernormative:Device Types / Network Device / Device Operation / Flow filter --></a></li></ul>
<a 
 id="x1-807001r819"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">7.2.5   </span> <a 
 id="x1-8080005"></a>Clause 6: Block Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A block driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-3790001">5.2.5.1<!--tex4ht:ref: drivernormative:Device Types / Block Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-3830001">5.2.6.1<!--tex4ht:ref: drivernormative:Device Types / Block Device / Device Operation --></a></li></ul>
<a 
 id="x1-808001r820"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.6   </span> <a 
 id="x1-8090006"></a>Clause 7: Console Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A console driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-3960001">5.3.6.1<!--tex4ht:ref: drivernormative:Device Types / Console Device / Device Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-3990002">5.3.6.2.2<!--tex4ht:ref: drivernormative:Device Types / Console Device / Device Operation / Multiport Device Operation --></a></li></ul>
<a 
 id="x1-809001r821"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.7   </span> <a 
 id="x1-8100007"></a>Clause 8: Entropy Driver Conformance</h4>
<!--l. 3--><p class="noindent" >An entropy driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4090001">5.4.6.1<!--tex4ht:ref: drivernormative:Device Types / Entropy Device / Device Operation --></a></li></ul>
<a 
 id="x1-810001r822"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.8   </span> <a 
 id="x1-8110008"></a>Clause 9: Traditional Memory Balloon Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A traditional memory balloon driver MUST conform to the following normative
statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4150001">5.5.3.1<!--tex4ht:ref: drivernormative:Device Types / Memory Balloon Device / Feature bits --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-4220001">5.5.6.1<!--tex4ht:ref: drivernormative:Device Types / Memory Balloon Device / Device Operation --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-4260001">5.5.6.3.1<!--tex4ht:ref: drivernormative:Device Types / Memory Balloon Device / Device Operation / Memory Statistics --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-4310001">5.5.6.5.1<!--tex4ht:ref: drivernormative:Device Types / Memory Balloon Device / Device Operation / Free Page Hinting --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-4350001">5.5.6.6.1<!--tex4ht:ref: drivernormative:Device Types / Memory Balloon Device / Device Operation / Page Poison --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-4380001">5.5.6.7.1<!--tex4ht:ref: drivernormative:Device Types / Memory Balloon Device / Device Operation / Free Page Reporting --></a></li></ul>
<a 
 id="x1-811001r823"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.9   </span> <a 
 id="x1-8120009"></a>Clause 10: SCSI Host Driver Conformance</h4>
<!--l. 3--><p class="noindent" >An SCSI host driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4450001">5.6.4.1<!--tex4ht:ref: drivernormative:Device Types / SCSI Host Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-4530002">5.6.6.1.2<!--tex4ht:ref: drivernormative:Device Types / SCSI Host Device / Device Operation / Device Operation: Request Queues --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-4580001">5.6.6.3.1<!--tex4ht:ref: drivernormative:Device Types / SCSI Host Device / Device Operation / Device Operation: eventq --></a></li></ul>
<a 
 id="x1-812001r824"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.10   </span> <a 
 id="x1-81300010"></a>Clause 11: Input Driver Conformance</h4>
<!--l. 3--><p class="noindent" >An input driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4880001">5.8.5.1<!--tex4ht:ref: drivernormative:Device Types / Input Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-4910001">5.8.6.1<!--tex4ht:ref: drivernormative:Device Types / Input Device / Device Operation --></a></li></ul>
<a 
 id="x1-813001r825"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">7.2.11   </span> <a 
 id="x1-81400011"></a>Clause 12: Crypto Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A Crypto driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5060002">5.9.5.2<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-5080001">5.9.6.1<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-5180006">5.9.7.2.1.6<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation / Session operation: create session --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-5200008">5.9.7.2.1.8<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation / Session operation: destroy session --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-5240001">5.9.7.4.1<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device Operation / HASH Service Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-5270001">5.9.7.5.1<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device Operation / MAC Service Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-5300001">5.9.7.6.1<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device Operation / Symmetric algorithms Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 13--><p class="noindent" ><a 
href="#x1-5330001">5.9.7.7.1<!--tex4ht:ref: drivernormative:Device Types / Crypto Device / Device Operation / AEAD Service Operation --></a></li></ul>
<a 
 id="x1-814001r826"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.12   </span> <a 
 id="x1-81500012"></a>Clause 13: Socket Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A socket driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5420001">5.10.3.1<!--tex4ht:ref: drivernormative:Device Types / Socket Device / Feature bits --></a>
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 7--><p class="noindent" ><a 
href="#x1-5520001">5.10.6.3.1<!--tex4ht:ref: drivernormative:Device Types / Socket Device / Device Operation / Buffer Space Management --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-5550001">5.10.6.4.1<!--tex4ht:ref: drivernormative:Device Types / Socket Device / Device Operation / Receive and Transmit --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-5610001">5.10.6.7.1<!--tex4ht:ref: drivernormative:Device Types / Socket Device / Device Operation / Device Events --></a></li></ul>
<a 
 id="x1-815001r827"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.13   </span> <a 
 id="x1-81600013"></a>Clause 14: File System Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A file system driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5670001">5.11.4.1<!--tex4ht:ref: drivernormative:Device Types / File System Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-5740002">5.11.6.2.2<!--tex4ht:ref: drivernormative:Device Types / File System Device / Device Operation / Device Operation: High Priority Queue --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-5760001">5.11.6.3.1<!--tex4ht:ref: drivernormative:Device Types / File System Device / Device Operation / Device Operation: Notification Queue --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-5790002">5.11.6.4.2<!--tex4ht:ref: drivernormative:Device Types / File System Device / Device Operation / Device Operation: DAX Window --></a></li></ul>
<a 
 id="x1-816001r828"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.14   </span> <a 
 id="x1-81700014"></a>Clause 15: RPMB Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A RPMB driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5950002">5.12.6.2<!--tex4ht:ref: drivernormative:Device Types / RPMB Device / Device Operation --></a></li></ul>
<a 
 id="x1-817001r829"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.15   </span> <a 
 id="x1-81800015"></a>Clause 16: IOMMU Driver Conformance</h4>
<!--l. 3--><p class="noindent" >An IOMMU driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-6010001">5.13.3.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Feature bits --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-6040001">5.13.4.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-6070001">5.13.5.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-6090001">5.13.6.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-6120001">5.13.6.3.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / ATTACH request --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-6150001">5.13.6.4.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / DETACH request --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-6180001">5.13.6.5.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / MAP request --></a>
    </li>
    <li class="itemize">
    <!--l. 13--><p class="noindent" ><a 
href="#x1-6210001">5.13.6.6.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / UNMAP request --></a>
    </li>
    <li class="itemize">
    <!--l. 14--><p class="noindent" ><a 
href="#x1-6240001">5.13.6.7.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / PROBE request --></a>
    </li>
    <li class="itemize">
    <!--l. 15--><p class="noindent" ><a 
href="#x1-6280001">5.13.6.8.1.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / PROBE properties / RESVMEM --></a>
    </li>
    <li class="itemize">
    <!--l. 16--><p class="noindent" ><a 
href="#x1-6310001">5.13.6.9.1<!--tex4ht:ref: drivernormative:Device Types / IOMMU Device / Device operations / Fault reporting --></a></li></ul>
<a 
 id="x1-818001r830"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.16   </span> <a 
 id="x1-81900016"></a>Clause 17: Sound Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A sound driver MUST conform to the following normative statements:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-6390001">5.14.5.1<!--tex4ht:ref: drivernormative:Device Types / Sound Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-6420002">5.14.6.2<!--tex4ht:ref: drivernormative:Device Types / Sound Device / Item Information Request --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-6550002">5.14.6.6.3.2<!--tex4ht:ref: drivernormative:Device Types / Sound Device / Device Operation / PCM Stream Parameters --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-6650002">5.14.6.8.1.2<!--tex4ht:ref: drivernormative:Device Types / Sound Device / Device Operation / PCM Output Stream --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-6680002">5.14.6.8.2.2<!--tex4ht:ref: drivernormative:Device Types / Sound Device / Device Operation / PCM Input Stream --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-6760001">5.14.6.10.2.1<!--tex4ht:ref: drivernormative:Device Types / Sound Device / Device Operation / Control Element Value --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-6790002">5.14.6.10.3.2<!--tex4ht:ref: drivernormative:Device Types / Sound Device / Device Operation / Control Element Metadata --></a></li></ul>
<a 
 id="x1-819001r831"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.17   </span> <a 
 id="x1-82000017"></a>Clause 18: Memory Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A memory driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-6870001">5.15.4.1<!--tex4ht:ref: drivernormative:Device Types / Memory Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-6900001">5.15.5.1<!--tex4ht:ref: drivernormative:Device Types / Memory Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-6930001">5.15.6.1<!--tex4ht:ref: drivernormative:Device Types / Memory Device / Device Operation --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-6960001">5.15.6.3.1<!--tex4ht:ref: drivernormative:Device Types / Memory Device / Device Operation / PLUG request --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-6990001">5.15.6.4.1<!--tex4ht:ref: drivernormative:Device Types / Memory Device / Device Operation / UNPLUG request --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-7020001">5.15.6.5.1<!--tex4ht:ref: drivernormative:Device Types / Memory Device / Device Operation / UNPLUG ALL request --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-7050001">5.15.6.6.1<!--tex4ht:ref: drivernormative:Device Types / Memory Device / Device Operation / STATE request --></a></li></ul>
<a 
 id="x1-820001r832"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.18   </span> <a 
 id="x1-82100018"></a>Clause 19: I2C Adapter Driver Conformance</h4>
<!--l. 3--><p class="noindent" >An I2C Adapter driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7160003">5.16.6.3<!--tex4ht:ref: drivernormative:Device Types / I2C Adapter Device / Device Operation --></a></li></ul>
<a 
 id="x1-821001r833"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.19   </span> <a 
 id="x1-82200019"></a>Clause 20: SCMI Driver Conformance</h4>
<!--l. 3--><p class="noindent" >An SCMI driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7280002">5.17.6.1.2<!--tex4ht:ref: drivernormative:Device Types / SCMI Device / Device Operation / cmdq Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-7300001">5.17.6.2.1<!--tex4ht:ref: drivernormative:Device Types / SCMI Device / Device Operation / Setting Up eventq Buffers --></a></li></ul>
<a 
 id="x1-822001r834"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.20   </span> <a 
 id="x1-82300020"></a>Clause 21: GPIO Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A General Purpose Input/Output (GPIO) driver MUST conform to the following
normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-7490008">5.18.6.8<!--tex4ht:ref: drivernormative:Device Types / GPIO Device / requestq Operation --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-7530002">5.18.7.2<!--tex4ht:ref: drivernormative:Device Types / GPIO Device / eventq Operation --></a></li></ul>
<a 
 id="x1-823001r835"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.21   </span> <a 
 id="x1-82400021"></a>Clause 22: PMEM Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A PMEM driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7620002">5.19.5.2<!--tex4ht:ref: drivernormative:Device Types / PMEM Device / Device Initialization --></a></li></ul>
<a 
 id="x1-824001r836"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.22   </span> <a 
 id="x1-82500022"></a>Clause 23: CAN Driver Conformance</h4>
<!--l. 3--><p class="noindent" >A CAN driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7800001">5.20.4.1<!--tex4ht:ref: drivernormative:Device Types / CAN Device / Device Operation / Initialization --></a></li></ul>
<a 
 id="x1-825001r837"></a>
<h4 class="subsectionHead"><span class="titlemark">7.2.23   </span> <a 
 id="x1-82600023"></a>Clause 24: SPI Controller Driver Conformance</h4>
<!--l. 3--><p class="noindent" >An SPI Controller driver MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7950003">5.21.6.3<!--tex4ht:ref: drivernormative:Device Types / SPI Controller Device / Device Operation --></a></li></ul>
<a 
 id="x1-826001r815"></a>
<h3 class="sectionHead"><span class="titlemark">7.3   </span> <a 
 id="x1-8270003"></a>Clause 25: Device Conformance</h3>
<!--l. 168--><p class="noindent" >A device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 171--><p class="noindent" ><a 
href="#x1-130002">2.1.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Device Status Field --></a>
    </li>
    <li class="itemize">
    <!--l. 172--><p class="noindent" ><a 
href="#x1-160002">2.2.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Feature Bits --></a>
    </li>
    <li class="itemize">
    <!--l. 173--><p class="noindent" ><a 
href="#x1-200001">2.4.1<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Device Reset --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 174--><p class="noindent" ><a 
href="#x1-240002">2.5.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Device Configuration Space --></a>
    </li>
    <li class="itemize">
    <!--l. 175--><p class="noindent" ><a 
href="#x1-300001">2.6.1.1.1<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Virtqueues / Virtqueue Reset / Virtqueue Reset --></a>
    </li>
    <li class="itemize">
    <!--l. 176--><p class="noindent" ><a 
href="#x1-400001">2.7.4.1<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Message Framing --></a>
    </li>
    <li class="itemize">
    <!--l. 177--><p class="noindent" ><a 
href="#x1-440001">2.7.5.1<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table --></a>
    </li>
    <li class="itemize">
    <!--l. 178--><p class="noindent" ><a 
href="#x1-480002">2.7.5.3.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Descriptor Table / Indirect Descriptors --></a>
    </li>
    <li class="itemize">
    <!--l. 179--><p class="noindent" ><a 
href="#x1-530002">2.7.7.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Virtqueues / Used Buffer Notification Suppression --></a>
    </li>
    <li class="itemize">
    <!--l. 180--><p class="noindent" ><a 
href="#x1-560002">2.7.8.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Virtqueues / The Virtqueue Used Ring --></a>
    </li>
    <li class="itemize">
    <!--l. 181--><p class="noindent" ><a 
href="#x1-610002">2.7.10.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Virtqueues / Available Buffer Notification Suppression --></a>
    </li>
    <li class="itemize">
    <!--l. 182--><p class="noindent" ><a 
href="#x1-8500012">2.8.12<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Packed Virtqueues --></a>
    </li>
    <li class="itemize">
    <!--l. 183--><p class="noindent" ><a 
href="#x1-8800015">2.8.15<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Packed Virtqueues / The Virtqueue Descriptor Table --></a>
    </li>
    <li class="itemize">
    <!--l. 184--><p class="noindent" ><a 
href="#x1-9100018">2.8.18<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Packed Virtqueues / Scatter-Gather Support --></a>
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 185--><p class="noindent" ><a 
href="#x1-1040002">2.10.2<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Shared Memory Regions --></a>
    </li>
    <li class="itemize">
    <!--l. 186--><p class="noindent" ><a 
href="#x1-7990002">6.2<!--tex4ht:ref: devicenormative:Reserved Feature Bits --></a>
    </li>
    <li class="itemize">
    <!--l. 187--><p class="noindent" ><a 
href="#x1-1200004">2.12.1.2.4<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device and driver capabilities --></a>
    </li>
    <li class="itemize">
    <!--l. 188--><p class="noindent" ><a 
href="#x1-1270005">2.12.1.3.5<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device resource objects --></a>
    </li>
    <li class="itemize">
    <!--l. 189--><p class="noindent" ><a 
href="#x1-1380001">2.12.1.4.4.1<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Device parts --></a></li></ul>
<a 
 id="x1-827001r838"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.1   </span> <a 
 id="x1-8280001"></a>Clause 26: PCI Device Conformance</h4>
<!--l. 194--><p class="noindent" >A PCI device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 197--><p class="noindent" ><a 
href="#x1-1640001">4.1.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus --></a>
    </li>
    <li class="itemize">
    <!--l. 198--><p class="noindent" ><a 
href="#x1-1660001">4.1.2.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery --></a>
    </li>
    <li class="itemize">
    <!--l. 199--><p class="noindent" ><a 
href="#x1-1710002">4.1.3.2<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout --></a>
    </li>
    <li class="itemize">
    <!--l. 200--><p class="noindent" ><a 
href="#x1-1740002">4.1.4.2<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / Virtio Structure PCI Capabilities --></a>
    </li>
    <li class="itemize">
    <!--l. 201--><p class="noindent" ><a 
href="#x1-1760001">4.1.4.3.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>
    </li>
    <li class="itemize">
    <!--l. 202--><p class="noindent" ><a 
href="#x1-1790001">4.1.4.4.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Notification capability --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 203--><p class="noindent" ><a 
href="#x1-1810001">4.1.4.5.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / ISR status capability --></a>
    </li>
    <li class="itemize">
    <!--l. 204--><p class="noindent" ><a 
href="#x1-1840001">4.1.4.6.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Device-specific configuration --></a>
    </li>
    <li class="itemize">
    <!--l. 205--><p class="noindent" ><a 
href="#x1-1860001">4.1.4.7.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Shared memory capability --></a>
    </li>
    <li class="itemize">
    <!--l. 206--><p class="noindent" ><a 
href="#x1-1910001">4.1.4.9.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / PCI configuration access capability --></a>
    </li>
    <li class="itemize">
    <!--l. 207--><p class="noindent" ><a 
href="#x1-1950001">4.1.4.11.0.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Device Initialization / Non-transitional Device With Legacy Driver --></a>
    </li>
    <li class="itemize">
    <!--l. 208--><p class="noindent" ><a 
href="#x1-2010001">4.1.5.1.2.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Device Initialization / MSI-X Vector Configuration --></a>
    </li>
    <li class="itemize">
    <!--l. 209--><p class="noindent" ><a 
href="#x1-2080001">4.1.5.3.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Used Buffer Notifications --></a>
    </li>
    <li class="itemize">
    <!--l. 210--><p class="noindent" ><a 
href="#x1-2100001">4.1.5.4.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Notification of Device Configuration Changes --></a></li></ul>
<a 
 id="x1-828001r840"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.2   </span> <a 
 id="x1-8290002"></a>Clause 27: MMIO Device Conformance</h4>
<!--l. 215--><p class="noindent" >An MMIO device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 218--><p class="noindent" ><a 
href="#x1-2160001">4.2.2.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a></li></ul>
<a 
 id="x1-829001r841"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.3   </span> <a 
 id="x1-8300003"></a>Clause 28: Channel I/O Device Conformance</h4>
<!--l. 223--><p class="noindent" >A Channel I/O device MUST conform to the following normative statements:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 226--><p class="noindent" ><a 
href="#x1-2310003">4.3.1.3<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Basic Concepts --></a>
    </li>
    <li class="itemize">
    <!--l. 227--><p class="noindent" ><a 
href="#x1-2350001">4.3.2.1.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting the Virtio Revision --></a>
    </li>
    <li class="itemize">
    <!--l. 228--><p class="noindent" ><a 
href="#x1-2390001">4.3.2.2.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Configuring a Virtqueue --></a>
    </li>
    <li class="itemize">
    <!--l. 229--><p class="noindent" ><a 
href="#x1-2430002">4.3.2.3.2<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Communicating Status Information --></a>
    </li>
    <li class="itemize">
    <!--l. 230--><p class="noindent" ><a 
href="#x1-2500001">4.3.2.6.3.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting Up Indicators / Setting Up Two-Stage Queue Indicators --></a>
    </li>
    <li class="itemize">
    <!--l. 231--><p class="noindent" ><a 
href="#x1-2560001">4.3.3.1.2.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Device Operation / Host->Guest Notification / Notification via Adapter I/O Interrupts --></a>
    </li>
    <li class="itemize">
    <!--l. 232--><p class="noindent" ><a 
href="#x1-2600001">4.3.3.2.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Device Operation / Guest->Host Notification --></a>
    </li>
    <li class="itemize">
    <!--l. 233--><p class="noindent" ><a 
href="#x1-2630001">4.3.3.3.1<!--tex4ht:ref: devicenormative:Virtio Transport Options / Virtio over channel I/O / Device Operation / Resetting Devices --></a></li></ul>
<a 
 id="x1-830001r842"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.4   </span> <a 
 id="x1-8310004"></a>Clause 29: Network Device Conformance</h4>
<!--l. 3--><p class="noindent" >A network device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-2740001">5.1.4.1<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-2840002">5.1.8.2.2<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Packet Transmission --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-2880002">5.1.8.3.2<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Setting Up Receive Buffers --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-2900001">5.1.8.4.1<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Processing of Incoming Packets --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-3060001">5.1.8.5.1.1<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Packet Receive Filtering --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-3090001">5.1.8.5.2.1<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Setting MAC Address Filtering --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-3130001">5.1.8.5.3.1<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / VLAN Filtering --></a>
    </li>
    <li class="itemize">
    <!--l. 13--><p class="noindent" ><a 
href="#x1-3170002">5.1.8.5.4.2<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Gratuitous Packet Sending --></a>
    </li>
    <li class="itemize">
    <!--l. 14--><p class="noindent" ><a 
href="#x1-3210002">5.1.8.5.6.2<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Automatic receive steering in multiqueue mode --></a>
    </li>
    <li class="itemize">
    <!--l. 15--><p class="noindent" ><a 
href="#x1-3270003">5.1.8.5.7.3<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS) / RSS processing --></a>
    </li>
    <li class="itemize">
    <!--l. 16--><p class="noindent" ><a 
href="#x1-3430006">5.1.8.5.10.6<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Notifications Coalescing --></a>
    </li>
    <li class="itemize">
    <!--l. 17--><p class="noindent" ><a 
href="#x1-3010004">5.1.8.4.4.4<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Inner Header Hash --></a>
    </li>
    <li class="itemize">
    <!--l. 18--><p class="noindent" ><a 
href="#x1-35600012">5.1.8.5.11.12<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / Device Statistics --></a>
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 19--><p class="noindent" ><a 
href="#x1-3310003">5.1.8.5.8.3<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Control Virtqueue / RSS Context --></a>
    </li>
    <li class="itemize">
    <!--l. 20--><p class="noindent" ><a 
href="#x1-3680004">5.1.8.6.4<!--tex4ht:ref: devicenormative:Device Types / Network Device / Device Operation / Flow filter --></a></li></ul>
<a 
 id="x1-831001r843"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.5   </span> <a 
 id="x1-8320005"></a>Clause 30: Block Device Conformance</h4>
<!--l. 3--><p class="noindent" >A block device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-3800002">5.2.5.2<!--tex4ht:ref: devicenormative:Device Types / Block Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-3840002">5.2.6.2<!--tex4ht:ref: devicenormative:Device Types / Block Device / Device Operation --></a></li></ul>
<a 
 id="x1-832001r844"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.6   </span> <a 
 id="x1-8330006"></a>Clause 31: Console Device Conformance</h4>
<!--l. 3--><p class="noindent" >A console device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-3940001">5.3.5.1<!--tex4ht:ref: devicenormative:Device Types / Console Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-3980001">5.3.6.2.1<!--tex4ht:ref: devicenormative:Device Types / Console Device / Device Operation / Multiport Device Operation --></a></li></ul>
<a 
 id="x1-833001r845"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.7   </span> <a 
 id="x1-8340007"></a>Clause 32: Entropy Device Conformance</h4>
<!--l. 3--><p class="noindent" >An entropy device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4100002">5.4.6.2<!--tex4ht:ref: devicenormative:Device Types / Entropy Device / Device Operation --></a></li></ul>
<a 
 id="x1-834001r846"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.8   </span> <a 
 id="x1-8350008"></a>Clause 33: Traditional Memory Balloon Device Conformance</h4>
<!--l. 3--><p class="noindent" >A traditional memory balloon device MUST conform to the following normative
statements:
    <ul class="itemize1">
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4160002">5.5.3.2<!--tex4ht:ref: devicenormative:Device Types / Memory Balloon Device / Feature bits --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-4230002">5.5.6.2<!--tex4ht:ref: devicenormative:Device Types / Memory Balloon Device / Device Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-4270002">5.5.6.3.2<!--tex4ht:ref: devicenormative:Device Types / Memory Balloon Device / Device Operation / Memory Statistics --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-4320002">5.5.6.5.2<!--tex4ht:ref: devicenormative:Device Types / Memory Balloon Device / Device Operation / Free Page Hinting --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-4360002">5.5.6.6.2<!--tex4ht:ref: devicenormative:Device Types / Memory Balloon Device / Device Operation / Page Poison --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-4390002">5.5.6.7.2<!--tex4ht:ref: devicenormative:Device Types / Memory Balloon Device / Device Operation / Free Page Reporting --></a></li></ul>
<a 
 id="x1-835001r847"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.9   </span> <a 
 id="x1-8360009"></a>Clause 34: SCSI Host Device Conformance</h4>
<!--l. 3--><p class="noindent" >An SCSI host device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4460002">5.6.4.2<!--tex4ht:ref: devicenormative:Device Types / SCSI Host Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-4480005">5.6.5<!--tex4ht:ref: devicenormative:Device Types / SCSI Host Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-4520001">5.6.6.1.1<!--tex4ht:ref: devicenormative:Device Types / SCSI Host Device / Device Operation / Device Operation: Request Queues --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-4590002">5.6.6.3.2<!--tex4ht:ref: devicenormative:Device Types / SCSI Host Device / Device Operation / Device Operation: eventq --></a></li></ul>
<a 
 id="x1-836001r848"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.10   </span> <a 
 id="x1-83700010"></a>Clause 35: GPU Device Conformance</h4>
<!--l. 3--><p class="noindent" >A GPU device MUST conform to the following normative statements:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4690005">5.7.5<!--tex4ht:ref: devicenormative:Device Types / GPU Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-4750005">5.7.6.5<!--tex4ht:ref: devicenormative:Device Types / GPU Device / Device Operation / Device Operation: Command lifecycle and fencing --></a></li></ul>
<a 
 id="x1-837001r849"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.11   </span> <a 
 id="x1-83800011"></a>Clause 36: Input Device Conformance</h4>
<!--l. 3--><p class="noindent" >An input device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-4890002">5.8.5.2<!--tex4ht:ref: devicenormative:Device Types / Input Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-4920002">5.8.6.2<!--tex4ht:ref: devicenormative:Device Types / Input Device / Device Operation --></a></li></ul>
<a 
 id="x1-838001r850"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.12   </span> <a 
 id="x1-83900012"></a>Clause 37: Crypto Device Conformance</h4>
<!--l. 3--><p class="noindent" >A Crypto device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5050001">5.9.5.1<!--tex4ht:ref: devicenormative:Device Types / Crypto Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-5190007">5.9.7.2.1.7<!--tex4ht:ref: devicenormative:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation / Session operation: create session --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-5210009">5.9.7.2.1.9<!--tex4ht:ref: devicenormative:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation / Session operation: destroy session --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-5250002">5.9.7.4.2<!--tex4ht:ref: devicenormative:Device Types / Crypto Device / Device Operation / HASH Service Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-5280002">5.9.7.5.2<!--tex4ht:ref: devicenormative:Device Types / Crypto Device / Device Operation / MAC Service Operation --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-5310002">5.9.7.6.2<!--tex4ht:ref: devicenormative:Device Types / Crypto Device / Device Operation / Symmetric algorithms Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-5340002">5.9.7.7.2<!--tex4ht:ref: devicenormative:Device Types / Crypto Device / Device Operation / AEAD Service Operation --></a></li></ul>
<a 
 id="x1-839001r851"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.13   </span> <a 
 id="x1-84000013"></a>Clause 38: Socket Device Conformance</h4>
<!--l. 3--><p class="noindent" >A socket device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5430002">5.10.3.2<!--tex4ht:ref: devicenormative:Device Types / Socket Device / Feature bits --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-5530002">5.10.6.3.2<!--tex4ht:ref: devicenormative:Device Types / Socket Device / Device Operation / Buffer Space Management --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-5560002">5.10.6.4.2<!--tex4ht:ref: devicenormative:Device Types / Socket Device / Device Operation / Receive and Transmit --></a></li></ul>
<a 
 id="x1-840001r852"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.14   </span> <a 
 id="x1-84100014"></a>Clause 39: File System Device Conformance</h4>
<!--l. 3--><p class="noindent" >A file system device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5680002">5.11.4.2<!--tex4ht:ref: devicenormative:Device Types / File System Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-5730001">5.11.6.2.1<!--tex4ht:ref: devicenormative:Device Types / File System Device / Device Operation / Device Operation: High Priority Queue --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-5780001">5.11.6.4.1<!--tex4ht:ref: devicenormative:Device Types / File System Device / Device Operation / Device Operation: DAX Window --></a></li></ul>
<a 
 id="x1-841001r853"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.15   </span> <a 
 id="x1-84200015"></a>Clause 40: RPMB Device Conformance</h4>
<!--l. 3--><p class="noindent" >An RPMB device MUST conform to the following normative statements:
                                                                  

                                                                  
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-5870005">5.12.5<!--tex4ht:ref: devicenormative:Device Types / RPMB Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-5900001">5.12.6.1.1<!--tex4ht:ref: devicenormative:Device Types / RPMB Device / Device Operation / Device Operation: Program Key --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-5910002">5.12.6.1.2<!--tex4ht:ref: devicenormative:Device Types / RPMB Device / Device Operation / Device Operation: Get Write Counter --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-5920003">5.12.6.1.3<!--tex4ht:ref: devicenormative:Device Types / RPMB Device / Device Operation / Device Operation: Data Write --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-5930004">5.12.6.1.4<!--tex4ht:ref: devicenormative:Device Types / RPMB Device / Device Operation / Device Operation: Data Read --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-5940005">5.12.6.1.5<!--tex4ht:ref: devicenormative:Device Types / RPMB Device / Device Operation / Device Operation: Result Read --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-5960003">5.12.6.3<!--tex4ht:ref: devicenormative:Device Types / RPMB Device / Device Operation --></a></li></ul>
<a 
 id="x1-842001r854"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.16   </span> <a 
 id="x1-84300016"></a>Clause 41: IOMMU Device Conformance</h4>
<!--l. 3--><p class="noindent" >An IOMMU device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-6020002">5.13.3.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Feature bits --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-6050002">5.13.4.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-6100002">5.13.6.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-6130002">5.13.6.3.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / ATTACH request --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-6160002">5.13.6.4.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / DETACH request --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-6190002">5.13.6.5.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / MAP request --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-6220002">5.13.6.6.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / UNMAP request --></a>
    </li>
    <li class="itemize">
    <!--l. 13--><p class="noindent" ><a 
href="#x1-6250002">5.13.6.7.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / PROBE request --></a>
    </li>
    <li class="itemize">
    <!--l. 14--><p class="noindent" ><a 
href="#x1-6290002">5.13.6.8.1.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / PROBE properties / RESVMEM --></a>
    </li>
    <li class="itemize">
    <!--l. 15--><p class="noindent" ><a 
href="#x1-6320002">5.13.6.9.2<!--tex4ht:ref: devicenormative:Device Types / IOMMU Device / Device operations / Fault reporting --></a></li></ul>
<a 
 id="x1-843001r855"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.17   </span> <a 
 id="x1-84400017"></a>Clause 42: Sound Device Conformance</h4>
<!--l. 3--><p class="noindent" >A sound device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-6460001">5.14.6.4.1.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / Jack Information --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-6520001">5.14.6.6.2.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / PCM Stream Information --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-6540001">5.14.6.6.3.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / PCM Stream Parameters --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-6580001">5.14.6.6.5.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / PCM Stream Release --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-6640001">5.14.6.8.1.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / PCM Output Stream --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-6670001">5.14.6.8.2.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / PCM Input Stream --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-6710001">5.14.6.9.1.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / Channel Map Information --></a>
    </li>
    <li class="itemize">
    <!--l. 13--><p class="noindent" ><a 
href="#x1-6740001">5.14.6.10.1.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / Control Element Information --></a>
    </li>
    <li class="itemize">
    <!--l. 14--><p class="noindent" ><a 
href="#x1-6780001">5.14.6.10.3.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / Control Element Metadata --></a>
    </li>
    <li class="itemize">
    <!--l. 15--><p class="noindent" ><a 
href="#x1-6810001">5.14.6.10.4.1<!--tex4ht:ref: devicenormative:Device Types / Sound Device / Device Operation / Control Element Notifications --></a></li></ul>
<a 
 id="x1-844001r856"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.18   </span> <a 
 id="x1-84500018"></a>Clause 43: Memory Device Conformance</h4>
<!--l. 3--><p class="noindent" >A memory device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-6880002">5.15.4.2<!--tex4ht:ref: devicenormative:Device Types / Memory Device / Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-6910002">5.15.5.2<!--tex4ht:ref: devicenormative:Device Types / Memory Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-6940002">5.15.6.2<!--tex4ht:ref: devicenormative:Device Types / Memory Device / Device Operation --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-6970002">5.15.6.3.2<!--tex4ht:ref: devicenormative:Device Types / Memory Device / Device Operation / PLUG request --></a>
    </li>
    <li class="itemize">
    <!--l. 10--><p class="noindent" ><a 
href="#x1-7000002">5.15.6.4.2<!--tex4ht:ref: devicenormative:Device Types / Memory Device / Device Operation / UNPLUG request --></a>
    </li>
    <li class="itemize">
    <!--l. 11--><p class="noindent" ><a 
href="#x1-7030002">5.15.6.5.2<!--tex4ht:ref: devicenormative:Device Types / Memory Device / Device Operation / UNPLUG ALL request --></a>
    </li>
    <li class="itemize">
    <!--l. 12--><p class="noindent" ><a 
href="#x1-7060002">5.15.6.6.2<!--tex4ht:ref: devicenormative:Device Types / Memory Device / Device Operation / STATE request --></a></li></ul>
<a 
 id="x1-845001r857"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.19   </span> <a 
 id="x1-84600019"></a>Clause 44: I2C Adapter Device Conformance</h4>
<!--l. 3--><p class="noindent" >An I2C Adapter device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7170004">5.16.6.4<!--tex4ht:ref: devicenormative:Device Types / I2C Adapter Device / Device Operation --></a></li></ul>
<a 
 id="x1-846001r858"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.20   </span> <a 
 id="x1-84700020"></a>Clause 45: SCMI Device Conformance</h4>
<!--l. 3--><p class="noindent" >An SCMI device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7220001">5.17.3.1<!--tex4ht:ref: devicenormative:Device Types / SCMI Device / Feature bits --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-7270001">5.17.6.1.1<!--tex4ht:ref: devicenormative:Device Types / SCMI Device / Device Operation / cmdq Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-7320001">5.17.6.3.1<!--tex4ht:ref: devicenormative:Device Types / SCMI Device / Device Operation / eventq Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 9--><p class="noindent" ><a 
href="#x1-7340001">5.17.6.4.1<!--tex4ht:ref: devicenormative:Device Types / SCMI Device / Device Operation / Shared Memory Operation --></a></li></ul>
<a 
 id="x1-847001r859"></a>
                                                                  

                                                                  
<h4 class="subsectionHead"><span class="titlemark">7.3.21   </span> <a 
 id="x1-84800021"></a>Clause 46: GPIO Device Conformance</h4>
<!--l. 3--><p class="noindent" >A General Purpose Input/Output (GPIO) device MUST conform to the following
normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-7500009">5.18.6.9<!--tex4ht:ref: devicenormative:Device Types / GPIO Device / requestq Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-7540003">5.18.7.3<!--tex4ht:ref: devicenormative:Device Types / GPIO Device / eventq Operation --></a></li></ul>
<a 
 id="x1-848001r860"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.22   </span> <a 
 id="x1-84900022"></a>Clause 47: PMEM Device Conformance</h4>
<!--l. 3--><p class="noindent" >A PMEM device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7610001">5.19.5.1<!--tex4ht:ref: devicenormative:Device Types / PMEM Device / Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 7--><p class="noindent" ><a 
href="#x1-7650001">5.19.7.1<!--tex4ht:ref: devicenormative:Device Types / PMEM Device / Device Operation / Virtqueue flush --></a>
    </li>
    <li class="itemize">
    <!--l. 8--><p class="noindent" ><a 
href="#x1-7670003">5.19.7.3<!--tex4ht:ref: devicenormative:Device Types / PMEM Device / Device Operation / Virtqueue return --></a></li></ul>
<a 
 id="x1-849001r861"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.23   </span> <a 
 id="x1-85000023"></a>Clause 48: CAN Device Conformance</h4>
<!--l. 3--><p class="noindent" >A CAN device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7830002">5.20.5.2<!--tex4ht:ref: devicenormative:Device Types / CAN Device / Device Operation / CAN Message Transmission --></a></li></ul>
<a 
 id="x1-850001r862"></a>
<h4 class="subsectionHead"><span class="titlemark">7.3.24   </span> <a 
 id="x1-85100024"></a>Clause 49: SPI Controller Device Conformance</h4>
<!--l. 3--><p class="noindent" >An SPI Controller device MUST conform to the following normative statements:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 6--><p class="noindent" ><a 
href="#x1-7960004">5.21.6.4<!--tex4ht:ref: devicenormative:Device Types / SPI Controller Device / Device Operation --></a></li></ul>
<a 
 id="x1-851001r839"></a>
                                                                  

                                                                  
<h3 class="sectionHead"><span class="titlemark">7.4   </span> <a 
 id="x1-8520004"></a>Clause 50: Legacy Interface: Transitional Device and Transitional Driver
Conformance</h3>
<!--l. 259--><p class="noindent" >A conformant implementation MUST be either transitional or non-transitional, see
<a 
href="#x1-60001">1.3.1<!--tex4ht:ref: intro:Legacy Interface: Terminology --></a>.
<!--l. 263--><p class="noindent" >An implementation MAY choose to implement OPTIONAL support for the legacy
interface, including support for legacy drivers or devices, by conforming to all of the
MUST or REQUIRED level requirements for the legacy interface for the transitional
devices and drivers.
<!--l. 269--><p class="noindent" >The requirements for the legacy interface for transitional implementations are located
in sections named “Legacy Interface” listed below:
    <ul class="itemize1">
    <li class="itemize">
    <!--l. 272--><p class="noindent" >Section <a 
href="#x1-170003">2.2.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits / Legacy Interface: A Note on Feature Bits --></a>
    </li>
    <li class="itemize">
    <!--l. 274--><p class="noindent" >Section <a 
href="#x1-250003">2.5.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Configuration Space / Legacy Interface: A Note on Configuration Space endian-ness --></a>
    </li>
    <li class="itemize">
    <!--l. 275--><p class="noindent" >Section <a 
href="#x1-260004">2.5.4<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device Configuration Space / Legacy Interface: Device Configuration Space --></a>
    </li>
    <li class="itemize">
    <!--l. 276--><p class="noindent" >Section <a 
href="#x1-370002">2.7.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Layout --></a>
    </li>
    <li class="itemize">
    <!--l. 277--><p class="noindent" >Section <a 
href="#x1-380003">2.7.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Legacy Interfaces: A Note on Virtqueue Endianness --></a>
    </li>
    <li class="itemize">
    <!--l. 278--><p class="noindent" >Section <a 
href="#x1-420003">2.7.4.3<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues / Message Framing / Legacy Interface: Message Framing --></a>
    </li>
    <li class="itemize">
    <!--l. 279--><p class="noindent" >Section <a 
href="#x1-1140006">2.12.1.1.6<!--tex4ht:ref: devicenormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Legacy Interface --></a>
    </li>
    <li class="itemize">
    <!--l. 280--><p class="noindent" >Section <a 
href="#x1-1150007">2.12.1.1.7<!--tex4ht:ref: drivernormative:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Legacy Interface --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 281--><p class="noindent" >Section <a 
href="#x1-1570002">3.1.2<!--tex4ht:ref: sec:General Initialization And Device Operation / Device Initialization / Legacy Interface: Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 282--><p class="noindent" >Section <a 
href="#x1-1680003">4.1.2.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery / Legacy Interfaces: A Note on PCI Device Discovery --></a>
    </li>
    <li class="itemize">
    <!--l. 283--><p class="noindent" >Section <a 
href="#x1-19300010">4.1.4.10<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Legacy Interfaces: A Note on PCI Device Layout --></a>
    </li>
    <li class="itemize">
    <!--l. 284--><p class="noindent" >Section <a 
href="#x1-1990001">4.1.5.1.1.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Device Initialization / Virtio Device Configuration Layout Detection / Legacy Interface: A Note on Device Layout Detection --></a>
    </li>
    <li class="itemize">
    <!--l. 285--><p class="noindent" >Section <a 
href="#x1-2040001">4.1.5.1.3.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Device Initialization / Virtqueue Configuration / Legacy Interface: A Note on Virtqueue Configuration --></a>
    </li>
    <li class="itemize">
    <!--l. 286--><p class="noindent" >Section <a 
href="#x1-2250004">4.2.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Legacy interface --></a>
    </li>
    <li class="itemize">
    <!--l. 287--><p class="noindent" >Section <a 
href="#x1-2370003">4.3.2.1.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting the Virtio Revision / Legacy Interfaces: A Note on Setting the Virtio Revision --></a>
    </li>
    <li class="itemize">
    <!--l. 288--><p class="noindent" >Section <a 
href="#x1-2400002">4.3.2.2.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Configuring a Virtqueue / Legacy Interface: A Note on Configuring a Virtqueue --></a>
    </li>
    <li class="itemize">
    <!--l. 289--><p class="noindent" >Section <a 
href="#x1-2580003">4.3.3.1.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Operation / Host->Guest Notification / Legacy Interfaces: A Note on Host->Guest Notification --></a>
    </li>
    <li class="itemize">
    <!--l. 290--><p class="noindent" >Section <a 
href="#x1-2510004">4.3.2.6.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting Up Indicators / Legacy Interfaces: A Note on Setting Up Indicators --></a>
    </li>
    <li class="itemize">
    <!--l. 291--><p class="noindent" >Section <a 
href="#x1-2720002">5.1.3.2<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits / Legacy Interface: Feature bits --></a>
    </li>
    <li class="itemize">
                                                                  

                                                                  
    <!--l. 292--><p class="noindent" >Section <a 
href="#x1-2760003">5.1.4.3<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout / Legacy Interface: Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 293--><p class="noindent" >Section <a 
href="#x1-2810001">5.1.8.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Legacy Interface: Device Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 294--><p class="noindent" >Section <a 
href="#x1-3110003">5.1.8.5.2.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Setting MAC Address Filtering / Legacy Interface: Setting MAC Address Filtering --></a>
    </li>
    <li class="itemize">
    <!--l. 295--><p class="noindent" >Section <a 
href="#x1-3140002">5.1.8.5.3.2<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / VLAN Filtering / Legacy Interface: VLAN Filtering --></a>
    </li>
    <li class="itemize">
    <!--l. 296--><p class="noindent" >Section <a 
href="#x1-3220003">5.1.8.5.6.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Automatic receive steering in multiqueue mode / Legacy Interface: Automatic receive steering in multiqueue mode --></a>
    </li>
    <li class="itemize">
    <!--l. 297--><p class="noindent" >Section <a 
href="#x1-3360003">5.1.8.5.9.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Offloads State Configuration / Setting Offloads State / Legacy Interface: Setting Offloads State --></a>
    </li>
    <li class="itemize">
    <!--l. 298--><p class="noindent" >Section <a 
href="#x1-3750001">5.2.3.1<!--tex4ht:ref: sec:Device Types / Block Device / Feature bits / Legacy Interface: Feature bits --></a>
    </li>
    <li class="itemize">
    <!--l. 299--><p class="noindent" >Section <a 
href="#x1-3770001">5.2.4.1<!--tex4ht:ref: sec:Device Types / Block Device / Device configuration layout / Legacy Interface: Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 300--><p class="noindent" >Section <a 
href="#x1-3810003">5.2.5.3<!--tex4ht:ref: sec:Device Types / Block Device / Device Initialization / Legacy Interface: Device Initialization --></a>
    </li>
    <li class="itemize">
    <!--l. 301--><p class="noindent" >Section <a 
href="#x1-3850003">5.2.6.3<!--tex4ht:ref: sec:Device Types / Block Device / Device Operation / Legacy Interface: Device Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 302--><p class="noindent" >Section <a 
href="#x1-3920001">5.3.4.1<!--tex4ht:ref: sec:Device Types / Console Device / Device configuration layout / Legacy Interface: Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 303--><p class="noindent" >Section <a 
href="#x1-4000003">5.3.6.3<!--tex4ht:ref: sec:Device Types / Console Device / Device Operation / Legacy Interface: Device Operation --></a>
                                                                  

                                                                  
    </li>
    <li class="itemize">
    <!--l. 304--><p class="noindent" >Section <a 
href="#x1-4170001">5.5.3.2.0.1<!--tex4ht:ref: sec:Device Types / Memory Balloon Device / Feature bits / Legacy Interface: Feature bits --></a>
    </li>
    <li class="itemize">
    <!--l. 305--><p class="noindent" >Section <a 
href="#x1-4240001">5.5.6.2.1<!--tex4ht:ref: sec:Device Types / Memory Balloon Device / Device Operation / Legacy Interface: Device Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 306--><p class="noindent" >Section <a 
href="#x1-4280003">5.5.6.3.3<!--tex4ht:ref: sec:Device Types / Memory Balloon Device / Device Operation / Memory Statistics / Legacy Interface: Memory Statistics --></a>
    </li>
    <li class="itemize">
    <!--l. 307--><p class="noindent" >Section <a 
href="#x1-4470003">5.6.4.3<!--tex4ht:ref: sec:Device Types / SCSI Host Device / Device configuration layout / Legacy Interface: Device configuration layout --></a>
    </li>
    <li class="itemize">
    <!--l. 308--><p class="noindent" >Section <a 
href="#x1-4500001">5.6.6.0.1<!--tex4ht:ref: sec:Device Types / SCSI Host Device / Device Operation / Legacy Interface: Device Operation --></a>
    </li>
    <li class="itemize">
    <!--l. 309--><p class="noindent" >Section <a 
href="#x1-4540003">5.6.6.1.3<!--tex4ht:ref: sec:Device Types / SCSI Host Device / Device Operation / Device Operation: Request Queues / Legacy Interface: Device Operation: Request Queues --></a>
    </li>
    <li class="itemize">
    <!--l. 310--><p class="noindent" >Section <a 
href="#x1-4560001">5.6.6.2.1<!--tex4ht:ref: sec:Device Types / SCSI Host Device / Device Operation / Device Operation: controlq / Legacy Interface: Device Operation: controlq --></a>
    </li>
    <li class="itemize">
    <!--l. 311--><p class="noindent" >Section <a 
href="#x1-4600003">5.6.6.3.3<!--tex4ht:ref: sec:Device Types / SCSI Host Device / Device Operation / Device Operation: eventq / Legacy Interface: Device Operation: eventq --></a>
    </li>
    <li class="itemize">
    <!--l. 312--><p class="noindent" >Section <a 
href="#x1-8000003">6.3<!--tex4ht:ref: sec:Reserved Feature Bits / Legacy Interface: Reserved Feature Bits --></a></li></ul>
                                                                  

                                                                  
<a 
 id="x1-852001r813"></a>
<!--l. 1--><p class="noindent" ><h2 class="appendixHead"><span class="titlemark">Appendix A</span>. <a 
 id="x1-853000A"></a>virtio_queue.h</h2>
This file is also available at the link    <a 
href="https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/listings/virtio_queue.h" class="url" >https://docs.oasis-open.org/virtio/virtio/v1.3/csd01/listings/virtio_queue.h</a>.
All definitions in this section are for non-normative reference only.
<!--l. 8--><pre class="lstinputlisting">
<a 
 id="x1-853001"></a>
<span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853002r1"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ifndef</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQUEUE_H</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853003r2"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQUEUE_H</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853004r3"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">An</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">interface</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">efficient</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtio</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">implementation</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853005r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853006r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">header</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BSD</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">licensed</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">so</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">anyone</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">can</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">use</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">definitions</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853007r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">implement</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">compatible</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">drivers</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">servers</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853008r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853009r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Copyright</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2007,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2009,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IBM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Corporation</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853010r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Copyright</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2011,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Red</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Hat</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Inc</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853011r10"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">All</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rights</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reserved</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853012r11"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853013r12"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Redistribution</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">use</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">binary</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">forms</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">without</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853014r13"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">modification</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">permitted</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">provided</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">that</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">following</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">conditions</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853015r14"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">are</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">met</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853016r15"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Redistributions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">source</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">code</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">must</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">retain</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">copyright</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853017r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notice</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">list</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">conditions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">following</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">disclaimer</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853018r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Redistributions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">binary</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">form</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">must</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reproduce</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">copyright</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853019r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notice</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">list</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">conditions</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">following</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">disclaimer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853020r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">documentation</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">other</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">materials</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">provided</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">distribution</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853021r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">3.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Neither</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">name</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IBM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">nor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">names</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">its</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">contributors</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853022r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">may</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">be</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">endorse</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">or</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">promote</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">products</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">derived</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">from</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">software</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853023r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">without</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">specific</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">prior</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">written</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">permission</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853024r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">THIS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SOFTWARE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PROVIDED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">THE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">COPYRIGHT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">HOLDERS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AND</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CONTRIBUTORS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">‘‘</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IS</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’’</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AND</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853025r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ANY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">EXPRESS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IMPLIED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">WARRANTIES</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INCLUDING</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BUT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">NOT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LIMITED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">TO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">THE</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853026r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IMPLIED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">WARRANTIES</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">MERCHANTABILITY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AND</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">FITNESS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">FOR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">A</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PARTICULAR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PURPOSE</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853027r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ARE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">DISCLAIMED</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">NO</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">EVENT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SHALL</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IBM</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CONTRIBUTORS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LIABLE</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853028r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">FOR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ANY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">DIRECT</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INDIRECT</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INCIDENTAL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SPECIAL</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">EXEMPLARY</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CONSEQUENTIAL</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853029r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">DAMAGES</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INCLUDING</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BUT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">NOT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LIMITED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">TO</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PROCUREMENT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SUBSTITUTE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">GOODS</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853030r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SERVICES</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LOSS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">USE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">DATA</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PROFITS</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BUSINESS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INTERRUPTION</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853031r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">HOWEVER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CAUSED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AND</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ON</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ANY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">THEORY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LIABILITY</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">WHETHER</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">CONTRACT</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">STRICT</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853032r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">LIABILITY</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">TORT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">INCLUDING</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">NEGLIGENCE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OTHERWISE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ARISING</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ANY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">WAY</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853033r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OUT</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">THE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">USE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">THIS</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SOFTWARE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">EVEN</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">IF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ADVISED</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">THE</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">POSSIBILITY</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">OF</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853034r33"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">SUCH</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">DAMAGE</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853035r34"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853036r35"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">include</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">stdint</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">h</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&gt;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853037r36"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853038r37"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">marks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">continuing</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">via</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">field</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853039r38"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_NEXT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853040r39"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">marks</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">write</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">otherwise</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">read</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853041r40"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_WRITE</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853042r41"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">This</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">means</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">contains</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">list</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853043r42"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_DESC_F_INDIRECT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">4</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853044r43"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853045r44"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uses</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">advise</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">don</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">kick</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">me</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853046r45"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">when</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">you</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">add</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">It</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unreliable</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">so</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">it</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">simply</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">an</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853047r46"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">optimization</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853048r47"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_USED_F_NO_NOTIFY</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853049r48"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uses</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">in</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">advise</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">don</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">t</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853050r49"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">interrupt</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">me</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">when</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">you</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">consume</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">a</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">buffer</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">It</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unreliable</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">so</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">it</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">’</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">s</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853051r50"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">simply</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">an</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">optimization</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853052r51"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQ_AVAIL_F_NO_INTERRUPT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853053r52"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853054r53"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Support</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indirect</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853055r54"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_INDIRECT_DESC</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">28</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853056r55"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853057r56"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Support</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail_event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">and</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">fields</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853058r57"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_EVENT_IDX</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">29</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853059r58"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853060r59"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Arbitrary</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">layouts</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853061r60"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">define</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_ANY_LAYOUT</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">27</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853062r61"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853063r62"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Virtqueue</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">bytes</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853064r63"></a></span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">These</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">can</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chain</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">together</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">via</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">"</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">".</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853065r64"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853066r65"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Address</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">guest</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">physical</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853067r66"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le64</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">addr</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853068r67"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Length</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853069r68"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853070r69"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">The</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">as</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indicated</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">above</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853071r70"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853072r71"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">We</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chain</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unused</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptors</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">via</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">this</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">too</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853073r72"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">next</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853074r73"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853075r74"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853076r75"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853077r76"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853078r77"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853079r78"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853080r79"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_EVENT_IDX</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853081r80"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853082r81"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853083r82"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">here</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ids</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">for</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">padding</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">reasons</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853084r83"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used_elem</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853085r84"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Index</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">start</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chain</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853086r85"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">id</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853087r86"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Total</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">length</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">the</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">descriptor</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">chain</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">which</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">was</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">written</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853088r87"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le32</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">len</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853089r88"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853090r89"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853091r90"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853092r91"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">flags</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853093r92"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853094r93"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used_elem</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853095r94"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">if</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_EVENT_IDX</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">:</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853096r95"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853097r96"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853098r97"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853099r98"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">unsigned</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">int</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853100r99"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853101r100"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_desc</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">desc</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853102r101"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853103r102"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853104r103"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">};</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853105r104"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853106r105"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">static</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">inline</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">int</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_need_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uint16_t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event_idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uint16_t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">new_idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uint16_t</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">old_idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853107r106"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853108r107"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uint16_t</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">new_idx</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event_idx</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">1)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&lt;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">uint16_t</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">new_idx</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">old_idx</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">;</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853109r108"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853110r109"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853111r110"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Get</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">location</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">indices</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">only</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">with</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTIO_F_EVENT_IDX</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853112r111"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">static</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">inline</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_used_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853113r112"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853114r113"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">backwards</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">compat</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">at</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853115r114"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853116r115"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853117r116"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853118r117"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">static</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">inline</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq_avail_event</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">struct</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">virtq</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">)</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853119r118"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">{</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853120r119"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">For</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">backwards</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">compat</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">,</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">avail</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">event</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">index</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">is</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">at</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">end</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">of</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">.</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853121r120"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">return</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">(</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">le16</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*)</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">&amp;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">used</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">ring</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">[</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vq</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">-&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">num</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">];</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853122r121"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">}</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-853123r122"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">#</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">endif</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/*</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VIRTQUEUE_H</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">*/</span></span>
</pre>
                                                                  

                                                                  
<a 
 id="x1-853124r813"></a>
<!--l. 1--><p class="noindent" ><h2 class="appendixHead"><span class="titlemark">Appendix B</span>. <a 
 id="x1-854000B"></a>Creating New Device Types</h2>
Various considerations are necessary when creating a new device type.
<a 
 id="x1-854001r864"></a>
<h3 class="sectionHead"><span class="titlemark">B.1   </span> <a 
 id="x1-8550001"></a>How Many Virtqueues?</h3>
<!--l. 8--><p class="noindent" >It is possible that a very simple device will operate entirely through its device
configuration space, but most will need at least one virtqueue in which it
will place requests. A device with both input and output (eg. console and
network devices described here) need two queues: one which the driver fills with
buffers to receive input, and one which the driver places buffers to transmit
output.
<a 
 id="x1-855001r868"></a>
<h3 class="sectionHead"><span class="titlemark">B.2   </span> <a 
 id="x1-8560002"></a>What Device Configuration Space Layout?</h3>
<!--l. 18--><p class="noindent" >Device configuration space should only be used for initialization-time parameters. It
is a limited resource with no synchronization between field written by the driver, so
for most uses it is better to use a virtqueue to update configuration information (the
network device does this for filtering, otherwise the table in the config space could
potentially be very large).
<!--l. 25--><p class="noindent" >Remember that configuration fields over 32 bits wide might not be atomically
writable by the driver. Therefore, no writeable field which triggers an action ought to
be wider than 32 bits.
<a 
 id="x1-856001r869"></a>
<h3 class="sectionHead"><span class="titlemark">B.3   </span> <a 
 id="x1-8570003"></a>What Device Number?</h3>
<!--l. 31--><p class="noindent" >Device numbers can be reserved by the OASIS committee: email virtio-comment@lists.linux.dev
(after subscribing through virtio-comment+subscribe@lists.linux.dev) to secure a
unique one.
<!--l. 35--><p class="noindent" >Meanwhile for experimental drivers, use 65535 and work backwards.
<a 
 id="x1-857001r870"></a>
<h3 class="sectionHead"><span class="titlemark">B.4   </span> <a 
 id="x1-8580004"></a>How many MSI-X vectors? (for PCI)</h3>
<!--l. 39--><p class="noindent" >Using the optional MSI-X capability devices can speed up interrupt processing by
removing the need to read ISR Status register by guest driver (which might be an
expensive operation), reducing interrupt sharing between devices and queues within
the device, and handling interrupts from multiple CPUs. However, some systems
impose a limit (which might be as low as 256) on the total number of MSI-X vectors
that can be allocated to all devices. Devices and/or drivers should take this into
account, limiting the number of vectors used unless the device is expected
to cause a high volume of interrupts. Devices can control the number of
vectors used by limiting the MSI-X Table Size or not presenting MSI-X
                                                                  

                                                                  
capability in PCI configuration space. Drivers can control this by mapping events
to as small number of vectors as possible, or disabling MSI-X capability
altogether.
<a 
 id="x1-858001r871"></a>
<h3 class="sectionHead"><span class="titlemark">B.5   </span> <a 
 id="x1-8590005"></a>Device Improvements</h3>
<!--l. 57--><p class="noindent" >Any change to device configuration space, or new virtqueues, or behavioural changes,
should be indicated by negotiation of a new feature bit. This establishes
clarity<span class="footnote-mark"><a 
href="#fn26x9" id="fn26x9-bk"><sup class="textsuperscript">26</sup></a></span><a 
 id="x1-859001f26"></a>
and avoids future expansion problems.
<!--l. 63--><p class="noindent" >Clusters of functionality which are always implemented together can use a single bit,
but if one feature makes sense without the others they should not be gratuitously
grouped together to conserve feature bits.
<a 
 id="x1-859002r872"></a>
<h3 class="sectionHead"><span class="titlemark">B.6   </span> <a 
 id="x1-8600006"></a>How to define a new device part?</h3>
<!--l. 69--><p class="noindent" >Few considerations are necessary when creating new device part or when
extending the device part structure. If the new field is generic for all the
device types or most of the device types, a new device part should be defined
as common device part by claiming a new <span 
class="aeti-10">type </span>value. If the new field is
unique to a device type, a new device specific device part should be added.
range.
<a 
 id="x1-860001r873"></a>
<h3 class="sectionHead"><span class="titlemark">B.7   </span> <a 
 id="x1-8610007"></a>When to define a new device part?</h3>
<!--l. 78--><p class="noindent" >When the device part for a specific field does not exists, one should define a new
device part.
<a 
 id="x1-861001r874"></a>
<h3 class="sectionHead"><span class="titlemark">B.8   </span> <a 
 id="x1-8620008"></a>How to avoid device part duplication with existing structure?</h3>
<!--l. 82--><p class="noindent" >Each device should reuse any existing field definition that may exists as part of
device control virtqueue or any other existing structure definition.
<a 
 id="x1-862001r875"></a>
<h3 class="sectionHead"><span class="titlemark">B.9   </span> <a 
 id="x1-8630009"></a>How to extend the existing device part definition?</h3>
<!--l. 87--><p class="noindent" >When a field is missing in already defined device part, a new field should be added at
the end of the existing device part. New field MUST not be added at beginning or in
the middle of the device part structure. Any field which is already present MUST
NOT be removed.
                                                                  

                                                                  
<a 
 id="x1-863001r813"></a>
<!--l. 1--><p class="noindent" ><h2 class="appendixHead"><span class="titlemark">Appendix C</span>. <a 
 id="x1-864000C"></a>Creating New Transports</h2>
Devices and drivers utilize various transport methods to facilitate communication,
such as PCI, MMIO, or Channel I/O. These transport methods determine aspects of
the interaction between the device and the driver, including device discovery,
capability exchange, interrupt handling, and data transfer. For instance, in a
host/guest architecture, the host might expose a device to the guest via a virtual
PCI bus, and the guest would use a PCI device driver to interface with the
device.
<!--l. 11--><p class="noindent" >This section outlines the mandatory requirements that a transport method
implements.
<!--l. 14--><p class="noindent" >A transport provides a mechanism to implement configuration space for the
device.
<!--l. 17--><p class="noindent" >A transport provides a mechanism for the driver to identify the device type.
<!--l. 20--><p class="noindent" >A transport provides a mechanism for the driver to read the device’s FEATURES_OK
and DEVICE_NEEDS_RESET status bits.
<!--l. 23--><p class="noindent" >A transport provides a mechanism for the driver to modify the device’s
status.
<!--l. 26--><p class="noindent" >A transport provides a mechanism for the driver to read and modify the device’s
feature bits.
<!--l. 29--><p class="noindent" >A transport allows one or more virtqueues to be implemented by the device. The
number of virtqueues is device specific and not specified by the transport.
<!--l. 33--><p class="noindent" >A transport provides a mechanism for the driver to communicate virtqueue
configuration and memory location to the device.
<!--l. 36--><p class="noindent" >A transport provides a mechanism for the device to send device notifications to the
driver, such as used buffer notifications.
<!--l. 39--><p class="noindent" >A transport provides a mechanism for the driver to send driver notifications to the
device, such as available buffer notifications.
<!--l. 42--><p class="noindent" >A transport provides a mechanism for the driver to initiate a device reset.
                                                                  

                                                                  
<a 
 id="x1-864001r813"></a>
<!--l. 4--><p class="noindent" ><h2 class="appendixHead"><span class="titlemark">Appendix D</span>. <a 
 id="x1-865000D"></a>Acknowledgements</h2>
The following individuals have participated in the creation of this specification and
are gratefully acknowledged:
<h4 class="likesubsectionHead"><a 
 id="x1-866000D"></a>Participants</h4>
<!--l. 9--><p class="noindent" >Alvaro Karsz, SolidRun <br 
class="newline" />Anton Yakovlev, OpenSynergy <br 
class="newline" />Cornelia Huck, Red Hat <br 
class="newline" />David Edmondson, Oracle <br 
class="newline" />David Hildenbrand, Red Hat <br 
class="newline" />Dmitry Fomichev, Western Digital <br 
class="newline" />Dust Li, Alibaba <br 
class="newline" />Enrico Granata, Google <br 
class="newline" />Haixu Cui, Quic Inc <br 
class="newline" />Halil Pasic, IBM <br 
class="newline" />Heng Qi, Alibaba <br 
class="newline" />Hrishivarya Bhageeradhan, OpenSynergy <br 
class="newline" />Jan Kiszka, Siemens <br 
class="newline" />Jiri Pirko, Nvidia <br 
class="newline" />Laura Loghin, Amazon <br 
class="newline" />Lei He, Bytedance <br 
class="newline" />Lingshan Zhu, Intel <br 
class="newline" />Matti Moell, OpenSynergy <br 
class="newline" />Michael S. Tsirkin, Red Hat <br 
class="newline" />Mihai Carabas, Oracle <br 
class="newline" />Parav Pandit, Nvidia <br 
class="newline" />Ran Koren, Nvidia <br 
class="newline" />Satananda Burla, Marvell <br 
class="newline" />Shahaf Shuler, Nvidia <br 
class="newline" />Si-Wei Liu, Oracle <br 
class="newline" />Stefan Hajnoczi, Red Hat <br 
class="newline" />Stefano Garzarella, Red Hat <br 
class="newline" />Xuan Zhuo, Alibaba <br 
class="newline" />Yuri Benditovich, Red Hat / Daynix <br 
class="newline" />Zhenwei Pi, Bytedance <br 
class="newline" />
<!--l. 40--><p class="noindent" >The following non-members have provided valuable feedback on this specification and
are gratefully acknowledged:
<h4 class="likesubsectionHead"><a 
 id="x1-867000D"></a>Reviewers</h4>
<!--l. 44--><p class="noindent" >Damien Le Moal, Western Digital <br 
class="newline" />Hans Holmberg, Western Digital <br 
class="newline" />Hans Zhang, Alibaba <br 
class="newline" />He Rongguang, Alibaba <br 
class="newline" />Helin Guo, Alibaba <br 
class="newline" />Jiang Liu, Alibaba <br 
class="newline" />Matias Bjørling, Western Digital <br 
class="newline" />Max Gurtovoy, Nvidia <br 
class="newline" />Niklas Cassel, Western Digital <br 
class="newline" />Tony Lu, Alibaba <br 
class="newline" />
<!--l. 56--><p class="noindent" >The following individuals have participated in the creation of previous versions of this
specification and are gratefully acknowledged:
<h4 class="likesubsectionHead"><a 
 id="x1-868000D"></a>Participants</h4>
<!--l. 60--><p class="noindent" >Alexander Duyck, Intel <br 
class="newline" />Alex Bennée, Linaro <br 
class="newline" />Allen Chia, Oracle <br 
class="newline" />Amit Shah, Red Hat <br 
class="newline" />Amos Kong, Red Hat <br 
class="newline" />Anthony Liguori, IBM <br 
class="newline" />Anton Yakovlev, OpenSynergy <br 
class="newline" />Arseny Krasnov, Kaspersky Lab <br 
class="newline" />Bruce Rogers, SUSE <br 
class="newline" />Bryan Venteicher, NetApp <br 
class="newline" />Chandra Thyamagondlu, Xilinx <br 
class="newline" />Chet Ensign, OASIS <br 
class="newline" />Cornelia Huck, Red Hat <br 
class="newline" />Cunming, Liang, Intel <br 
class="newline" />Damjan, Marion, Cisco <br 
class="newline" />Daniel Kiper, Oracle <br 
class="newline" />David Hildenbrand, Red Hat <br 
class="newline" />David Stevens, Chromium <br 
class="newline" />Dr. David Alan Gilbert, Red Hat <br 
class="newline" />Enrico Granata, Google <br 
class="newline" />Eugenio Pérez, Red Hat <br 
class="newline" />Fang Chen, Huawei <br 
class="newline" />Fang You, Huawei <br 
class="newline" />Felipe Franciosi, Nutanix <br 
class="newline" />Gaetan Harter, OpenSynergy <br 
class="newline" />Geoff Brown, M2Mi <br 
class="newline" />Gerd Hoffmann, Red Hat <br 
class="newline" />Gershon Janssen, Individual Member <br 
class="newline" />Grant Likely, ARM <br 
class="newline" />Gurchetan Singh, Chromium <br 
class="newline" />Haggai Eran, Mellanox <br 
class="newline" />Halil Pasic, IBM <br 
class="newline" />Hao Chen, Google <br 
class="newline" />Huang Yang, Intel <br 
class="newline" />James Bottomley, Parallels IP Holdings GmbH <br 
class="newline" />Jani Kokkonen, Huawei <br 
class="newline" />Jan Kiszka, Siemens AG <br 
class="newline" />Jean-Philippe Brucker, Linaro <br 
class="newline" />Jens Freimann, Red Hat <br 
class="newline" />Jian Zhou, Huawei <br 
class="newline" />Jiang Wang, Bytedance <br 
class="newline" />Jie Deng, Intel <br 
class="newline" />Joel Nider, Individual <br 
class="newline" />Johannes Berg, Intel <br 
class="newline" />Junji Wei, Bytedance <br 
class="newline" />Karen Xie, Xilinx <br 
class="newline" />Keiichi Watanabe, Chromium <br 
class="newline" />Kumar Sanghvi, Xilinx <br 
class="newline" />Lei Gong, Huawei <br 
class="newline" />Lior Narkis, Mellanox <br 
class="newline" />Luiz Capitulino, Red Hat <br 
class="newline" />Marc-André Lureau, Red Hat <br 
class="newline" />Marcel Holtmann, Individual <br 
class="newline" />Mark Gray, Intel <br 
class="newline" />Michael S. Tsirkin, Red Hat <br 
class="newline" />Mihai Carabas, Oracle <br 
class="newline" />Nikos Dragazis, Arrikto <br 
class="newline" />Nishank Trivedi, NetApp <br 
class="newline" />Pankaj Gupta, Red Hat <br 
class="newline" />Paolo Bonzini, Red Hat <br 
class="newline" />Paul Mundt, Huawei <br 
class="newline" />Pawel Moll, ARM <br 
class="newline" />Peng Long, Huawei <br 
class="newline" />Peter Hilber, OpenSynergy <br 
class="newline" />Petre Eftime, Amazon <br 
class="newline" />Philipp Hahn, Univention <br 
class="newline" />Piotr Uminski, Intel <br 
class="newline" />Qian Xum, Intel <br 
class="newline" />Richard Sohn, Alcatel-Lucent <br 
class="newline" />Rob Bradford, Intel <br 
class="newline" />Rusty Russell, IBM <br 
class="newline" />Sasha Levin, Oracle <br 
class="newline" />Sergey Tverdyshev, Thales e-Security <br 
class="newline" />Stefan Fritsch, Individual <br 
class="newline" />Stefan Hajnoczi, Red Hat <br 
class="newline" />Sundar Mohan, Xilinx <br 
class="newline" />Taylor Stark, Microsoft <br 
class="newline" />Tiwei Bie, Intel <br 
class="newline" />Tom Lyon, Samya Systems, Inc. <br 
class="newline" />Victor Kaplansky, Red Hat <br 
class="newline" />Vijay Balakrishna, Oracle <br 
class="newline" />Viresh Kumar, Linaro <br 
class="newline" />Vitaly Mireyno, Marvell <br 
class="newline" />Wei Wang, Intel <br 
class="newline" />Xin Zeng, Intel <br 
class="newline" />Yadong Qi, Intel <br 
class="newline" />Yoni Bettan, Red Hat <br 
class="newline" />Yuri Benditovich, Red Hat / Daynix <br 
class="newline" />
<!--l. 149--><p class="noindent" >The following non-members have provided valuable feedback on previous versions of
this specification and are gratefully acknowledged:
<h4 class="likesubsectionHead"><a 
 id="x1-869000D"></a>Reviewers</h4>
<!--l. 154--><p class="noindent" >Aaron Conole, Red Hat <br 
class="newline" />Adam Tao, Huawei <br 
class="newline" />Alexander Duyck, Intel <br 
class="newline" />Andreas Pape, ADITG/ESB <br 
class="newline" />Andrew Thornton, Google <br 
class="newline" />Arnd Bergmann, Individual <br 
class="newline" />Arun Subbarao, LynuxWorks <br 
class="newline" />Baptiste Reynal, Virtual Open Systems <br 
class="newline" />Bharat Bhushan, NXP Semiconductors <br 
class="newline" />Bing Zhu, Intel <br 
class="newline" />Brian Foley, ARM <br 
class="newline" />Chandra Thyamagondlu, Xilinx <br 
class="newline" />Changpeng Liu, Intel <br 
class="newline" />Christian Pinto, Virtual Open Systems <br 
class="newline" />Christoffer Dall, ARM <br 
class="newline" />Christoph Hellwig, Individual <br 
class="newline" />Christophe de Dinechin, Red Hat <br 
class="newline" />Christian Borntraeger, IBM <br 
class="newline" />Daniel Marcovitch, Mellanox <br 
class="newline" />David Alan Gilbert, Red Hat <br 
class="newline" />David Hildenbrand, Red Hat <br 
class="newline" />David Riddoch, Solarflare <br 
class="newline" />Denis V. Lunev, OpenVZ <br 
class="newline" />Dmitry Fleytman, Red Hat <br 
class="newline" />Don Wallwork, Broadcom <br 
class="newline" />Eduardo Habkost, Red Hat <br 
class="newline" />Emily Drea, ARM <br 
class="newline" />Eric Auger, Red Hat <br 
class="newline" />Fam Zheng, Red Hat <br 
class="newline" />Francesco Fusco, Red Hat <br 
class="newline" />Frank Yang, Google <br 
class="newline" />Gil Savir, Intel <br 
class="newline" />Gonglei (Arei), Huawei <br 
class="newline" />Greg Kurz, IBM <br 
class="newline" />Hannes Reiencke, SUSE <br 
class="newline" />Ian Campbell, Docker <br 
class="newline" />Ilya Lesokhin, Mellanox <br 
class="newline" />Jacques Durand, Fujutsu <br 
class="newline" />Jakub Jermar, Kernkonzept <br 
class="newline" />Jan Scheurich, Ericsson <br 
class="newline" />Jason Baron, Akamai <br 
class="newline" />Jason Wang, Red Hat <br 
class="newline" />Jean-Philippe Brucker, ARM <br 
class="newline" />Jens Freimann, Red Hat <br 
class="newline" />Jianfeng Tan, intel <br 
class="newline" />Jonathan Helman, Oracle <br 
class="newline" />Karandeep Chahal, DDN <br 
class="newline" />Kevin Lo, MSI <br 
class="newline" />Kevin Tian, Intel <br 
class="newline" />Kully Dhanoa, Intel <br 
class="newline" />Laura Novich, Red Hat <br 
class="newline" />Ladi Prosek, Red Hat <br 
class="newline" />Lars Ganrot, Napatech <br 
class="newline" />Linus Walleij, Linaro <br 
class="newline" />Longpeng (Mike), Huawei <br 
class="newline" />Mario Torrecillas Rodriguez, ARM <br 
class="newline" />Mark Rustad, Intel <br 
class="newline" />Matti Möll, OpenSynergy <br 
class="newline" />Maxime Coquelin, Red Hat <br 
class="newline" />Namhyung Kim, LG <br 
class="newline" />Ola Liljedahl, ARM <br 
class="newline" />Pankaj Gupta, Red Hat <br 
class="newline" />Paolo Bonzini, Red Hat <br 
class="newline" />Patrick Durusau, OASIS <br 
class="newline" />Pierre Pfister, Cisco <br 
class="newline" />Pranavkumar Sawargaonkar, Linaro <br 
class="newline" />Rauchfuss Holm, Huawei <br 
class="newline" />Rob Miller, Broadcom <br 
class="newline" />Roman Kiryanov, Google <br 
class="newline" />Robin Cover, OASIS <br 
class="newline" />Roger S Chien, Intel <br 
class="newline" />Ruchika Gupta, Linaro <br 
class="newline" />Sameeh Jubran, Red Hat / Daynix <br 
class="newline" />Si-Wei Liu, Oracle <br 
class="newline" />Sridhar Samudrala, Intel <br 
class="newline" />Stefan Fritsch, Individual <br 
class="newline" />Stefano Garzarella, Red Hat <br 
class="newline" />Steven Luong, Cisco <br 
class="newline" />Thomas Huth, Red Hat <br 
class="newline" />Tiwei Bie, Intel <br 
class="newline" />Tomáš Golembiovský, Red Hat <br 
class="newline" />Tomas Winkler, Intel <br 
class="newline" />Venu Busireddy, Oracle <br 
class="newline" />Victor Kaplansky, Red Hat <br 
class="newline" />Vijayabhaskar Balakrishna, Oracle <br 
class="newline" />Vlad Yasevich, Red Hat <br 
class="newline" />Yan Vugenfirer, Red Hat / Daynix <br 
class="newline" />Wei Xu, Red Hat <br 
class="newline" />Will Deacon, ARM <br 
class="newline" />Willem de Bruijn, Google <br 
class="newline" />Yang Huang, Intel <br 
class="newline" />Yuanhan Liu, Intel <br 
class="newline" />Yuri Benditovich, Red Hat / Daynix <br 
class="newline" />Zhi Yong Wu, IBM <br 
class="newline" />Zhoujian, Huawei <br 
class="newline" />
                                                                  

                                                                  
<a 
 id="x1-869001r813"></a>
<!--l. 1--><p class="noindent" ><h2 class="appendixHead"><span class="titlemark">Appendix E</span>. <a 
 id="x1-870000E"></a>Revision History</h2>
The following changes have been made since version 1.2 of this specification:
<a 
 id="x1-870001r1"></a><!--l. 8--><div class="longtable"> <table id="TBL-93" class="longtable" 
 
><colgroup id="TBL-93-1g"><col 
id="TBL-93-1"></colgroup><colgroup id="TBL-93-2g"><col 
id="TBL-93-2"></colgroup><colgroup id="TBL-93-3g"><col 
id="TBL-93-3"></colgroup><colgroup id="TBL-93-4g"><col 
id="TBL-93-4"></colgroup>
                                                                  

                                                                  
<tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-1-"><td  style="white-space:normal; text-align:left;" id="TBL-93-1-1"  
class="td11">
 <!--l. 8--><p class="noindent" ><span 
class="aeb10-">Revision</span>      </td><td  style="white-space:normal; text-align:left;" id="TBL-93-1-2"  
class="td11">
 <!--l. 8--><p class="noindent" ><span 
class="aeb10-">Date</span> </td><td  style="white-space:normal; text-align:left;" id="TBL-93-1-3"  
class="td11">
 <!--l. 8--><p class="noindent" ><span 
class="aeb10-">Editor</span>    </td><td  style="white-space:normal; text-align:left;" id="TBL-93-1-4"  
class="td11">
 <!--l. 8--><p class="noindent" ><span 
class="aeb10-">Changes Made</span>                                                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-2-"><td  style="white-space:normal; text-align:left;" id="TBL-93-2-1"  
class="td11">
 <!--l. 10--><p class="noindent" >          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-93-3-"><td  style="white-space:normal; text-align:left;" id="TBL-93-3-1"  
class="td11">            </td><td  style="white-space:normal; text-align:left;" id="TBL-93-3-2"  
class="td11">      </td><td  style="white-space:normal; text-align:left;" id="TBL-93-3-3"  
class="td11">         </td><td  style="white-space:normal; text-align:left;" id="TBL-93-3-4"  
class="td11">
</td></tr>
<tr  
 style="vertical-align:baseline;" id="TBL-93-4-"><td  style="white-space:normal; text-align:left;" id="TBL-93-4-1"  
class="td11">
 <!--l. 1--><p class="noindent" >5da7c1414e7e </td><td  style="white-space:normal; text-align:left;" id="TBL-93-4-2"  
class="td11">
 <!--l. 1--><p class="noindent" >13
  Jun
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-4-3"  
class="td11">
 <!--l. 1--><p class="noindent" >Stefan
  Hajnoczi </td><td  style="white-space:normal; text-align:left;" id="TBL-93-4-4"  
class="td11">
 <!--l. 1--><p class="noindent" >virtio-blk: document that the capacity field can change
  <!--l. 4--><p class="noindent" >Block   devices   can   change   size   during   operation.
  A  configuration  change  notification  is  sent  by  the
  device  and  the  driver  detects  that  the  field  has
  changed. Document this behavior that has already been
  implemented in Linux and QEMU since 2011.
  <!--l. 10--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/136" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/136</a>
  <!--l. 12--><p class="noindent" >Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 14--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 16--><p class="noindent" >See <a 
href="#x1-3820006">5.2.6<!--tex4ht:ref: sec:Device Types / Block Device / Device Operation --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-5-"><td  style="white-space:normal; text-align:left;" id="TBL-93-5-1"  
class="td11">
 <!--l. 19--><p class="noindent" >ad2e1674bb69 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-5-2"  
class="td11">
 <!--l. 19--><p class="noindent" >13
  Jun
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-5-3"  
class="td11">
 <!--l. 19--><p class="noindent" >Laura
  Loghin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-5-4"  
class="td11">
 <!--l. 19--><p class="noindent" >vsock: add documentation about len header field
  <!--l. 23--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/137" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/137</a>
  <!--l. 25--><p class="noindent" >Reviewed-by:                Stefano                Garzarella
  <sgarzare@redhat.com>
  <!--l. 27--><p class="noindent" >Signed-off-by: Laura Loghin <lauralg@amazon.com>
  <!--l. 29--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 31--><p class="noindent" >See <a 
href="#x1-5460006">5.10.6<!--tex4ht:ref: sec:Device Types / Socket Device / Device Operation --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-6-"><td  style="white-space:normal; text-align:left;" id="TBL-93-6-1"  
class="td11">
 <!--l. 34--><p class="noindent" >fca015771bc9 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-6-2"  
class="td11">
 <!--l. 34--><p class="noindent" >13
  Jun
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-6-3"  
class="td11">
 <!--l. 34--><p class="noindent" >Xuan
  Zhuo      </td><td  style="white-space:normal; text-align:left;" id="TBL-93-6-4"  
class="td11">
 <!--l. 34--><p class="noindent" >virtio-net: support reset queue
  <!--l. 37--><p class="noindent" >A separate reset queue function introduced by Virtqueue
  Reset.
  <!--l. 39--><p class="noindent" >However,  it  is  currently  not  defined  what  to  do  if
  the destination queue is being reset when virtio-net is
  steering in multi-queue mode.
  <!--l. 43--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/138" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/138</a>
  <!--l. 45--><p class="noindent" >Reviewed-by: Jason Wang <jasowang@redhat.com>
  <!--l. 47--><p class="noindent" >Signed-off-by:                    Xuan                    Zhuo
  <xuanzhuo@linux.alibaba.com>
  <!--l. 49--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 51--><p class="noindent" >See <a 
href="#x1-3190006">5.1.8.5.6<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Automatic receive steering in multiqueue mode --></a>, and <a 
href="#x1-3250001">5.1.8.5.7.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Receive-side scaling (RSS) / Setting RSS parameters --></a>.                                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-7-"><td  style="white-space:normal; text-align:left;" id="TBL-93-7-1"  
class="td11">
 <!--l. 55--><p class="noindent" >6328f51e21b5 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-7-2"  
class="td11">
 <!--l. 55--><p class="noindent" >24
  Jun
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-7-3"  
class="td11">
 <!--l. 55--><p class="noindent" >Yuri
  Benditovich </td><td  style="white-space:normal; text-align:left;" id="TBL-93-7-4"  
class="td11">
 <!--l. 55--><p class="noindent" >virtio-net: define guest USO features
  <!--l. 59--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/120" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/120</a>
  <!--l. 61--><p class="noindent" >Add definition for large UDP packets device-to-driver.
  <!--l. 63--><p class="noindent" >Signed-off-by:                 Yuri                 Benditovich
  <yuri.benditovich@daynix.com>
  <!--l. 65--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 67--><p class="noindent" >See <a 
href="#x1-2700003">5.1.3<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits --></a>, <a 
href="#x1-2710001">5.1.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits / Feature bit requirements --></a>, <a 
href="#x1-2770005">5.1.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Initialization --></a>, <a 
href="#x1-2860003">5.1.8.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Setting Up Receive Buffers --></a>, <a 
href="#x1-2890004">5.1.8.4<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets --></a>, and <a 
href="#x1-3340001">5.1.8.5.9.1<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Offloads State Configuration / Setting Offloads State --></a>.  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-8-"><td  style="white-space:normal; text-align:left;" id="TBL-93-8-1"  
class="td11">
 <!--l. 75--><p class="noindent" >49ff7805924c </td><td  style="white-space:normal; text-align:left;" id="TBL-93-8-2"  
class="td11">
 <!--l. 75--><p class="noindent" >24
  Jun
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-8-3"  
class="td11">
 <!--l. 75--><p class="noindent" >Anton
  Yakovlev</td><td  style="white-space:normal; text-align:left;" id="TBL-93-8-4"  
class="td11">
 <!--l. 75--><p class="noindent" >virtio-snd: add support for audio controls
  <!--l. 78--><p class="noindent" >This patch extends the virtio sound device specification
  by adding support for audio controls. Audio controls
  can be used to set the volume level, mute/unmute the
  audio signal, switch different modes/states of the virtual
  sound device, etc.
  <!--l. 84--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/107" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/107</a>
  <!--l. 86--><p class="noindent" >Signed-off-by:                 Anton                 Yakovlev
  <anton.yakovlev@opensynergy.com>
  <!--l. 88--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 90--><p class="noindent" >See <a 
href="#x1-81900016">7.2.16<!--tex4ht:ref: sec:Conformance / Driver Conformance / Sound Driver Conformance --></a>, <a 
href="#x1-84400017">7.3.17<!--tex4ht:ref: sec:Conformance / Device Conformance / Sound Device Conformance --></a>, <a 
href="#x1-6360003">5.14.3<!--tex4ht:ref: sec:Device Types / Sound Device / Feature Bits --></a>, <a 
href="#x1-6370004">5.14.4<!--tex4ht:ref: sec:Device Types / Sound Device / Device Configuration Layout --></a>, <a 
href="#x1-6400006">5.14.6<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation --></a>, and <a 
href="#x1-67200010">5.14.6.10<!--tex4ht:ref: sec:Device Types / Sound Device / Device Operation / Control Elements --></a>.   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-9-"><td  style="white-space:normal; text-align:left;" id="TBL-93-9-1"  
class="td11">
 <!--l. 98--><p class="noindent" >4d9068effa81 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-9-2"  
class="td11">
 <!--l. 98--><p class="noindent" >11
  Jul
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-9-3"  
class="td11">
 <!--l. 98--><p class="noindent" >Alvaro
  Karsz     </td><td  style="white-space:normal; text-align:left;" id="TBL-93-9-4"  
class="td11">
 <!--l. 98--><p class="noindent" >Introduction  of  Virtio  Network  device  notifications
  coalescing feature.
  <!--l. 101--><p class="noindent" >Control   a   network   device   notifications   coalescing
  parameters using the control virtqueue. A new control
  class was added: VIRTIO_NET_CTRL_NOTF_COAL.
  <!--l. 104--><p class="noindent" >This class provides 2 commands:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 107--><p class="noindent" >VIRTIO_NET_CTRL_NOTF_COAL_TX_SET:
        Ask the network device to change the tx_usecs and
        tx_max_packets parameters.
              <ul class="itemize2">
              <li class="itemize">
              <!--l. 111--><p class="noindent" >tx_usecs: Maximum number of usecs to delay
              a TX notification.
              </li>
              <li class="itemize">
              <!--l. 113--><p class="noindent" >tx_max_packets: Maximum number of packets
              to send before a TX notification.</li></ul>
        </li>
        <li class="itemize">
        <!--l. 117--><p class="noindent" >VIRTIO_NET_CTRL_NOTF_COAL_RX_SET: Ask
        the network device to change the rx_usecs and
        rx_max_packets parameters.
              <ul class="itemize2">
              <li class="itemize">
              <!--l. 121--><p class="noindent" >rx_usecs: Maximum number of usecs to delay
              a RX notification.
              </li>
              <li class="itemize">
              <!--l. 123--><p class="noindent" >rx_max_packets: Maximum number of packets
              to receive before a RX notification.</li></ul>
        </li></ul>
  <!--l. 128--><p class="noindent" >Fixes:     <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/141" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/141</a>
  <!--l. 130--><p class="noindent" >Reviewed-by: Jason Wang <jasowang@redhat.com>
  <!--l. 132--><p class="noindent" >Signed-off-by: Alvaro Karsz <alvaro.karsz@solid-run.com>
  <!--l. 134--><p class="noindent" >[CH: fixed commit message]
  <!--l. 136--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 138--><p class="noindent" >See <a 
href="#x1-8070004">7.2.4<!--tex4ht:ref: sec:Conformance / Driver Conformance / Network Driver Conformance --></a>, <a 
href="#x1-8310004">7.3.4<!--tex4ht:ref: sec:Conformance / Device Conformance / Network Device Conformance --></a>, <a 
href="#x1-2700003">5.1.3<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits --></a>, <a 
href="#x1-2710001">5.1.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits / Feature bit requirements --></a>, and <a 
href="#x1-33700010">5.1.8.5.10<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Notifications Coalescing --></a>.                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-10-"><td  style="white-space:normal; text-align:left;" id="TBL-93-10-1"  
class="td11">
 <!--l. 145--><p class="noindent" >abbe8afda8db </td><td  style="white-space:normal; text-align:left;" id="TBL-93-10-2"  
class="td11">
 <!--l. 145--><p class="noindent" >03
  Aug
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-10-3"  
class="td11">
 <!--l. 145--><p class="noindent" >Lei He    </td><td  style="white-space:normal; text-align:left;" id="TBL-93-10-4"  
class="td11">
 <!--l. 145--><p class="noindent" >virtio-crypto: introduce akcipher service
  <!--l. 148--><p class="noindent" >Introduce  akcipher  (asymmetric  key  cipher)  service
  type,   several   asymmetric   algorithms   and   relevent
  information:
  <!--l. 151--><p class="noindent" >- RSA(padding algorithm, ASN.1 schema definition)
  <!--l. 153--><p class="noindent" >- ECDSA(ECC algorithm)
  <!--l. 156--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/129" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/129</a>
  <!--l. 158--><p class="noindent" >Signed-off-by: zhenwei pi <pizhenwei@bytedance.com>
  <!--l. 160--><p class="noindent" >Signed-off-by: Lei He <helei.sig11@bytedance.com>
  <!--l. 162--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 164--><p class="noindent" >See <a 
href="#x1-30001">1.1<!--tex4ht:ref: sec:Normative References --></a>, <a 
href="#x1-4930009">5.9<!--tex4ht:ref: sec:Device Types / Crypto Device --></a>, <a 
href="#x1-4960003">5.9.3<!--tex4ht:ref: sec:Device Types / Crypto Device / Feature bits --></a>, <a 
href="#x1-4970001">5.9.3.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Feature bit requirements --></a>, <a 
href="#x1-4980004">5.9.4<!--tex4ht:ref: sec:Device Types / Crypto Device / Supported crypto services --></a>, <a 
href="#x1-5030005">5.9.4.5<!--tex4ht:ref: sec: Device Types / Crypto Device / Supported crypto services / AKCIPHER services --></a>, <a 
href="#x1-5040005">5.9.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device configuration layout --></a>, <a 
href="#x1-5100001">5.9.7.1<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Operation status --></a>,
  <a 
href="#x1-5110002">5.9.7.2<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue --></a>, <a 
href="#x1-5170005">5.9.7.2.1.5<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Control Virtqueue / Session operation / Session operation: AKCIPHER session --></a>, <a 
href="#x1-5220003">5.9.7.3<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / Data Virtqueue --></a>, and <a 
href="#x1-5350008">5.9.7.8<!--tex4ht:ref: sec:Device Types / Crypto Device / Device Operation / AKCIPHER Service Operation --></a>.                       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-11-"><td  style="white-space:normal; text-align:left;" id="TBL-93-11-1"  
class="td11">
 <!--l. 178--><p class="noindent" >26ed30ccb049 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-11-2"  
class="td11">
 <!--l. 178--><p class="noindent" >03
  Aug
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-11-3"  
class="td11">
 <!--l. 178--><p class="noindent" >Stefano
  Garzarella </td><td  style="white-space:normal; text-align:left;" id="TBL-93-11-4"  
class="td11">
 <!--l. 178--><p class="noindent" >virtio-vsock:                                                    add
  VIRTIO_VSOCK_F_NO_IMPLIED_STREAM   feature
  bit
  <!--l. 181--><p class="noindent" >Initially virtio-vsock only supported the stream type,
  which is why there was no feature. Later we added the
  seqpacket type and in the future we may have other
  types (e.g. datagram).
  <!--l. 185--><p class="noindent" >seqpacket  is  an  extension  of  stream,  so  it  might  be
  implied that if seqpacket is supported, stream is too, but
  this might not be true for other types.
  <!--l. 189--><p class="noindent" >As  we  discussed  here  [1]  should  be  better  to  add
  a   new   VIRTIO_VSOCK_F_NO_IMPLIED_STREAM
  feature bit to avoid this implication.
  <!--l. 192--><p class="noindent" >Let’s also add normative sections to better define the
  behavior
  when  VIRTIO_VSOCK_F_NO_IMPLIED_STREAM  is
  negotiated or not.
  <!--l. 195--><p class="noindent" >[1]     <a 
href="http://markmail.org/message/2s3qd74drgjxkvte" class="url" >http://markmail.org/message/2s3qd74drgjxkvte</a>
  <!--l. 198--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/142" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/142</a>
  <!--l. 200--><p class="noindent" >Suggested-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 202--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 204--><p class="noindent" >Signed-off-by:                Stefano                Garzarella
  <sgarzare@redhat.com>
  <!--l. 206--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 208--><p class="noindent" >See <a 
href="#x1-81500012">7.2.12<!--tex4ht:ref: sec:Conformance / Driver Conformance / Socket Driver Conformance --></a>, <a 
href="#x1-84000013">7.3.13<!--tex4ht:ref: sec:Conformance / Device Conformance / Socket Device Conformance --></a>, and <a 
href="#x1-5410003">5.10.3<!--tex4ht:ref: sec:Device Types / Socket Device / Feature bits --></a>.                                    </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-12-"><td  style="white-space:normal; text-align:left;" id="TBL-93-12-1"  
class="td11">
 <!--l. 213--><p class="noindent" >a7251b0cb4d9 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-12-2"  
class="td11">
 <!--l. 213--><p class="noindent" >14
  Nov
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-12-3"  
class="td11">
 <!--l. 213--><p class="noindent" >Hrishivarya
  Bhageeradhan </td><td  style="white-space:normal; text-align:left;" id="TBL-93-12-4"  
class="td11">
 <!--l. 213--><p class="noindent" >content: reserve device ID 43 for Camera device
  <!--l. 216--><p class="noindent" >The  virtio-camera  device  allows  to  stream  a  camera
  video with ability to change controls, formats and get
  camera  captures.  This  patch  is  to  reserve  the  next
  available device ID for virtio-camera.
  <!--l. 222--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/148" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/148</a>
  <!--l. 224--><p class="noindent" >Signed-off-by:          Hrishivarya          Bhageeradhan
  <hrishivarya.bhageeradhan@opensynergy.com>
  <!--l. 226--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 228--><p class="noindent" >See <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>.                                                                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-13-"><td  style="white-space:normal; text-align:left;" id="TBL-93-13-1"  
class="td11">
 <!--l. 231--><p class="noindent" >b4e8efa0fa6c </td><td  style="white-space:normal; text-align:left;" id="TBL-93-13-2"  
class="td11">
 <!--l. 231--><p class="noindent" >05
  Dec
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-13-3"  
class="td11">
 <!--l. 231--><p class="noindent" >Dmitry
  Fomichev </td><td  style="white-space:normal; text-align:left;" id="TBL-93-13-4"  
class="td11">
 <!--l. 231--><p class="noindent" >virtio-blk: add zoned block device specification
  <!--l. 234--><p class="noindent" >Introduce support for Zoned Block Devices to virtio.
  <!--l. 236--><p class="noindent" >Zoned Block Devices (ZBDs) aim to achieve a better
  capacity, latency and/or cost characteristics compared
  to  commonly  available  block  devices  by  getting  the
  entire  LBA  space  of  the  device  divided  to  block
  regions that are much larger than the LBA size. These
  regions are called zones and they can only be written
  sequentially. More details about ZBDs can be found at
  <!--l. 243--><p class="noindent" >   <a 
href="https://zonedstorage.io/docs/introduction/zoned-storage" class="url" >https://zonedstorage.io/docs/introduction/zoned-storage</a>
  .
  <!--l. 245--><p class="noindent" >In  its  current  form,  the  virtio  protocol  for  block
  devices (virtio-blk) is not aware of ZBDs but it allows
  the  driver  to  successfully  scan  a  host-managed  drive
  provided by the virtio block device. As the result, the
  host-managed drive is recognized by virtio driver as a
  regular, non-zoned drive that will operate erroneously
  under the most common write workloads. Host-aware
  ZBDs are currently usable, but their performance may
  not be optimal because the driver can only see them as
  non-zoned block devices.
  <!--l. 254--><p class="noindent" >To fix this, the virtio-blk protocol needs to be extended
  to add the capabilities to convey the zone characteristics
  of ZBDs at the device side to the driver and to provide
  support  for  ZBD-specific  commands  -  Report  Zones,
  four zone operations (Open, Close, Finish and Reset)
  and (optionally) Zone Append. The proposed standard
  extension aims to define this new functionality.
  <!--l. 261--><p class="noindent" >This  patch  extends  the  virtio-blk  section  of  virtio
  specification  with  the  minimum  set  of  requirements
  that  are  necessary  to  support  ZBDs.  The  resulting
  device  model  is  a  subset  of  the  models  defined  in
  ZAC/ZBC and ZNS standards documents. The included
  functionality  mirrors  the  existing  Linux  kernel  block
  layer ZBD support and should be sufficient to handle
  the host-managed and host-aware HDDs that are on the
  market today as well as ZNS SSDs that are entering the
  market at the time of submission of this patch.
  <!--l. 270--><p class="noindent" >I would like to thank the following people for their useful
  feedback and suggestions while working on the initial
  iterations of this patch.
  <!--l. 273--><p class="noindent" >Damien                          Le                          Moal
  <damien.lemoal@opensource.wdc.com>
  <!--l. 275--><p class="noindent" >Matias Bjørling <Matias.Bjorling@wdc.com>
  <!--l. 277--><p class="noindent" >Niklas Cassel <Niklas.Cassel@wdc.com>
  <!--l. 279--><p class="noindent" >Hans Holmberg <Hans.Holmberg@wdc.com>
  <!--l. 282--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/143" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/143</a>
  <!--l. 284--><p class="noindent" >Signed-off-by:                Dmitry                Fomichev
  <dmitry.fomichev@wdc.com>
  <!--l. 286--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 288--><p class="noindent" >Reviewed-by:            Damien            Le            Moal
  <damien.lemoal@opensource.wdc.com>
  <!--l. 290--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 292--><p class="noindent" >See <a 
href="#x1-3740003">5.2.3<!--tex4ht:ref: sec:Device Types / Block Device / Feature bits --></a>, <a 
href="#x1-3760004">5.2.4<!--tex4ht:ref: sec:Device Types / Block Device / Device configuration layout --></a>, <a 
href="#x1-3780005">5.2.5<!--tex4ht:ref: sec:Device Types / Block Device / Device Initialization --></a>, and <a 
href="#x1-3820006">5.2.6<!--tex4ht:ref: sec:Device Types / Block Device / Device Operation --></a>.                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-14-"><td  style="white-space:normal; text-align:left;" id="TBL-93-14-1"  
class="td11">
 <!--l. 298--><p class="noindent" >985bbf397db4 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-14-2"  
class="td11">
 <!--l. 298--><p class="noindent" >07
  Dec
  2022 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-14-3"  
class="td11">
 <!--l. 298--><p class="noindent" >Xuan
  Zhuo      </td><td  style="white-space:normal; text-align:left;" id="TBL-93-14-4"  
class="td11">
 <!--l. 298--><p class="noindent" >content: reserve device ID 44 for ISM device
  <!--l. 301--><p class="noindent" >The  virtio-ism  device  provides  the  ability  to  share
  memory between different guests on a host. A guest’s
  memory got from ism device can be shared with multiple
  peers at the same time. This shared relationship can be
  dynamically created and released.
  <!--l. 306--><p class="noindent" >The shared memory obtained from the device is divided
  into multiple ism regions for share. ISM device provides
  a  mechanism  to  notify  other  ism  region  referrers  of
  content update events.
  <!--l. 310--><p class="noindent" >This patch is to reserve the next available device ID for
  virtio-ism.
  <!--l. 313--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/150" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/150</a>
  <!--l. 315--><p class="noindent" >Signed-off-by:                    Xuan                    Zhuo
  <xuanzhuo@linux.alibaba.com>
  <!--l. 317--><p class="noindent" >Signed-off-by: Jiang Liu <gerry@linux.alibaba.com>
  <!--l. 319--><p class="noindent" >Signed-off-by: Dust Li <dust.li@linux.alibaba.com>
  <!--l. 321--><p class="noindent" >Signed-off-by: Tony Lu <tonylu@linux.alibaba.com>
  <!--l. 323--><p class="noindent" >Signed-off-by:                     Helin                     Guo
  <helinguo@linux.alibaba.com>
  <!--l. 325--><p class="noindent" >Signed-off-by: Hans Zhang <hans@linux.alibaba.com>
  <!--l. 327--><p class="noindent" >Signed-off-by:                  He                  Rongguang
  <herongguang@linux.alibaba.com>
  <!--l. 329--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 331--><p class="noindent" >See <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>.                                                                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-15-"><td  style="white-space:normal; text-align:left;" id="TBL-93-15-1"  
class="td11">
 <!--l. 334--><p class="noindent" >f2b28698a28a </td><td  style="white-space:normal; text-align:left;" id="TBL-93-15-2"  
class="td11">
 <!--l. 334--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-15-3"  
class="td11">
 <!--l. 334--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-15-4"  
class="td11">
 <!--l. 334--><p class="noindent" >virtio-net:  Maintain  network  device  spec  in  separate
  directory
  <!--l. 337--><p class="noindent" >Move virtio network device specification to its own file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 344--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 346--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 348--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 350--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 352--><p class="noindent" >See <a 
href="#x1-2670001">5.1<!--tex4ht:ref: sec:Device Types / Network Device --></a>, <a 
href="#x1-8310004">7.3.4<!--tex4ht:ref: sec:Conformance / Device Conformance / Network Device Conformance --></a>, and <a 
href="#x1-8070004">7.2.4<!--tex4ht:ref: sec:Conformance / Driver Conformance / Network Driver Conformance --></a>.                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-16-"><td  style="white-space:normal; text-align:left;" id="TBL-93-16-1"  
class="td11">
 <!--l. 357--><p class="noindent" >81694cddc4c1 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-16-2"  
class="td11">
 <!--l. 357--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-16-3"  
class="td11">
 <!--l. 357--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-16-4"  
class="td11">
 <!--l. 357--><p class="noindent" >virtio-net: Fix spelling errors
  <!--l. 360--><p class="noindent" >Fix  two  spelling  errors  in  the  virtio  network  device
  specification.
  <!--l. 362--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 364--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 366--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 368--><p class="noindent" >See <a 
href="#x1-2770005">5.1.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Initialization --></a>, and <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-17-"><td  style="white-space:normal; text-align:left;" id="TBL-93-17-1"  
class="td11">
 <!--l. 372--><p class="noindent" >335342f5cd88 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-17-2"  
class="td11">
 <!--l. 372--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-17-3"  
class="td11">
 <!--l. 372--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-17-4"  
class="td11">
 <!--l. 372--><p class="noindent" >virtio-blk:  Maintain  block  device  spec  in  separate
  directory
  <!--l. 375--><p class="noindent" >Move  virtio  block  device  specification  to  its  own  file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 382--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 384--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 386--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 388--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 390--><p class="noindent" >See <a 
href="#x1-3710002">5.2<!--tex4ht:ref: sec:Device Types / Block Device --></a>, <a 
href="#x1-8320005">7.3.5<!--tex4ht:ref: sec:Conformance / Device Conformance / Block Device Conformance --></a>, and <a 
href="#x1-8080005">7.2.5<!--tex4ht:ref: sec:Conformance / Driver Conformance / Block Driver Conformance --></a>.                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-18-"><td  style="white-space:normal; text-align:left;" id="TBL-93-18-1"  
class="td11">
 <!--l. 395--><p class="noindent" >d3d06187eabb </td><td  style="white-space:normal; text-align:left;" id="TBL-93-18-2"  
class="td11">
 <!--l. 395--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-18-3"  
class="td11">
 <!--l. 395--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-18-4"  
class="td11">
 <!--l. 395--><p class="noindent" >virtio-console: Maintain console device spec in separate
  directory
  <!--l. 398--><p class="noindent" >Move virtio console device specification to its own file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 405--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 407--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 409--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 411--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 413--><p class="noindent" >See <a 
href="#x1-3870003">5.3<!--tex4ht:ref: sec:Device Types / Console Device --></a>, <a 
href="#x1-8330006">7.3.6<!--tex4ht:ref: sec:Conformance / Device Conformance / Console Device Conformance --></a>, and <a 
href="#x1-8090006">7.2.6<!--tex4ht:ref: sec:Conformance / Driver Conformance / Console Driver Conformance --></a>.                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-19-"><td  style="white-space:normal; text-align:left;" id="TBL-93-19-1"  
class="td11">
 <!--l. 418--><p class="noindent" >c71e88e86d35 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-19-2"  
class="td11">
 <!--l. 418--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-19-3"  
class="td11">
 <!--l. 418--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-19-4"  
class="td11">
 <!--l. 418--><p class="noindent" >virtio-entropy: Maintain entropy device spec in separate
  directory
  <!--l. 421--><p class="noindent" >Move virtio entropy device specification to its own file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 428--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 430--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 432--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 434--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 436--><p class="noindent" >See <a 
href="#x1-4020004">5.4<!--tex4ht:ref: sec:Device Types / Entropy Device --></a>, <a 
href="#x1-8340007">7.3.7<!--tex4ht:ref: sec:Conformance / Device Conformance / Entropy Device Conformance --></a>, and <a 
href="#x1-8100007">7.2.7<!--tex4ht:ref: sec:Conformance / Driver Conformance / Entropy Driver Conformance --></a>.                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-20-"><td  style="white-space:normal; text-align:left;" id="TBL-93-20-1"  
class="td11">
 <!--l. 441--><p class="noindent" >c06f3b670dd6 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-20-2"  
class="td11">
 <!--l. 441--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-20-3"  
class="td11">
 <!--l. 441--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-20-4"  
class="td11">
 <!--l. 441--><p class="noindent" >virtio-balloon:  Maintain  mem  balloon  device  spec  in
  separate directory
  <!--l. 444--><p class="noindent" >Move virtio memory balloon device specification to its
  own file similar to recent virtio devices. While at it, place
  device specification, its driver and device conformance
  into  its  own  directory  to  have  self  contained  device
  specification.
  <!--l. 451--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 453--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 455--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 457--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 459--><p class="noindent" >See <a 
href="#x1-4110005">5.5<!--tex4ht:ref: sec:Device Types / Memory Balloon Device --></a>, <a 
href="#x1-8350008">7.3.8<!--tex4ht:ref: sec:Conformance / Device Conformance / Traditional Memory Balloon Device Conformance --></a>, and <a 
href="#x1-8110008">7.2.8<!--tex4ht:ref: sec:Conformance / Driver Conformance / Traditional Memory Balloon Driver Conformance --></a>.                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-21-"><td  style="white-space:normal; text-align:left;" id="TBL-93-21-1"  
class="td11">
 <!--l. 464--><p class="noindent" >d404f1c4e886</td><td  style="white-space:normal; text-align:left;" id="TBL-93-21-2"  
class="td11">
 <!--l. 464--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-21-3"  
class="td11">
 <!--l. 464--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-21-4"  
class="td11">
 <!--l. 464--><p class="noindent" >virtio-scsi: Maintain scsi host device spec in separate
  directory
  <!--l. 467--><p class="noindent" >Move virtio SCSI host device specification to its own file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 474--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 476--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 478--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 480--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 482--><p class="noindent" >See <a 
href="#x1-4400006">5.6<!--tex4ht:ref: sec:Device Types / SCSI Host Device --></a>, <a 
href="#x1-8360009">7.3.9<!--tex4ht:ref: sec:Conformance / Device Conformance / SCSI Host Device Conformance --></a>, and <a 
href="#x1-8120009">7.2.9<!--tex4ht:ref: sec:Conformance / Driver Conformance / SCSI Host Driver Conformance --></a>.                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-22-"><td  style="white-space:normal; text-align:left;" id="TBL-93-22-1"  
class="td11">
 <!--l. 487--><p class="noindent" >442bb643a9ad </td><td  style="white-space:normal; text-align:left;" id="TBL-93-22-2"  
class="td11">
 <!--l. 487--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-22-3"  
class="td11">
 <!--l. 487--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-22-4"  
class="td11">
 <!--l. 487--><p class="noindent" >virtio-gpu:   Maintain   gpu   device   spec   in   separate
  directory
  <!--l. 490--><p class="noindent" >Move  virtio  gpu  device  specification  to  its  own  file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 497--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 499--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 501--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 503--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 505--><p class="noindent" >See <a 
href="#x1-83700010">7.3.10<!--tex4ht:ref: sec:Conformance / Device Conformance / GPU Device Conformance --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-23-"><td  style="white-space:normal; text-align:left;" id="TBL-93-23-1"  
class="td11">
 <!--l. 508--><p class="noindent" >c9686f241819</td><td  style="white-space:normal; text-align:left;" id="TBL-93-23-2"  
class="td11">
 <!--l. 508--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-23-3"  
class="td11">
 <!--l. 508--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-23-4"  
class="td11">
 <!--l. 508--><p class="noindent" >virtio-input:  Maintain  input  device  spec  in  separate
  directory
  <!--l. 511--><p class="noindent" >Move  virtio  input  device  specification  to  its  own  file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 518--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 520--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 522--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 524--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 526--><p class="noindent" >See <a 
href="#x1-83800011">7.3.11<!--tex4ht:ref: sec:Conformance / Device Conformance / Input Device Conformance --></a>, and <a 
href="#x1-81300010">7.2.10<!--tex4ht:ref: sec:Conformance / Driver Conformance / Input Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-24-"><td  style="white-space:normal; text-align:left;" id="TBL-93-24-1"  
class="td11">
 <!--l. 530--><p class="noindent" >8463bba27c79 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-24-2"  
class="td11">
 <!--l. 530--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-24-3"  
class="td11">
 <!--l. 530--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-24-4"  
class="td11">
 <!--l. 530--><p class="noindent" >virtio-crypto: Maintain crypto device spec in separate
  directory
  <!--l. 533--><p class="noindent" >Move virtio crypto device specification to its own file
  similar to recent virtio devices. While at it, place device
  specification, its driver and device conformance into its
  own directory to have self contained device specification.
  <!--l. 540--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 542--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 544--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 546--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 548--><p class="noindent" >See <a 
href="#x1-83900012">7.3.12<!--tex4ht:ref: sec:Conformance / Device Conformance / Crypto Device Conformance --></a>, and <a 
href="#x1-81400011">7.2.11<!--tex4ht:ref: sec:Conformance / Driver Conformance / Crypto Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-25-"><td  style="white-space:normal; text-align:left;" id="TBL-93-25-1"  
class="td11">
 <!--l. 552--><p class="noindent" >828754b98e3b </td><td  style="white-space:normal; text-align:left;" id="TBL-93-25-2"  
class="td11">
 <!--l. 552--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-25-3"  
class="td11">
 <!--l. 552--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-25-4"  
class="td11">
 <!--l. 552--><p class="noindent" >virtio-vsock:  Maintain  socket  device  spec  in  separate
  directory
  <!--l. 555--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 560--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 562--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 564--><p class="noindent" >Reviewed-by:                Stefano                Garzarella
  <sgarzare@redhat.com>
  <!--l. 566--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 568--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 570--><p class="noindent" >See <a 
href="#x1-84000013">7.3.13<!--tex4ht:ref: sec:Conformance / Device Conformance / Socket Device Conformance --></a>, and <a 
href="#x1-81500012">7.2.12<!--tex4ht:ref: sec:Conformance / Driver Conformance / Socket Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-26-"><td  style="white-space:normal; text-align:left;" id="TBL-93-26-1"  
class="td11">
 <!--l. 574--><p class="noindent" >8632f80e251f </td><td  style="white-space:normal; text-align:left;" id="TBL-93-26-2"  
class="td11">
 <!--l. 574--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-26-3"  
class="td11">
 <!--l. 574--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-26-4"  
class="td11">
 <!--l. 574--><p class="noindent" >virtio-fs: Maintain file system device spec in separate
  directory
  <!--l. 577--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 582--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 584--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 586--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 588--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 590--><p class="noindent" >See <a 
href="#x1-84100014">7.3.14<!--tex4ht:ref: sec:Conformance / Device Conformance / File System Device Conformance --></a>, and <a 
href="#x1-81600013">7.2.13<!--tex4ht:ref: sec:Conformance / Driver Conformance / File System Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-27-"><td  style="white-space:normal; text-align:left;" id="TBL-93-27-1"  
class="td11">
 <!--l. 594--><p class="noindent" >b067de47a506 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-27-2"  
class="td11">
 <!--l. 594--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-27-3"  
class="td11">
 <!--l. 594--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-27-4"  
class="td11">
 <!--l. 594--><p class="noindent" >virtio-rpmb:  Maintain  rpmb  device  spec  in  separate
  directory
  <!--l. 597--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 602--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 604--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 606--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 608--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 610--><p class="noindent" >See <a 
href="#x1-84200015">7.3.15<!--tex4ht:ref: sec:Conformance / Device Conformance / RPMB Device Conformance --></a>, and <a 
href="#x1-81700014">7.2.14<!--tex4ht:ref: sec:Conformance / Driver Conformance / RPMB Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-28-"><td  style="white-space:normal; text-align:left;" id="TBL-93-28-1"  
class="td11">
 <!--l. 614--><p class="noindent" >b1cf73e96173</td><td  style="white-space:normal; text-align:left;" id="TBL-93-28-2"  
class="td11">
 <!--l. 614--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-28-3"  
class="td11">
 <!--l. 614--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-28-4"  
class="td11">
 <!--l. 614--><p class="noindent" >virtio-iommu: Maintain iommu device spec in separate
  directory
  <!--l. 617--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 622--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 624--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 626--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 628--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 630--><p class="noindent" >See <a 
href="#x1-84300016">7.3.16<!--tex4ht:ref: sec:Conformance / Device Conformance / IOMMU Device Conformance --></a>, and <a 
href="#x1-81800015">7.2.15<!--tex4ht:ref: sec:Conformance / Driver Conformance / IOMMU Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-29-"><td  style="white-space:normal; text-align:left;" id="TBL-93-29-1"  
class="td11">
 <!--l. 634--><p class="noindent" >6813e3cc271e </td><td  style="white-space:normal; text-align:left;" id="TBL-93-29-2"  
class="td11">
 <!--l. 634--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-29-3"  
class="td11">
 <!--l. 634--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-29-4"  
class="td11">
 <!--l. 634--><p class="noindent" >virtio-sound:  Maintain  sound  device  spec  in  separate
  directory
  <!--l. 637--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 642--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 644--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 646--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 648--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 650--><p class="noindent" >See <a 
href="#x1-84400017">7.3.17<!--tex4ht:ref: sec:Conformance / Device Conformance / Sound Device Conformance --></a>, and <a 
href="#x1-81900016">7.2.16<!--tex4ht:ref: sec:Conformance / Driver Conformance / Sound Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-30-"><td  style="white-space:normal; text-align:left;" id="TBL-93-30-1"  
class="td11">
 <!--l. 654--><p class="noindent" >5042a5031502 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-30-2"  
class="td11">
 <!--l. 654--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-30-3"  
class="td11">
 <!--l. 654--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-30-4"  
class="td11">
 <!--l. 654--><p class="noindent" >virtio-mem: Maintain memory device spec in separate
  directory
  <!--l. 657--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 662--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 664--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 666--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 668--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 670--><p class="noindent" >See <a 
href="#x1-84500018">7.3.18<!--tex4ht:ref: sec:Conformance / Device Conformance / Memory Device Conformance --></a>, and <a 
href="#x1-82000017">7.2.17<!--tex4ht:ref: sec:Conformance / Driver Conformance / Memory Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-31-"><td  style="white-space:normal; text-align:left;" id="TBL-93-31-1"  
class="td11">
 <!--l. 674--><p class="noindent" >00b9935238bf </td><td  style="white-space:normal; text-align:left;" id="TBL-93-31-2"  
class="td11">
 <!--l. 674--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-31-3"  
class="td11">
 <!--l. 674--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-31-4"  
class="td11">
 <!--l. 674--><p class="noindent" >virtio-i2c: Maintain i2c device spec in separate directory
  <!--l. 677--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 682--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 684--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 686--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 688--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 690--><p class="noindent" >See <a 
href="#x1-84600019">7.3.19<!--tex4ht:ref: sec:Conformance / Device Conformance / I2C Adapter Device Conformance --></a>, and <a 
href="#x1-82100018">7.2.18<!--tex4ht:ref: sec:Conformance / Driver Conformance / I2C Adapter Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-32-"><td  style="white-space:normal; text-align:left;" id="TBL-93-32-1"  
class="td11">
 <!--l. 694--><p class="noindent" >674489b191ab </td><td  style="white-space:normal; text-align:left;" id="TBL-93-32-2"  
class="td11">
 <!--l. 694--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-32-3"  
class="td11">
 <!--l. 694--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-32-4"  
class="td11">
 <!--l. 694--><p class="noindent" >virtio-scmi:  Maintain  scmi  device  spec  in  separate
  directory
  <!--l. 697--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 702--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 704--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 706--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 708--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 710--><p class="noindent" >See <a 
href="#x1-84700020">7.3.20<!--tex4ht:ref: sec:Conformance / Device Conformance / SCMI Device Conformance --></a>, and <a 
href="#x1-82200019">7.2.19<!--tex4ht:ref: sec:Conformance / Driver Conformance / SCMI Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-33-"><td  style="white-space:normal; text-align:left;" id="TBL-93-33-1"  
class="td11">
 <!--l. 714--><p class="noindent" >6c9c04d2bf5e</td><td  style="white-space:normal; text-align:left;" id="TBL-93-33-2"  
class="td11">
 <!--l. 714--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-33-3"  
class="td11">
 <!--l. 714--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-33-4"  
class="td11">
 <!--l. 714--><p class="noindent" >virtio-gpio:  Maintain  gpio  device  spec  in  separate
  directory
  <!--l. 717--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 722--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 724--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 726--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 728--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 730--><p class="noindent" >See <a 
href="#x1-84800021">7.3.21<!--tex4ht:ref: sec:Conformance / Device Conformance / GPIO Device Conformance --></a>, and <a 
href="#x1-82300020">7.2.20<!--tex4ht:ref: sec:Conformance / Driver Conformance / GPIO Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-34-"><td  style="white-space:normal; text-align:left;" id="TBL-93-34-1"  
class="td11">
 <!--l. 734--><p class="noindent" >d04d253b1055 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-34-2"  
class="td11">
 <!--l. 734--><p class="noindent" >30
  Jan
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-34-3"  
class="td11">
 <!--l. 734--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-34-4"  
class="td11">
 <!--l. 734--><p class="noindent" >virtio-pmem: Maintain pmem device spec in separate
  directory
  <!--l. 737--><p class="noindent" >Place   device   specification,   its   driver   and   device
  conformance into its own directory to have self contained
  device specification.
  <!--l. 742--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/153" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/153</a>
  <!--l. 744--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 746--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 748--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 750--><p class="noindent" >See <a 
href="#x1-84900022">7.3.22<!--tex4ht:ref: sec:Conformance / Device Conformance / PMEM Device Conformance --></a>, and <a 
href="#x1-82400021">7.2.21<!--tex4ht:ref: sec:Conformance / Driver Conformance / PMEM Driver Conformance --></a>.                                             </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-35-"><td  style="white-space:normal; text-align:left;" id="TBL-93-35-1"  
class="td11">
 <!--l. 754--><p class="noindent" >b1fb6b62495f </td><td  style="white-space:normal; text-align:left;" id="TBL-93-35-2"  
class="td11">
 <!--l. 754--><p class="noindent" >02
  Feb
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-35-3"  
class="td11">
 <!--l. 754--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-35-4"  
class="td11">
 <!--l. 754--><p class="noindent" >virtio-net: Clarify VLAN filter table configuration
  <!--l. 757--><p class="noindent" >The filtering behavior of the VLAN filter commands is
  not very clear as discussed in thread [1].
  <!--l. 760--><p class="noindent" >Hence,  add  the  command  description  and  device
  requirements for it.
  <!--l. 762--><p class="noindent" >[1]   <a 
href="https://lists.oasis-open.org/archives/virtio-dev/202301/msg00210.html" class="url" >https://lists.oasis-open.org/archives/virtio-dev/202301/msg00210.html</a>
  <!--l. 765--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/147" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/147</a>
  <!--l. 767--><p class="noindent" >Suggested-by: Si-Wei Liu <si-wei.liu@oracle.com>
  <!--l. 769--><p class="noindent" >Reviewed-by: Si-Wei Liu <si-wei.liu@oracle.com>
  <!--l. 771--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 773--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 775--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 777--><p class="noindent" >See <a 
href="#x1-3120003">5.1.8.5.3<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / VLAN Filtering --></a>, <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>, and <a 
href="#x1-8310004">7.3.4<!--tex4ht:ref: sec:Conformance / Device Conformance / Network Device Conformance --></a>.                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-36-"><td  style="white-space:normal; text-align:left;" id="TBL-93-36-1"  
class="td11">
 <!--l. 782--><p class="noindent" >53b0cb13169c </td><td  style="white-space:normal; text-align:left;" id="TBL-93-36-2"  
class="td11">
 <!--l. 782--><p class="noindent" >02
  Feb
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-36-3"  
class="td11">
 <!--l. 782--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-36-4"  
class="td11">
 <!--l. 782--><p class="noindent" >virtio-net: Avoid confusing device configuration text
  <!--l. 785--><p class="noindent" >The added text in commit of Fixes tag was redundant
  and confusing in context of VLAN filtering description.
  <!--l. 788--><p class="noindent" >Hence remove it as discussed in [1] and [2].
  <!--l. 790--><p class="noindent" >[1]   <a 
href="https://lists.oasis-open.org/archives/virtio-dev/202301/msg00282.html" class="url" >https://lists.oasis-open.org/archives/virtio-dev/202301/msg00282.html</a>
  [2]   <a 
href="https://lists.oasis-open.org/archives/virtio-dev/202301/msg00286.html" class="url" >https://lists.oasis-open.org/archives/virtio-dev/202301/msg00286.html</a>
  <!--l. 794--><p class="noindent" >Fixes:  296303444f6b  ("virtio-net:  Clarify  VLAN  filter
  table configuration")
  <!--l. 796--><p class="noindent" >Suggested-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 798--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 800--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 802--><p class="noindent" >[CH: applied as editorial change]
  <!--l. 804--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 806--><p class="noindent" >See <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-37-"><td  style="white-space:normal; text-align:left;" id="TBL-93-37-1"  
class="td11">
 <!--l. 809--><p class="noindent" >3b9b6acb0936 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-37-2"  
class="td11">
 <!--l. 809--><p class="noindent" >09
  Feb
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-37-3"  
class="td11">
 <!--l. 809--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-37-4"  
class="td11">
 <!--l. 809--><p class="noindent" >audio->sound
  <!--l. 812--><p class="noindent" >Spec calls the device "sound device". Make the name in
  the ID section match.
  <!--l. 816--><p class="noindent" >MST: applied as editorial change.
  <!--l. 818--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 820--><p class="noindent" >Reviewed-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 822--><p class="noindent" >See <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>.                                                                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-38-"><td  style="white-space:normal; text-align:left;" id="TBL-93-38-1"  
class="td11">
 <!--l. 825--><p class="noindent" >0ce03bc6995a </td><td  style="white-space:normal; text-align:left;" id="TBL-93-38-2"  
class="td11">
 <!--l. 825--><p class="noindent" >14
  Feb
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-38-3"  
class="td11">
 <!--l. 825--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-38-4"  
class="td11">
 <!--l. 825--><p class="noindent" >virtio-net: Avoid confusion between a card and a device
  <!--l. 828--><p class="noindent" >Historically virtio network device is documented as an
  Ethernet  card.  A  modern  card  in  the  industry  has
  one to multiple ports, one to multiple PCI functions.
  However the virtio network device is usually just a single
  link/port network interface controller.
  <!--l. 833--><p class="noindent" >Hence, avoid this confusing term ’card’ and align the
  specification to adhere to widely used specification term
  as ’device’ used for all virtio device types.
  <!--l. 837--><p class="noindent" >Replaced ’card’ with ’network interface controller’.
  <!--l. 840--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/154" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/154</a>
  <!--l. 842--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 844--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 846--><p class="noindent" >See <a 
href="#x1-1650002">4.1.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Discovery --></a>, <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>, <a 
href="#x1-2670001">5.1<!--tex4ht:ref: sec:Device Types / Network Device --></a>, <a 
href="#x1-2700003">5.1.3<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits --></a>, and <a 
href="#x1-2770005">5.1.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Initialization --></a>.                               </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-39-"><td  style="white-space:normal; text-align:left;" id="TBL-93-39-1"  
class="td11">
 <!--l. 853--><p class="noindent" >be2ce1ee17e0</td><td  style="white-space:normal; text-align:left;" id="TBL-93-39-2"  
class="td11">
 <!--l. 853--><p class="noindent" >15
  Feb
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-39-3"  
class="td11">
 <!--l. 853--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-39-4"  
class="td11">
 <!--l. 853--><p class="noindent" >content.tex Fix Driver notifications label
  <!--l. 856--><p class="noindent" >Driver notifications section is under "Basic Facilities of
  a  Virtio  Device".  However,  the  label  is  placed  under
  "Virtqueues" section.
  <!--l. 859--><p class="noindent" >Fix the label references.
  <!--l. 861--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 863--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 865--><p class="noindent" >[CH: pushed as an editorial update]
  <!--l. 867--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 869--><p class="noindent" >See <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-40-"><td  style="white-space:normal; text-align:left;" id="TBL-93-40-1"  
class="td11">
 <!--l. 872--><p class="noindent" >2ea4627093fb </td><td  style="white-space:normal; text-align:left;" id="TBL-93-40-2"  
class="td11">
 <!--l. 872--><p class="noindent" >20
  Feb
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-40-3"  
class="td11">
 <!--l. 872--><p class="noindent" >Alvaro
  Karsz     </td><td  style="white-space:normal; text-align:left;" id="TBL-93-40-4"  
class="td11">
 <!--l. 872--><p class="noindent" >virtio-net:  Mention  VIRTIO_NET_F_HASH_REPORT
  dependency on VIRTIO_NET_F_CTRL_VQ
  <!--l. 875--><p class="noindent" >If  the  VIRTIO_NET_F_HASH_REPORT  feature  is
  negotiated,                       the                       driver
  may  send  VIRTIO_NET_CTRL_MQ_HASH_CONFIG
  commands,  thus,  the  control  VQ  feature  should  be
  negotiated.
  <!--l. 880--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/158" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/158</a>
  <!--l. 882--><p class="noindent" >Signed-off-by:                   Alvaro                   Karsz
  <alvaro.karsz@solid-run.com>
  <!--l. 884--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 886--><p class="noindent" >See <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-41-"><td  style="white-space:normal; text-align:left;" id="TBL-93-41-1"  
class="td11">
 <!--l. 889--><p class="noindent" >73ce5bb02003 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-41-2"  
class="td11">
 <!--l. 889--><p class="noindent" >01
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-41-3"  
class="td11">
 <!--l. 889--><p class="noindent" >Alvaro
  Karsz     </td><td  style="white-space:normal; text-align:left;" id="TBL-93-41-4"  
class="td11">
 <!--l. 889--><p class="noindent" >virtio-net:              Fix              and              update
  VIRTIO_NET_F_NOTF_COAL feature
  <!--l. 892--><p class="noindent" >This   patch   makes   several   improvements   to   the
  notification coalescing feature, including:
        <ul class="itemize1">
        <li class="itemize">
        <!--l. 897--><p class="noindent" >Consolidating                   virtio_net_ctrl_coal_tx
        and  virtio_net_ctrl_coal_rx  into  a  single  struct,
        virtio_net_ctrl_coal, as they are identical.
        </li>
        <li class="itemize">
        <!--l. 900--><p class="noindent" >Emphasizing  that  the  coalescing  commands  are
        best-effort.
        </li>
        <li class="itemize">
        <!--l. 902--><p class="noindent" >Defining the behavior of coalescing with regards to
        delivering notifications when a change occur.
        </li>
        <li class="itemize">
        <!--l. 905--><p class="noindent" >Stating that the commands should apply to all the
        receive/transmit virtqueues.
        </li>
        <li class="itemize">
        <!--l. 908--><p class="noindent" >Stating   that   every   receive/transmit   virtqueue
        should count it’s own packets.
        </li>
        <li class="itemize">
        <!--l. 911--><p class="noindent" >A  new  intro  explaining  the  entire  coalescing
        operation.
        </li></ul>
  <!--l. 916--><p class="noindent" >Fixes:     <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/159" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/159</a>
  <!--l. 918--><p class="noindent" >Signed-off-by: Alvaro Karsz <alvaro.karsz@solid-run.com>
  <!--l. 920--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
  <!--l. 922--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 924--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 926--><p class="noindent" >See <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-42-"><td  style="white-space:normal; text-align:left;" id="TBL-93-42-1"  
class="td11">
 <!--l. 929--><p class="noindent" >3508347769af </td><td  style="white-space:normal; text-align:left;" id="TBL-93-42-2"  
class="td11">
 <!--l. 929--><p class="noindent" >01
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-42-3"  
class="td11">
 <!--l. 929--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-42-4"  
class="td11">
 <!--l. 929--><p class="noindent" >virtio-net: Improve introductory description
  <!--l. 932--><p class="noindent" >The  control  VQ  of  the  virtio  network  device  is  used
  beyond  advance  steering  control.  The  control  VQ
  dynamically changes multiple features of the initialized
  device.
  <!--l. 936--><p class="noindent" >Hence,  update  this  area  of  control  VQ  introductory
  description at few places and also place the link to its
  description.
  <!--l. 939--><p class="noindent" >Also update the introduction section to better describe
  receive and transmit virtqueues.
  <!--l. 943--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/156" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/156</a>
  <!--l. 945--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 947--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 949--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 951--><p class="noindent" >See <a 
href="#x1-2670001">5.1<!--tex4ht:ref: sec:Device Types / Network Device --></a>, <a 
href="#x1-2690002">5.1.2<!--tex4ht:ref: sec:Device Types / Network Device / Virtqueues --></a>, and <a 
href="#x1-2800008">5.1.8<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation --></a>.                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-43-"><td  style="white-space:normal; text-align:left;" id="TBL-93-43-1"  
class="td11">
 <!--l. 956--><p class="noindent" >91a469991433 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-43-2"  
class="td11">
 <!--l. 956--><p class="noindent" >10
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-43-3"  
class="td11">
 <!--l. 956--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-43-4"  
class="td11">
 <!--l. 956--><p class="noindent" >transport-pci: Split PCI transport to its own file
  <!--l. 959--><p class="noindent" >Place PCI transport specification in its own file to better
  maintain it.
  <!--l. 962--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/157" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/157</a>
  <!--l. 964--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 966--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 968--><p class="noindent" >See <a 
href="#x1-1630001">4.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-44-"><td  style="white-space:normal; text-align:left;" id="TBL-93-44-1"  
class="td11">
 <!--l. 971--><p class="noindent" >9e88ba9c47d0 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-44-2"  
class="td11">
 <!--l. 971--><p class="noindent" >10
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-44-3"  
class="td11">
 <!--l. 971--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-44-4"  
class="td11">
 <!--l. 971--><p class="noindent" >transport-mmio: Split MMIO transport to its own file
  <!--l. 974--><p class="noindent" >Place MMIO transport specification in its own file to
  better maintain it.
  <!--l. 977--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/157" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/157</a>
  <!--l. 979--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 981--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 983--><p class="noindent" >See <a 
href="#x1-2130002">4.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-45-"><td  style="white-space:normal; text-align:left;" id="TBL-93-45-1"  
class="td11">
 <!--l. 986--><p class="noindent" >0af264f9d4ea</td><td  style="white-space:normal; text-align:left;" id="TBL-93-45-2"  
class="td11">
 <!--l. 986--><p class="noindent" >10
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-45-3"  
class="td11">
 <!--l. 986--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-45-4"  
class="td11">
 <!--l. 986--><p class="noindent" >transport-ccw: Split Channel IO transport to its own file
  <!--l. 989--><p class="noindent" >Place Channel IO transport specification in its own file
  to better maintain it.
  <!--l. 993--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/157" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/157</a>
  <!--l. 995--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 997--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 999--><p class="noindent" >See <a 
href="#x1-2270003">4.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over Channel I/O --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-46-"><td  style="white-space:normal; text-align:left;" id="TBL-93-46-1"  
class="td11">
 <!--l. 1002--><p class="noindent" >deb0aa0c7faa </td><td  style="white-space:normal; text-align:left;" id="TBL-93-46-2"  
class="td11">
 <!--l. 1002--><p class="noindent" >10
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-46-3"  
class="td11">
 <!--l. 1002--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-46-4"  
class="td11">
 <!--l. 1002--><p class="noindent" >transport-pci: Fix spellings and white spaces
  <!--l. 1005--><p class="noindent" >Now that we have individual files, fix reported spelling
  errors.
  <!--l. 1007--><p class="noindent" >While at it, remove trailing white spaces.
  <!--l. 1010--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/157" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/157</a>
  <!--l. 1012--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1014--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1016--><p class="noindent" >See <a 
href="#x1-1630001">4.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a>, <a 
href="#x1-1800005">4.1.4.5<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / ISR status capability --></a>, and <a 
href="#x1-1970001">4.1.5.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Device Initialization --></a>.                                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-47-"><td  style="white-space:normal; text-align:left;" id="TBL-93-47-1"  
class="td11">
 <!--l. 1021--><p class="noindent" >ca97719ea35e </td><td  style="white-space:normal; text-align:left;" id="TBL-93-47-2"  
class="td11">
 <!--l. 1021--><p class="noindent" >10
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-47-3"  
class="td11">
 <!--l. 1021--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-47-4"  
class="td11">
 <!--l. 1021--><p class="noindent" >transport-mmio: Fix spellings and white spaces
  <!--l. 1024--><p class="noindent" >Now that we have individual files, fix reported spelling
  errors.
  <!--l. 1026--><p class="noindent" >While at it, remove trailing white spaces.
  <!--l. 1029--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/157" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/157</a>
  <!--l. 1031--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1033--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1035--><p class="noindent" >See <a 
href="#x1-2150002">4.2.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a>, and <a 
href="#x1-2250004">4.2.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Legacy interface --></a>.                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-48-"><td  style="white-space:normal; text-align:left;" id="TBL-93-48-1"  
class="td11">
 <!--l. 1039--><p class="noindent" >8797f4d4e410 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-48-2"  
class="td11">
 <!--l. 1039--><p class="noindent" >10
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-48-3"  
class="td11">
 <!--l. 1039--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-48-4"  
class="td11">
 <!--l. 1039--><p class="noindent" >transport-ccw: Fix spellings and white spaces
  <!--l. 1042--><p class="noindent" >Now that we have individual files, fix reported spelling
  errors.
  <!--l. 1044--><p class="noindent" >While at it, remove extra white spaces.
  <!--l. 1047--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/157" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/157</a>
  <!--l. 1049--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1051--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1053--><p class="noindent" >See <a 
href="#x1-2280001">4.3.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Basic Concepts --></a>, <a 
href="#x1-2300002">4.3.1.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Basic Concepts/ Notifications --></a>, <a 
href="#x1-2460006">4.3.2.6<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Setting Up Indicators --></a>, and <a 
href="#x1-2590002">4.3.3.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Operation / Guest->Host Notification --></a>.                         </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-49-"><td  style="white-space:normal; text-align:left;" id="TBL-93-49-1"  
class="td11">
 <!--l. 1059--><p class="noindent" >d3f832b6605d </td><td  style="white-space:normal; text-align:left;" id="TBL-93-49-2"  
class="td11">
 <!--l. 1059--><p class="noindent" >15
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-49-3"  
class="td11">
 <!--l. 1059--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-49-4"  
class="td11">
 <!--l. 1059--><p class="noindent" >virtio-net: Describe dev cfg fields read only
  <!--l. 1062--><p class="noindent" >Device   configuration   fields   are   read   only.   Avoid
  duplicating this description for multiple fields.
  <!--l. 1065--><p class="noindent" >Instead  describe  it  one  time  and  do  it  in  the  driver
  requirements section.
  <!--l. 1069--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/161" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/161</a>
  <!--l. 1071--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1073--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1075--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1077--><p class="noindent" >See <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-50-"><td  style="white-space:normal; text-align:left;" id="TBL-93-50-1"  
class="td11">
 <!--l. 1080--><p class="noindent" >115ceb97f813</td><td  style="white-space:normal; text-align:left;" id="TBL-93-50-2"  
class="td11">
 <!--l. 1080--><p class="noindent" >15
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-50-3"  
class="td11">
 <!--l. 1080--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-50-4"  
class="td11">
 <!--l. 1080--><p class="noindent" >virtio-net: Define cfg fields before description
  <!--l. 1083--><p class="noindent" >Currently some fields of the virtio_net_config structure
  are defined before introducing the structure and some
  are  defined  after.  Better  to  define  the  configuration
  layout first followed by description of all the fields.
  <!--l. 1088--><p class="noindent" >Device configuration fields are described in the section.
  Change wording from ’listed’ to ’described’ as suggested
  in patch [1].
  <!--l. 1091--><p class="noindent" >[1]   <a 
href="https://lists.oasis-open.org/archives/virtio-dev/202302/msg00004.html" class="url" >https://lists.oasis-open.org/archives/virtio-dev/202302/msg00004.html</a>
  <!--l. 1094--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/161" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/161</a>
  <!--l. 1096--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1098--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1100--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1102--><p class="noindent" >See <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-51-"><td  style="white-space:normal; text-align:left;" id="TBL-93-51-1"  
class="td11">
 <!--l. 1105--><p class="noindent" >2d1d8dfa3474 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-51-2"  
class="td11">
 <!--l. 1105--><p class="noindent" >15
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-51-3"  
class="td11">
 <!--l. 1105--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-51-4"  
class="td11">
 <!--l. 1105--><p class="noindent" >virtio-net: Fix virtqueues spelling error
  <!--l. 1108--><p class="noindent" >Correct spelling from virtqueus to virtqueues.
  <!--l. 1110--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1112--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1114--><p class="noindent" >Reviewed-by: Jiri Pirko <jiri@nvidia.com>
  <!--l. 1116--><p class="noindent" >[CH: pushed as editorial update]
  <!--l. 1118--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1120--><p class="noindent" >See <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-52-"><td  style="white-space:normal; text-align:left;" id="TBL-93-52-1"  
class="td11">
 <!--l. 1123--><p class="noindent" >2d5495083c12 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-52-2"  
class="td11">
 <!--l. 1123--><p class="noindent" >15
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-52-3"  
class="td11">
 <!--l. 1123--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-52-4"  
class="td11">
 <!--l. 1123--><p class="noindent" >transport-pci: Remove duplicate word structure
  <!--l. 1126--><p class="noindent" >Remove duplicate word structure.
  <!--l. 1128--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1130--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1132--><p class="noindent" >Reviewed-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1134--><p class="noindent" >Reviewed-by: Jiri Pirko <jiri@nvidia.com>
  <!--l. 1136--><p class="noindent" >[CH: pushed as editorial update]
  <!--l. 1138--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1140--><p class="noindent" >See <a 
href="#x1-19300010">4.1.4.10<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Legacy Interfaces: A Note on PCI Device Layout --></a>.                                                          </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-53-"><td  style="white-space:normal; text-align:left;" id="TBL-93-53-1"  
class="td11">
 <!--l. 1143--><p class="noindent" >b0414098602f </td><td  style="white-space:normal; text-align:left;" id="TBL-93-53-2"  
class="td11">
 <!--l. 1143--><p class="noindent" >15
  Mar
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-53-3"  
class="td11">
 <!--l. 1143--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-53-4"  
class="td11">
 <!--l. 1143--><p class="noindent" >virtio-blk: Define dev cfg layout before its fields
  <!--l. 1146--><p class="noindent" >Define  device  configuration  layout  structure  before
  describing its individual fields.
  <!--l. 1149--><p class="noindent" >This is an editorial change.
  <!--l. 1151--><p class="noindent" >Suggested-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1153--><p class="noindent" >Reviewed-by:                   Max                   Gurtovoy
  <mgurtovoy@nvidia.com>
  <!--l. 1155--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1157--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1159--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1161--><p class="noindent" >See <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-54-"><td  style="white-space:normal; text-align:left;" id="TBL-93-54-1"  
class="td11">
 <!--l. 1164--><p class="noindent" >380ed02bdb88 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-54-2"  
class="td11">
 <!--l. 1164--><p class="noindent" >04
  Apr
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-54-3"  
class="td11">
 <!--l. 1164--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-54-4"  
class="td11">
 <!--l. 1164--><p class="noindent" >transport-pci: Remove empty line at end of file
  <!--l. 1167--><p class="noindent" >Remove empty line at end of file.
  <!--l. 1169--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1171--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1173--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1175--><p class="noindent" >See <a 
href="#x1-1630001">4.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-55-"><td  style="white-space:normal; text-align:left;" id="TBL-93-55-1"  
class="td11">
 <!--l. 1178--><p class="noindent" >1ed0754c6134 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-55-2"  
class="td11">
 <!--l. 1178--><p class="noindent" >11
  Apr
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-55-3"  
class="td11">
 <!--l. 1178--><p class="noindent" >Heng
  Qi         </td><td  style="white-space:normal; text-align:left;" id="TBL-93-55-4"  
class="td11">
 <!--l. 1178--><p class="noindent" >virtio-net: support the virtqueue coalescing moderation
  <!--l. 1181--><p class="noindent" >Currently,  coalescing  parameters  are  grouped  for  all
  transmit and receive virtqueues. This patch supports
  setting  or  getting  the  parameters  for  a  specified
  virtqueue, and a typical application of this function is
  netdim[1].
  <!--l. 1185--><p class="noindent" >When the traffic between virtqueues is unbalanced, for
  example, one virtqueue is busy and another virtqueue
  is idle, then it will be very useful to control coalescing
  parameters at the virtqueue granularity.
  <!--l. 1189--><p class="noindent" >[1]     <a 
href="https://docs.kernel.org/networking/net_dim.html" class="url" >https://docs.kernel.org/networking/net_dim.html</a>
  <!--l. 1192--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/166" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/166</a>
  <!--l. 1194--><p class="noindent" >Signed-off-by: Heng Qi <hengqi@linux.alibaba.com>
  <!--l. 1196--><p class="noindent" >Reviewed-by:                     Xuan                     Zhuo
  <xuanzhuo@linux.alibaba.com>
  <!--l. 1198--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1200--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1202--><p class="noindent" >See <a 
href="#x1-2700003">5.1.3<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits --></a>, <a 
href="#x1-2710001">5.1.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits / Feature bit requirements --></a>, and <a 
href="#x1-33700010">5.1.8.5.10<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue / Notifications Coalescing --></a>.                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-56-"><td  style="white-space:normal; text-align:left;" id="TBL-93-56-1"  
class="td11">
 <!--l. 1207--><p class="noindent" >362ebd007271 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-56-2"  
class="td11">
 <!--l. 1207--><p class="noindent" >11
  Apr
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-56-3"  
class="td11">
 <!--l. 1207--><p class="noindent" >Alvaro
  Karsz     </td><td  style="white-space:normal; text-align:left;" id="TBL-93-56-4"  
class="td11">
 <!--l. 1207--><p class="noindent" >virtio-net:                        define                        the
  VIRTIO_NET_F_CTRL_RX_EXTRA feature bit
  <!--l. 1210--><p class="noindent" >The VIRTIO_NET_F_CTRL_RX_EXTRA feature bit is
  mentioned  in  the  spec  since  version  1.0,  but  it’s  not
  properly defined.
  <!--l. 1213--><p class="noindent" >This  patch  defines  the  feature  bit  and  defines  the
  dependency on VIRTIO_NET_F_CTRL_VQ.
  <!--l. 1215--><p class="noindent" >Since this dependency is missing in previous versions,
  we add it now as a "SHOULD".
  <!--l. 1219--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/162" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/162</a>
  <!--l. 1221--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1223--><p class="noindent" >Signed-off-by:                   Alvaro                   Karsz
  <alvaro.karsz@solid-run.com>
  <!--l. 1225--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1227--><p class="noindent" >See <a 
href="#x1-2700003">5.1.3<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits --></a>, and <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>.                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-57-"><td  style="white-space:normal; text-align:left;" id="TBL-93-57-1"  
class="td11">
 <!--l. 1231--><p class="noindent" >d3b2a19bc369 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-57-2"  
class="td11">
 <!--l. 1231--><p class="noindent" >21
  Apr
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-57-3"  
class="td11">
 <!--l. 1231--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-57-4"  
class="td11">
 <!--l. 1231--><p class="noindent" >device-types/multiple: replace queues with enqueues
  <!--l. 1234--><p class="noindent" >Queue  is  a  verb  and  noun  both.  Replacing  it  with
  enqueue avoids ambiguity around plural queues noun vs
  verb; similar to virtio fs device description.
  <!--l. 1239--><p class="noindent" >Acked-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1241--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1243--><p class="noindent" >[CH: pushed as editorial update]
  <!--l. 1245--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1247--><p class="noindent" >See <a 
href="#x1-3820006">5.2.6<!--tex4ht:ref: sec:Device Types / Block Device / Device Operation --></a>, <a 
href="#x1-7480007">5.18.6.7<!--tex4ht:ref: sec:Device Types / GPIO Device / requestq Operation / Message Flow --></a>, <a 
href="#x1-7510007">5.18.7<!--tex4ht:ref: sec:Device Types / GPIO Device / eventq Operation --></a>, <a 
href="#x1-7140001">5.16.6.1<!--tex4ht:ref: sec:Device Types / I2C Adapter Device / Device Operation: Request Queue --></a>, <a 
href="#x1-4510001">5.6.6.1<!--tex4ht:ref: sec:Device Types / SCSI Host Device / Device Operation / Device Operation: Request Queues --></a>, and <a 
href="#x1-5540004">5.10.6.4<!--tex4ht:ref: sec:Device Types / Socket Device / Device Operation / Receive and Transmit --></a>.  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-58-"><td  style="white-space:normal; text-align:left;" id="TBL-93-58-1"  
class="td11">
 <!--l. 1255--><p class="noindent" >aadefe688680</td><td  style="white-space:normal; text-align:left;" id="TBL-93-58-2"  
class="td11">
 <!--l. 1255--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-58-3"  
class="td11">
 <!--l. 1255--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-58-4"  
class="td11">
 <!--l. 1255--><p class="noindent" >virtio: document forward compatibility guarantees
  <!--l. 1258--><p class="noindent" >Feature   negotiation   forms   the   basis   of   forward
  compatibility guarantees of virtio but has never been
  properly documented. Do it now.
  <!--l. 1263--><p class="noindent" >Suggested-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1265--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1267--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1269--><p class="noindent" >Reviewed-by: Zhu Lingshan <lingshan.zhu@intel.com>
  <!--l. 1271--><p class="noindent" >See <a 
href="#x1-140002">2.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-59-"><td  style="white-space:normal; text-align:left;" id="TBL-93-59-1"  
class="td11">
 <!--l. 1274--><p class="noindent" >f3ce853c8a91</td><td  style="white-space:normal; text-align:left;" id="TBL-93-59-2"  
class="td11">
 <!--l. 1274--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-59-3"  
class="td11">
 <!--l. 1274--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-59-4"  
class="td11">
 <!--l. 1274--><p class="noindent" >admin: introduce device group and related concepts
  <!--l. 1277--><p class="noindent" >Each device group has a type. For now, define one initial
  group type:
  <!--l. 1279--><p class="noindent" >SR-IOV type - PCI SR-IOV virtual functions (VFs) of
  a given PCI SR-IOV physical function (PF). This group
  may contain zero or more virtio devices according to
  NumVFs configured.
  <!--l. 1283--><p class="noindent" >Each device within a group has a unique identifier. This
  identifier is the group member identifier.
  <!--l. 1286--><p class="noindent" >Note:  one  can  argue  both  ways  whether  the  new
  device group handling functionality (this and following
  patches) is closer to a new device type or a new transport
  type.
  <!--l. 1290--><p class="noindent" >However, it’s expected that we will add more features
  in the near future. To facilitate this as much as possible
  of the text is located in the new admin chapter.
  <!--l. 1294--><p class="noindent" >Effort was made to minimize transport-specific text.
  <!--l. 1296--><p class="noindent" >There’s a bit of duplication with 0x1 repeated twice and
  no special section for group type identifiers. It seems ok
  to defer adding these until we have more group types.
  <!--l. 1302--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1304--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1306--><p class="noindent" >See <a 
href="#x1-10600012">2.12<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups --></a>.                                                               </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-60-"><td  style="white-space:normal; text-align:left;" id="TBL-93-60-1"  
class="td11">
 <!--l. 1309--><p class="noindent" >2cbaaa19b15a </td><td  style="white-space:normal; text-align:left;" id="TBL-93-60-2"  
class="td11">
 <!--l. 1309--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-60-3"  
class="td11">
 <!--l. 1309--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-60-4"  
class="td11">
 <!--l. 1309--><p class="noindent" >admin: introduce group administration commands
  <!--l. 1312--><p class="noindent" >This
  introduces a general structure for group administration
  commands, used to control device groups through their
  owner.
  <!--l. 1315--><p class="noindent" >Following patches will introduce specific commands and
  an  interface  for  submitting  these  commands  to  the
  owner.
  <!--l. 1318--><p class="noindent" >Note  that  the  commands  are  focused  on  controlling
  device groups: this is why group related fields are in the
  generic part of the structure. Without this the admin
  vq would become a "whatever" vq which does not do
  anything  specific  at  all,  just  a  general  transport  like
  thing. I feel going this way opens the design space to
  the point where we no longer know what belongs in e.g.
  config space what in the control q and what in the admin
  q. As it is, whatever deals with groups is in the admin
  q; other things not in the admin q.
  <!--l. 1329--><p class="noindent" >There are specific exceptions such as query but that’s
  an exception that proves the rule ;)
  <!--l. 1333--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1335--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1337--><p class="noindent" >Reviewed-by: Zhu Lingshan <lingshan.zhu@intel.com>
  <!--l. 1339--><p class="noindent" >See <a 
href="#x1-1070001">2.12.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands --></a>, and <a 
href="#x1-30001">1.1<!--tex4ht:ref: sec:Normative References --></a>.                                                 </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-61-"><td  style="white-space:normal; text-align:left;" id="TBL-93-61-1"  
class="td11">
 <!--l. 1343--><p class="noindent" >5f1a8ac61c15</td><td  style="white-space:normal; text-align:left;" id="TBL-93-61-2"  
class="td11">
 <!--l. 1343--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-61-3"  
class="td11">
 <!--l. 1343--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-61-4"  
class="td11">
 <!--l. 1343--><p class="noindent" >admin: introduce virtio admin virtqueues
  <!--l. 1346--><p class="noindent" >The admin virtqueues will be the first interface used to
  issue admin commands.
  <!--l. 1348--><p class="noindent" >Currently   the   virtio   specification   defines   control
  virtqueue to manipulate features and configuration of
  the  device  it  operates  on:  virtio-net,  virtio-scsi,  etc
  all have existing control virtqueues. However, control
  virtqueue  commands  are  device  type  specific,  which
  makes  it  very  difficult  to  extend  for  device  agnostic
  commands.
  <!--l. 1354--><p class="noindent" >Keeping the device-specific virtqueue separate from the
  admin  virtqueue  is  simpler  and  has  fewer  potential
  problems. I don’t think creating common infrastructure
  for device-specific control virtqueues across device types
  worthwhile or within the scope of this patch series.
  <!--l. 1359--><p class="noindent" >To support this requirement in a more generic way, this
  patch introduces a new admin virtqueue interface. The
  admin virtqueue can be seen as the virtqueue analog
  to  a  transport.  The  admin  queue  thus  does  nothing
  device type-specific (net, scsi, etc) and instead focuses
  on transporting the admin commands.
  <!--l. 1365--><p class="noindent" >We also support more than one admin virtqueue, for
  QoS and scalability requirements.
  <!--l. 1369--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1371--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1373--><p class="noindent" >See <a 
href="#x1-14200013">2.13<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Administration Virtqueues --></a>, <a 
href="#x1-140002">2.2<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Feature Bits --></a>, and <a 
href="#x1-7970006">6<!--tex4ht:ref: sec:Reserved Feature Bits --></a>.                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-62-"><td  style="white-space:normal; text-align:left;" id="TBL-93-62-1"  
class="td11">
 <!--l. 1378--><p class="noindent" >677aeaebf6a7</td><td  style="white-space:normal; text-align:left;" id="TBL-93-62-2"  
class="td11">
 <!--l. 1378--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-62-3"  
class="td11">
 <!--l. 1378--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-62-4"  
class="td11">
 <!--l. 1378--><p class="noindent" >pci: add admin vq registers to virtio over pci
  <!--l. 1381--><p class="noindent" >Add  new  registers  to  the  PCI  common  configuration
  structure.
  <!--l. 1383--><p class="noindent" >These registers will be used for querying the indices of
  the admin virtqueues of the owner device. To configure,
  reset or enable the admin virtqueues, the driver should
  follow existing queue configuration/setup sequence.
  <!--l. 1388--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1390--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1392--><p class="noindent" >Reviewed-by: Zhu Lingshan <lingshan.zhu@intel.com>
  <!--l. 1394--><p class="noindent" >See <a 
href="#x1-7970006">6<!--tex4ht:ref: sec:Reserved Feature Bits --></a>, and <a 
href="#x1-1750003">4.1.4.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>.                                                  </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-63-"><td  style="white-space:normal; text-align:left;" id="TBL-93-63-1"  
class="td11">
 <!--l. 1398--><p class="noindent" >a9a59f70be46 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-63-2"  
class="td11">
 <!--l. 1398--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-63-3"  
class="td11">
 <!--l. 1398--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-63-4"  
class="td11">
 <!--l. 1398--><p class="noindent" >mmio: document ADMIN_VQ as reserved
  <!--l. 1401--><p class="noindent" >Adding relevant registers needs more work and it’s not
  clear what the use-case will be as currently only the PCI
  transport is supported. But let’s keep the door open on
  this. We already say it’s reserved in a central place, but
  it does not hurt to remind implementers to mask it.
  <!--l. 1409--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1411--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1413--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1415--><p class="noindent" >See <a 
href="#x1-2260005">4.2.5<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Features reserved for future use --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-64-"><td  style="white-space:normal; text-align:left;" id="TBL-93-64-1"  
class="td11">
 <!--l. 1418--><p class="noindent" >325046c1460e </td><td  style="white-space:normal; text-align:left;" id="TBL-93-64-2"  
class="td11">
 <!--l. 1418--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-64-3"  
class="td11">
 <!--l. 1418--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-64-4"  
class="td11">
 <!--l. 1418--><p class="noindent" >ccw: document ADMIN_VQ as reserved
  <!--l. 1421--><p class="noindent" >Adding relevant registers needs more work and it’s not
  clear what the use-case will be as currently only the PCI
  transport is supported. But let’s keep the door open on
  this. We already say it’s reserved in a central place, but
  it does not hurt to remind implementers to mask it.
  <!--l. 1428--><p class="noindent" >Note: there are more features to add to this list. Will be
  done later with a patch on top.
  <!--l. 1432--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1434--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1436--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1438--><p class="noindent" >Reviewed-by: Zhu Lingshan <lingshan.zhu@intel.com>
  <!--l. 1440--><p class="noindent" >See <a 
href="#x1-2650004">4.3.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Features reserved for future use --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-65-"><td  style="white-space:normal; text-align:left;" id="TBL-93-65-1"  
class="td11">
 <!--l. 1443--><p class="noindent" >3dc7196cba2d </td><td  style="white-space:normal; text-align:left;" id="TBL-93-65-2"  
class="td11">
 <!--l. 1443--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-65-3"  
class="td11">
 <!--l. 1443--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-65-4"  
class="td11">
 <!--l. 1443--><p class="noindent" >admin: command list discovery
  <!--l. 1446--><p class="noindent" >Add commands to find out which commands does each
  group support, as well as enable their use by driver. This
  will be especially useful once we have multiple group
  types.
  <!--l. 1450--><p class="noindent" >An alternative is per-type VQs. This is possible but will
  require more per-transport work. Discovery through the
  vq helps keep things contained.
  <!--l. 1454--><p class="noindent" >e.g. lack of support for some command can switch to a
  legacy mode
  <!--l. 1456--><p class="noindent" >note  that  commands  are  expected  to  be  avolved  by
  adding  new  fields  to  command  specific  data  at  the
  tail,  so  we  generally  do  not  need  feature  bits  for
  compatibility.
  <!--l. 1461--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1463--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1465--><p class="noindent" >Reviewed-by: Zhu Lingshan <lingshan.zhu@intel.com>
  <!--l. 1467--><p class="noindent" >See <a 
href="#x1-1070001">2.12.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-66-"><td  style="white-space:normal; text-align:left;" id="TBL-93-66-1"  
class="td11">
 <!--l. 1470--><p class="noindent" >bf1d6b0d24ae </td><td  style="white-space:normal; text-align:left;" id="TBL-93-66-2"  
class="td11">
 <!--l. 1470--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-66-3"  
class="td11">
 <!--l. 1470--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-66-4"  
class="td11">
 <!--l. 1470--><p class="noindent" >admin: conformance clauses
  <!--l. 1473--><p class="noindent" >Add  conformance  clauses  for  admin  commands  and
  admin virtqueues.
  <!--l. 1476--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/171" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/171</a>
  <!--l. 1478--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1480--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1482--><p class="noindent" >See <a 
href="#x1-1070001">2.12.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands --></a>, <a 
href="#x1-14200013">2.13<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Administration Virtqueues --></a>, and <a 
href="#x1-1750003">4.1.4.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>.                                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-67-"><td  style="white-space:normal; text-align:left;" id="TBL-93-67-1"  
class="td11">
 <!--l. 1487--><p class="noindent" >b04be31f0bf0</td><td  style="white-space:normal; text-align:left;" id="TBL-93-67-2"  
class="td11">
 <!--l. 1487--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-67-3"  
class="td11">
 <!--l. 1487--><p class="noindent" >Michael
  S.
  Tsirkin   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-67-4"  
class="td11">
 <!--l. 1487--><p class="noindent" >ccw: document more reserved features
  <!--l. 1490--><p class="noindent" >vq reset and shared memory are unsupported, too.
  <!--l. 1493--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1495--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/160" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/160</a>
  <!--l. 1497--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1499--><p class="noindent" >Reviewed-by: Zhu Lingshan <lingshan.zhu@intel.com>
  <!--l. 1501--><p class="noindent" >See <a 
href="#x1-2650004">4.3.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Features reserved for future use --></a>.                                                              </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-68-"><td  style="white-space:normal; text-align:left;" id="TBL-93-68-1"  
class="td11">
 <!--l. 1504--><p class="noindent" >619f60ae4ccf </td><td  style="white-space:normal; text-align:left;" id="TBL-93-68-2"  
class="td11">
 <!--l. 1504--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-68-3"  
class="td11">
 <!--l. 1504--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-68-4"  
class="td11">
 <!--l. 1504--><p class="noindent" >admin: Fix reference and table formation
  <!--l. 1507--><p class="noindent" >This patch brings three fixes.
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
     1.  </dt><dd 
class="enumerate-enumitem">Opcode  table  has  3  columns,  only  two  were
        enumerated.  Due  to  this  pdf  generation  script
        stops. Fix it and also have resizeable description
        column as it needs wrap.
        </dd><dt class="enumerate-enumitem">
     2.  </dt><dd 
class="enumerate-enumitem">Status description column content needs to wrap.
        Without it pdf does not read good. Fix it by having
        resizeable description column.
        </dd><dt class="enumerate-enumitem">
     3.  </dt><dd 
class="enumerate-enumitem">Fix the broken link to the Device groups.
        </dd></dl>
  <!--l. 1523--><p class="noindent" >Fixes: 2cbaaa1 ("admin: introduce group administration
  commands")
  <!--l. 1525--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1527--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1529--><p class="noindent" >Reviewed-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1531--><p class="noindent" >See <a 
href="#x1-1070001">2.12.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-69-"><td  style="white-space:normal; text-align:left;" id="TBL-93-69-1"  
class="td11">
 <!--l. 1534--><p class="noindent" >c1cd68b97611 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-69-2"  
class="td11">
 <!--l. 1534--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-69-3"  
class="td11">
 <!--l. 1534--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-69-4"  
class="td11">
 <!--l. 1534--><p class="noindent" >transport-pci: Improve config msix vector description
  <!--l. 1537--><p class="noindent" >config_msix_vector is the register that holds the MSI-X
  vector number for receiving configuration change related
  interrupts.
  <!--l. 1540--><p class="noindent" >It is not "for MSI-X".
  <!--l. 1542--><p class="noindent" >Hence, replace the confusing text with appropriate one.
  <!--l. 1545--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/169" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/169</a>
  <!--l. 1547--><p class="noindent" >Reviewed-by:                   Max                   Gurtovoy
  <mgurtovoy@nvidia.com>
  <!--l. 1549--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1551--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1553--><p class="noindent" >See <a 
href="#x1-1750003">4.1.4.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-70-"><td  style="white-space:normal; text-align:left;" id="TBL-93-70-1"  
class="td11">
 <!--l. 1556--><p class="noindent" >0f433d62e81d </td><td  style="white-space:normal; text-align:left;" id="TBL-93-70-2"  
class="td11">
 <!--l. 1556--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-70-3"  
class="td11">
 <!--l. 1556--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-70-4"  
class="td11">
 <!--l. 1556--><p class="noindent" >transport-pci: Improve queue msix vector register desc
  <!--l. 1559--><p class="noindent" >queue_msix_vector  register  is  for  receiving  virtqueue
  notification interrupts from the device for the virtqueue.
  <!--l. 1562--><p class="noindent" >"for MSI-X" is confusing term.
  <!--l. 1564--><p class="noindent" >Also it is the register that driver "writes" to, similar to
  many other registers such as queue_desc, queue_driver
  etc.
  <!--l. 1567--><p class="noindent" >Hence, replace the verb from use to write.
  <!--l. 1570--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/169" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/169</a>
  <!--l. 1572--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1574--><p class="noindent" >Reviewed-by:                   Max                   Gurtovoy
  <mgurtovoy@nvidia.com>
  <!--l. 1576--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1578--><p class="noindent" >See <a 
href="#x1-1750003">4.1.4.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-71-"><td  style="white-space:normal; text-align:left;" id="TBL-93-71-1"  
class="td11">
 <!--l. 1581--><p class="noindent" >b0fbccd4062f</td><td  style="white-space:normal; text-align:left;" id="TBL-93-71-2"  
class="td11">
 <!--l. 1581--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-71-3"  
class="td11">
 <!--l. 1581--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-71-4"  
class="td11">
 <!--l. 1581--><p class="noindent" >content: Add vq index text
  <!--l. 1584--><p class="noindent" >Introduce vq index and its range so that subsequent
  patches can refer to it.
  <!--l. 1588--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1590--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1592--><p class="noindent" >Reviewed-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1594--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1596--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1598--><p class="noindent" >See <a 
href="#x1-270006">2.6<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Virtqueues --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-72-"><td  style="white-space:normal; text-align:left;" id="TBL-93-72-1"  
class="td11">
 <!--l. 1601--><p class="noindent" >362f1cac2516</td><td  style="white-space:normal; text-align:left;" id="TBL-93-72-2"  
class="td11">
 <!--l. 1601--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-72-3"  
class="td11">
 <!--l. 1601--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-72-4"  
class="td11">
 <!--l. 1601--><p class="noindent" >content.tex Replace virtqueue number with index
  <!--l. 1604--><p class="noindent" >Replace virtqueue number with index to align to rest of
  the specification.
  <!--l. 1608--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1610--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1612--><p class="noindent" >Reviewed-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1614--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1616--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1618--><p class="noindent" >See <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-73-"><td  style="white-space:normal; text-align:left;" id="TBL-93-73-1"  
class="td11">
 <!--l. 1621--><p class="noindent" >cc4a5604b259 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-73-2"  
class="td11">
 <!--l. 1621--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-73-3"  
class="td11">
 <!--l. 1621--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-73-4"  
class="td11">
 <!--l. 1621--><p class="noindent" >content: Rename confusing queue_notify_data and vqn
  names
  <!--l. 1624--><p class="noindent" >Currently                                    queue_notify_data
  register indicates the device internal queue notification
  content. This register is meaningful only when feature
  bit VIRTIO_F_NOTIF_CONFIG_DATA is negotiated.
  <!--l. 1629--><p class="noindent" >However,                      above                      register
  name often get confusing association with very similar
  feature bit VIRTIO_F_NOTIFICATION_DATA.
  <!--l. 1632--><p class="noindent" >When VIRTIO_F_NOTIFICATION_DATA feature bit
  is   negotiated,   notification   really   involves   sending
  additional  queue  progress  related  information  (not
  queue identifier or index).
  <!--l. 1636--><p class="noindent" >Hence
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
     1.  </dt><dd 
class="enumerate-enumitem">to avoid any misunderstanding and association of
        queue_notify_data       with       similar       name
        VIRTIO_F_NOTIFICATION_DATA,
        <!--l. 1643--><p class="noindent" >and
        </dd><dt class="enumerate-enumitem">
     2.  </dt><dd 
class="enumerate-enumitem">to
        reflect that queue_notify_data is the actual device
        internal virtqueue identifier/index/data/cookie,
        </dd></dl>
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
     a.  </dt><dd 
class="enumerate-enumitem">rename               queue_notify_data               to
        queue_notif_config_data.
        </dd><dt class="enumerate-enumitem">
    b.  </dt><dd 
class="enumerate-enumitem">rename ambiguous vqn to a union of vq_index and
        vq_config_data
        </dd><dt class="enumerate-enumitem">
     c.  </dt><dd 
class="enumerate-enumitem">The   driver   notification   section   assumes   that
        queue   notification   contains   vq   index   always.
        CONFIG_DATA  feature  bit  introduction  missed
        to update the driver notification section. Hence,
        correct it.
        </dd></dl>
  <!--l. 1663--><p class="noindent" >Fixes:     <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1665--><p class="noindent" >Acked-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1667--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1669--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1671--><p class="noindent" >Reviewed-by: David Edmondson <david.edmondson@oracle.com>
  <!--l. 1673--><p class="noindent" >See <a 
href="#x1-1010009">2.9<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Driver notifications --></a>, <a 
href="#x1-1750003">4.1.4.3<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI Device Layout / Common configuration structure layout --></a>, and <a 
href="#x1-2050002">4.1.5.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Available Buffer Notifications --></a>.                                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-74-"><td  style="white-space:normal; text-align:left;" id="TBL-93-74-1"  
class="td11">
 <!--l. 1678--><p class="noindent" >fbb119dad56d </td><td  style="white-space:normal; text-align:left;" id="TBL-93-74-2"  
class="td11">
 <!--l. 1678--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-74-3"  
class="td11">
 <!--l. 1678--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-74-4"  
class="td11">
 <!--l. 1678--><p class="noindent" >transport-pci: Avoid first vq index reference
  <!--l. 1681--><p class="noindent" >Drop reference to first virtqueue as it is already covered
  now by the generic section in first patch.
  <!--l. 1685--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1687--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1689--><p class="noindent" >Acked-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1691--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1693--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1695--><p class="noindent" >See <a 
href="#x1-1970001">4.1.5.1<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over PCI Bus / PCI-specific Initialization And Device Operation / Device Initialization --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-75-"><td  style="white-space:normal; text-align:left;" id="TBL-93-75-1"  
class="td11">
 <!--l. 1698--><p class="noindent" >a7a21e451987 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-75-2"  
class="td11">
 <!--l. 1698--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-75-3"  
class="td11">
 <!--l. 1698--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-75-4"  
class="td11">
 <!--l. 1698--><p class="noindent" >transport-mmio: Rename QueueNum register
  <!--l. 1701--><p class="noindent" >These are further named differently between pci and
  mmio transport. PCI transport indicates queue size as
  queue_size.
  <!--l. 1704--><p class="noindent" >To bring consistency between pci and mmio transport,
  rename the QueueNumMax and QueueNum registers to
  QueueSizeMax and QueueSize respectively.
  <!--l. 1709--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1711--><p class="noindent" >Reviewed-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1713--><p class="noindent" >Reviewed-by: Jiri Pirko <jiri@nvidia.com>
  <!--l. 1715--><p class="noindent" >Reviewed-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1717--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1719--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1721--><p class="noindent" >See <a 
href="#x1-2150002">4.2.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a>, and <a 
href="#x1-2250004">4.2.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Legacy interface --></a>.                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-76-"><td  style="white-space:normal; text-align:left;" id="TBL-93-76-1"  
class="td11">
 <!--l. 1725--><p class="noindent" >9ddc59553984 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-76-2"  
class="td11">
 <!--l. 1725--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-76-3"  
class="td11">
 <!--l. 1725--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-76-4"  
class="td11">
 <!--l. 1725--><p class="noindent" >transport-mmio: Avoid referring to zero based index
  <!--l. 1728--><p class="noindent" >VQ range is already described in the first patch in basic
  virtqueue section. Hence remove the duplicate reference
  to it.
  <!--l. 1732--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1734--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1736--><p class="noindent" >Acked-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1738--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1740--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1742--><p class="noindent" >See <a 
href="#x1-2150002">4.2.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a>, and <a 
href="#x1-2250004">4.2.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Legacy interface --></a>.                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-77-"><td  style="white-space:normal; text-align:left;" id="TBL-93-77-1"  
class="td11">
 <!--l. 1746--><p class="noindent" >e7a764f66598</td><td  style="white-space:normal; text-align:left;" id="TBL-93-77-2"  
class="td11">
 <!--l. 1746--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-77-3"  
class="td11">
 <!--l. 1746--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-77-4"  
class="td11">
 <!--l. 1746--><p class="noindent" >transport-ccw:  Rename  queue  depth/size  to  other
  transports
  <!--l. 1749--><p class="noindent" >max_num field reflects the maximum queue size/depth.
  Hence  align  name  of  this  field  with  similar  field  in
  PCI and MMIO transport to max_queue_size. Similarly
  rename ’num’ to ’size’.
  <!--l. 1755--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1757--><p class="noindent" >Reviewed-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1759--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1761--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1763--><p class="noindent" >See <a 
href="#x1-2380002">4.3.2.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Initialization / Configuring a Virtqueue --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-78-"><td  style="white-space:normal; text-align:left;" id="TBL-93-78-1"  
class="td11">
 <!--l. 1766--><p class="noindent" >c3092410ac51 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-78-2"  
class="td11">
 <!--l. 1766--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-78-3"  
class="td11">
 <!--l. 1766--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-78-4"  
class="td11">
 <!--l. 1766--><p class="noindent" >transport-ccw: Refer to the vq by its index
  <!--l. 1769--><p class="noindent" >Currently specification uses virtqueue index and number
  interchangeably to refer to the virtqueue.
  <!--l. 1772--><p class="noindent" >Instead refer to it by its index.
  <!--l. 1775--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1777--><p class="noindent" >Reviewed-by: Halil Pasic <pasic@linux.ibm.com>
  <!--l. 1779--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1781--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1783--><p class="noindent" >See <a 
href="#x1-2590002">4.3.3.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio over channel I/O / Device Operation / Guest->Host Notification --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-79-"><td  style="white-space:normal; text-align:left;" id="TBL-93-79-1"  
class="td11">
 <!--l. 1786--><p class="noindent" >d6f310dbb3bf </td><td  style="white-space:normal; text-align:left;" id="TBL-93-79-2"  
class="td11">
 <!--l. 1786--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-79-3"  
class="td11">
 <!--l. 1786--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-79-4"  
class="td11">
 <!--l. 1786--><p class="noindent" >virtio-net: Avoid duplicate receive queue example
  <!--l. 1789--><p class="noindent" >Receive queue number/index example is duplicate which
  is already defined in the Setting RSS parameters section.
  <!--l. 1792--><p class="noindent" >Hence, avoid such duplicate example and prepare it for
  the subsequent patch to describe using receive queue
  handle.
  <!--l. 1796--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1798--><p class="noindent" >Reviewed-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1800--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1802--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1804--><p class="noindent" >See <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-80-"><td  style="white-space:normal; text-align:left;" id="TBL-93-80-1"  
class="td11">
 <!--l. 1807--><p class="noindent" >da0e16928d0b </td><td  style="white-space:normal; text-align:left;" id="TBL-93-80-2"  
class="td11">
 <!--l. 1807--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-80-3"  
class="td11">
 <!--l. 1807--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-80-4"  
class="td11">
 <!--l. 1807--><p class="noindent" >virtio-net: Describe RSS using rss rq id
  <!--l. 1810--><p class="noindent" >The                 content                 of                 the
  indirection table and unclassified_queue were originally
  described based on mathematical operations. In order
  to make it easier to understand and to avoid intermixing
  the array index with the vq index, introduce a structure
  rss_rq_id (RSS receive queue ID) and use it to describe
  the unclassified_queue and indirection_table fields.
  <!--l. 1818--><p class="noindent" >As  part  of  it,  have  the  example  that  uses  non-zero
  virtqueue  index  which  helps  to  have  better  mapping
  between receiveX object with virtqueue index and the
  actual value in the indirection table.
  <!--l. 1824--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1826--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1828--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1830--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1832--><p class="noindent" >See <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-81-"><td  style="white-space:normal; text-align:left;" id="TBL-93-81-1"  
class="td11">
 <!--l. 1835--><p class="noindent" >f9ff777fba59  </td><td  style="white-space:normal; text-align:left;" id="TBL-93-81-2"  
class="td11">
 <!--l. 1835--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-81-3"  
class="td11">
 <!--l. 1835--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-81-4"  
class="td11">
 <!--l. 1835--><p class="noindent" >virtio-net: Update vqn to vq_index for cvq cmds
  <!--l. 1838--><p class="noindent" >Replace field name vqn to vq_index for recent virtqueue
  level commands.
  <!--l. 1841--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/163" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/163</a>
  <!--l. 1843--><p class="noindent" >Reviewed-by:                David                Edmondson
  <david.edmondson@oracle.com>
  <!--l. 1845--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1847--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1849--><p class="noindent" >See <a 
href="#x1-3040005">5.1.8.5<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Control Virtqueue --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-82-"><td  style="white-space:normal; text-align:left;" id="TBL-93-82-1"  
class="td11">
 <!--l. 1852--><p class="noindent" >74460ef69d5f</td><td  style="white-space:normal; text-align:left;" id="TBL-93-82-2"  
class="td11">
 <!--l. 1852--><p class="noindent" >19
  May
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-82-3"  
class="td11">
 <!--l. 1852--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-82-4"  
class="td11">
 <!--l. 1852--><p class="noindent" >transport-mmio: Replace virtual queue with virtqueue
  <!--l. 1855--><p class="noindent" >Basic facilities define the virtqueue construct for device
  <-> driver communication.
  <!--l. 1858--><p class="noindent" >PCI transport and individual devices description also
  refers to it as virtqueue.
  <!--l. 1861--><p class="noindent" >MMIO refers to it as ’virtual queue’.
  <!--l. 1863--><p class="noindent" >Align MMIO transport description to call such object a
  virtqueue.
  <!--l. 1866--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/168" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/168</a>
  <!--l. 1868--><p class="noindent" >Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  <!--l. 1870--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1872--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  <!--l. 1874--><p class="noindent" >See <a 
href="#x1-2150002">4.2.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / MMIO Device Register Layout --></a>, <a 
href="#x1-2210002">4.2.3.2<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / MMIO-specific Initialization And Device Operation / Virtqueue Configuration --></a>, and <a 
href="#x1-2250004">4.2.4<!--tex4ht:ref: sec:Virtio Transport Options / Virtio Over MMIO / Legacy interface --></a>.                                      </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-83-"><td  style="white-space:normal; text-align:left;" id="TBL-93-83-1"  
class="td11">
 <!--l. 1879--><p class="noindent" >6724756eaf0a</td><td  style="white-space:normal; text-align:left;" id="TBL-93-83-2"  
class="td11">
 <!--l. 1879--><p class="noindent" >07
  Jul
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-83-3"  
class="td11">
 <!--l. 1879--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-83-4"  
class="td11">
 <!--l. 1879--><p class="noindent" >admin: Split opcode table rows with a line
  <!--l. 1882--><p class="noindent" >Currently  all  opcode  appears  to  be  in  a  single  row.
  Separate them with a line similar to other tables.
  <!--l. 1886--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1888--><p class="noindent" >Reviewed-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1890--><p class="noindent" >[CH: pushed as editorial update]
  <!--l. 1892--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1894--><p class="noindent" >See <a 
href="#x1-1070001">2.12.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-84-"><td  style="white-space:normal; text-align:left;" id="TBL-93-84-1"  
class="td11">
 <!--l. 1897--><p class="noindent" >1518c9ce2cde </td><td  style="white-space:normal; text-align:left;" id="TBL-93-84-2"  
class="td11">
 <!--l. 1897--><p class="noindent" >07
  Jul
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-84-3"  
class="td11">
 <!--l. 1897--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-84-4"  
class="td11">
 <!--l. 1897--><p class="noindent" >admin: Fix section numbering
  <!--l. 1900--><p class="noindent" >Requirements are put one additional level down. Fix it.
  <!--l. 1902--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
  <!--l. 1904--><p class="noindent" >Reviewed-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1906--><p class="noindent" >[CH: pushed as editorial update]
  <!--l. 1908--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1910--><p class="noindent" >See <a 
href="#x1-1070001">2.12.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands --></a>.                                                            </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-85-"><td  style="white-space:normal; text-align:left;" id="TBL-93-85-1"  
class="td11">
 <!--l. 1913--><p class="noindent" >9c3ba1ec6acb </td><td  style="white-space:normal; text-align:left;" id="TBL-93-85-2"  
class="td11">
 <!--l. 1913--><p class="noindent" >14
  Jul
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-85-3"  
class="td11">
 <!--l. 1913--><p class="noindent" >Heng
  Qi         </td><td  style="white-space:normal; text-align:left;" id="TBL-93-85-4"  
class="td11">
 <!--l. 1913--><p class="noindent" >virtio-net: support inner header hash
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
     1.  </dt><dd 
class="enumerate-enumitem">Currently, a received encapsulated packet has an
        outer and an inner header, but the virtio device is
        unable to calculate the hash for the inner header.
        The  same  flow  can  traverse  through  different
        tunnels, resulting in the encapsulated packets being
        spread across multiple receive queues (refer to the
        figure  below).  However,  in  certain  scenarios,  we
        may  need  to  direct  these  encapsulated  packets
        of the same flow to a single receive queue. This
        facilitates the processing of the flow by the same
        CPU to improve performance (warm caches, less
        locking, etc.).
        <!--l. 1925-->
        <pre class="lstlisting" id="listing-307"><span class="label"><a 
 id="x1-870011r1"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">client1</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">client2</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870012r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-------+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870013r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-------&gt;|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">tunnels</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|&lt;--------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870014r4"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870015r5"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870016r6"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">v</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">v</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870017r7"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----------------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870018r8"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">monitoring</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">host</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870019r9"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----------------+</span></span></pre>
       
     <!--l. 1937--><p class="noindent" >To achieve this, the device can calculate a symmetric
       hash based on the inner headers of the same flow.
       </dd><dt class="enumerate-enumitem">
   2.  </dt><dd 
class="enumerate-enumitem">For legacy systems, they may lack entropy fields
       which modern protocols have in the outer header,
       resulting in multiple flows with the same outer header
       but different inner headers being directed to the
       same receive queue. This results in poor receive
       performance.
       <!--l. 1945--><p class="noindent" >To address this limitation, inner header hash can be
       used to enable the device to advertise the capability to
       calculate the hash for the inner packet, regaining
       better receive performance.
       </dd></dl>
<!--l. 1951--><p class="noindent" >Fixes:     <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/173" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/173</a>
<!--l. 1953--><p class="noindent" >Signed-off-by: Heng Qi <hengqi@linux.alibaba.com>
<!--l. 1955--><p class="noindent" >Reviewed-by: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
<!--l. 1957--><p class="noindent" >Reviewed-by: Parav Pandit <parav@nvidia.com>
<!--l. 1959--><p class="noindent" >[CH: added missing lstlisting and hyperref escapes, fixed
references]
<!--l. 1961--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
<!--l. 1963--><p class="noindent" >See <a 
href="#x1-2700003">5.1.3<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits --></a>, <a 
href="#x1-2710001">5.1.3.1<!--tex4ht:ref: sec:Device Types / Network Device / Feature bits / Feature bit requirements --></a>, <a 
href="#x1-2730004">5.1.4<!--tex4ht:ref: sec:Device Types / Network Device / Device configuration layout --></a>, <a 
href="#x1-2890004">5.1.8.4<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets --></a>, <a 
href="#x1-2970004">5.1.8.4.4<!--tex4ht:ref: sec:Device Types / Network Device / Device Operation / Processing of Incoming Packets / Inner Header Hash --></a>, <a 
href="#x1-8310004">7.3.4<!--tex4ht:ref: sec:Conformance / Device Conformance / Network Device Conformance --></a>, <a 
href="#x1-8070004">7.2.4<!--tex4ht:ref: sec:Conformance / Driver Conformance / Network Driver Conformance --></a>,
and <a 
href="#x1-30001">1.1<!--tex4ht:ref: sec:Normative References --></a>.                                                                </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-86-"><td  style="white-space:normal; text-align:left;" id="TBL-93-86-1"  
class="td11">
 <!--l. 1973--><p class="noindent" >73c2fd96af96</td><td  style="white-space:normal; text-align:left;" id="TBL-93-86-2"  
class="td11">
 <!--l. 1973--><p class="noindent" >17
  Jul
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-86-3"  
class="td11">
 <!--l. 1973--><p class="noindent" >Haixu
  Cui       </td><td  style="white-space:normal; text-align:left;" id="TBL-93-86-4"  
class="td11">
 <!--l. 1973--><p class="noindent" >virtio-spi: define the DEVICE ID for virtio SPI master
  <!--l. 1976--><p class="noindent" >Define the DEVICE ID of virtio SPI master device as
  45.
  <!--l. 1979--><p class="noindent" >Fixes:
  <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/174" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/174</a>
  <!--l. 1981--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
  <!--l. 1983--><p class="noindent" >See <a 
href="#x1-2660005">5<!--tex4ht:ref: sec:Device Types --></a>.                                                                   </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-87-"><td  style="white-space:normal; text-align:left;" id="TBL-93-87-1"  
class="td11">
 <!--l. 1986--><p class="noindent" >03c2d32e5093 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-87-2"  
class="td11">
 <!--l. 1986--><p class="noindent" >21
  Jul
  2023 </td><td  style="white-space:normal; text-align:left;" id="TBL-93-87-3"  
class="td11">
 <!--l. 1986--><p class="noindent" >Parav
  Pandit   </td><td  style="white-space:normal; text-align:left;" id="TBL-93-87-4"  
class="td11">
 <!--l. 1986--><p class="noindent" >admin:  Add  group  member  legacy  register  access
  commands
  <!--l. 1989--><p class="noindent" >Introduce group member legacy common configuration
  and   legacy   device   configuration   access   read/write
  commands.
  <!--l. 1992--><p class="noindent" >Group member legacy registers access commands enable
  group owner driver software to access legacy registers
  on behalf of the guest virtual machine.
  <!--l. 1997--><p class="noindent" >Usecase:
  <!--l. 1999--><p class="noindent" >========
        <dl class="enumerate-enumitem"><dt class="enumerate-enumitem">
     1.  </dt><dd 
class="enumerate-enumitem">A hypervisor/system needs to provide transitional
        virtio  devices  to  the  guest  VM  at  scale  of
        thousands, typically, one to eight devices per VM.
        </dd><dt class="enumerate-enumitem">
     2.  </dt><dd 
class="enumerate-enumitem">A hypervisor/system needs to provide such devices
        using a vendor agnostic driver in the hypervisor
        system.
        </dd><dt class="enumerate-enumitem">
     3.  </dt><dd 
class="enumerate-enumitem">A hypervisor system prefers to have single stack
        regardless of virtio device type (net/blk) and be
        future  compatible  with  a  single  vfio  stack  using
        SR-IOV  or  other  scalable  device  virtualization
        technology to map PCI devices to the guest VM.
        (as transitional or otherwise)
        </dd></dl>
  <!--l. 2019--><p class="noindent" >Motivation/Background:
  <!--l. 2021--><p class="noindent" >=====================
  <!--l. 2023--><p class="noindent" >The existing virtio transitional PCI device is missing
  support for PCI SR-IOV based devices. Currently it does
  not work beyond PCI PF, or as software emulated device
  in reality. Currently it has below cited system level
  limitations:
  <!--l. 2028--><p class="noindent" >[a] PCIe spec citation: VFs do not support I/O Space and
  thus VF BARs shall not indicate I/O Space.
  <!--l. 2031--><p class="noindent" >[b] cpu arch citiation: Intel 64 and IA-32 Architectures
  Software Developer’s Manual: The processor’s I/O address
  space is separate and distinct from the physical-memory
  address space. The I/O address space consists of 64K
  individually addressable 8-bit I/O ports, numbered 0
  through FFFFH.
  <!--l. 2037--><p class="noindent" >[c] PCIe spec citation: If a bridge implements an I/O
  address range,...I/O address range will be aligned to a 4 KB
  boundary.
  <!--l. 2042--><p class="noindent" >Overview:
  <!--l. 2044--><p class="noindent" >=========
  <!--l. 2046--><p class="noindent" >Above usecase requirements is solved by PCI PF group
  owner accessing its group member PCI VFs legacy registers
  using the administration commands of the group owner
  PCI PF.
  <!--l. 2050--><p class="noindent" >Two types of administration commands are added which
  read/write PCI VF registers.
  <!--l. 2053--><p class="noindent" >Software usage example:
  <!--l. 2055--><p class="noindent" >=======================
  <!--l. 2058--><p class="noindent" >1. One way to use and map to the guest VM is by using
  vfio driver framework in Linux kernel.
  <!--l. 2061--><p class="noindent" >...                                                                        </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-88-"><td  style="white-space:normal; text-align:left;" id="TBL-93-88-1"  
class="td11">
 <!--l. 2064--><p class="noindent" >          </td><td  style="white-space:normal; text-align:left;" id="TBL-93-88-2"  
class="td11">
 <!--l. 2064--><p class="noindent" >    </td><td  style="white-space:normal; text-align:left;" id="TBL-93-88-3"  
class="td11">
 <!--l. 2064--><p class="noindent" >       </td><td  style="white-space:normal; text-align:left;" id="TBL-93-88-4"  
class="td11">
 <!--l. 2064--><p class="noindent" >...
  <!--l. 2067-->
  <pre class="lstlisting" id="listing-308"><span class="label"><a 
 id="x1-870024r1"></a></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870025r2"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+----------------------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870026r3"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pci_dev_id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x100X</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870027r4"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+---------------|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">pci_rev_id</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">0</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">x0</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|-----+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870028r5"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vfio</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BAR0</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">=</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">I</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">O</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">region</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870029r6"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Other</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">attributes</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870030r7"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+----------------------+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870031r8"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870032r9"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+--------------+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----------------+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870033r10"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">I</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">O</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">BAR</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">to</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AQ</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Other</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">vfio</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870034r11"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">rd</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">/</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">wr</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">mapper</span></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">' &amp;</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">functionalities</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870035r12"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">forwarder</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870036r13"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+--------------+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----------------+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870037r14"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870038r15"></a></span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+------+-------------------------+-----------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870039r16"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870040r17"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Config</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">region</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870041r18"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">access</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">Driver</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">notifications</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870042r19"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870043r20"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+----+------------+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+----+------------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870044r21"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">A</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870045r22"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">AQ</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|-------------+----&gt;+-------------+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870046r23"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">legacy</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">regs</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870047r24"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-------------+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870048r25"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----------------+</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----------------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870049r26"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870050r27"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+----+------------+</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870051r28"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">PCI</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">VF</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">device</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">N</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870052r29"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+----&gt;+-------------+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870053r30"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">legacy</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">regs</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870054r31"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-------------+</span></span><span style="color:#000000"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">|</span></span><span 
class="pcrr8t-x-x-80"> </span><br /> 
<span class="label"><a 
 id="x1-870055r32"></a></span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span 
class="pcrr8t-x-x-80"> </span><span style="color:#000000"><span 
class="pcrr8t-x-x-80">+-----------------+</span></span></pre>
 
<!--l. 2102--><p class="noindent" >2. Continue to use the virtio pci driver to bind to the listed
device id and use it as in the host.
<!--l. 2105--><p class="noindent" >3. Use it in a light weight hypervisor to run bare-metal
OS.
<!--l. 2108--><p class="noindent" >Fixes:     <a 
href="https://github.com/oasis-tcs/virtio-spec/issues/167" class="url" >https://github.com/oasis-tcs/virtio-spec/issues/167</a>
<!--l. 2110--><p class="noindent" >Signed-off-by: Parav Pandit <parav@nvidia.com>
<!--l. 2112--><p class="noindent" >Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
<!--l. 2114--><p class="noindent" >Signed-off-by: Cornelia Huck <cohuck@redhat.com>
<!--l. 2116--><p class="noindent" >See <a 
href="#x1-1080001">2.12.1.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands / Legacy Interface --></a>, <a 
href="#x1-1070001">2.12.1<!--tex4ht:ref: sec:Basic Facilities of a Virtio Device / Device groups / Group administration commands --></a>, and <a 
href="#x1-8020001">7.1<!--tex4ht:ref: sec:Conformance / Conformance Targets --></a>.                                     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-89-"><td  style="white-space:normal; text-align:left;" id="TBL-93-89-1"  
class="td11">
 <!--l. 14--><p class="noindent" >          </td><td  style="white-space:normal; text-align:left;" id="TBL-93-89-2"  
class="td11">
 <!--l. 14--><p class="noindent" >    </td><td  style="white-space:normal; text-align:left;" id="TBL-93-89-3"  
class="td11">
 <!--l. 15--><p class="noindent" >       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-93-90-"><td  style="white-space:normal; text-align:left;" id="TBL-93-90-1"  
class="td11">           </td>                                                   

                                                                  
</tr><tr  
 style="vertical-align:baseline;" id="TBL-93-91-"><td  style="white-space:normal; text-align:left;" id="TBL-93-91-1"  
class="td11">           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-93-92-"><td  style="white-space:normal; text-align:left;" id="TBL-93-92-1"  
class="td11">
 <!--l. 16--><p class="noindent" >          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-93-93-"><td  style="white-space:normal; text-align:left;" id="TBL-93-93-1"  
class="td11">
 <!--l. 16--><p class="noindent" >          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-93-94-"><td  style="white-space:normal; text-align:left;" id="TBL-93-94-1"  
class="td11">
 <!--l. 16--><p class="noindent" >          </td>
</tr>
</table></div>
                                                                  

                                                                  
                                                                  

                                                                  
<div class="footnotes"><!--l. 13--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn1x1-bk" id="fn1x1"><sup class="textsuperscript">1</sup></a></span><span 
class="aer-8">This lack of page-sharing implies that the implementation of the device (e.g. the hypervisor</span>
<span 
class="aer-8">or host) needs full access to the guest memory. Communication with untrusted parties (i.e.</span>
<span 
class="aer-8">inter-guest communication) requires copying.</span>
<!--l. 27--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn2x1-bk" id="fn2x1"><sup class="textsuperscript">2</sup></a></span><span 
class="aer-8">The Linux implementation further separates the virtio transport code from the specific</span>
<span 
class="aer-8">virtio drivers: these drivers are shared between different transports.</span>
<!--l. 343--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn3x2-bk" id="fn3x2"><sup class="textsuperscript">3</sup></a></span><span 
class="aer-8">For example, the simplest network device has one virtqueue for transmit and one for</span>
<span 
class="aer-8">receive.</span>
<!--l. 49--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn4x2-bk" id="fn4x2"><sup class="textsuperscript">4</sup></a></span><span 
class="aer-8">For example, if Queue Size is 4 then at most 4 buffers can be queued at any given</span>
<span 
class="aer-8">time.</span>
<!--l. 388--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn5x2-bk" id="fn5x2"><sup class="textsuperscript">5</sup></a></span><span 
class="aer-8">For example, if Queue Size is 4 then at most 4 buffers can be queued at any given</span>
<span 
class="aer-8">time.</span>
<!--l. 30--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn6x2-bk" id="fn6x2"><sup class="textsuperscript">6</sup></a></span><span 
class="aer-8">Even though some group types only support specific transports, group type identifiers are</span>
<span 
class="aer-8">global rather than transport-specific - a flood of new group types is not expected.</span>
<!--l. 80--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn7x2-bk" id="fn7x2"><sup class="textsuperscript">7</sup></a></span><span 
class="aer-8">The term "administration" is intended to be interpreted widely to include any kind of control.</span>
<span 
class="aer-8">See specific commands for detail.</span>
<!--l. 1040--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn8x4-bk" id="fn8x4"><sup class="textsuperscript">8</sup></a></span><span 
class="aer-8">For example, the simplest network device has two virtqueues.</span>
<!--l. 1071--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn9x4-bk" id="fn9x4"><sup class="textsuperscript">9</sup></a></span><span 
class="aer-8">The 4096 is based on the x86 page size, but it’s also large enough to ensure that the separate</span>
<span 
class="aer-8">parts of the virtqueue are on separate cache lines.</span>
<!--l. 542--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn10x5-bk" id="fn10x5"><sup class="textsuperscript">10</sup></a></span><span 
class="aer-8">Due to various bugs in implementations, this field is not useful as a guarantee of the</span>
<span 
class="aer-8">transport header size.</span>
<!--l. 554--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn11x5-bk" id="fn11x5"><sup class="textsuperscript">11</sup></a></span><span 
class="aer-8">This case is not handled by some older hardware, so is called out specifically in the</span>
<span 
class="aer-8">protocol.</span>
<!--l. 1331--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn12x5-bk" id="fn12x5"><sup class="textsuperscript">12</sup></a></span><span 
class="aer-8">Since there are no guarantees, it can use a hash filter or silently switch to allmulti or</span>
<span 
class="aer-8">promiscuous mode if it is given too many addresses.</span>
<!--l. 251--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn13x5-bk" id="fn13x5"><sup class="textsuperscript">13</sup></a></span><span 
class="aer-8">Consistent with </span><a 
href="#x1-3840002"><span 
class="aer-8">5.2.6.2</span><!--tex4ht:ref: devicenormative:Device Types / Block Device / Device Operation --></a><span 
class="aer-8">, a writethrough cache can be defined broadly as a cache that</span>
<span 
class="aer-8">commits writes to persistent device backend storage before reporting their completion. For</span>
<span 
class="aer-8">example, a battery-backed writeback cache actually counts as writethrough according to this</span>
<span 
class="aer-8">definition.</span>
<!--l. 1026--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn14x5-bk" id="fn14x5"><sup class="textsuperscript">14</sup></a></span><span 
class="aer-8">Note that in this case, according to </span><a 
href="#x1-3800002"><span 
class="aer-8">5.2.5.2</span><!--tex4ht:ref: devicenormative:Device Types / Block Device / Device Initialization --></a><span 
class="aer-8">, the device will not have offered</span>
<span 
class="aer-8">VIRTIO_BLK_F_CONFIG_WCE either.</span>
<!--l. 122--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn15x5-bk" id="fn15x5"><sup class="textsuperscript">15</sup></a></span><span 
class="aer-8">Because this is high importance and low bandwidth, the current Linux implementation</span>
<span 
class="aer-8">polls  for  the  buffer  to  become  used,  rather  than  waiting  for  a  used  buffer  notification,</span>
<span 
class="aer-8">simplifying  the  implementation  significantly.  However,  for  generic  serial  ports  with  the</span>
<span 
class="aer-8">O_NONBLOCK flag set, the polling limitation is relaxed and the consumed buffers are freed</span>
<span 
class="aer-8">upon the next write or poll call or when a port is closed or hot-unplugged.</span>
<!--l. 153--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn16x5-bk" id="fn16x5"><sup class="textsuperscript">16</sup></a></span><span 
class="aer-8">This is historical, and independent of the guest page size.</span>
<!--l. 169--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn17x5-bk" id="fn17x5"><sup class="textsuperscript">17</sup></a></span><span 
class="aer-8">In this case, deflation advice is merely a courtesy.</span>
<!--l. 140--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn18x5-bk" id="fn18x5"><sup class="textsuperscript">18</sup></a></span><span 
class="aer-8">For example, INQUIRY or REPORT LUNS.</span>
<!--l. 141--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn19x5-bk" id="fn19x5"><sup class="textsuperscript">19</sup></a></span><span 
class="aer-8">For example, I_T RESET.</span>
<!--l. 280--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn20x5-bk" id="fn20x5"><sup class="textsuperscript">20</sup></a></span><span 
class="aer-8">There is no separate residual size for </span><span 
class="aeti8-">pi_bytesout </span><span 
class="aer-8">and </span><span 
class="aeti8-">pi_bytesin</span><span 
class="aer-8">. It can be computed from the</span>
<span 
class="aeti8-">residual </span><span 
class="aer-8">field, the size of the data integrity information per sector, and the sizes of </span><span 
class="aeti8-">pi_out</span><span 
class="aer-8">, </span><span 
class="aeti8-">pi_in</span><span 
class="aer-8">,</span>
<span 
class="aeti8-">dataout </span><span 
class="aer-8">and </span><span 
class="aeti8-">datain</span><span 
class="aer-8">.</span>
<!--l. 59--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn21x5-bk" id="fn21x5"><sup class="textsuperscript">21</sup></a></span><span 
class="aer-8">Future  extensions  may  add  different  modes  of  operations.  At  the  moment,  only</span>
<span 
class="aer-8">VIRTIO_IOMMU_F_MAP_UNMAP is supported.</span>
<!--l. 883--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn22x5-bk" id="fn22x5"><sup class="textsuperscript">22</sup></a></span><span 
class="aer-8">This would happen for example if the device implements a more recent version of this</span>
<span 
class="aer-8">specification, whose fault report contains additional fields.</span>
<!--l. 41--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn23x5-bk" id="fn23x5"><sup class="textsuperscript">23</sup></a></span><span 
class="aer-8">For example, s390x provides storage keys for each 4 KiB page and may, depending on the</span>
<span 
class="aer-8">configuration, provide storage attributes for each 4 KiB page.</span>
<!--l. 62--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn24x5-bk" id="fn24x5"><sup class="textsuperscript">24</sup></a></span><span 
class="aer-8">On platforms with memory properties that might get modified implicitly on memory</span>
<span 
class="aer-8">access, this feature is expected to be offered by the device.</span>
<!--l. 290--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn25x5-bk" id="fn25x5"><sup class="textsuperscript">25</sup></a></span><span 
class="aer-8">To allow for simplified dumping of memory. The CPU is expected to copy such memory to</span>
<span 
class="aer-8">another location before starting DMA.</span>
<!--l. 61--><p class="noindent" ><span class="footnote-mark"><a 
href="#fn26x9-bk" id="fn26x9"><sup class="textsuperscript">26</sup></a></span><span 
class="aer-8">Even if it does mean documenting design or implementation mistakes!</span>             </div>
                                                                  

                                                                  
 
</body></html> 

                                                                  


